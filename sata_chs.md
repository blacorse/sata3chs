
##### 在附件处进行高速小型化。
序号 ATA国际组织
串行ATA修订版3.0-黄金版 **串行ATA国际组织:** **串行ATA修订版3.**。
#### 27-May- 
#### Gold Revision 
## [SATA-IO董事会成员。
## 戴尔电脑公司 
## 惠普公司 
## ＃＃日立全球存储技术，公司。

## 英特尔公司 
## Maxim Integrated Products 
## ＃＃希捷技术 
## 西部数字公司  
串行ATA国际组织。串行ATA修订版3.0规范（"最终规范"）可在http://www.sata-io.org 下载。
规格说明免责声明
本说明书以 "原样 "提供给您，不作任何保证。
任何情况下，包括任何适销性、非适销性的保证。
侵权行为，或对任何特定目的的适用性。本文件的作者
规格书对所有的责任，包括对违反以下规定的责任作出声明。
任何与使用或隐瞒信息有关的专有权利
在本说明书中。作者并不保证或代表这些。
使用不会侵犯这些权利。本规格的规定适用于
您不向您提供任何明示或默示的许可，通过以下方式
终止或以其他方式，对任何知识产权。
Copyright 2002-2009, Serial ATA International Organization. 保留所有权利。
有关Serial ATA的更多信息，请参阅Serial ATA国际组织网站http://www.sata-io.org。
所有产品名称均为其各自所有者的商标、注册商标或服务商标。
串行ATA国际组织的联系信息。
SATA-IO 3855 SW 153号驱动器
Beaverton, Oregon 97006 USA.
电话：+1 503-619-
传真：+1 503-644-
电子邮件：admin@sata-io.org 
## 目录                  
- 1 修订历史....................................................................................................................
   - 1.1 第2.5次修订(批准日期2005年10月27日) - 1.2 第2.6次修订(批准日期2007年2月15日) - 1.3 第3.0次修订(候选版本2：2009年5月15日)
- 2 范围....................................................................................................................................
- 3 规范性参考文献...........................................................................................................
   - 3.1 已批准的参考文献 - 3.2 正在编写的参考文献 - 3.3 其他参考文献............................................................................................................。
- 4 定义、缩略语和惯例.........................................................................
   - 4.1 定义和缩写 - 4.1.1 有源端口 - 4.1.2 ATA (AT Attachment).............................................................................................
      - 4.1.3 ATAPI (AT Attachment Packet Interface) 设备 - 4.1.4 BER (bit error rate) - 4.1.5 bitrate - 4.1.6 bit synchronization - 4.1.7 burst - 4.1.8 byte - 4.1.9 character - 4.1.10 character alignment - 4.1.11 character slipping...................................................................................................。
      - 4.1.12 ClickConnect..........................................................................................................
      - 4.1.13 CLTF（闭环传输函数）.................................................................。
      - 4.1.14 违反代码 - 4.1.15 逗号字符 - 4.1.16 逗号序列 - 4.1.17 命令中止 - 4.1.18 命令完成.............................................................................................。
      - 4.1.19 命令包 - 4.1.20 集中器 - 4.1.21 控制块寄存器...........................................................................................。
      - 4.1.22 控制字符 - 4.1.23 控制端口 - 4.1.24 控制变量 - 4.1.25 CRC（循环冗余检查） - 4.1.26 数据字符 - 4.1.27 数据信号源..................................................................................................。
      - 4.1.28 设备.....................................................................................................................
      - 4.1.29 设备端口 - 4.1.30 DCB (DC block) - 4.1.31 差分信号 - 4.1.32 DJ (确定性抖动 - 峰值到峰值) - 4.1.33 DMA (直接内存访问) - 4.1.34 Dword.....................................................................................................................。
      - 4.1.35 Dword同步 - 4.1.36 EMI（电磁干扰） - 4.1.37 编码字符 - 4.1.38 端点设备......................................................................................................。

      - 4.1.39 弹性缓冲器 - 4.1.40 eSATA....................................................................................................................
      - 4.1.41 Fbaud.....................................................................................................................
      - 4.1.42 FER (帧错误率)
- 4.1.43 第一方DMA数据阶段..................................................................................。
- 4.1.44 第一方DMA访问权限
- 4.1.45 FIS（Frame Information Structure）.........................................................................
- 4.1.46 frame......................................................................................................................
- 4.1.47 Gen1
- 4.1.48 Gen1i
- 4.1.49 Gen1m
- 4.1.50 Gen1x
- 4.1.51 Gen2
- 4.1.52 Gen2i
- 4.1.53 Gen2m
- 4.1.54 Gen2x
- 4.1.55 Gen3
- 4.1.56 Gen3i
- 4.1.57 HBA（主机总线适配器）........................................................................................。
- 4.1.58 HBWS (High Bandwidth Scope)
- 4.1.59 HFTP(高频测试模式)
- 4.1.60 热塞
- 4.1.61 主机端口
- 4.1.62 非活动端口
- 4.1.63 中断等待
- 4.1.64 即时NCQ命令
- 4.1.65 ISI（符号间干扰）。
- 4.1.66 JMD(抖动测量装置)
- 4.1.67 JTF（抖动传输功能）。
- 4.1.68 垃圾
- 4.1.69 LBA(逻辑块地址)
- 4.1.70 LBP(Lone Bit Pattern)...........................................................................................。
- 4.1.71 LED(发光二极管)
- 4.1.72 遗留模式
- 4.1.73 法律性质
- 4.1.74 LFSR（线性反馈移位寄存器）.................................................................。
- 4.1.75 LFTP(低频测试模式)
- 4.1.76 LL(实验室负荷)................................................................................................
- 4.1.77 LSS（实验室来源信号或实验室来源信号） ..........................................
- 4.1.78 MFTP(中频测试模式)
- 4.1.79 NCQ流媒体命令
- 4.1.80 NCQ 非流式命令。
- 4.1.81 OOB(带外信令)
- 4.1.82 OS-aware热插件.................................................................................................
- 4.1.83 OS-aware hot removal...........................................................................................
- 4.1.84 Phy脱机
- 4.1.85 PIO(程序输入/输出)
- 4.1.86 端口地址
- 4.1.87 PRD(物理区域描述符)
- 4.1.88 基元..................................................................................................................
- 4.1.89 基于协议的端口选择
- 4.1.90 静态电源条件
- 4.1.91 RJ(随机抖动)
- 4.1.92部门
- 4.1.93 SEMB(串行ATA机箱管理桥)
- 4.1.94 SEP(存储外壳处理器)
- 4.1.95 影子寄存器块寄存器...........................................................................
- 4.1.96 侧带端口选择.........................................................................................
- 4.1.97 SMART
- 4.1.98 SSC(扩频时钟)--4.1.99 突发热插拔--4.1.100 突发热移除--4.1.101 SYNC Escape--4.1.102 TDR(时域反射计)--4.1.103 TIA(定时间隔分析仪)--4.1.104 TJ(总抖动)--4.1.105 UI(单位间隔)--4. 1.106 不可恢复的错误 - 4.1.107 UUT（被测单元） - 4.1.108 VNA（矢量网络分析仪） - 4.1.109 温插 - 4.1.110 字 - 4.1.111 xSATA....................................................................................................................。
      - 4.1.112 零交叉 - 4.2 公约 - 4.2.1 优先级............................................................................................................。
      - 4.2.2 关键词 - 4.2.3 编号 - 4.2.4 尺寸 - 4.2.5 信号约定.................................................................................................。
      - 4.2.6 状态机约定 - 4.2.7 字节、字和D字关系.....................................................................。
- 5 总体概述 ..................................................................................................................
   - 5.1 架构....................................................................................................................
   - 5.2 使用模式 - 5.2.1 内部1米长电缆主机到设备.................................................................。
      - 5.2.2 短背板到设备 - 5.2.3 长背板到设备 - 5.2.4 内部 4 线缆磁盘阵列 - 5.2.5 系统到系统的互连 - 数据中心应用 (xSATA) - 5.2.6 系统到系统的互连 - 外部桌面应用 (eSATA)........。

      - 5.2.7 专有的串行ATA磁盘阵列 - 5.2.8 串行ATA和SAS - 5.2.9 潜在的外部SATA不兼容问题.....................................................。
      - 5.2.10 移动应用 - 5.2.11 端口乘法器应用实例
- 6 电缆和连接器 ........................................................................................................
   - 6.1 内部电缆和连接器......................................................................................
      - 6.1.1 内部单通道说明............................................................................
      - 6.1.2 连接器位置 - 6.1.3 配套接口 - 6.1.4 信号线插座连接器.........................................................................
      - 6.1.5 信号主机插头连接器 - 6.1.6 背板连接器 - 6.1.7 电源线插座连接器 - 6.1.8 内部单通道电缆 - 6.1.9 连接器标签 - 6.1.10 连接器和电缆装配要求和测试程序 - 6.1.11 内部多通道电缆 - 6.1.12 Mini SATA 内部多通道 - 6.2 用于 1.8" HDD 的内部 Micro SATA 连接器 - 6.2.1 使用型号........................................................................................................。
      - 6.2.2 一般说明..............................................................................................
      - 6.2.3 连接器位置 - 6.2.4 配套接口 - 6.3 内部纤细电缆和连接器 - 6.3.1 使用型号 - 6.3.2 一般说明..............................................................................................。
      - 6.3.3 连接器位置和禁区 - 6.3.4 配套接口 - 6.3.5 背板连接器配置和盲配公差..........................。
      - 6.3.6 连接器标签 - 6.3.7 连接器和电缆装配要求和测试程序 - 6.4 1.1 1.8" HDD内部LIF-SATA连接器 - 6.4.1 一般说明..............................................................................................。
      - 6.4.2 连接器位置............................................................................................
      - 6.4.3 配套接口--同时带有信号段和电源段的连接器。图87定义了内部LIF-SATA嵌入式-安装型连接器的接口尺寸。图88定义了内部LIF-SATA设备表面的接口尺寸--6.4.4内部LIF-SATA引脚信号定义和触点配合顺序...............。
      - 6.4.5 外壳和触点电气要求 - 6.5 外部电缆和连接器 - 6.5.1 外部单通道............................................................................................。
      - 6.5.2 外置多线 - 6.5.3 Mini SATA 外置多线 - 6.6 电缆和连接器电气规格............................................................。
      - 6.6.1 串行ATA电缆 - 6.6.2 电缆/连接器测试方法 - 6.7 电源段引脚P11定义（可选） - 6.7.1 设备活动信号 - 6.7.2 交错旋起禁用控制 - 6.8 预充电和设备存在检测 - 6.8.1 设备要求 - 6.8.2 插座预充电（信息）....................................................................。
      - 6.8.3 存在检测 (信息)
- 7 Phy层............................................................................................................................
   - 7.1 Phy电气规范说明...............................................................。
      - 7.1.1 服务列表 - 7.1.2 低层电子框图（资料性） - 7.1.3 符合性测试 - 7.1.4 链路性能.................................................................................................。
   - 7.2 电气规范 - 7.2.1 物理层要求表 - 7.2.2 物理层要求详情 - 7.2.3 回环 - 7.2.4 测试模式要求..................................................................................。
      - 7.2.5 热插拔注意事项 - 7.2.6 配套连接器对定义..........................................................................。
      - 7.2.7 符合性互连通道（Gen1x、Gen2x、Gen3i） - 7.2.8 阻抗校准（可选） - 7.3 抖动 - 7.3.1 抖动定义 - 7.3.2 参考时钟定义 - 7.3.3 扩频时钟 - 7.3.4 抖动预算.........................................................................................................。

   - 7.4 测量 - 7.4.1 帧误码率测试 - 7.4.2 差分电压幅度的测量（Gen1, Gen2） - 7.4.3 差分电压幅度的测量（Gen3i） - 7.4.4 上升和下降时间 - 7.4.5 发射机幅度..........................................................................................。
      - 7.4.6 接收振幅...............................................................................................。
      - 7.4.7 长期频率精度 - 7.4.8 抖动测量 - 7.4.9 发送抖动（Gen1i, Gen2i, Gen1m, Gen2m, Gen1x, and Gen2x） - 7.4.10 发送抖动（Gen3i） - 7.4.11 接收器容差（Gen1i, Gen2i, Gen1m, Gen2m, Gen1x, and Gen2x）.........。
      - 7.4.12 接收器容差（Gen3i） - 7.4.13 回波损耗和阻抗平衡 - 7.4.14 SSC Profile - 7.4.15 线对内偏移 - 7.4.16 序列瞬态电压 - 7.4.17 交流耦合电容 - 7.4.18 TX 幅度不平衡......................................................................................。
      - 7.4.19 TX上升/下降不平衡........................................................................................。
      - 7.4.20 TX交流共模电压(Gen2i, Gen2m) - 7.4.21 Tx交流共模电压(Gen3i) - 7.4.22 OOB共模Delta..................................................................................。
      - 7.4.23 OOB差分三角 - 7.4.24 静噪检测器测试 - 7.4.25 OOB信号测试 - 7.4.26 TDR差分阻抗（Gen1i / Gen1m） - 7.4.27 TDR单端阻抗（Gen1i / Gen1m） - 7.4. 28 DC 耦合共模电压（Gen1i / Gen1m） - 7.4.29 AC 耦合共模电压（Gen1i / Gen1m） - 7.4.30 排序瞬态电压 - 实验室负载（Gen3i）..................................。
   - 7.5 接口状态............................................................................................................
      - 7.5.1 带外信令 - 7.5.2 空闲总线状态................................................................................................
   - 7.6 弹性缓冲区管理
- 8 OOB 和 Phy 电源状态 ...............................................................................................
   - 8.1 接口功率状态 - 8.2 异步信号恢复（可选）..................................................................。
      - 8.2.1 非请求COMINIT使用（告知） - 8.3 OOB和签名FIS返回（告知） - 8.4 上电序列状态机 - 8.4.1 主机Phy初始化状态机 - 8.4.2 设备Phy初始化状态机...............................................................。
      - 8.4.3 速度协商
- 9 链路层 ...........................................................................................................................
   - 9.1 概述 - 9.1.1 帧传输 - 9.1.2 帧接收 - 9.2 编码方式.........................................................................................................。
      - 9.2.1 符号和约定 - 9.2.2 字符码 - 9.2.3 传输摘要 - 9.2.4 接收摘要 - 9.3 传输概述 - 9.4 基元 - 9.4.1 概述 - 9.4.2 基元描述 - 9.4.3 基元编码 - 9.4.4 DMATPP 基元 - 9.4.5 CONTP 基元 - 9.4.6 ALIGNPP 基元..................................................................................................。
      - 9.4.7 流量控制信令延迟 - 9.4.8 基元使用示例（信息） - 9.5 CRC 和扰频 - 9.5.1 FIS 数据扰频与重复基元之间的关系 - 9.5.2 扰频与 CRC 之间的关系 - 9.5.2 扰频与 CRC 之间的关系 - 9.5.2 扰频与 CRC 之间的关系 - 9.5.2 扰频与 CRC 之间的关系 - 9.5.2 扰频与 CRC 之间的关系 3 Scrambling Disable (Informative) - 9.6 链路层状态机 - 9.6.1 链路层转换表中使用的术语 - 9.6.2 链路空闲状态图 - 9.6.3 链路发送状态图 - 9.6.4 链路接收状态图 - 9.6.5 链路电源模式状态图。
- 10 传输层 ..................................................................................................................
   - 10.1 概述 - 10.1.1 FIS 的构造 - 10.1.2 FIS 的分解 - 10.2 帧信息结构（FIS）...............................................................................。
      - 10.2.1 概述 - 10.2.2 有效载荷内容 - 10.3 FIS类型 - 10.3.1 FIS类型值 - 10.3.2 数据FIS的CRC错误 - 10.3.3 所有FIS类型.........................................................................................................。
      - 10.3.4 寄存器 - 主机到设备。
....................................................................................
      - 10.3.5 注册 - 器件到主机.....................................................................................。
      - 10.3.6 设置设备位 - 器件到主机..........................................................................。
      - 10.3.7 激活DMA - 器件到主机 - 10.3.8 DMA设置 - 器件到主机或主机到器件（双向） - 10.3.9 激活BIST - 双向 - 10.3.10 PIO设置 - 器件到主机.................................................................................。
      - 10.3.11 数据 - 主机到设备或设备到主机（双向）.......................................。
   - 10.4 主机传输状态....................................................................................................
      - 10.4.1 主机传输空闲状态图.........................................................................
      - 10.4.2 主机传输命令FIS图 - 10.4.3 主机传输控制FIS图.......................................................。
      - 图 10.4.4 主机传输传输DMA设置-设备到主机或主机到设备FIS状态 - 10.4.5 主机传输传输BIST激活FIS..........................................................。
      - 10.4.6 主机传输分解寄存器FIS图 - 10.4.7 主机传输分解设置设备位FIS状态图 - 10.4.8 主机传输分解DMA激活FIS图 - 10.4.9 主机传输分解PIO设置FIS状态图 - 10.4. 10主机传输分解DMA设置FIS状态图 - 10.4.11主机传输分解BIST激活FIS状态图 - 10.5设备传输状态 - 10.5.1设备传输空闲状态图 - 10.5.2设备传输发送寄存器-设备到主机状态图......................。
      - 10.5.3 Device Transport发送Set Device Bits FIS状态图................................。
      - 10.5.4 设备传输发送PIO设置-设备到主机FIS状态图.........。
      - 10.5.5 设备传输发送DMA激活FIS状态图 - 10.5.6 设备传输发送DMA设置 - 设备到主机FIS状态图 - 10.5.7 设备传输发送数据 - 设备到主机FIS状态图...........................。
      - 10.5.8 设备传输传输BIST激活FIS状态图 - 10.5.9 设备传输分解寄存器 - 主机到设备状态图 - 10.5.10 设备传输分解数据(主机到设备)FIS状态图...........。
      - 10.5.11 设备传输分解DMA设置 - 主机到设备状态图......。
      - 10.5.12 设备传输分解BIST激活FIS状态图。
- 11 设备命令层协议 .......................................................................................
   - 11.1 开机和COMRESET协议 - 11.2 设备空闲协议 - 11.3 软件复位协议................................................................................................。
   - 11.4 EXECUTE DEVICE DIAGNOSTIC命令协议 - 11.5 DEVICE RESET命令协议............................................................................。
   - 11.6 非数据命令协议 - 11.7 PIO数据输入命令协议 - 11.8 PIO数据输出命令协议..................................................................................。
   - 11.9 DMA数据入命令协议 - 11.10 DMA数据出命令协议 - 11.11 PACKET协议.....................................................................................................
   - 11.12 READ DMA QUEUED 命令协议 -...............................................................
   - 11.13 WRITE DMA QUEUED 命令协议 - 11.14 FPDMA QUEUED 命令协议
- 12 主机命令层协议 ...........................................................................................
   - 12.1 FPDMA QUEUED命令协议
- 13 应用层 ................................................................................................................
   - 13.1 并行ATA仿真................................................................................................。
      - 13.1.1 软件复位 - 13.1.2 仅主站仿真 - 13.1.3 主站/从站仿真（可选） - 13.2 识别（包）设备 - 13.2.1 识别设备 - 13.2.2 识别包设备 - 13.2.3 确定对串行ATA功能的支持 - 13.3 设置功能..........................................................................................................。
      - 13.3.1 启用/禁用 DMA 设置中的非零偏移 - 13.3.2 启用/禁用 DMA 设置 FIS 自动激活优化...............................。

      - 13.3.3 启用/禁用设备启动的接口电源状态转换 - 13.3.4 启用/禁用有保证的顺序数据传输 - 13.3.5 启用/禁用异步通知..........................................................。
      - 13.3.6 启用/禁用软件设置保存 - 13.3.7 启用/禁用设备自动部分到休眠过渡 - 13.4 设备配置覆盖......................................................................................
      - 13.4.1 设备配置覆盖识别 - 13.4.2 设备配置覆盖设置 - 13.5 软件设置保存（可选） - 13.5.1 温暖重启注意事项（告知性） - 13.6 本机命令队列（可选） - 13.6.1 定义 - 13.6. 2 混合非本机队列命令和本机队列命令 - 13.6.3 命令定义 - 13.6.4 第一方 DMA HBA 支持（信息） - 13.7 SATA 日志...................................................................................................................。
      - 13.7.1 日志地址定义.......................................................................................
      - 13.7.2 通用日志目录 (00h)..................................................................
      - 13.7.3 排队的错误日志(10h).......................................................................................
      - 13.7.4 Phy事件计数器日志（11h） - 13.7.5 NCQ队列管理日志（12h） - 13.8 异步通知（可选） - 13.8.1 设置设备位FIS通知位 - 13.8.2 通知机制........................................................................................。
      - 13.8.3 异步通知的状态图......................................................。
      - 13.8.4 ATAPI通知的状态图................................................................................................
   - 13.9 Phy 事件计数器（可选） - 13.9.1 计数器复位机制 - 13.9.2 计数器标识符 - 13.9.3 Phy 事件计数器日志（11h） - 13.10 交错旋转（可选） - 13.11 非512字节扇区大小（信息） - 13.12 缺陷管理（信息） - 13.12.1 概述（信息）.........................................................................................。
      - 13.12.2 典型串行ATA可靠性指标（信息）.............................................
      - 13.12.3 串行ATA缺陷管理概述（信息） - 13.12.4 连续后台缺陷扫描（信息） - 13.12.5 自我监控、分析和报告技术（信息） - 13.13 机柜服务/管理（可选） - 13.13.1 概述 - 13.13.2 拓扑 - 13.13.3 限制............................................................................................................。
      - 13.13.4 定义 - 13.13.5 SES和SAF-TE扩展 - 13.13.6 机柜服务硬件接口 - 13.14 硬盘活动指示（可选） - 13.14.1 硬盘活动模拟桌面行为 - 13.14.2 活动/状态指示参考（信息）...............................................。
   - 13.15 端口乘法器的发现和枚举 - 13.15.1 开机 - 13.15.2 重置..................................................................................................................。
      - 13.15.3 软件初始化序列(信息) - 13.15.4 端口倍增器发现和设备枚举(信息) - 13.16 自动部分到休眠的转换
- 14 主机适配器寄存器接口 ...........................................................................................
   - 14.1 状态和控制寄存器.......................................................................................
      - 14.1.1 SStatus 寄存器 - 14.1.2 SError 寄存器 - 14.1.3 SControl 寄存器 - 14.1.4 SActive 寄存器....................................................................................................。
      - 14.1.5 SNotification寄存器（可选）...........................................................................。
- 15 错误处理 .....................................................................................................................
   - 15.1 架构..................................................................................................................
   - 15.2 Phy错误处理概述 - 15.2.1错误检测 - 15.2.2错误控制动作.............................................................................................。
      - 15.2.3 错误报告......................................................................................................

   - 15.3 链路层错误处理概述...............................................................................
      - 15.3.1 错误检测 - 15.3.2 错误控制动作.............................................................................................
      - 15.3.3 错误报告......................................................................................................
   - 15.4 传输层错误处理概述 - 15.4.1 错误检测 - 15.4.2 错误控制动作.............................................................................................
      - 15.4.3 错误报告......................................................................................................
   - 15.5 应用层错误处理概述....................................................................
      - 15.5.1 错误检测 - 15.5.2 错误控制动作.............................................................................................。
- 16 端口乘法器......................................................................................................................
   - 16.1 简介 - 16.2 概述 - 16.3 定义 - 16.3.1 寻址机制 - 16.3.2 设备端口要求...................................................................................。
      - 16.3.3 政策.................................................................................................................
   - 16.4 端口乘法器寄存器 - 16.4.1 一般状态和控制寄存器.................................................................。
      - 16.4.2 端口状态和控制寄存器 - 16.5 端口乘法器命令定义 - 16.5.1 READ PORT MULTIPLIER..................................................................................
      - 16.5.2 WRITE PORT MULTIPLIER - 16.5.3 Interrupts...............................................................................................................
   - 16.6 控制PM端口值和接口电源管理....................................。
   - 16.7 交换类型(信息) - 16.7.1 基于命令的交换 - 16.7.2 基于FIS的交换
- 17 端口选择器 .......................................................................................................................
   - 17.1 应用实例 - 17.2 概述 - 17.3 活动端口选择....................................................................................................
      - 17.3.1 基于协议的端口选择 - 17.3.2 侧带端口选择 - 17.3.3 活动端口变化时的行为 - 17.4 行为和策略 - 17.4.1 控制状态机 - 17.4.2 BIST支持 - 17.4.3 流量控制信令延迟..............................................................................。
      - 17.4.4 电源管理.............................................................................................
      - 17.4.5 OOB Phy信号 - 17.4.6 热插拔 - 17.4.7 速度协商 - 17.4.8 扩频时钟 - 17.5 上电和复位 - 17.5.1 上电 - 17.5.2 重置..................................................................................................................。
   - 17.6 主机的实现（资料性） - 17.6.1 基于协议选择的软件方法（资料性）..............................。
- 17.6.1 基于协议选择的软件方法（信息） 附录A. CRC和加扰的示例代码（信息）..........................................。
   - A.1 CRC计算 - A.1.1概述 - A.1.2最大帧大小............................................................................................。
      - A.1.3 CRC算法示例代码 - A.1.4 CRC算法示例代码 - A.1.5 CRC实现输出示例 - A.2 加扰计算.................................................................................................
      - A.2.1 概述 - A.2.2 加扰算法代码示例 - A.2.3 加扰器实现示例 - A.2.4 加扰器实现输出示例 - A.3 框架示例.............................................................................................................。
- 附录B. 命令处理概述（资料性）......................................................
   - B.1非数据命令 - B.2主机从设备读取DMA - B.3主机向设备写入DMA - B.4从设备读取PIO数据.....................................................................................。
   - B.5 PIO数据写入设备 - B.6 ATA标签命令队列 DMA从设备读取 - B.7 ATA标签命令队列 DMA写入设备 - B.8 ATAPI包命令中含有PIO数据 - B．
9 带有PIO数据输出的ATAPI分组命令 - B.10 带有DMA数据输入的ATAPI分组命令 - B.11 带有DMA数据输出的ATAPI分组命令 - B.12 奇数字数注意事项 - B.12.1 从目标读取奇数字数的DMA - B.12.2 主机向目标写入奇数字数的DMA - B.13 从设备读取PIO数据.....................................................................................。
   - B.14 向设备写入PIO数据 - B.15 原生命令排队示例（信息性） - B.15.1 排队命令的顺序外完成.............................................。
      - B.15.2 中断聚合 - B.15.2 中断聚合
- 附录C. 中断待定的nIEN的设备模拟（信息）.......................。
- 附录D. I/O控制器模块（信息）..................................................................
   - D.1 支持的配置 - D.1.1 单I/O控制器信号 - D.1.2 双I/O控制器信号 - D.1.3 其他可选功能......................................................................................。
   - D.2 可选的高速通道配置 - D.3 可选的低速通道配置 - D.4 I/O控制器模块连接器 - D.4.1 I/O控制器模块连接器 - D.5 I/O控制器模块连接器位置 - D.5.1 用途................................................................................................................。
   - D.6 引脚列表 - D.7 信号描述
- 附录E. 不含SSC的抖动公式(信息性)............................................................。
   - E.1 时钟到数据 - E.2 数据到数据 (由于历史原因而显示)
- 图1--字节、字和D字关系............................................................................. 图表
- 图2 - 平行ATA设备连接
- 图3 - 串行ATA连接
- 图4 - 通信层..................................................................................................
- 图5 - 内部1米有线主机到设备应用
- 图6 - 短背板到设备的应用
- 图7 - 长背板到设备应用.........................................................................
- 图8 - 内部四线电缆磁盘阵列
- 图9 - 系统对系统数据中心互连.............................................................
- 图10 - 外部桌面应用程序
- 图11 - SATA磁盘阵列.......................................................................................................
- 图12 - 嵌入式LIF-SATA应用 - 机架 图13 - 使用串口ATA作为连接的端口倍增器的机箱示例。
- 图14 - 使用端口多路复用器与机架内不同连接的机箱示例
- 图15 - 使用端口倍增器的移动坞站示例
- 图16 - 串行ATA连接器示例.................................................................................
- 图17 - SATA电缆/连接器连接图
- 图18 - SATA主机/设备连接图..................................................................
- 图19 - 5.25 "规格产品上的光学设备插头连接器位置图
- 图20 - 5.25 "外形尺寸上的非光学备用设备插头连接器位置。
- 图21 - 3.5 "侧装设备上的设备插头连接器位置。
- 图 22 - 3.5" 底部安装设备上的设备插头连接器位置
- 图 23 - 2.5" 侧装设备上的设备插头连接器位置
- 图 24 - 2.5" 底部安装设备上的设备插头连接器位置
- 图 25 - 1.8" 侧装设备上的设备插头连接器位置
- 图 26 - 1.8" 底部安装设备上的设备插头连接器位置
- 图 27 - 设备插头连接器禁区
- 图28 - 设备插头连接器...............................................................................................
- 图29 - 设备插头连接器(其他视图)..................................................................
- 图30 - 连接器引脚和特征位置........................................................................
- 图31 - 电缆插座连接器接口尺寸
- 图32 - 锁定信号电缆插座(ClickConnect)
- 图33 - 主机信号插头连接器接口尺寸.......................................................
- 图34 - 非锁存连接器堆栈间距和方向
- 图35 - 锁存连接器堆栈间距和方向
- 图36--背板连接器接口尺寸................................................................。
- 图37 - 连接器对盲配错位公差。
...................................................
- 图38 - 设备背板配接配置
- 图39 - 电源插座接口尺寸
- 图40 - 闩式电源电缆插座................................................................................
- 图41--内部单通道电缆实例的详细截面图
- 图42 - 内部2车道电缆和连接器等距图...............................。
- 图43 - 内部4车道电缆和连接器的等距图...............................。
- 图44 - 4巷引脚分配...........................................................................................
- 图45 - 4 Lane至4 x 1 Lanes, Fanout实现........................................................
- 图46 - 4巷扇出引脚分配图
- 图47 - 2通道扇出引脚分配
- 图48 迷你SATA内部多通道等距图
- 图49 Mini SATA内部多通道连接器的引脚分配
- 图50 Mini SATA内部多线系统，对称电缆的实施 - 图51 Mini SATA内部多线系统，基于控制器的扇出电缆的实施 - 图52 Mini SATA内部多线系统，基于背板的扇出电缆的实施。
- 图53 1.8 "硬盘内部微型SATA连接器位置....................................。
- 图54 1.8 "硬盘的内部微型SATA连接器位置....................................。
- 圖55 裝置內部微型SATA插頭位置...............................................................
- 圖56 裝置內部微型SATA背板接頭.................................................................
- 圖五十七 內置微型SATA電源插座的位置
- 图58 内部微型SATA连接器对盲配错位功能...................。
- 图59 - 7.0毫米超薄硬盘连接器位置图
- 图 60 - 9.5 毫米/12.7 毫米超薄型驱动器连接器的位置。
- 图 61 - 7.0 毫米细长型驱动器连接器位置（A-A 部分）。
- 图 62 - 9.5 毫米细长型驱动器连接器位置（A-A 部分）。
- 图 63 - 12.7 毫米超薄型驱动器连接器位置（A-A 部分）。
- 图64 - 7毫米细线设备插头接口尺寸
- 图 65 - 7.0 mm 薄型设备插头连接器接口尺寸 A-A 节。
- 图66 - 7.0 mm超薄型设备插头接口尺寸 B-B节。
- 图67 - 7.0 mm超薄型设备插头接口尺寸详图D - 安装 图68 - 7.0 mm超薄型设备插头接口尺寸可选压紧装置。
- 图69 - Slimline Device插头接口尺寸..............................................。
- 图70 - 薄型器件插头接口尺寸(A-A部分)
- 图 71 - 薄型设备插头接口尺寸（B-B 节）。
- 图72 - Slimline Device插头连接器接口尺寸（C-C部分）........................。
- 图73 - 薄型设备插头接口尺寸(细节F)...............................。
- 图74 - 薄型设备插头接口尺寸(C-C部分)。
- 图75 - Slimline设备插头连接器可选固定安装..............................。
- 图76 - Slimline连接器引脚和特征位置
- 图77 - 薄型电源插座接口尺寸.....................................。
- 图78 - 薄型电源插座连接器 选配带锁扣的连接器
- 图79 - 带凸点的超薄型电源插座连接器选件
- 图80 - 薄型主机插座接口尺寸........................................。
- 图81 - 薄型主机插座接口尺寸 C-C部分
- 图82 - 薄型主机插座接口尺寸 第X-X节
- 图83 - 薄型主机插座接口尺寸 Y-Y节
- 图84 - 薄型连接器对盲插错位容差
- 图85 - 1.8 "硬盘内部LIF-SATA接口位置..................................................。
- 图86 - 1.8 "SSD单面安装型内部LIF-SATA接口位置。
- 图87 - 设备内部LIF SATA嵌入式连接器...............................................
- 图88 - 设备内部的LIF-SATA表面安装型连接器。
- 图89 - 用于内部LIF SATA的FPC。
- 图90 - 带外部电缆和单个设备外壳的HBA使用模式 - 电缆到磁盘.........................................................................................................................。图91 - 带扩展电缆的板载串行ATA连接器的使用模式 - 电缆至磁盘
- 图92--外部串行ATA电缆插座和直角插头的渲染图。

- 图93 - 外部串行ATA电缆插座组件机械尺寸............。
- 图94 - 外置串行ATA RA SMT插头机械尺寸.................................
- 图95 - 外置串行ATA RA SMT插头的机械尺寸 - 反向引脚输出
- 图96 - 外部串行ATA RA通孔机械尺寸...........................
- 图97 - 外置串行ATA垂直SMT插头机械尺寸..........................
- 图98 - 外置串行ATA垂直通孔插头机械尺寸............
- 图99 - 外置多芯电缆和连接器
- 图100 - 多芯电缆连接器阻挡关键位置
- 图101 - 插头/插座的键合
- 图102 迷你SATA外置多通道系统，主要特点
- 图103 迷你SATA外部多通道系统，"x级 "信号的关键插槽1和4。
- 图104 Mini SATA外部多通道系统，"m级 "信号的关键插槽7。
- 图105 Mini SATA外部多通道连接器引脚分配图
- 图106--活动信号电气框图示例
- 图107 - 主机LED驱动电路示例
- 图108--用于信号交错旋起禁用的主机电路示例
- 图109 - 典型的预充电配置
- 图110 - 存在检测实施例
- 图111--物理厂总体框图（资料性）。
- 图112 - 模拟前端（AFE）框图
- 图113 - 模拟前端（AFE）布线............................................................................
- 图114 - 简单链接
- 图115 - Gen1i的共模偏置示例（信息）....................................
- 图116 - 用于Gen1x、Gen2i、Gen2x和Gen3i的共模偏置。
- 图117 - 差动回波损耗限制
- 图118 - 共模回波损耗限制........................................................................
- 图119 - 阻抗平衡限制
- 图120 - 差分回波损耗限制，Gen3i，TX和RX
- 图121 - 信号上升和下降时间
- 图122 - TX线对内偏移
- 图123 - OOB差分三角(在交流耦合的顺应点)
- 图124 - LL实验室负荷
- 图125 - LSS实验室来源信号
- 图126 - RX差分输入电压条件................................................................
- 图127 - RX线对内偏移.................................................................................................
- 图128 - 远端重定时环回
- 图129 - 远端模拟环回
- 图130 - 近端模拟环回
- 图131 - 合规测试模式.........................................................................................
- 图132 - 共模瞬态电路示例
- 图133 - 匹配的连接器对
- 图134 - 配接的连接器对，引脚尾部细节
- 图135 - Gen3i的合规通道损耗
- 图136 - Gen2x的合规性通道损失
- 图137 - Gen1x的合规性通道损失
- 图138 - SSC轮廓示例。三角形
- 图139 - 频谱基频比较
- 图140 - 差分电压幅度测量.........................................................
- 图141 - 差分电压幅度测量模式示例
- 图142 - 高BW范围（HBWS）上的LFTP模式
- 图143 - 单端上升和下降时间...........................................................................
- 图144 - 带实验室负载的发射振幅测试
- 图145 - 使用顺应性互连通道的发射振幅测试
- 图146 - 接收器振幅测试--设置电平
- 图147 - 接收器振幅测试
- 图148 - 接收器输入端的电压........................................................................................
- 图149 - TX长期频率测量
- 图150- 抖动的接收器模型
- 图151 - 接收器的抖动
- 图152 - 接收器的抖动，高通功能
- 图153 -- -- 联合工作队和地方政府工作队的定义
- 图154 - 发射机抖动测试(Gen1i, Gen2i)....................................................................
- 图155 - 带顺应性互连通道的发射机抖动测试(Gen1x, Gen2x).......。
- 图156 - 发射机随机抖动测试(Gen3i).................................................................
- 图157 - 发射机总抖动测试(Gen3i)
- 图 158 - 接收器抖动和 CM 容差测试设置级别
- 图159 - 接收器抖动和CM容差测试..................................................................
- 图160 - 接收器抖动和CM容忍度测试 - 设置RJ电平(Gen3i)
- 图161 - 接收器抖动和CM容忍度测试 - 设置TJ和CM水平(Gen3i)

- 图93 - 机械结构图 - 图162 - 接收器抖动和CM公差测试(Gen3i)
- 图163 - 回损测试-校准
- 图164 - 回损测试
- 图165 - 发射机的线对内偏移测试
- 图166 - 接收器线对内偏移测试设置水平
- 图167 - 接收器线对内偏移测试
- 图168 - 发射机的线对内偏移测试示例(10.8 pS)
- 图 169 - TX/RX 序列瞬态电压测量
- 图 170 - AC 耦合电容测量................................................................
- 图171 - 静噪检测器阈值测试-设置级别
- 图172 - 静噪检测器阈值测试...........................................................................
- 图173 - TDR差分阻抗测试-设置上升时间.............................................
- 图174 - TDR阻抗测试
- 图175 - TDR单端阻抗测试设置上升时间
- 图176 - 直流耦合共模电压测量..............................................
- 图177 - 交流耦合共模电压测量..............................................
- 图178 - TDR阻抗测试
- 图179 - 瞬态电压实验室负载排序图
- 图180 - OOB信号...........................................................................................................
- 图181 - 发射机示例
- 图182 - 发射机实例（已完成）........................................................................
- 图183 - COMRESET序列..........................................................................................
- 图184 - COMINIT序列
- 图185 - OOB信号检测器..............................................................................................
- 图186 - 静噪检测器....................................................................................................
- 图187 - 开机序列
- 图188 - PHYRDY至部分主机启动
- 图189 - PHYRDY至部分设备启动.....................................................................。
- 图190 - 命名法参考
- 图191 - 比特排序和意义.................................................................................
- 图192 - 传输结构
- 图193 - FIS类型值的分配
- 图194 - 寄存器--主机到设备的FIS布局
- 图 195 - 寄存器 - 设备到主机 FIS 布局
- 图196 - 设置设备位 - 设备到主机FIS布局
- 图197 - 激活DMA - 设备到主机FIS布局..............................................................。
- 图198 - DMA设置 - 设备到主机或主机到设备FIS布局图
- 图199 - 激活BIST - 双向...................................................................................。
- 图200 - PIO设置 - 设备到主机FIS布局...................................................................
- 图201 - 数据 - 主机到设备或设备到主机FIS布局图
- 图202 -设备配置识别数据结构
- 图203 - 设备配置集数据结构
- 图204 - DMA设置 FIS定义的内存缓冲区选择
- 图205 - READ FPDMA QUEUED命令定义
- 图206 - READ FPDMA QUEUED收到命令时出错。
- 图207 - 设置设备位FIS与错误通知，和命令完成。
- 图208 - 设置Device Bits FIS中止所有未完成的命令..........................................
- 图209 - WRITE FPDMA QUEUED命令定义 - 图210 - 为成功完成WRITE FPDMA QUEUED命令设置设备位FIS
- 图211 - 收到命令时WRITE FPDMA QUEUED错误
- 图212 - 设置设备位FIS与错误通知，以及命令完成。
- 图213 - NCQ QUE管理 - 命令定义
- 图214 - NCQUE管理，中止NCQ队列--成功完成........。
- 图215 - NCQUE管理，中止NCQ队列--收到命令时出错。
- 图216 - NCQUE MANAGEMENT, Abort NCQ Queue - error during execution.........。
- 图217 - NCQQUE管理，截止日期处理--成功完成........。
- 图218 - NCQ QUE管理，截止时间处理--收到命令时出错。
- 图219 - NCQ QUE MANAGEMENT, Deadline Handling - 执行过程中出错.........。
- 图220 - 第一方DMA支持的DMA引擎间接示例
- 图221 - 排队错误日志数据结构定义
- 图222-NCQ队列管理日志（12h）数据结构定义
- 图223 - Phy事件计数器标识符
- 图224 - Phy事件计数器日志数据结构定义..................................................。
- 图225 - 通用外壳服务拓扑结构

- 图226 - 通用拓扑的简化视图
- 图227 - 机柜服务定义配置
- 图228 - 显示存在机箱服务设备的注册签名.................。
- 图229 - 表示不存在的机箱处理器的寄存器签名..............................................
- 图230 - 外壳处理器通信中使用的命令块寄存器字段
- 图231 - 用于传送附件服务命令的I^2 C框架
- 图232 - WRITE SEP命令块寄存器................................................................
- 图233 - 与WRITE SEP命令相对应的I^2 C事务。
- 图234 - READ SEP命令块寄存器
- 图235 - 与READ SEP命令相对应的I^2 C事务。
- 图236 - IDENTIFY SEP数据结构定义
- 图237 - SAF-TE写入设备插槽状态数据结构。
- 图238 - SES设备元素数据结构
- 图239 - 示例子系统...............................................................................................
- 图240 - SAF-TE设备ID字段惯例
- 图241 - SES插槽地址字段约定.........................................................................
- 图242 - 桌面行为仿真的活动LED定义
- 图243 - 带独立导线的设备活动LED.............................................................。
- 图244 - 带带状电缆的设备活动LED................................................................
- 图245 - 存储子系统中的设备活动LED.......................................................
- 图246 - 软件复位以控制端口结果值............................................................
- 图247 - 端口乘法器签名
- 图248 - SActive寄存器定义.......................................................................................
- 图249 - SNotification寄存器定义...............................................................................
- 图250 - 错误处理架构
- 图251 - 端口乘法器概述
- 图252 - 端口选择器概述...........................................................................................
- 图253 - 带有两个主机的故障切换应用示例 - COMRESET 图254 - 基于断言COMRESET到断言以下的端口选择信号 - spacings...............................................................................................................................。图255 - 由两个序列组成的完整的端口选择信号，并具有必要的互斥功能
- 图256 - 控制状态机............................................................................................
- 图257 - Phy框图.................................................................................................
- 图258--概念摘要互连结构
- 图259 - 一个I/O控制器的信号连接示例.....................................。
- 图260 - 两个I/O模块的信号连接示例
- 图261 - 高速通道 - 配置0................................................................
- 图262 - 高速通道 - 配置图
- 图263 - 低速通道
- 图264 - 互联通道
- 图265 - I/O控制器模块连接器渲染图..........................................................。
- 图266 - 连接器引脚布局和引脚长度..................................................................
- 图267 - I/O控制器模块连接器插座工程图......................
- 图268 - 连接器侧视图..........................................................................................
- 图269 - 1xWide I/O模块上的I/O控制器模块连接器位置图
- 图270 - 2xWide I/O模块上的I/O控制器模块连接器位置。
- 图271 - 抖动偏差......................................................................................................
- 图272 - 边缘到边缘时序..............................................................................................
- 表1 - 状态表单元描述表列表
- 表 2 - 使用模式说明.............................................................................................
- 表 3 - 信号和电源 SATA 插头和标称配接顺序
- 表4 - 设备到背板配接的尺寸A和B的允许值。
- 表5----外壳和触头电气参数、试验程序和要求：
- 表6----机械试验程序和要求
- 表7----环境参数、试验程序和要求

- 表8 - 附加要求...................................................................................................
- 表9 - 连接器测试顺序.............................................................................................
- 表10 - 信号和电源内部Micro SATA插头和标称配接顺序
- 表11 - 独特的连接器机械测试程序和要求
- 表12 - Slimline连接器位置参考
- 表13 - 薄型设备插头连接器引脚定义
- 表14 - 薄型连接器机械测试程序和要求
- 表 15 - 信号和电源 内部 LIF-SATA 插头
- 表16 - 独特的连接器机械测试程序和要求
- 表 17 - 多线引脚分配表
- 表18 - 内部电缆/连接器测量参数和要求.................。
      - 表19 - 外部单车道电缆/连接器测量参数及要求 - 要求 表20 - 有限外部多车道电缆/连接器测量参数及要求 表21 - 扩展外部多车道电缆/连接器测量参数及要求
- 表22 - 常用互连测量程序方法..............................
- 表23 - 互连测试方法/程序.........................................................
- 表24--电源段P11引脚活动信号电参数表
- 表25--主机活动信号电参数
- 表26--活动信号功能状态..................................................................................
- 表27--主机交错旋转控制电气要求
- 表28--另一个存在检测电路实例的比较器电压
- 表29 - 一般规格...............................................................................................
- 表30 - 发射机规格
- 表31--发射信号要求
- 表32 - 接收器规格
- 表33--实验室信号（用于接收机容差测试
- 表34 - OOB规格
- 表35 - 从RD-开始的低过渡密度模式(LTDP)
- 表36--从RD+开始的低过渡密度模式(LTDP)
- 表37 - 从RD-开始的高转换密度模式(HTDP)
- 表38 - 从RD+开始的高转换密度模式(HTDP)
- 表39 - 以RD-为起点的低频谱内容模式(LFSCP)
- 表40 - 从RD+开始的低频频谱内容模式(LFSCP)
- 表41 - 从RD-开始的同步开关输出模式(SSOP)
- 表42 - 从RD+开始的同步开关输出模式(SSOP)
- 表43 - 从RD-开始的单比特码型(LBP)
- 表44 - 从RD+开始的单比特模式(LBP)
- 表45 - 从RD-开始的复合比特码型(COMP)
- 表46 - 以RD+.................................................... 为起点的复合比特模式(COMP)
- 表47 - 帧错误率置信度与样本大小的关系。
- 表48 - 比特错误率置信度水平与样本大小的比较
- 表49 - OOB信号时间.....................................................................................................
- 表50 - 接口电源状态
- 表51 - 状态图 主机Phy初始化状态机
- 表52 - 状态图 设备 Phy 初始化 状态机
- 表53 - 位指定.........................................................................................................
- 表54 - 转换示例................................................................................................
- 表55 - 5B/6B编码
- 表56 - 3B/4B编码
- 表57 - 编码示例...................................................................................................
- 表58 - 有效数据字符
- 表59 - 有效控制字符
- 表60 - 双字符延迟的单位错误
- 表61 - 一个字符延迟的单位错误。
- 表62 - 基元的描述
- 表63 - 原始编码.....................................................................................................
- 表64 - CONTPUsage示例
- 表65 - 往返延误的构成例证........................................................
   - 数据FIS............................................................................................................................... 表66 - 从主机到设备的SRST写入 传输突破设备到主机
- 表67 - 命令影子寄存器块寄存器传输示例
- 表68 - 主机到设备的数据传输示例.....................................................。
- 表69 - 状态图 链路空闲

- 表 70 - 状态图 链路传输
- 表71 - 状态图 链接接收
- 表72 - 状态图 链接电源模式...............................................................................
- 表73 - 简化阴影寄存器块寄存器编号
- 表 74 - BIST 激活 FIS 模式和位设置
- 表75 - 识别设备信息
- 表76 - 协商的串行ATA信令速度的编码值
- 表77--IDIDIFY PACKET DEVICE信息。
- 表78 - 功能启用/禁用值
- 表79--特征识别值
- 表80 - 子命令字段
- 表81 - 终止类型
- 表82- 串行ATA的日志地址
- 表83 - 串行ATA的通用日志目录值
- 表84 - SCR定义............................................................................................................
- 表85 - SCR定义
- 表86 - 状态图碰撞
- 表 87 - 主机端口热插拔状态机的状态图
- 表88 - 设备端口热插拔状态机的状态图............................................。
- 表89 - 不支持的命令的寄存器值
- 表90 - 静态信息寄存器
- 表91 - 状态信息和控制寄存器
- 表92 - 支持的功能 寄存器
- 表93 - 启用功能的寄存器
- 表94 - 供应商专用登记册
- 表95 - Phy事件计数器寄存器
- 表96 - 保留寄存器
- 表97 - PSCR定义.........................................................................................................
- 表98 - READ PORT MULTIPLIER命令的定义
- 表 99 - READ PORT MULTIPLIER 成功状态结果值
- 表 100 - READ PORT MULTIPLIER 错误状态结果值..........................................。
- 表 101 - WRITE PORT MULTIPLIER 命令定义
- 表 102 - 写入端口多路复用器成功状态结果值
- 表103 - 写入端口多路复用器错误状态结果值
- 表104 - 端口选择信号间复位时序要求
- 表105 - CRC和加扰器计算示例 - PIO写命令  
#### 表106 - J1、J2、J3引脚分配.....................................................................................。656 
#### 表107 - J4、J5、J6引脚分配.....................................................................................。656   
## 1 修订历史....................................................................................................................

### 1 .1 修订2.5(批准日期2005年10月27日) 
该版本集成并整合了以下之前发布的规范，包括所有与这些规范相关的勘误。
- 串行ATA 1.0a修订版
- 串行ATA II：串行ATA 1.0a的扩展版本1.2。
- 串行ATA II：电气规范修订版1.0。
- 串行ATA II：电缆和连接器卷1修订版1.0。
- 串行ATA II：电缆和连接器第2卷修订版1.0。
- 串行ATA II：端口乘法器修订版1.2。
- 串行ATA II：端口选择器 1.0修订版 
### 1.2 修订版 2.6 (批准日期 2007 年 2 月 15 日) 
该版本包含了2.5版的勘误表以及以下新功能和增强功能。
- 内部Slimline电缆和连接器
- 内置Micro SATA接口，可连接1.8 "硬盘。
- 迷你SATA内部多通道电缆和连接器
- 迷你SATA外置多通道电缆和连接器
- 国家统计局的优先事项
- NCQ卸货
- 增强BIST激活FIS的功能。
- 加强对签名式金融信息服务系统的有力接收。
### 1.3修订版3.0(候选版2：2009年5月15日) 
此版本包含了针对2.6版的勘误。
- ECN001----超薄凸点校正
- ECN002 - 凸点校正
- ECN003 -- -- 国名更正
- ECN004 - ATA日志和子代码保留
- ECN006 - fbaud/10 抖动参数删除
- ECN008 - fbaud/500 抖动参数说明
- ECN009----纠正COMP数据模式和其他位置中的枸杞多糖参考。
- ECN010 - 电源状态恢复速度
- ECN011----数据有效性的澄清
- ECN012 - 电缆和连接器固定
- ECN013----第13节更正
- ECN014--------------------------包件国名
- ECN016 - 发射机的长期频率精度和SSC曲线测试
- ECN017--OOB爆裂/间隔期澄清
- ECN018 - 图 69 引脚位置校正
- ECN019 - 电缆ISI测试源上升时间
- ECN021 - 外部插头高度
- ECN022 - 编辑清理 - 8KB, IDENTIFY DEVICE
- ECN023 - L键开孔校正（超薄型主机插座连接器
- ECN024 - 接触电流评级程序
- ECN025 - 上升时间测量  
- ECN026 - Gen 3i TX TJ的测量位置。
- ECN027----Gen3i Rx差分回波损耗文字说明和图示更改----仅作说明。
- ECN028 - 澄清7.2电气规范中规定的测量测试模式。

- ECN029 - 在TX交流共模电压（Gen3i）测量中增加模式。
- ECN031 - 对ECN 004的更正
- ECN032 - 修正TX交流共模电压表值 "单位"。
- ECN033 - 术语定义
- ECN034 - 对技术提案005的更正
- ECN035 -- -- 词语76至79的澄清
- ECN036 - LIF-SATA的说明
- ECN037 - 技术整合工作组所作的修改。
- ECN038----主要澄清和以下新功能和增强功能
- TP002--第三代寄存器分配
- TP004----NCQ的澄清
- TP005 - ID 字符串中的SATA速度指示器
- TP007--自动部分进入睡眠状态的转换
- TP009 - 用于 1.8" HDD 的 LIF 连接器，适用于 SATA Revision 2.6。
- TP010 - 串行ATA NCQ流命令
- TP011 - 串行 ATA NCQ QUEUE 管理命令。
- TP012--第1代时钟至数据抖动定义
- TP013 - 用于7毫米细线驱动器的连接器。
- TP014 - 允许 READ LOG DMA EXT 清除 NCQ 错误。
- TP015-从签名中删除设备寄存器
- TP016--在SSP支持中增加写-读-核对。
- TP017 - 将SATA 2.6与ATA8-ACS对齐。
- TP018--Gen3i的规格修订。 
## 2 范围....................................................................................................................................

本规范定义了一个高速串行化ATA数据链路接口(指定Phy、Link。
传输层和应用层）。) 串行化接口使用来自于
ATA8-ACS标准，增加了针对串行化接口优化的本地命令队列命令。串行化ATA接口是以与并行ATA兼容的寄存器方式定义的，以实现与并行ATA驱动器的后向兼容性。物理接口的定义是为了便于集成（低引脚数、低电压）并实现可扩展的性能（目前定义的数据速率为1.5 Gbps、3.0 Gbps和6.0 Gbps）。
还规定了补充元件，包括各种应用的互连解决方案、端口扩展设备和故障切换设备。
提供规范性信息是为了允许根据本规范设计的组件的互操作性。提供的信息可说明可能的设计实现。
 
## 3 规范性参考文献 ...........................................................................................................

以下标准包含的条款，通过文中的引用，构成本标准的条款。在出版时，所标明的版本是有效的。所有标准均可修订，鼓励基于本标准达成协议的各方调查适用下列标准最新版本的可能性。
可从ANSI获得以下文件的副本：已批准的ANSI标准、已批准和起草的国际和地区标准（ISO、IEC、CEN/CENELEC、ITUT）以及已批准和起草的国外标准（包括BSI、JIS和DIN）。如需了解更多信息，请致电 212-642-4900（电话）、212-302-1286（传真）或通过万维网 http://www.ansi.org 联系 ANSI 客户服务部。
以下是根据需要提供的其他可用性联系信息。
### 3.1 批准的参考资料 
下列已批准的ANSI标准、已批准的国际和区域标准（ISO：）。
IEC、CEN/CENELEC、ITUT），可从控制它们的国际和区域组织获得。
带分组接口的AT附件-5 (ATA/ATAPI-5) [ANSI INCITS 340-2000] 。
带分组接口的AT附件-6（ATA/ATAPI-6）[ANSI INCITS 361-2002]
ATA/ATAPI-8命令集(ATA8-ACS) [ANSI INCITS 452-2008]
串行连接SCSI-1.1（SAS-1.1）[ANSI INCITS 417-2006]
SCSI-3机箱服务（SES）命令集[ANSI INCITS 305-1998]。
SCSI-3外壳服务(SES)修正案1[ANSI INCITS 305-1998/AM1-2000]
SCSI机箱服务 - 2 (SES-2) [ANSI INCITS T10/1559-D]
ATA/ATAPI主机适配器标准[ANSI INCITS 370-2004]
ASME Y14.5M尺寸和公差。
要获得这些文件的副本，请联系Global Engineering或INCITS。
Global Engineering Documents, an IHS Company 15 Inverness Way East.
Englewood, CO 80112-5704
美国
网站：http://global.ihs.com
电话：(303) 397-7956或(303) 792-2181或(800) 854-7179 (303) 397-7956或(303) 792-2181或(800) 854-7179。
文件分发
INCITS网上商店由Techstreet管理，1327 Jones Drive。
Ann Arbor, MI 48105
美国 
网站：http://www.techstreet.com/incits.html
电话：(734) 302-7801或(800) 699-9277 (734) 302-7801或(800) 699-9277
其他材料和版本草案可从http://www.T10.org 和http://www.T13.org。
SAF-TE - SCSI Accessed Fault-Tolerant Enclosure version 1.00 [reviction R041497, April 14, 1997]。可在 http://www.intel.com/design/servers/ipmi/pdf/sr041497.pdf 下载。
I^2 C-Bus规范2.1版。可从飞利浦半导体公司获得：http://www.semiconductor.philips.com/buses/i2c。

IPMB - 智能平台管理总线通信协议规范1.0版。
可在 http://www.intel.com/design/servers/ipmi/spec.htm 下载。
IPMI - 智能平台管理接口规范1.5版。可在 http://www.intel.com/design/servers/ipmi/spec.htm 上下载。
JEDEC标准（位于http://www.jedec.com）。
- JESD22-A114-B，静电放电（ESD）灵敏度测试人体模型（HBM）。
- JESD22-C101-A，"微电子元件静电-放电-耐受阈值的场致带电设备模型测试方法" 
参考了小鱼儿玄机2站委员会公布的下列标准。这些标准可通过http://www.sffcommittee.org 下载。
- SFF-8086，紧凑型多线系列。通用元件
- SFF-8087，紧凑型多线系列。非屏蔽式
- SFF-8088，紧凑型多线系列。屏蔽式
- SFF-8111，1.8 "驱动器外形尺寸(60x70毫米)
- SFF-8144, 54 mm x 71 mm 外形，带微型SATA连接器。
- SFF-8201，2.5 "磁盘驱动器的外形尺寸。
- SFF-8301，3.5 "磁盘驱动器的外形尺寸。
- SFF-8470，屏蔽式高速串行多线铜连接器
- SFF-8484，多线内部串行连接连接器
- SFF-8553，外形尺寸为 5 1/4" 7 mm 高度的光驱，带 SATA 接口。
以下是由EIA发布的EIA-364-xx标准。要获得这些文件的副本，请联系Global Engineering。
- EIA-364-09，电气连接器和触点的耐久性测试程序
- EIA-364-13，电连接器的配接和非配接力测试程序
- EIA-364-17，电气连接器和插座的有无电气负载的温度寿命测试程序。
- EIA-364-18，电气连接器的视觉和尺寸检查
- EIA-364-20，电气连接器、插座和同轴触点的耐电压测试程序
- EIA-364-21，电连接器、插座和同轴触点的绝缘电阻测试程序
- EIA-364-23，电气连接器和插座的低电平接触电阻测试程序。
- EIA-364-27，电气连接器的机械冲击（特定脉冲）测试程序
- EIA-364-28，电气连接器和插座的振动测试程序。
- EIA-364-31，电气连接器和插座的湿度测试程序。
- EIA-364-32，电连接器和插座的热冲击（温度循环）测试程序  
- EIA-364-38，电气连接器的电缆拔出测试程序。
- EIA-364-41，电气连接器的电缆弯曲测试程序。
- EIA-364-65,混合流动气体。
许多EIA-364-xx规格可从以下网站下载：http://www.ecaus.org/engineering/Downloads/eia364.htm。
参考了EIA发布的下列外形系数标准。这些标准可从 Global Engineering 获得。
- EIA-740，小外形尺寸 3.5" 磁盘驱动器规格。
- EIA-720，小型2.5 "磁盘驱动器规格 
### 3.2 正在制定的参考文献 
以下是正在制定的ANSI标准。这些标准的草案版本可从 http://www.T10.org 或 http://www.T13.org 获得。
ATA/ATAPI-8 串行传输 (ATA8-AST) [ANSI INCITS T13/1697-D] 。
ATA/ATAPI-8并行传输（ATA8-APT）[ANSI INCITS T13/1698-D]
ATA主机适配器标准-2 (HBA-2) [ANSI INCITS T13/2014D]
### 3.3 其他参考资料............................................................................................................。

串行ATA中使用的8b/10b代码是基于以下已发表的参考文献。[1] A.X.Widmer和P.A.Franaszek，"A DC-Balanced, Partitioned-Block, 8B/10B"。
传输代码"。IBM Journal of Research and Development , 27, no. 5: 440-451 (September, 1983) [2] 美国专利4,486,739. Peter A. Franaszek and Albert X. Widmer. 面向字节的DC
平衡(0，4)8B/10B分区块传输码。(1984年12月4日)  
## 4 定义、缩略语和惯例 .........................................................................

### 4.1 定义和缩略语 
#### 4.1.1 活动端口 
活动端口是指端口选择器上当前选定的主机端口。
#### 4.1.2 ATA（AT附加）.............................................................................................。

ATA定义了存储设备附加的物理、电气、传输和命令协议。
#### 4.1.3 ATAPI(AT Attachment Packet Interface)设备。
实现Packet Command功能集的设备。
#### 4.1.4 BER(误码率) 
#### 4.1.5 比特率 
单位间隔的往复。比特率=1/UI。
#### 4.1.6 位同步 
接收器已将内部接收时钟与外部发射器同步，并正在传送重新定时的串行数据的状态。
#### 4.1.7 burst 
从接口上的空闲状态开始和结束的一个短数据脉冲。
 这些都是用于OOB信号的。
#### 4.1.8 字节 
一个字节是一组有序的八（8）位。最不重要的位是0位，最重要的位是7位。
#### 4.1.9 字符 
字符是一个字节在Zxx.y符号中的表示（见9.2.1）。
#### 4.1.10 字符对齐 
字符对齐是一个接收器动作，它将字符边界重新设置为ALIGNP的K28.5控制字符中发现的逗号序列，并建立输入的串行数据流的Dword同步。
#### 4.1.11字符滑移...................................................................................................。

字符滑移是接收机的动作，通过在ALIGNP的字符内增加或删除比特时间，使接收机的时钟与接收到的比特流重新调整。

#### 4.1.12 ClickConnect..........................................................................................................

一种用于内部单通道互连的可选正锁存解决方案（见6.1.4节）。
#### 4.1.13 CLTF（闭环传输功能）.................................................................。

对于反馈系统，CLTF是输出变量的幅度和相位与输入变量的幅度和相位之比，作为正弦激励的频率函数。这个术语在本规范的参考时钟部分使用。
#### 4.1.14 违规代码 
Acode violation是指在接收过程中由于以下原因而发生的错误：(1)违反运行差异，或(2)编码字符没有转换为有效的数据或控制字符，或(3)编码字符转换为K28.5或以外的控制字符。
K28.3 在一个 Dword 的字节 0 中，或 (4) 一个编码字符，可转换为 Dword 的字节 1-3 中的任何控制字符（有效或无效）。
#### 4.1.15 逗号字符 
逗号字符是一个控制字符，编码后包含逗号序列。逗号字符是一个控制字符，在编码时，包含逗号序列。
串行ATA唯一使用的逗号字符是K28.5，只有ALIGNP包含逗号字符。逗号序列是编码字符的前七位。
#### 4.1.16 逗号序列 
逗号序列是编码流中0011111或1100000的七位序列。
逗号序列是独一无二的，因为它只出现在一个编码字符中，而且，不能出现在相邻编码字符中的任何比特子集中。这种独特的属性使得逗号序列可以用来确定接收数据流的对齐方式。
#### 4.1.17 命令中止 
命令中止是指命令完成，错误寄存器中的ABRT位设为1，而
状态寄存器中的 ERR 位设置为 1。
#### 4.1.18 命令完成.............................................................................................。

命令完成描述了命令所要求的动作的完成，适用于设备。命令完成也适用于命令以错误终止的情况，并且发生了以下操作： a) 状态寄存器的相应位已被更新 b) BSY 和 DRQ 位已被清零 c) INTRQ 的断言（如果 nIEN 为低激活），假设命令协议指定 INTRQ 被断言。
在串行ATA中，寄存器的内容是通过寄存器-设备到主机的方式传输到主机的。
FIS。
#### 4.1.19 命令包 
在执行PACKET命令时传送给设备的Adata结构，包括命令和命令参数。

#### 4.1.20 集中器 
集中器是一个通用术语，用于描述一个逻辑块，该逻辑块有多个Serial ATA端口连接到Serial ATA设备，再加上一些小数量的端口连接到主机。在最简单的情况下，集中器可能是一个主机总线适配器(HBA)，插入主机，连接到一些串行ATA设备(如PCI串行ATA控制卡)。集中器也可以是一个内部或外部的RAID控制器，如光纤通道到Serial ATA设备。
ATA RAID控制器，也可能是一些通过扇出方案扩展端口数量的元素，如端口乘法器。
#### 4.1.21 控制块寄存器...........................................................................................

控制块寄存器是用于设备控制和发布备用状态的接口寄存器。
#### 4.1.22 控制字符 
控制字符是指Z等于K的字符（见9.2.1）。
#### 4.1.23 控制端口 
端口乘法器有一个端口地址，保留给控制和状态通信。
端口乘法器本身。控制端口的端口地址为Fh。
#### 4.1.24 控制变量 
控制变量Z是一个标志，它决定用于解释数据字节的代码集。
控制变量的值为D（数据字符）或K（控制字符）。

#### 4.1.25 CRC(循环冗余检查) 
一种通过计算基于多项式算法的校验和来检查数据完整性的错误检查机制。在串行ATA中，一个32位的CRC是根据一个帧的内容计算出来的。
信息结构。串行ATA CRC是帧中紧接在 "CRC "之前的Dword。
EOFP。
#### 4.1.26 数据字符 
数据字符是指Z等于D的字符（见9.2.1）。
#### 4.1.27 数据信号源..................................................................................................。

提供串行ATA数据信号的仪器。
#### 4.1.28 设备.....................................................................................................................

设备是一种存储外围设备。传统上，接口上的设备是硬盘驱动器，但只要设备符合本规范和ATA标准，任何形式的存储设备都可以放在接口上。
#### 4.1.29 设备端口 
设备端口是连接到设备的端口倍增器或端口选择器上的一个端口。
端口乘法器最多可以有15个设备端口。端口选择器有一个设备端口。
#### 4.1.30 DCB (DC block) 
直流电阻的定义是指能通过10 MHz至至少12 GHz的频率，且对信号的振幅或相位影响最小的设备。

#### 4.1.31 差分信号 
差分信号是正导体上的电压减去负导体上的电压（即TX+ - TX-）。
#### 4.1.32 DJ (确定性抖动--峰-峰) 
所有具有边界概率分布函数的抖动源（即边界外的值的概率为零）。确定性抖动有四种：占空比失真、数据依赖性(ISI)、正弦波、与数据不相关的有界抖动。DJ的特点是有界的、峰-峰值。
#### 4.1.33 DMA(直接内存访问) 
DMA是设备与主机内存之间的数据传输方式，无需主机处理器干预。
#### 4.1.34 Dword.....................................................................................................................

一个Dword是由32位组成的有序集合，最不重要的位是0位，最重要的位是31位。最不重要的位是0位，最重要的位是31位。
#### 4.1.35 Dword 同步化 
接收器已经识别了逗号序列，并从逗号字符的零点参考中产生一个对齐的Dword（四个连续字节）数据流的状态。
#### 4.1.36 EMI(电磁干扰) 
#### 4.1.37 编码字符 
编码字符是8b/10b编码器的输出--编码字符的结果。
一个编码字符由10位组成，其中0位是最重要的位，9位是最不重要的位。编码字符中的位被符号化地称为 "abcdeifghj"，其中 "a "对应于位0，"j "对应于位9。大小写是重要的。注意失序表示。关于字节、字符和编码字符之间的关系，请参见9.2节。
#### 4.1.38 端点设备......................................................................................................

端点设备是指ATA或ATAPI设备，由开机或复位后的设备签名报告。这可能包括硬盘驱动器、光盘驱动器和磁带驱动器。
#### 4.1.39 弹性缓冲器 
弹性缓冲区是接收机中执行字符滑移和/或字符对齐的部分。
#### 4.1.40 eSATA....................................................................................................................

系统到系统互连--外部桌面应用的使用模式（见5.2.6节）。

#### 4.1.41 Fbaud.....................................................................................................................

通过通道的标称数据速率，以 GHz 为单位。
#### 4.1.42 FER (帧错误率) 
参见7.2.2.1.2节。
## 4.1.43 第一方DMA数据阶段..................................................................................。

第一方DMA数据阶段是指从接收到DMA设置FIS到相关数据传输次数耗尽或影子中ERR位断言的这段时间。
状态寄存器。
## 4.1.44 第一方DMA访问权限。
第一方DMA访问是设备访问主机内存的一种方法。
## 4.1.45 FIS（帧信息结构）.........................................................................

帧的用户有效载荷，不包括SOFP、CRC和EOFPdelimiters。
## 4.1.46 frame......................................................................................................................

帧是主机和设备之间交换的不可分割的信息单位。一个帧由SOFP组成。
 帧信息结构、根据FIS内容计算的CRC和EOFP。
## 4.1.47 Gen1 
指以1.5 Gbps速度为特征的第一代信令。参见7.1节。
## 4.1.48 Gen1i 
内部电气规格为1.5 Gbps，电缆长度可达1米。
## 4.1.49 Gen1m。
短背板应用、外部桌面应用和数据中心应用中使用的电气规格，电缆长度可达2米，定义为1.5 Gbps。
## 4.1.50 Gen1x 
长背板应用和数据中心应用中使用的电气规格，支持长度达2米以上的电缆，定义为1.5 Gbps。
## 4.1.51 Gen2 
指以3.0 Gbps速度为特征的第二代信令。参见7.1节。
## 4.1.52 Gen2i。
内部电气规格为3.0 Gbps，电缆长度可达1米。
## 4.1.53 Gen2m 
短背板应用、外部桌面应用和数据中心应用中使用的电气规格，电缆长度可达2米，定义为3.0 Gbps。

## 4.1.54 Gen2x 
长背板应用和数据中心应用中使用的电气规格，支持长度达2米以上的电缆，定义为3.0 Gbps。
## 4.1.55 Gen3 
指以6.0 Gbps速度为特征的第三代信令。
## 4.1.56 Gen3i。
内部电气规格为6.0 Gbps，电缆长度可达1米。
## 4.1.57 HBA (Host Bus Adapter)........................................................................................。

HBA是连接到主机系统的扩展总线，为设备提供连接的组件。HBA也常被称为控制器卡或仅仅是控制器。
## 4.1.58 HBWS（高带宽范围 
测量路径中模拟带宽为10 GHz或更高的示波器。
**4.1.58.1 Gen1/Gen2要求**。
对于第1代/第2代的测量，必须在测量路径中使用模拟带宽为10GHz或更大的示波器。
**4.1.58.2 第3代要求**。
对于Gen3的测量，在测量路径中应使用模拟带宽为12GHz或更高的示波器。
## 4.1.59 HFTP(高频测试模式) 
此模式提供了串行ATA编码规则中允许的最大频率。
模式：1010101010 1010101010b = 编码D10.2。该模式是重复的。
## 4.1.60 热插拔 
将SATA设备连接到已经供电的主机系统。在插入/连接时，SATA设备已经供电或供电。请参阅7.2.5.1节，了解热插拔的详细情况。
## 4.1.61 主机端口 
主机端口是用来连接端口乘法器或端口选择器到主机的端口。埠
乘法器有一个主机端口。端口选择器有两个主机端口。
## 4.1.62 非活动端口 
非活动端口是指当前在端口选择器上没有选择的主机端口。
## 4.1.63 中断待定 
中断挂起是设备的一种内部状态，当设备协议要求设备通过断言INTRQ来通知主机发生事件时，给定条件是nIEN被断言为active-low为0时，这种状态就存在。

## 4.1.64 立即NCQ命令 
即时NCQ命令是指：a)在设备之前接受的任何命令之后，设备已经为其传输了DMA设置FIS，且尚未达到命令完成；b)在设备之前接受的任何NCQ命令之前，设备尚未为其传输DMA设置FIS。
## 4.1.65 ISI(符号间干扰) 
从比特序列(符号)的不同位置开始时，信号到达接收机门限所需的时间差引起的数据依赖性确定性抖动。例如介质对比特序列[ 0,1,0,1...]的峰值振幅的衰减比对比特序列[ 0,0,0,0,1,1,1,1...]的峰值振幅的衰减要大，因此用[ 0,1,0,1...]序列到达接收机阈值所需的时间比从[ 0,0,0,0,1,1,1,1...]序列所需的时间要少。与1位序列的运行长度相比，4的运行长度会产生较高的振幅，在改变位值时需要更多的时间来克服，因此会产生时间差。当不同的运行长度混合在同一传输中时，不同的比特序列（符号）因此会相互干扰。每当任何比特序列具有由传输介质以不同速率传播的频率成分时，都会出现ISI。这将转化为高频率、数据依赖性的抖动。
## 4.1.66 JMD(抖动测量装置) 
用于测量抖动的设备。例如，位错率测试仪（BERT）、时序间隔分析仪（TIA）、单枪捕获示波器和处理软件或HBWS。
## 4.1.67 JTF（抖动传输功能）。

一般来说，系统的JTF是输出变量的抖动幅度和相位与输入变量的抖动幅度和相位之比，作为正弦抖动激励的频率函数。在抖动定义的情况下，这定义了抖动的幅度，作为发射器允许产生或接收器容忍的频率函数。
在 JMD 的情况下，它定义了报告的抖动与应用的抖动的比率，作为正弦激励的频率函数。
## 4.1.68 垃圾 
在CONTP和链路上传输的另一个基元之间发送的8b/10b编码数据D字。所有的垃圾D字应被接收方忽略。
## 4.1.69 LBA(逻辑块地址) 
如ATA8-ACS标准中所定义。
## 4.1.70 LBP (Lone Bit Pattern)...........................................................................................。

该模式在7.2.4.3.5节中定义。该模式是重复的。
## 4.1.71 LED (發光二極體)  
## 4.1.72 传统模式 
传统模式是指使用ATA命令块和控制提供主机和设备之间命令和状态的软件透明通信的操作模式。
块寄存器。
## 4.1.73 法律字符 
合法字符是指存在有效解码的字符，无论是数据字符还是控制字符字段。由于运行差异的限制，并非所有的10位组合都会产生一个合法字符。串行ATA中额外的使用限制导致了进一步的减少。
SATA定义的控制字符空间。
## 4.1.74 LFSR（线性反馈移位寄存器）.................................................................。

请参阅第9.4.5节，了解在加扰中使用LFSR的详情。
## 4.1.75 LFTP (低頻測試模式) 
此模式提供了一个低频率，这在串行ATA编码规则中是允许的。
模式：0111100011 1000011100b = 编码D30.3。该模式是重复的。
## 4.1.76 LL（实验室负载）................................................................................................。

连接到被测设备的电气测试系统。LL接收来自UUT的信号，其阻抗水平为100欧姆差分和25欧姆共模。
## 4.1.77 LSS（实验室信号或实验室信号）..........................................。

连接到被测设备的仪器和电气测试系统。LSS以100欧姆差分和25欧姆共模的定义阻抗水平向被测单元提供信号。
## 4.1.78 MFTP (中频测试模式) 
此模式提供了一个中间频率，是串行ATA编码规则所允许的。
模式：1100110011 0011001100b = 编码D24.3。该模式是重复的。
## 4.1.79 NCQ串流命令。
NCQ流命令是使用FPDMA QUEUED协议的命令，其中的
ICC 字段为非零。
## 4.1.80 NCQ非流命令 
NCQ Non-Streaming命令是使用FPDMA QUEUED协议的命令，该命令的内容是
ICC字段为零。
## 4.1.81 OOB(带外信令) 
OOB 信令是由 D24.3 字符和空闲时间组成的 ALIGNPprimitives 或 Dwords 模式，用于初始化串行 ATA 接口。OOB 信令还用于从低功率状态恢复，并在测试模式下发出特定动作的信号。参考第8节。

## 4.1.82 OS-aware热插拔.................................................................................................。

将一个SATA设备插入到已断电的背板上。之后背板上电，设备和主机都上电，主机启动的OOB序列决定了SATA操作开始的时间。
## 4.1.83 OS-aware热移除...........................................................................................。

将SATA设备从供电的背板上移除，该设备首先处于静止状态。
## 4.1.84 Phy offline(离线) 
在这种模式下，主机Phy被强制关闭，主机Phy不识别也不响应于
COMINIT或COMWAKE。通过将SControl寄存器的DET字段设置为0100b进入该模式。这是主机关闭其Phy的一种机制。
## 4.1.85 PIO(程序输入/输出) 
PIO是访问设备寄存器的一种方式。PIO也被用来描述数据传输的一种形式。PIO数据传输是由主机处理器利用PIO寄存器访问数据寄存器来完成的。
## 4.1.86 端口地址 
控制端口和端口倍增器上的每个设备端口都有一个端口地址，端口地址用于在主机和特定设备或控制端口之间路由FIS。端口地址用于在主机和特定设备或控制端口之间路由FIS。
## 4.1.87 PRD(物理区域描述符) 
PRD表是DMA引擎使用的一种数据结构，它符合ATA/ATAPI主机
适配器标准。PRD描述了在DMA传输过程中作为数据源或目的地的内存区域。
 PRD表通常被称为散点/集合表。
## 4.1.88 基元..................................................................................................................。

基元是Link层用于传输控制的特殊D字。每个基元的字节0是一个控制字符。
## 4.1.89 基于协议的端口选择功能 
基于协议的端口选择是一种可由主机用于选择端口选择器上活动的主机端口的方法。基于协议的端口选择使用串行ATA OOB的序列。
Phy信号来选择活动的主机端口。
## 4.1.90 静态电源条件 
进入特定Phy的静止功率条件是指Phy进入7.5.2节定义的空闲总线条件。
## 4.1.91 RJ(随机抖动) 
随机抖动是高斯的。随机抖动等于给定10-12个误码率要求的1个标准偏差值的14倍的峰对峰值。
## 4.1.92 部门 
一组数据字节作为一个单元被访问和引用。

## 4.1.93 SEMB (Serial ATA Enclosure Management Bridge) 
ASEMB 是一个逻辑块，它将串行 ATA 事务转化为 I^2 C 事务，以便将机箱服务命令传达给存储设备处理器。
## 4.1.94 SEP (存储设备处理器) 
SEP是一个逻辑块，它与机柜中的各种机柜传感器和执行器相连接，并通过I^2 C接口与串行ATA机柜管理进行控制。
桥。
## 4.1.95 影子暫存器區塊暫存器...........................................................................。

影子寄存器块寄存器是接口寄存器，用于向设备发送命令或从设备发布状态。
## 4.1.96 侧带端口选择.........................................................................................

侧带端口选择是一种主机可以用来选择端口选择器上活动的主机端口的方法。侧带端口选择使用的机制不在串行端口选择器的范围内。
用于确定哪个主机端口处于活动状态的ATA协议。支持侧带端口选择的实现中使用的端口选择机制不在本规范的范围内。
## 4.1.97 SMART 
自我监测、分析和报告技术，用于预测设备退化和/或故障。
## 4.1.98 SSC(扩频时钟) 
稍微调制信号的工作频率，使其辐射发射分布在一定频率范围内的技术。这种降低给定频率的最大辐射有助于满足辐射发射要求。
#### 4.1.99惊喜热塞 
将SATA设备插入有电源的背板。设备上电并启动OOB序列。
#### 4.1.100 突发热移除 
将SATA设备从供电背板上移出，而不先置于静止状态。
#### 4.1.101 SYNC Escape 
SYNCP用于逃离当前接口上的FIS传输，并将链路重新同步回IDLE状态时的条件。SYNC Escape机制最常见的用途是使链路进入IDLE状态，以便向设备发送带有软件复位的控制寄存器FIS，但在其他时候也可能用于从错误的条件下恢复链路通信。SYNC Escape由传输层向链路层请求。
#### 4.1.102 TDR(时域反射计) 
用于测试被测设备阻抗的仪器。

#### 4.1.103 TIA（定时间隔分析仪）。
时序间隔分析仪的占空比失真和ISI噪声底限性能优于K28.5的UI的5%，上升和下降时间小于67 ps。
#### 4.1.104 TJ(总抖动) 
峰峰值为（14*RJ）+DJ。
#### 4.1.105 UI(单位间隔) 
等于传输一个比特所需的时间（例如Gen1的666.667 ps）。
#### 4.1.106 不可恢复的错误。
不可恢复的错误被定义为当设备设置了以下任何一个点时发生的错误
命令完成时，状态寄存器中的 ERR 位或 DF 位为 1。
#### 4.1.107 UUT(被测单元) 
被测产品和 "配接 "连接器的另一半（实际在实验室负载上，但被认为是UUT的一部分）。
#### 4.1.108 VNA（矢量网络分析仪）。
用于测试被测单元阻抗的仪器。
#### 4.1.109 温控插头 
设备连接，主机控制器供电，连接器引脚电源关闭（不供电）。
此机制用于Slimline应用，请参考6.3节。
#### 4.1.110 word 
一个字是一个有序的十六（16）位的集合，最小的是位0，最重要的是位15。最不重要的位是0位，最重要的位是15位。
#### 4.1.111 xSATA....................................................................................................................。


系统与系统之间的互联--数据中心应用使用模式（见5.2.5节）。
#### 4.1.112 零交叉 
要定位数据眼的零点交叉点，打开水平直方图功能，水平包围与 "边缘 "相关的所有波形，垂直限制在波形电压的+/-5%。零点交叉点 "就是波形的平均值的位置。
### 4.2 公约 
具有正常英语含义的词语使用小写。本文件中使用的某些词语和术语具有超出正常英语含义的特定含义。这些单词和术语在第 4.1 节或其首次出现的文本中都有定义。
缩写、命令、字段和用作信号名称的缩写词的名称均为大写字母（例如，IDENTIFY DEVICE）。只包含一个位的字段通常被称为 "名称 "位而不是 "名称 "字段。

设备寄存器的名称以大写字母开头（例如，Command）。
基元名称后面有一个 "P "下标（例如，R_OKP）。
#### 4.2.1 优先性............................................................................................................。

如果文本、数字和表格之间有冲突，则应以表格、数字为先，然后是文本。
#### 4.2.2 关键词 
使用了几个关键词来区分不同层次的要求和可选性。
**4.2.2.1 预期**。
用于描述本标准所假设的设计模型中硬件或软件行为的关键字。也可以实现其他硬件和软件设计模型。
**4.2.2.2强制性**。
表示本标准规定要实施的项目的关键字。
**4.2.2.3 可**。
表示选择灵活性的关键词，没有暗示偏好。
**4.2.2.4 na**。
表示某个字段或值不适用，没有定义值，收件人不应检查的关键字。
**4.2.2.5 过时**。
用于描述不同实施方式之间不再具有一致意义或功能的比特、字节、字段和代码值的关键词。然而，对于被指定为 "过时 "的项目，可能需要某种程度的功能，以提供后向兼容性。过时的位、字节、字段或命令不得在未来的任何标准中被重新使用。在以前的标准中被指定为 "过时 "的位、字节、字段和代码值，在本标准中可根据 "过时 "和 "退役 "的定义重新归类为 "退役"。
**4.2.2.6可选**。
描述本标准不要求的功能的关键字。但是，如果实现了本标准定义的任何可选功能，则应按本标准定义的方式实现该功能。
**4.2.2.7 退役**。
表示以前标准中定义的指定位、字节、字段和代码值在本标准中没有定义，可以在以后的标准中收回用于其他用途的关键字。废弃的位、字节、字段、代码值在被回收之前被使用时，其意义和功能应与以前的标准相同。
 **4.2.2.8 保留**。
表示为将来标准化而保留的位、字节、字、字段和代码值的关键字。它们的使用和解释可由本标准或其他标准的未来扩展来规定。保留位、字节、字或字段应清零，或按照本标准未来的扩展。接收者不得检查保留位、字节、字或字段。在定义的字段中接收到保留的代码值应被视为命令参数错误，并通过返回命令中止来报告。
**4.2.2.9 应**。
表示强制性要求的关键词。设计者必须实现所有这些强制性要求，以确保与其他符合标准的产品的互操作性。
**4.2.2.10应**。
表示灵活选择的关键词，具有强烈的优先选择权。相当于 "建议 "一词。
#### 4.2.3 编号 
不紧跟在小写 "b "或 "h "后面的数字是十进制值。
紧跟在小写 "b "后面的数字（如01b）是二进制值。
紧跟在小写 "h "后面的数字（如3Ah）是十六进制值。
#### 4.2.4 尺寸 
除非另有说明，所有尺寸均以毫米为单位。
#### 4.2.5 信号约定.................................................................................................。

信号名称均以大写字母显示。

#### 4.2.6 状态机约定 
对于每个要完成的功能，采用状态机的方法来描述序列要求。每个功能都是由若干个状态组成，以完成既定的目标。
 集合中的每个状态由一个单独的状态表来描述。下面的表1显示了构成函数的状态集的每个状态表的总体布局。
表1 - 状态表单元格描述
国家代号。国家名称：
动作列表[P | W]
过渡条件 0 下一个状态 0
过渡条件1 下一个状态1
每个国家都有一个国家代号和一个国家名称。在本文件的所有州图中，州代号在所有州中是唯一的。国家代号由一组字母组成，这些字母大写，然后是一个独特的数字。状态名称是对状态期间所采取的主要动作的简要描述，相同的状态名称可能出现在其他状态图中。如果同一状态图中的其他状态中出现了相同的主要功能，则在名称的末尾用唯一的字母指定。在状态中可以采取额外的动作，这些动作在状态描述文本中描述。
每个过渡由一个过渡标签和一个过渡条件来标识。过渡标签包括从哪个状态进行过渡的状态代号，然后是过渡到哪个状态的状态代号。过渡条件是对导致过渡发生的事件或条件的简要描述，可以包括当过渡发生时采取的过渡动作。这个动作在过渡描述文本中会有完整的描述。
进入一个状态后，所有在该状态下要执行的动作都会被执行。如果从自身重新进入一个状态，则该状态中所有要执行的动作都会被再次执行。
假设所有的动作都在一个状态中执行，并且从状态到状态的转换是瞬时的。
#### 4.2.7 字节、字和D字的关系.....................................................................。

一个字节中最重要的位（即位7）如左图所示（见图1）。
一个字可以表示为两（2）个字节的有序集合。最不重要的字节(下字节)是字节0，最重要的字节(上字节)是字节1。最重要的字节显示在左边（见图1）。
ADword可以表示为两（2）个字的有序集合。最不重要的字（下字）是字0，最重要的字（上字）是字1。最重要的词显示在左边（见图1）。
一个Dword可以表示为四（4）个字节的有序集合。最不重要的字节是字节0，最重要的字节是字节3。最重要的字节显示在左边（见图 1）。
图1）。)
 7 6 5 4 3 2 1 0
字节 1 5 1 4 1 3 1 2 1 1 1 0 9 8 7 6 5 4 3 2 1 0
字
字节 1 字节 0 3 1 3 0 2 9 2 8 2 7 2 6 2 5 2 4 2 3 2 2 2 1 2 0 1 9 1 8 1 7 1 6 1 5 1 4 1 3 1 2 1 1 1 0 9 8 7 6 5 4 3 2 2 1 0
字词
字1字0
字节3 字节2 字节1 字节0
图1--字节、字和D字的关系  
## 5 概述 ..................................................................................................................

串行ATA是一种高速串行链路，可替代大容量存储设备的并行ATA附件。采用的串行链路是一个高速差分层，利用千兆技术和8b/10b编码。
图2说明了如何将两个设备连接到并行ATA主机适配器上。这种方法允许使用主/从通信技术将最多两个设备连接到并行ATA总线。每个设备都是通过 "菊花链 "设备的带状电缆连接的。
## 图2 - 平行ATA设备连接方式 
驱动程序 
操作系统 
应用1 
应用2 
应用3
磁盘驱动器 磁盘驱动器 
平行
ATA适配器  
图3显示了使用Serial ATA HBA连接相同的两个设备的例子。
在该图中，深灰色部分与图2中的深灰色部分功能相同。
只知道并行ATA的主机软件以完全相同的方式访问Serial ATA子系统，并且功能正确。然而，在这种情况下，软件将这两个设备视为两个独立端口上的 "主设备"。HBA的右侧部分是一种新的设计，它将软件的正常操作转换为串行数据/控制流。串行数据/控制流。
串行ATA结构以点对点的方式用各自的电缆连接两个设备。
## 图3 - 串行ATA连接 
### 5.1 架构....................................................................................................................

串行ATA架构有四层。应用层、传输层、链路层和数据层。应用层
应用层负责ATA命令的整体执行，包括控制?
命令块寄存器的访问。
 传输层负责将控制信息和要在主机和设备之间传输的数据放在一个数据包/帧中，称为帧信息结构（FIS）。链路层负责从构建的帧中获取数据，用8b/10b对每个字节进行编码或解码，并插入控制字符，使10位数据流可以正确解码。物理层负责将编码后的信息作为串行数据流在导线上传输和接收。
串行ATA
HBA 
驱动程序 
操作系统 
应用1 
应用2 
应用3 
磁盘驱动器 
磁盘驱动器  
## 图4-通信层..................................................................................................

主机可以通过一个寄存器接口与应用层进行交互，该接口相当于传统并行ATA主机适配器所提供的接口。当使用并行ATA仿真时，主机软件在访问寄存器接口时遵循现有的ATA/ATAPI-6标准和约定，并遵循标准的命令协议约定。
### 5.2 使用模式 
本节介绍了串行ATA的一些潜在应用，包括利用诸如本地命令队列、机柜管理、端口管理等功能的使用模式。
乘法器和端口选择器。表2概述了本节中描述的不同使用模式，并强调了适用于这些使用模式的相对要求。
表2显示了第一列中的哪些特性是支持顶行中的使用模式所必需的。
特定特性(FS)旨在表明Gen1是必需的，但更高的数据速率是可选的。
注：与发射机和接收机相关的符合点的确切位置在7.2.2.4和7.2.2.5节中定义。
命令和应用（第 12 和 13 节）。
#### 主机所在层 
串行物理接口设备(第7和8节)
串行数字链路控制（第9节
串行数字传输控制（第10节
#### 设备所在层 
串行物理接口设备(第7和8节)
串行数字链路控制（第9节
串行数字传输控制（第10节
命令和应用(第11和13节)
应用层4
传输层3
链接层2
物理层1 
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n p ag e
##### 5 
##### 0 o f^6
##### 63 
## 表2 - 使用模式说明.............................................................................................。

##### C h a ra c te ri s ti c
In te rn a l
##### 1 m et er
##### C ab le d
##### H o st to
D ev ic e
##### S h o rt
B ac kp la n e to
##### D ev ic e
##### L o n g
B a c k p la n e to
##### D e v ic e
In te rn al
##### 4 - la n e
C a b le d
##### D is k
A rr ay s
##### Sys te m to
##### Sys te m
In te r c o n e ct s
##### – 
##### D a ta
##### C en te r
##### A p p li c at io n s x
##### S 
##### A 
##### T 
##### A 
##### S y st e m to
##### S y st e m
In te r c o n e ct s
##### – 
##### D at a
##### C en te r
##### A p p lic at io n s x
##### S 
##### A 
##### T 
##### A 
##### S y st e m to
##### S y st e m
In te r c o n e ct s
##### – 
##### E x te rn a l
##### D es kt o p
##### A p p lic at io n s e
##### S 
##### A 
##### T 
##### A 
##### P ro p ri et ar y
##### S e ri a l
##### A 
##### T 
##### A 
##### D is k
A rr a ys
##### S e ri a l
A
##### T 
##### A an d
S
##### A 
##### S 
##### L 
##### IF 
##### - 
##### S 
##### A 
##### T 
##### A 
##### U se m o de l se ct io n um be r.
##### 5.

##### 2.

##### 1 
##### 5 
##### .^2 
##### .^2 
##### 5 
##### .^2 
##### .^3 
##### 5.

##### 2 
##### .^4 
##### 5 
##### .^2 
##### .^5 
##### 5 
##### .^2 
##### .^5 
##### 5 
##### .^2 
##### .^6 
##### 5 
##### .^2 
##### .^7 
##### 5.

##### 2.

##### 8 
##### 5.

##### 2 
##### .^1 
##### 0 
##### C a bl e an d/ o r b ac kp la n e ty pe.
在tS
##### L 
##### B 
##### P 
##### B 
##### P 
在t
##### M 
##### L 
##### Ext
##### M 
##### L 
##### Ext
##### M 
##### L 
##### Ext
##### S 
##### L 
##### B 
##### P a n d ca bl e
##### B 
##### P 
##### P 
##### C a bl e le ng th
##### <= 
##### 1 m
##### < 
##### = 
##### 1 m
##### < 
##### = 
##### 2 m *s u bj e ct to e le ct ri ca l re q ui re m en ts.
##### < 
##### = 
##### 2 m
##### P 
##### C a bl e
E le ct ri ca l
##### T ab le 18
##### P 
##### P 
##### T a bl e
##### 18 
##### T a bl e
##### 20 
##### T ab le
##### 2 
##### 1 
##### T ab le
##### 1 
##### 9 
##### T ab le
##### 1 
##### 8 
##### P 
##### T a b le 1
##### 8 
##### A tte nu at io n a t.
##### 4 
##### .^5 
##### G 
##### H z
##### -^6 d
##### B 
##### P 
##### -^1 
##### 6 dB
##### -^6 dB
##### -^8 d
##### B 
##### -^1 
##### 6 dB
##### -^8 d
##### B 
##### -^6 d
##### B 
##### P 
##### -^6 d

##### B 
##### H o st
- sid e co nec to r
##### 6.

##### 1.

##### 5 
##### P 
##### P 
##### 6.

##### 1 
##### .^1 
##### 1 o r
##### 6.

##### 1 
##### .^1 
##### 2 
##### 6 
##### .^5 
##### .^3 (k ey
##### 7 ) 
##### 6 
##### .^5 
##### .^2 o r
##### 6 
##### .^5 
##### .^3 (k ey
##### 1 
##### ) 
##### 6 
##### .^5 
##### .^1 
##### 6 
##### .^1 
##### .^5 o r
##### P 
##### S 
##### A 
##### S 
##### 6.

##### 4.

##### 3 
##### D e vi ce
- sid e co nec to r
##### 6.

##### 1.

##### 3 
##### .^1 
##### 6 
##### .^1 
##### .^3 
##### .^1 
##### 6 
##### .^1 
##### .^3 
##### .^1 (i ns id e ca ni st e r)
##### 6.

##### 1 
##### .^3 
##### .^1 
##### 6 
##### .^5 
##### .^3 (k ey
##### 7 ) 
##### 6 
##### .^5 
##### .^2 o r
##### 6 
##### .^5 
##### .^3 (k ey
##### 1 o r
##### 4 
##### ) 
##### 6 
##### .^5 
##### .^1 
##### 6 
##### .^1 
##### .^3 
##### .^1 
##### 6.

##### 1.

##### 3 
##### .^1 
##### 6.

##### 4.

##### 2 
##### G en 1 i 1
##### .^5 
##### G b p s
##### R 
##### D (h o st to p ro vi d e receiv e d si gn al)
##### ) 
##### D 
##### R 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### R 
##### D 
##### R 
##### G en 1 m 1
##### .^5 
##### G b p s
##### N 
##### S 
##### H 
##### N 
##### S 
##### N 
##### S 
##### R (k ey)
##### 7 ) 
##### N 
##### S 
##### R 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n p ag e
##### 5 
##### 1 o f^6
##### 63 
##### C h a ra c te ri s ti c
In te rn a l
##### 1 m et er
##### C ab le d
##### H o st to
D ev ic e
##### S h o rt
B ac kp la n e to
##### D ev ic e
##### L o n g
B a c k p la n e to
##### D e v ic e
In te rn al
##### 4 - la n e
C a b le d
##### D is k
A rr ay s
##### Sys te m to
##### Sys te m
In te r c o n e ct s
##### – 
##### D a ta
##### C en te r
##### A p p li c at io n s x
##### S 
##### A 
##### T 
##### A 
##### S y st e m to
##### S y st e m
In te r c o n e ct s
##### – 
##### D at a
##### C en te r
##### A p p lic at io n s x
##### S 
##### A 
##### T 
##### A 
##### S y st e m to
##### S y st e m
In te r c o n e ct s
##### – 
##### E x te rn a l
##### D es kt o p
##### A p p lic at io n s e
##### S 
##### A 
##### T 
##### A 
##### P ro p ri et ar y
##### S e ri a l
##### A 
##### T 
##### A 
##### D is k
A rr a ys
##### S e ri a l
A
##### T 
##### A an d
S
##### A 
##### S 
##### L 
##### IF 
##### - 
##### S 
##### A 
##### T 
##### A 
##### G en 2 i 3
##### .^0 
##### G b p s
##### F 
##### S 
##### D (h o st to p ro vi d e receiv e d si gn al)
##### ) 
##### D 
##### F 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### F 
##### S 
##### D 
##### F 
##### S 
##### G en 2 m 3
##### .^0 
##### G b p s
##### N 
##### S 
##### H 
##### N 
##### S 
##### N 
##### S 
##### F 
##### S (k e y)
##### 7 
##### ) 
##### N 
##### S 
##### F 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### G en 1 x 1
##### .^5 
##### G b p s
##### N 
##### S 
##### N 
##### S 
##### H 
##### , 
##### D 
##### N 
##### S 
##### N 
##### S 
##### R 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### G en 2 x 3
##### .^0 
##### G b p s
##### N 
##### S 
##### N 
##### S 
##### H 
##### , 
##### D 
##### N 
##### S 
##### N 
##### S 
##### F 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### G en 3 i 6
##### .^0 
##### G b p s
##### F 
##### S 
##### N 
##### S 
##### N 
##### S 
##### F 
##### S 
##### N 
##### S 
##### N 
##### S 
##### N 
##### S 
##### F 
##### S 
##### D 
##### F 
##### S 
##### H o tp lu g su pp or t.
##### N 
##### S 
##### R 
##### R 
##### N 
##### S 
##### R 
##### R 
##### R 
##### R 
##### R 
##### N 
##### S 
##### K ey
##### : R 
##### – 
##### R e q ui re d
##### : co nf ig ur at io n re q ui re s a pp ro pr ia te ca p ab ili tie s.
##### F 
##### S 
##### – 
##### F ea tu re sp ec ifi c
##### : co n fig u ra tio n is su p po rt e d by sp ec ifi ca tio n b but m a y b e tie d to a n o pt io na lc a pa bi lit y.
##### N 
##### O 
##### T 
##### E 
##### :F e at u re sp e ci fic is in tend ed to in di c at that.
##### G e n^1 is re qu ire d but hig her da ta ra te s ar e o pt io na l.
##### N 
##### S 
##### – 
##### 不适用
##### : co nf ig ur at io n is n ot su p po rt e d by d ef in iti o n in sp e ci fic a tio n.
##### P 
##### – 
##### P ro p rie ta ry
##### : im pl e m e nt a tio n is ve n do r sp e ci fic a nd n o td ef in ed in sp ec ifi ca tio n.
##### H 
##### – 
##### H o st
##### D 
##### – 
##### D e vi ce
##### S 
##### L 
##### - si n g le la ne
##### M 
##### L 
##### - m u lti
- l an e
在t
##### – 
In te rn al
##### Ext
##### – 
##### Ext er na l
##### B 
##### P 
##### – 
##### B a ck pl a ne
N
##### O 
##### T 
##### E 
##### : 

##### M a ny of th e fe re nc e s in th e ta b le a re se ct io n n um be rs or n ot a tio n s of cl a rif ic a tio n w hi ch d o no re qu ire。
##### K e y va lu es 
#### 5.2.1 内部1米电缆主机到设备.................................................................。

在此应用中，符合Gen1i、Gen2i或Gen3i电气规格的点位于主机控制器和设备上的Serial ATA配接连接器处。在第6节中指定的电缆，工作在1.5 Gbps、3.0 Gbps和6.0 Gbps。该应用可能符合第7.2.5节中描述的电气热插规格。
## 图5--内部1米有线主机到设备应用图。
主机控制器
设备设备
设备设备
Gen1i / Gen2i / Gen3i.
遵守要点
Gen1i / Gen2i / Gen3i.
遵守要点 
#### 5.2.2 短背板至设备 
在此应用中，小型磁盘阵列中的Gen1i/2i磁盘设备被安装到驱动器罐中，而驱动器罐被插入到一个 "短 "背板中。连接到背板的主机控制器应包含一个超过Gen1i/2i发射器和接收器差动规格的主机组件，以使主机控制器连接器上的信号符合或超过 "短 "背板。
Gen1m/2m电气规格。该符合点的所有其他电气规格应符合Gen1i/2i规格。合规点位于设备(Gen1i/2i)和主机控制器(Gen1m/2m)的串行ATA配接连接器上。在主机控制器连接器上的信令可能会超过Gen1m/Gen2m的最大传输量，但必须满足以下条件
在设备连接器处不超过Gen1i/Gen2i接收器的最大值。该应用不包含电缆，但在印刷电路板上以1.5 Gbps和3.0 Gbps的速度路由串行ATA信号，预计背板对信号的衰减比第6节中描述的合规铜缆要大。
Gbps，预计背板对信号的衰减比第6节中描述的合规铜缆要大。负担落在主机控制器上，以增加发射信号摆动，并适应主机控制器连接器上较小的接收摆动。该
Gen1i/2i设备不需要遵守第7.2.5节所述的热插拔电气规范。但是，遵守热插拔电气规范会带来实际应用的好处。
注意：在Gen2速度下，设计者面临着有关信号完整性问题的重大挑战。尚未提供Gen2速度下的验证/可行性数据。使这一工作由系统设计者决定。使用实验室负载来测量设备连接器处的主机控制器振幅或抖动，并与 
表33不合适。由于发射机和接收器的非理想阻抗匹配，需要额外的余量。当信号从实验室来源的信号中应用时，接收器被测试在这些振幅和抖动水平下工作。
## 图6 - 短背板到设备的应用 
#### 5.2.3 长背板至设备 
在这个1.5 Gbps或3.0 Gbps的应用中，背板的长度比前面的例子要长，因此信号的衰减会使它们的振幅降低到超出可用的水平。因此，可以在设备和罐体的连接器到背板之间放置一个IC，以将磁盘的Gen1i/Gen2i电平转换为Gen1x/Gen2x电平。一个典型的电路可能是一个串行ATA端口，它可以将硬盘的Gen1i/Gen2i电平转换为Gen1x/Gen2x电平。
选择器。同样，主机控制器与主机控制器的背板连接器也符合Gen1x/Gen2x级别。这允许通过比上述短背板应用更长的背板可靠地传输串行ATA数据。确定背板应用是短板还是长板的责任由系统设计者根据系统的衰减来承担。合规点位于罐体(Gen1x/Gen2x)和主机控制器(Gen1x/Gen2x)的串行ATA配接连接器上。罐体上的
Gen1x/Gen2x电气规格要求具有热插拔功能，以便在不损坏磁盘/滤筒的情况下进行插拔。
设备
Gen1m合规点(4个)
驱动罐
背板
Gen1i合规性
点数（4个点）
主机控制器 
## 图7 - 长背板到设备应用.........................................................................

#### 5.2.4 内部四线电缆磁盘阵列 
在此应用中，Gen1i、Gen2i和Gen3i串行ATA设备通过内部4线电缆解决方案连接到主机控制器。Gen1i、Gen2i和Gen3i规格应在4线电缆配接接口的两端得到满足。内部4线电缆应通过以下两种方式之一与设备连接。
- 内部4线方案的主机端应直接与主机控制器板配接。设备端应包括四条独立的单通道串行ATA电缆，以便与最多四个独立的串行ATA设备直接配接。

- 内部4线解决方案的主机端应直接连接到主机控制器板。内部4线电缆的设备端应包括与背板相连的单个内部4线连接器，背板为最多四个串行ATA设备提供单独的连接点。背板设计是专有的。

设备端
Gen1x / Gen2x
遵守要点
驱动罐
背板
Gen1i/Gen2i合规性
点数
##### ICIC 
##### ICIC 
##### ICIC 
##### ICIC 
##### ICIC 
##### ICIC 
##### ICIC 
##### ICIC 
##### ...

Gen1x/Gen2x
遵守要点
主机控制器 
在第二种解决方案中，背板的衰减会使符合点的信号幅度降低到规格限制以下。一个IC，如端口选择器，应放在设备和内部4线电缆配接接口之间。在4线电缆配接的接口和设备配接的连接器接口的两端，应满足Gen1i、Gen2i和Gen3i规格。
## 图 8 - 内部 4 线缆磁盘阵列 
注意：对于 Gen2i 和 Gen3i 设备，从主机到驱动器的链接（通过背板上的 IC）没有 "交付信号 "到驱动器的电气规范。
考虑背板-驱动器连接器的符合点（通过配接对）。如果符合点的信号，进入实验室的负载符合表 29 和表 29 的所有要求。
设备
专有
背板
Gen1i合规性
点数（4个点）
串行ATA
主机
内部4车道电缆
Gen1i / Gen2i / Gen3i.
合规点(8个)
IC以确保Gen1i/Gen2/Gen3i。
合规(8件)
驱动罐 
表31，而背板符合表30的所有要求，那么就可以确认互操作性。
然而，预计背板上IC和背板-设备连接器之间的额外跟踪长度会使其难以符合这些规范。确保与所有Gen1i/Gen2i器件的互操作性的责任落在了系统的实现者身上。基本上，实施者将使用模拟和经验结果来确认背板-设备连接器处的合规点相当于或优于合规的主机和电缆组合。
#### 5.2.5 系统对系统的互连--数据中心应用 (xSATA) 
此应用被定义为需要在系统间建立一个以上串行链接的外部存储应用。此应用使用第6.5.2和6.5.3节中定义的外部多路电缆，可称为xSATA。
对于需要大约两米或更少电缆的系统到系统的互连（即基座到基座、基座到基座、基座到基座）。
对于需要约两米或更少电缆的系统到系统互连（即底座到底座、刀片到刀片或机架内连接），可以使用Gen1m/Gen2m或Gen3m电缆。
使用Gen1x/Gen2x电气规范。对于需要距离超过两米（即机架到机架）的系统到系统互连，则使用Gen1x/Gen2x电气规格。
所有外部串行ATA电缆均以1.5 Gbps和3.0 Gbps的速度运行。允许使用工作在1.5 Gbps但不工作在3.0 Gbps的电缆，但该电缆组件不得与标准Serial ATA电缆互换。例如，如果该1.5 Gbps电缆使用Serial?
ATA指定的连接器，电缆必须通过键控，以确保它不能插入到标准的 "标准 "连接器。
串行ATA连接。热插拔性是本应用中的一个要求。
合规点位于每个系统的配接隔板连接器处，如图9中的实施例所示。如果系统中包含一个SATA端点设备，则不应直接连接到外部连接器。相反，应在外部连接器和端点设备之间使用桥接器。桥接器的一些例子包括中继器/定时器、端口乘法器和 RAID 控制器。
注意：不允许在Gen1m/Gen2m和Gen1x/Gen2x系统之间进行互连。
注意：没有为xSATA定义Gen3。

## 图 9 - 系统对系统的数据中心互连.............................................................。

Gen1m/Gen2m
遵守要点
串行ATA
体系
串行ATA
##### | 
##### _____ <两米
##### _____ 
##### | 
限定长度的外部多线互连
串行ATA
系统 h h h h
Gen1i / Gen2i / Gen3i.
遵守要点
主机桥
控制器
串行ATA
体系
Gen1x / Gen2x
遵守要点
串行ATA
体系
串行ATA
体系
加长型外部多线互连h h h h h
Gen1i / Gen2i / Gen3i.
遵守要点
主机桥
控制器
串行ATA
体系 
#### 5.2.6 系统对系统的互连--外部桌面应用（eSATA）........。

该应用针对的是需要约两米或更少电缆长度的单通道的外部存储应用。该应用使用6.5.1节中定义的外部单通道连接器系统，可称为eSATA。
注意：eSATA没有定义Gen3i。
在下图所示的例子中。
 设备外壳包含一个Gen1i/Gen2i设备和一个包含集成电路的中间卡，除非该设备是专门为外部连接设计的。无论采用何种实现方式，当以Gen1速度运行时，设备外壳的外部应符合Gen1m规格，当以Gen2速度运行时，应符合Gen2m规格。已为该应用定义了一种同时在Gen1和Gen2速度下工作的电缆/连接器。主机系统有一个符合以下要求的外部连接器
以Gen1速度运行时，应符合Gen1m规格，以Gen2速度运行时，应符合Gen2m规格。
整个系统应满足以下要求。
- 电缆/连接器应以Gen1和Gen2速度运行。当主机系统和设备外壳均符合Gen2m电气规格时，系统不得部署任何不能以Gen2速度运行的电缆。
- 当主机系统和设备外壳以Gen1速度运行时，应符合Gen1m规格。
- 主机系统和设备外壳可在Gen2速度下运行，但如果在Gen2速度下运行，则主机系统和设备外壳应符合Gen1m规格。然而，如果它们以Gen2速度运行，则主机系统和设备外壳在Gen2速度下运行时应符合Gen2m规格，并应能够使用Gen1m电气规格以Gen1速度运行。
- 主机系统和设备外壳应符合本文件中的热插拔规格。
- 注：强烈建议 Gen1m 的主机系统和设备外壳的发射器和接收器采用交流耦合，Gen2m 则需要采用。

## 图 10 - 外部桌面应用 
设备外壳
Gen1m / Gen2m
符合点设备
##### ICIC 
Gen1i / Gen2i / Gen3i.
合规点
Gen1m / Gen2m
合规点
主机系统 
#### 5.2.7 专用串行ATA磁盘阵列 
在此应用中，串行ATA设备连接到背板上，链接通过内部背板或电缆以及外部电缆组合路由到串行ATA系统。设备和系统之间没有半导体，因此中间连接器不是合规点。虽然允许这种应用，但磁盘阵列上的外部连接器不得是标准的Serial ATA连接器。这是为了防止用户在系统和磁盘阵列之间连接标准外部电缆，因为它们可能无法可靠地工作。
注意：由于接口的复杂性，设计者在信号完整性问题上面临重大挑战，这可能需要额外的余量。尚未提供验证/可行性数据。让这个工作由系统设计者决定。使用实验室负载来测量设备连接器处的主机控制器振幅或抖动，并与表33进行比较是不合适的。当信号从实验室来源的信号应用时，接收器被测试为在这些振幅和抖动水平下工作。
## 图11 - SATA磁盘阵列.......................................................................................................

#### 5.2.8 串行ATA和SAS 
SAS参考是一个标准，它规定了通过串行链路的SCSI传输协议。该
SAS标准大量借鉴了SATA Phy、Link和传输层。一个SAS域可以支持连接到未修改的SATA设备的附件和控制，直接连接到SAS域。
使用串行ATA隧道协议（STP）的SAS域。
设备
驱动罐
背板
专有
电缆或PCB
串行ATA
体系
专有
缆线
Gen1i / Gen2i / Gen3i.
合规点(4个)
不遵守规定
点数（8个点）
Gen1i / Gen2i / Gen3i.
合规点(4个) 
#### 5.2.9 潜在的外部SATA不兼容问题.....................................................。

警告：本规范没有定义外部桌面和外部数据中心的应用功能，因此，即使所有的组件都符合本文档中定义的电气规格，连接的两个系统也可能无法互通。因此，即使所有的组件都符合本文档中定义的电气规格，连接的两个系统也可能无法互操作。外部应用程序不需要支持端口乘法器或端口接口。
选择器。因此，具有外部数据中心连接器的主机可能会连接到包含端口多路复用器的磁盘阵列上，从而导致系统无法正常运行。
#### 5.2.10 移动应用 
除嵌入式应用外，本文件中未定义串行ATA设备在移动计算机内或与移动计算机连接的应用和合规点。如果为该应用开发了任何专有电缆/连接器或电气规格，则系统的设计应防止与标准SATA组件连接。如果在移动计算机内、基座内或外部存储组件上使用标准电缆/连接器/电气接口。
 这些产品应符合本规范中的适用要求，并能与串行ATA组件正常运行。
内部应用。
所有内部接口应符合Gen1i、Gen2i和/或Gen3i规格。任何移动计算机设计者可以自由修改移动计算机内主机和设备的电气规格，但是，所有专有接口的设计应防止与标准SATA组件连接。
扩展坞应用。
專有的基座接口必須設計成防止與標準的SATA元件連接。
SATA组件。
外部应用。
移动计算机上的外置串行ATA接口的应用可以使用外置串行ATA组件。
台式机电缆/连接器(Gen1m/Gen2m)或系统到系统数据中心电缆/连接器(Gen1m/Gen2m或Gen1x/Gen2x)。專有解決方案的設計應防止與標準SATA元件連接。

嵌入式应用
## 图12 - 嵌入式LIF-SATA应用 
在此应用中，设备通过柔性印刷电路电缆(FPC)连接到主机控制器。FPC接口应符合表18中列出的Gen1i电气要求。
合规点如图12所示。Gen2i或Gen3i符合性是针对特定功能的，但如果实施，也应符合表18中列出的电气要求。
#### 5.2.11 端口倍增器应用示例 
端口倍增器的一个可能应用是增加机柜中的串行ATA连接数，因为机柜中的所有设备没有足够的串行ATA连接数。图 13 中显示了一个例子。具有两个多线电缆的多线电缆
串行ATA连接被送到机柜上。机柜包含八个串行ATA设备。要创建适当数量的串行 ATA 连接，可使用两个 1-4 端口乘法器来创建八个串行 ATA 连接。
LIFSATA 连接器 LIFSATA 连接器
主机FPC设备 
##### - - 
Gen1i / Gen2i / Gen3i.
遵守点
Gen1i / Gen2i / Gen3i.
遵守点 
###机架 图13 - 机柜示例，使用串行ATA连接的端口多路复用器作为机架内的连接。
另一个例子如图14所示。光纤通道、Infiniband或千兆以太网被用作机架内与机柜的连接。在机柜内部，一个主机控制器从交付的连接中创建两个串行ATA连接。机柜包含八个串行
ATA设备。要创建适当数量的串行ATA连接，需要两个1到4的端口。
乘法器用于创建八个串行ATA连接。
**驱动器外壳** 
#### 多车道 
#### 串行ATA 
#### 
## 港口 
##乘数  
## 图14 - 机柜示例，使用机架内不同连接的端口倍增器。
端口多路复用器允许在这些机柜中使用具有适量连接数的主机控制器，然后根据产品需求增加连接数。
另一个应用实例是使用端口多路复用器来增加移动坞站中的串行ATA连接数。图15中所示的例子在笔记本电脑和坞站之间有一个专有接口。该专有接口可以路由一个
从笔记本电脑到扩展坞的串行ATA连接，或扩展坞可能会产生一个 "串行ATA"。
串行ATA连接本身。扩展坞将串行ATA连接路由到一个端口。
乘法器，为要连接的设备数量创建适当数量的串行ATA连接。
**驱动器外壳** **光纤通道。
InfiniBand，或
千兆以太网** **端口倍增器**  
## 图15 - 使用端口乘法器的移动坞站示例。
这些都是端口乘法器可能应用的几个例子，并不意味着包罗万象。
#### CD 
#### 外置硬盘 
#### 其他 
#### 基于串行ATA的 
#### 外围设备 
#### "楔形 "或 
#### 笔记本电脑或扩展坞 
#### 移动设备   
## 6 电缆和连接器 ........................................................................................................

本节定义了串行ATA的连接器和电缆组件。它规定了
- 连接器之间的配合接口
- 串行ATA设备上的连接器位置
- 连接器和电缆组件的电气、机械和可靠性要求。
串行ATA连接器的配接接口仅根据其前端（即可分离）特性来定义。
串行ATA连接器的配合接口仅根据其前端（即可分离）特性来定义。所有SATA内部和外部连接器的接触配接区域应采用金色或与金色兼容的表面处理。除非另有规定，否则连接器的后端特性，包括表面处理、PCB安装特性和电缆终端特性都没有定义。
### 6.1 内部电缆和连接器。
.....................................................................................

#### 6.1.1 内部单通道说明............................................................................。

串行ATA设备可以直接与主机连接，也可以通过电缆与主机连接。
对于直接连接，设备插头连接器（如图16中的(a)和(b)所示）直接插入背板连接器，如图16中的(g)所示。设备插头连接器和背板连接器具有使直接连接可热插拔和可盲配的特性。
对于通过电缆连接，设备信号插头连接器，如图16中的(a)所示，与电缆一端的信号电缆插座连接器配接，如图16中的(c)所示。电缆另一端的信号电缆插座连接器插入主机信号插头连接器，如图16中的(f)所示。信号电缆线由两段双轴线组成，在一个共同的外护套中。
除了信号线外，还有一根单独的电源线用于电缆连接。A 串行
ATA电源线一端包括如图16中的(d)所示的电源线插座连接器，可以直接连接到另一端的主机电源，也可以在另一端包括电源线插座。电源线插座一端的电源线连接器与设备电源插头连接器对接，如图16中的(b)所示。电源电缆的另一端根据需要连接到主机上。

##图16--串行ATA连接器实例.................................................................................。

如上图所示。(a)设备信号插头段或连接器；(b)设备电源插头段或连接器；(c)信号电缆插座连接器，需与(a)配接；(d)电源电缆插座连接器，需与(b)配接；(e)信号电缆插座连接器，需与(f)、主机信号插头连接器配接；(g)背板连接器直接与设备插头连接器(a)&(b)配接。
(a) (b) ( c ) (d) (e) (f) (g) **6.1.1.1**。
图17显示了直接电缆/连接器连接，并突出了差分TX和RX对的信号路径。
## 图17 - SATA电缆/连接器连接图 
左边的连接器代表主机，其TX/RX差分线对连接到电缆上。
右边的连接器表示设备，其TX/RX差分对也连接到电缆上。还请注意连接电缆屏蔽层和电缆插座的接地路径。
图18显示的是主机和设备之间的直接连接。除电缆外，它与电缆/连接器的连接类似。
#### A+ 
#### A- 
##### GND 
##### GND 
#### B- 
#### B+ 
##### GND 
钥匙
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
主机Tx+
主机Tx-
主机Rx-
主机Rx+
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
#### A+ 
#### A- 
##### GND 
##### GND 
#### B- 
#### B+ 
##### GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
##### GND 
主机
插头
缆线
插座
缆线
插座
设备
插头
主机芯片、PCB和连接器电缆和连接器
器件芯片、PCB和连接器
#### A+ 
#### A- 
##### GND 
##### GND 
#### B- 
#### B+ 
##### GND 
钥匙
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
主机Tx+
主机Tx-
主机Rx-
主机Rx+
主机Tx+
主机Tx-
主机Rx-
主机Rx+
主机Tx+
主机Tx-
主机Rx-
主机Rx+
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
#### 2 
#### 3 
#### 4 
#### 1 
#### 5 
#### 6 
#### 7 
钥匙
#### A+ 
#### A- 
##### GND 
##### GND 
#### B- 
#### B+ 
##### GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
##### GND 
主机
插头
缆线
插座
缆线
插座
设备
插头
主机芯片、PCB和连接器电缆和连接器
器件芯片、PCB和连接器 
## 图18 - SATA主机/设备连接图 ..................................................................

在这两种情况下，主机侧的TX差分信号对与设备侧的RX差分信号对的连接。主机的RX信号对与设备的RX信号对也有类似的连接。
TX对也有显示。
#### 6.1.2 连接器位置 
定义设备连接器位置是为了方便盲插。
图19和图20定义了5.25 "器件的连接器位置。光学器件应按照光学器件连接器位置中的指示来确定连接器的位置。非光学设备应将连接器定位在光学设备连接器位置上，但也可将连接器定位在非光学设备备用连接器位置上。串行ATA连接器通常与设备因子的端部齐平。
图21定义了侧装3.5 "设备的连接器位置。
 图22定义了底部安装的3.5 "设备的连接器位置。请参阅EIA-740和SFF-8301，了解3.5 "设备外形规格。串行ATA连接器通常与设备系数的末端齐平。
图23定义了侧装2.5 "设备上的连接器位置。图24定义了底部安装的2.5 "设备的连接器位置。请参阅EIA-720和SFF-8201了解2.5 "设备外形规格。串行ATA连接器名义上从设备外形尺寸的末端突出0.3毫米。
图25定义了侧装1.8 "设备的串行ATA连接器位置。图26定义了底部安装的1.8 "设备上的串行ATA连接器位置。请参阅SFF-8111了解1.8 "设备的外形规格。串行ATA连接器通常从设备外形尺寸的末端突出0.3毫米。
为了确保设备与背板的配接具有正确的机械和电气接口，并且没有物理冲突，图38说明了设备与名义上的背板完全配接的状态。
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
主机Tx+
主机Tx-
主机Rx-
主机Rx+
GND 
主芯片、PCB和连接器
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
器件芯片、PCB和连接器
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
直接连接
器件芯片、PCB和连接器
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
主机Tx+
主机Tx-
主机Rx-
主机Rx+
主机Tx+
主机Tx-
主机Rx-
主机Rx+
主机Tx+
主机Tx-
主机Rx-
主机Rx+
GND 
主芯片、PCB和连接器
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
器件芯片、PCB和连接器
A+ 
A- 
GND 
GND 
B- 
B+ 
GND 
钥匙
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
Dev Rx+
Dev Rx-
Dev Tx-
Dev Tx+
直接连接
器件芯片、PCB和连接器平装背板插座，图27定义了所有外形尺寸器件的禁区。应用应确保这些区域不包含任何妨碍完全配接状态的材料或结构。
## 图19 - 5.25 "外形尺寸上的光学设备插头连接器位置  
## 图20 - 5.25 "外形尺寸上的非光学备用设备插头连接器位置  
## 图21 - 3.5 "侧装设备上的设备插头连接器位置。 
## 图22 - 3.5 "底部安装设备上的设备插头连接器位置。 
## 图23 - 2.5 "侧装设备上的设备插头连接器位置。 
## 图24 - 2.5 "底部安装设备上的设备插头连接器位置。 
## 图25 - 1.8 "侧装设备上的设备插头连接器位置。 
## 图26 - 1.8" 底部安装设备上的设备插头连接器位置。 
## 图27 - 设备插头连接器防区 
注释：1: 1. 图28中，基准点A上方的1.50保持区延伸到外形尺寸至连接器基准点C。
2. 细节1中所示的1.00保持区域适用于连接器的两端，并从连接器外壳向外延伸至外形尺寸的最外侧。

#### 6.1.3 配套接口 **6.1.3.1 设备插头连接器**。
图28和图29显示了带信号和电源段的设备插头连接器的接口尺寸。设备插头包括可选功能，允许使用闩锁电缆、圆角和附加材料来提高连接器的坚固性。表3定义了热插头的引脚定义和触点配接顺序。这些可选功能应包括在所有插头设计中。

## 图28 - 设备插头连接器...............................................................................................
 
## 图29 - 设备插头连接器(其他视图)..................................................................
  **6.1.3.2 引脚信号定义和触点配接顺序**。
表3详细介绍了两种SATA插头选项的引脚名称、类型和接触顺序，还包括信号、接地和电源引脚的简要说明。表中还包括了信号、接地和电源引脚的简要说明。信号段共有7个引脚，电源段共有15个引脚。
## 表 3 - 信号和电源 SATA 插头和标称匹配顺序 
配套配置注意事项
- 所有引脚均为单排，间距为1.27毫米（0.050"）。
- 串行ATA设备插头电源段中的所有接地引脚（连接器引脚P4、P5、P6、P10和P12）应在串行ATA设备上总线化。
- 串行ATA设备信号地和电源地之间的连接是由厂商指定的。
- 串行 ATA 设备插头电源段中的以下几组电压引脚应在串行 ATA 设备上串联在一起。
名称类型 说明 电缆用途 2、3
背板
用途^3
信号段键
S1 GND 1 stMate 2nd Mate
S2 A+ 2nd Mate 3nd Mate
S3 A-
差分信号对 A 2nd Mate 3rd Mate
S4 GND 1 stMate 2nd Mate
S5 B- 2nd Mate 3nd Mate
S6 B+
差分信号对B 2nd Mate 3rd Mate
S ig na lSeg m e nt
S7 GND 1 stMate 2nd Mate.
信号段 "L"

中央连接器间隙^4
功率段 "L"
P1 V 33 3.3 V 电源 2nd Mate 3 rd Mate
P2 V 33 3.3 V 电源 2ndMate 3rdMate
P3 V 33 3.3 V 电源，预充电 1 stMate 2ndMate
P4 GND 1 stMate 1stMate
P5 GND 1 stMate 2nd Mate
P6 GND 1 stMate 2nd Mate
P7 V 5 5 V 电源，预充电 1 stMate 2 2nd Mate
P8 V 5 5 V 电源 2号伴侣 3号伴侣
P9 V 5 5 V 电源 2号伴侣 3号伴侣
P10 GND 1 stMate 2nd Mate.
P11 DAS/DSS
设备活动信号/禁用
错位旋转上篮^1 2次配速 3次配速
P12 GND 1 stMate 1 1stMate
P13 V 12 12 V 电源，预充电 1 stMate 2 2nd Mate.
P14 V 12 12 V 电源 2nd Mate 3 rd Mate
##### P ow e r
##### S eg m e nt
P15 V 12 12 V 电源 2nd Mate 3 rd Mate
电力领域的关键
注：1.电源线插座连接器中与P11配接的相应引脚应始终接地。P11引脚的具体可选使用方法见6.7节。
2. 虽然显示了配接顺序，但使用电缆连接器插座时不支持热插拔。
3. 所有的配接顺序都假定连接器之间的角度偏移为零。
4. 4. 信号段和电源段可以分开。
 
P1、P2和P3 3.3 V电源输送和预充电。
P7、P8和P9 5 V电源输送和预充电。
P13、P14和P15 12 V电源输送和预充电。
- 只有在有足够的配置控制以确保所连接的设备不需要未提供的电源电压的情况下，才能使用未提供所有规定电压的电源输送方案。

## 图30 - 连接器引脚和特征位置........................................................................。

#### 6.1.4 信号电缆插座连接器.........................................................................。

图31为信号电缆插座连接器的接口尺寸。在串行ATA电缆组件的两端有两个相同的插座。电缆插座与设备上的设备插头连接器的信号段或主机上的主机插头连接器对接。
图32定义了一个用于内部电缆系统应用的可选的正向锁存器解决方案。该闩锁要求用户在断开电缆时按住一个释放机构。
设备和主机插头连接器的闩锁功能选项需要提供一个闩锁面。这种闩锁功能选项称为ClickConnect。如果没有闩锁表面，就没有固定功能来固定闩锁电缆组件。
在电缆插座上实现闩锁是可选的。
信号段
引脚S1
功率段
引脚P1
信号段
钥匙
功率段
钥匙
信号段
引脚S1
功率段
引脚P1
信号段
钥匙
功率段
钥匙 
## 图31--电缆插座连接器接口尺寸  
## 图32 - 锁定信号电缆插座(ClickConnect) 
电缆插座连接器的引脚输出是设备插头连接器信号段的镜像。请注意。
- 两个差分针对是用相应的差分电缆对终止的
- 如果适用，则用电缆泄放线端接接地引脚。
- 电缆端接方法的选择，如压接或焊接，由各连接器供应商决定。
#### 6.1.5 信号主机插头连接器 
信号主机插头连接器将与串行ATA电缆组件的一端相配。
主机插头连接器的引脚配置是信号电缆插座的镜像。图33显示了主机插头连接器的接口定义。主机插头包括可选功能，允许使用闩锁电缆、圆角和附加材料来提高连接器的坚固性。

## 图33 - 主机信号插头连接器接口尺寸.......................................................。
 **6.1.5.1 内部插头堆叠**。
此推荐布局的目的是为了节省主板、HBA和I/O控制器的印刷电路板空间，以支持此类产品的系统密度和尺寸目标。
对于主机上多个串行ATA端口或连接器堆叠在一起的应用，有一个间隙或间距要求，以防止电缆组件相互干扰。图34显示了推荐的间隙或间距。图35显示了推荐的间隙和方向，以允许闩锁电缆的访问。
## 图 34 - 非闩锁式连接器堆栈的间距和方向 
## 图35 - 锁存连接器堆栈间距和方向  
#### 6.1.6 背板连接器 
背板连接器要与设备插头连接器直接盲配。背板连接器的接口尺寸如图36所示。注意，尺寸B允许有两个值。8.15mm和14.15mm。背板连接器有两级触点。前进地触点P4和P12首先与设备插头连接器上的相应地脚相配。
 然后是预充电电源引脚的接合。需要一个独立于连接器的适当的外部固定机构来保持主机PCB和器件的位置。背板连接器没有设计任何固定机构。

## 图36 - 背板连接器接口尺寸................................................................。
 **6.1.6.1 背板连接器配置和盲配公差***  
如图37所示，两个垂直轴的最大盲配偏差分别为±1.50mm和±1.00mm。插头相对于插座的任何倾斜角度都会减小盲配公差。
##图37--连接器对盲配错位公差....................................................。

设备到背板的配接配置如图38所示。尺寸A和尺寸B的允许值如表4所示。

## 表4 - 设备对背板配接时尺寸A和B的允许值 
描述 标准型 扩展型
设备配合高度(A) 8.45 mm 14.45 mm
部件间隙(B) 3.55毫米 9.55毫米
## 图38 - 设备背板配接配置 
#### 6.1.7 电源线插座连接器 
电源线插座连接器与设备插头的电源段对接，为设备带来电源。图39显示了电源插座连接器的接口尺寸。该连接器的引脚是表3所示设备插头电源段的镜像。图40定义了一个可选的正向锁存器解决方案，用于内部有线系统应用。该闩锁要求用户在断开电缆时按住一个释放机构。设备插头连接器的闩锁功能选项需要提供一个闩锁面。如果没有闩锁表面，就没有固定功能来固定闩锁电缆组件。
在电缆插座上实现闩锁是可选的。

## 图39 - 电源插座连接器接口尺寸  
## 图40 - 锁定式电源电缆插座................................................................................。

电源插座连接器端接在连接到系统电源或其他电源的18 AWG电线上。可使用五根18AWG导线，其中三根导线端接在三个电压的九个电源引脚上，其余两根导线端接在六个接地引脚上。
#### 6.1.8 内部单车道电缆。
内部单通道电缆由两对差分的四根导体组成。如有必要，该电缆还可包括与串行ATA电缆插座连接器中的接地引脚端接的排水线。导体尺寸可以是30至26 AWG。电缆最大长度为一米。
本规范没有规定标准的内部单通道电缆。任何符合第6.3节中电气要求的电缆都被视为可接受的内部单通道电缆。
连接器和电缆供应商可以根据性能和成本考虑灵活选择电缆结构和终端方法。图41中给出了一个电缆结构的例子，仅供参考。
虽然没有规定施工方法，但有几个基本要素，即
应该考虑的串行ATA电缆。串行ATA电缆的物理特性可能包括以下项目。详情请参见图 41。
- 屏蔽线对 (2)
- 实心镀锡铜(26 AWG)
- 白色泡沫聚烯烃（直径43.5密耳)
- 平行排水对（2个价位，28 AWG - 实心镀锡铜）。
- 镀铝聚酯箔(1mil厚/35mil重叠)
- 箔片可能是用热封的蓝色纵向包装。
- 护套(20mil PVC墙体)  
## 图41----内部单车道电缆示例的详细横截面。
#### 6.1.9 连接器的标签 
在连接器上标明连接器制造商标识符或串行ATA图标是可选的。
#### 6.1.10 连接器和电缆装配要求和测试程序 
除另有规定外，所有测量应在以下实验室条件下进行。
- 配对
- 温度：15°至35°C 15°至35°C
- 相对湿度：20%至80%。
- 大气压力：650毫米至800毫米汞柱。
如果在试验程序中指定的EIA(电子工业协会)试验没有字母后缀，则应使用该试验的最新批准版本。
**6.1.10.1 外壳和触头电气要求**。
表5是连接器外壳和触点的电气要求。
1 15 mil 3 05 mil 150 mil 46.5 mil 86.5 mil
虚空是可选的 
实心镀锡铜(26 AWG)
白色泡沫聚烯烃
平行排水对
镀铝聚酯箔
夹克 1 15密耳 3 05密耳 150密耳 46.5密耳 86.5密耳 1 15密耳 3 05密耳 150密耳 46.5密耳 86.5密耳
虚空是可选的 
实心镀锡铜(26 AWG)
白色泡沫聚烯烃
平行排水对

镀铝聚酯箔
外套 
## 表5----外壳和触点的电气参数、试验程序和要求。
参数程序要求
绝缘性能 EIA 364-21
500 V 直流电压1分钟后，测量已配接和未配接的连接器组件的相邻触点之间的绝缘电阻。
1000M最小值
绝缘耐压
EIA 364-20方法B
在已配接和未配接的连接器组件的相邻触点之间进行测试。
介电体在海平面上应能承受500VAC 1分钟。
低电平接触电阻(LLCR)
##### EIA 364-23 
在100mA最大电流下，装配在外壳中的被测物配接触点的最大开路电压为20mV。
- 最初最大30米。
    - 应力后阻力最大增加15米
触点额定电流(功率段)
- 将连接器安装到测试设备上
多氯联苯
- 将相邻的3个针脚并联起来进行供电（或连接器类型所要求的最低数量）。
- 将相邻的三个针脚并联起来，进行回线（或连接器类型所要求的最小数量）。
- 在电源引脚上施加每个触点额定电流三倍的直流电，通过回流引脚返回。
- 记录达到热平衡时的温升。
 每个引脚最小为1.5 A。
当触点位置供电时，在连接器中的任何一点，高于环境的温升不得超过30℃。环境条件为25℃时仍为空气。
**6.1.10.2 机械和环境要求**。
表6列出了机械参数和要求，表7列出了环境和可靠性试验和要求。
## 表6----机械试验程序和要求。
视觉和尺寸检查
##### EIA-364-18 
根据适用的质量检验计划，进行可行性、尺寸和功能检验。
符合产品图纸要求
电缆拉出 EIA-364-38 条件 A
在夹紧电缆插头一端的同时，将串行ATA电缆组件置于40 N的轴向载荷下一分钟。
无物理损坏。测试完成前后，电缆应满足所有连接器和电缆的机械要求。
电缆弯曲 对于圆形电缆。EIA-364-41 条件一
尺寸x=3.7×电缆直径，两个平面各100次。
对于扁平电缆。EIA-364-41条件II 使用方法1或2循环250次。
无物理损伤。弯曲时没有超过1us的不连续性。
插入力
电缆信号连接器
##### EIA-364-13 
以每分钟12.5mm的最大速度测量连接组件的连接力。
45 N 最大
拆卸力
电缆信号连接器(非锁定)
##### EIA-364-13 
测量以每分钟12.5mm的最大速度拆开连接器组件所需的力。
10 N 最小值，通过50次循环
插入力
有线电源连接器
##### EIA-364-13 
以每分钟12.5mm的最大速度测量连接组件的连接力。
45 N 最大
拆卸力
有线电源连接器（非锁定式
##### EIA-364-13 
测量以每分钟12.5毫米的最大速度拆开连接器组件所需的力。
循环1至5的最小值为15 N. 循环50的最小值为10 N.
插入力
背板连接器
##### EIA-364-13 
以每分钟12.5mm的最大速度测量连接组件的连接力。
20 N 最大
拆卸力
背板连接器
##### EIA-364-13 
测量以每分钟12.5mm的最大速度解开连接器组件所需的力。
500次循环后的最小力为4 N
拆除力
锁定式连接器
包括电源和信号连接器
##### EIA-364-13 
施加25 N的静态非配接测试载荷。
没有损坏
耐用性 EIA-364-09 内部电缆应用50次；背板/盲板应用500次。以每小时200次循环的最大速度进行测试。
无物理损坏。符合表9中测试顺序中规定的其他测试要求。

## 表7--环境参数、试验程序和要求。
参数程序要求
物理冲击 EIA 364-27 条件H
受试者配接的连接器到30克的半正弦冲击脉冲的11毫秒持续时间。
每个方向沿三个相互垂直的平面施加三次冲击，共18次冲击。见
注2：没有1us或更长时间的不连续。
没有1us或更长时间的不连续。无物理损坏。
随机振动
环评364-28条件五测试书A篇
受制于5.35克的配接连接器。
RMS。三个相互垂直的平面各30分钟。见
注2：
没有持续时间较长的1us的不连续。
湿度 EIA 364-31 方法 II 测试条件 A。
在40°C和90%至95%相对湿度下，将已配接的连接器放置96小时。
见注1。
温度寿命 EIA 364-17 测试条件III 方法A。
在+85°C的温度条件下，对已配接的连接器进行500小时的温度寿命测试。
请参见注1.EIA 364-32测试条件I.
热冲击 EIA 364-32 测试条件I.
连接的连接器在-55°C和+85°C之间循环10次。
见注1。
混合流动
燃气
EIA 364-65，2A级

一半的样品在七天内不交配，然后在剩下的七天内交配。另一半样品在整个测试期间交配。
见注1。
##### 注：1.应符合EIA 364-18目测要求，无物理损伤，并应符合表9中测试顺序中规定的附加测试要求。
2. 冲击和振动测试夹具由各用户与连接器供应商确定。

表8中列出了附加要求。
## 表8 - 附加要求...................................................................................................

参数程序要求
可燃性 UL 94V-0 每批产品均需提供材料认证或合格证，以满足美国保险商实验室的后续服务要求。
需要指出的是，本规范并不试图定义被认为是特定应用的连接器和电缆组件可靠性要求。用户及其连接器供应商可自行决定是否应增加额外的要求以满足应用需求。例如，需要使用SMT连接器的用户可能希望增加SMT连接器的可靠性要求。
**6.1.10.3 样品选择**。 
样品必须按照适用的制造商的说明准备，并应从当前生产的产品中随机挑选。每个测试组应提供100个数据点，以便对测试结果进行良好的统计。对于针脚数超过20个的连接器，一个测试组应至少包括5对连接器。从这些连接器对中，每个配接的连接器应至少选择和识别20个接触对。对于针脚数少于20个的连接器，选择足以提供100个数据点的连接器数量。
**6.1.10.4 测试顺序**。
表9显示了五组测试的连接器测试顺序。
## 表9 - 连接器测试顺序.............................................................................................

测试组
测试或检查
A B C D E
检查接头 1、5 1、9 1、8 1、8 1、7
低级接触电阻 (LLCR) 2, 4 3, 7 2, 4, 6 4, 6
绝缘电阻2，6
绝缘耐压3，7
当前评级 7
插入力2
拆除力 8
耐用性 3 4(1) 2(1)
物理冲击
振动5
湿度5
温度寿命3
重置（手动拔掉插头/插三次）。
##### 5 5 
混合流动气体3
热冲击4
注1.预处理，50个耐用性周期要求20个周期，500个耐用性周期要求50个周期。插入和拆除周期的最大速率为每小时200次。

例如，在试验组A中，人们将进行以下试验。1. 检查连接器 2. LLCR 3.耐久性 4.LLCR 5.连接器的检查 LLCR 5.连接器的检查。
#### 6.1.11 内部多线电缆。
本节定义了标准的电缆组件和头，用于将多个串行ATA链路从RAID主机总线适配器连接到同一机箱或服务器内的背板，或将多个串行ATA链路从主机总线适配器连接到单个设备。
该电缆/连接器基于SFF-8484规范。SFF-8484 规范也被串行连接 SCSI (SAS) 使用。
 **6.1.11.1 符合性标准**。
- 2或4条通道，串行ATA信号。
- 要么在电缆两端使用高密度连接器进行点对点连接，要么在电缆组件的一端使用高密度连接器进行扇出，在电缆组件的另一端使用单个单通道连接器。
- 用于边带信号的附加引脚/导线。
- SMT、通孔和压接的PCB占位规格。
- RX、TX、RX、TX引脚排序，以减少串扰。
- 每个线对之间的接地参考。
- 灵活的电缆，用于布线和气流。
- 支持1.5 Gbps和3.0 Gbps的性能。
- 合规点位于配接电缆接口的两端。如果主机和设备之间存在额外的互连介质，则该部分设计为专有设计，应确保满足配接电缆接口的合规点。
 **6. 1. 1 1. 1 1 E l e c t r i c a l R e q u i r e m e n t s ** 
内部多线电缆组件应符合表18中规定的电气特性。内部多线电缆组件应在Gen1i和Gen2i级别运行，并满足表18中定义的电气特性。由于该电缆是多线电缆，因此有多个进线器，额外的要求是使用CXT方法测量串扰。测量到的串扰应符合表18中列出的要求。
 **6. 1. 1 1. 1. 2 C o m p o n e n t D e s c r i p t i o n s**。
本节为多线应用定义了三个组件。每个组件都有一个2
巷和4巷版本。
 本节末尾提供了引脚分配。
- 电缆插座和后壳
- 竖向标头
- 直角接头 **6.1.11.1.3 电缆插座和后壳**。
图42和图43显示了内部Multilane电缆和连接器的等距图。
有关尺寸和机械细节，请参阅SFF-8484。

## 图42--内部2通道电缆和连接器的等距图...............................。

## 图43 - 内部4巷电缆和连接器的等距图...............................。
 **6.1.11.2 4 Lane 引脚分配**。 
注：侧带线14-19周围的虚线表示根据应用情况可选择屏蔽，可连接到相邻的信号地。
## ＃＃图44 - 4车道引脚分配...........................................................................................
 
## ＃＃图45 - 4车道到4 x 1车道，扇出实施........................................................。
 
注：未显示边带信号
## 图 46 - 4 Lane Fanout 引脚分配 **6.1.11.3 2 Lane 引脚分配**。
## 图47 - 2巷扇出引脚分配 
#### 6.1.12 迷你SATA内部多线程 
本节定义了标准电缆组件和接头，用于将多个串行ATA链路从RAID主机总线适配器连接到同一机箱或服务器的背板，或将多个串行ATA链路从主机总线适配器连接到单个设备。
该电缆/连接器系统基于SFF-8086和SFF-8087规格。串行连接SCSI (SAS)也使用SFF-8086和SFF-8087两种规格。
**6.1.12.1 符合性标准**。 
- 4通道，串行ATA信号。
- 电缆长度最大为1米。
- 可在电缆两端使用高密度连接器进行点对点连接，或在电缆组件的一端使用高密度连接器进行扇出，在电缆组件的另一端使用单独的单通道连接器。
- RX、TX、RX、TX引脚排序，以减少串扰。
- 每对电缆之间有接地参考。
- 支持1.5 Gbps、3.0 Gbps和6.0 Gbps的性能。
- 合规点位于配接电缆接口的两端。如果主机和设备之间存在额外的互连介质，则该部分设计为专有设计，应确保满足配接电缆接口的合规点。
  1. 1 2. 1 E l e c t r i c a l R e q u i r e m e n t s ** 
迷你SATA内部多线电缆组件应在Gen1i、Gen2i和Gen3i级别上运行，并满足表18中定义的电气特性。由於此纜線是多線纜線，因此有多個進取器，額外的要求是使用 CXT 方法測量串音。测量到的串扰应符合表18中列出的要求。
**6. 1. 1 2. 1. 2 C o m p o n e n t D e s c r i p t i o n s**。
详细的机械要求见SFF-8086和SFF-8087。
**6. 1. 1 2. 1. 3 M e c h a n i c a l R e q u i r e m e n t s**。
图48是Mini SATA内部多通道电缆和连接器的等距图。尺寸和机械细节请参考SFF-8086和SFF-8087。
Mini SATA 内部多线电缆和连接器应使用 SFF-8086 和 SFF-8087 中定义的 36 线路版本插头和插座。
## 图 48 Mini SATA 内部多线程等距图 **6.1.12.2 Mini SATA 内部多线程引脚分配**。
Mini SATA内部多通道连接器针脚分配如图49所示。
##### B1 B18 
##### A1 
##### A18 
B18 
B1 
A1 
A18  
边带信号的引脚分配基于内部对称电缆组件。
实现方式如图50所示。
对于主机到背板的应用，主机上的边带信号与其对应的背板上的边带信号相连接(例如，主机的SB0与背板的SB0相连接)。对于主机到主机的应用，一台主机上的边带信号不与另一台主机上相应的边带信号相连（例如，一台主机的SB0与另一台主机的SB6相连）。
图51为基于控制器的扇出电缆组件。
图52是基于背板的扇出电缆组件。
## 图49 Mini SATA内部多通道连接器针脚分配图 
信号信号引脚
讯号 GND A1
RX 0+ A2
RX 0- A3
SIGNAL GND A4
RX 1+ A5
RX 1- A6
SIGNAL GND A7
SB7(主机)/SB0(背板) A8
SB3(主机)/SB1(背板) A9
SB4(主机)/SB2(背板) A10
SB5(主机)/SB6(背板)A11
信号灯 GND A12
RX 2+ A13
RX 2-A14
SIGNAL GND A15
RX 3+ A16
RX 3- A17
SIGNAL GND A18
讯号 GND B1
TX 0+ B2
TX 0-B3
SIGNAL GND B4
TX 1+ B5
TX 1-B6
SIGNAL GND B7
SB0(主机)/SB7(背板) B8
SB1(主机)/SB3(背板) B9
SB2（主机）/SB4（背板） B10
SB6(主机)/SB5(背板) B11
信号 GND B12
TX 2+ B13
TX 2-B14
SIGNAL GND B15
TX 3+ B16
TX 3- B17
SIGNAL GND B18
B18 
B1 
A1 
A18 
B18 
B1 
A1 
A18  
## 图50 迷你SATA内部多通道系统。
 对称电缆实施 
B18
B17
B16
B15
B14
B13
B12
B11
B10
B9
B8
B7
B6
B5
B4
B3
B2
B1
A18
A17
A16
A15
A14
A13
A12
A11
A10
A9
A8
A7
A6
A5
A4
A3
A2
A1 “
传说。
高速序列
差分对
信号返回
边带信号
A18
A17
A16
A15
A14
A13
A12
A11
A10
A9
A8
A7
A6
A5
A4
A3
A2
A1
B18
B17
B16
B15
B14
B13
B12
B11
B10
B9
B8
B7
B6
B5
B4
B3
B2
B1
B18
B17
B16
B15
B14
B13
B12
B11
B10
B9
B8
B7
B6
B5
B4
B3
B2
B1
A18
A17
A16
A15
A14
A13
A12
A11
A10
A9
A8
A7
A6
A5
A4
A3
A2
A1
传说。
高速序列
差分对
信号返回
边带信号
A18
A17
A16
A15
A14
A13
A12
A11
A10
A9
A8
A7
A6
A5
A4
A3
A2
A1
B18
B17
B16
B15
B14
B13
B12
B11
B10
B9
B8
B7
B6
B5
B4
B3
B2
B1
迷你SATA内部多路电缆插头连接器 
注：电缆组件应将一端的每个信号回线与另一端的至少一个信号回线连接起来。电缆组件可将一个或多个信号回线连接在一起。
#### 图51 Mini SATA内部多线系统，基于控制器的扇出电缆实施方案 
B 18
A18
B17
B 16
B15
A17
A 16
A15
B14
B 13
B12
A14
A 13
A12
A11
A10
A9
A8
B11
B10
B9
B8
B7
A7
B6
B5
B4
A6
A5
A4
B3
B2
B1
A3
A2
A1 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7
地面B18
地面A18
主机TX3-B17
主机TX3+B16
地面B15
主机RX3-A17
主机RX3+ A16
地面A15
主机TX2-B14
主机TX2+B13
地面B12
主机RX2-A14
主机RX2+ A13
地面A12
地面B7
地面A7
主机TX1-B6
主机TX1+B5
地面B4
主机RX1-A6
主机RX1+A5
地面A4
主机TX0-B3
主机TX0+ B2
地面B1
主机RX0-A3
主机RX0+ A2
A1 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 - 接地 1 接地 2 驱动 RX+ 3 驱动 RX- 4 接地 5 驱动 TX- 6 驱动 TX+ 7 接地 
控制器
边带信号连接是由厂商指定的
SATA单通道信号电缆插座连接器 
B18
A18
B17
B16
B15
A17
A16
A15
B14
B13
B12
A14
A13
A12
A11
A10
A9
A8
B11
B10
B9
B8
B7
A7
B6
B5
B4
A6
A5
A4
B3
B2
B1
A3
A2
A1 7 6 5 4 3 2 1 7 6 5 4 3 2 1
B18 地面
A18地面
B17 背板 TX3-
B16 背板 TX3+
B15 地面
A17背板RX3-
A16背板RX3+
A15地面
B14 背板 TX2-
B13 背板 TX2+
B12 地面
A14背板RX2-
A13 背板 RX2+
A12 地面
B7 地面
A7 地面
B6 背板 TX1-
B5 背板 TX1+
B4地面
A6背板RX1-
A5背板RX1+
A4 地面
B3背板 TX0-
B2 背板 TX0+
B1 地面
A3背板RX0-
A2 背板 RX0+
A1 地面
地面7
主机RX+6
主机RX- 5
地面4
主机TX-3
主机TX+2
地面1
地面7
主机RX+6
主机RX- 5
地面4
主机TX-3
主机TX+2
地面1
边带信号连接是由厂商指定的
SATA单通道信号电缆插座连接器
背板 7 6 5 4 3 2 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1
地面7
主机RX+6
主机RX- 5
地面4
主机TX-3
主机TX+2
地面1
地面7
主机RX+6
主机RX- 5
地面4
主机TX-3
主机TX+2
地面 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1 7 6 5 4 3 2 1
注：电缆组件应将一端的每个信号回线与另一端的至少一个信号回线连接起来。电缆组件可将一个或多个信号回线连接在一起。
#### 图52 Mini SATA内部多线系统，基于背板的扇出电缆实施方案  
### 6.2 内部微型SATA连接器，用于1.8 "硬盘。
本节提供了启用较小的串行 ATA 1.8" HDD（硬盘驱动器）所需的功能。
该定义支持以下功能。
- 支持Gen1(1.5 Gbps)和Gen2(3.0 Gbps)传输速率。
- 支持背板（直接连接）和电缆连接使用模式
- 支持热插拔背板（非有线）应用
- 支持8.0和5.0毫米的1.8 "薄型硬盘。
- 支持3.3 V和5 V，以满足未来产品的需求。
- 支持可选的引脚，P8和P9，供厂商特定使用。
#### 6.2.1 使用模式........................................................................................................。

内部micro SATA连接器可用于5.2.10节中定义的移动使用模式，该定义仅支持内部8.0 mm和5.0 mm超薄型1.8 "硬盘。
#### 6.2.2 一般说明..............................................................................................

内部微型SATA连接器设计用于连接1.8 "薄型硬盘。
硬盘到串行ATA接口。
内部微型Serial ATA连接器的信号段和电源段均采用1.27 mm间距配置。信号段的配置与内部标准的Serial ATA接口相同。
串行ATA连接器。电源段提供目前的3.3 V电压要求支持，并包括未来5 V电压要求的规定。此外，还有一个保留引脚P7。最后，还有两个可选引脚，P8和P9，供厂商特定使用。

内部微型SATA连接器采用交错式针脚设计，适用于热插拔背板（非有线）应用。
一个特殊的电源段键位于P7和P8引脚之间。此功能可防止插入其他串行ATA电缆。
在应用该设备时应注意不要对设备或连接器施加过大的压力。背板配置应特别注意，以免设备和连接器因过度错位而损坏。
#### 6.2.3 连接器位置 
图53和图54显示了硬盘上的内部微型SATA连接器的位置，以供参考。请参考SFF-8144的外形尺寸定义和连接器位置。

## 图53 1.8 "硬盘的内部微型SATA连接器位置....................................。
 
## 图54 1.8 "硬盘的内部微型SATA连接器位置....................................。
 
#### 6.2.4 配套接口 **6.2.4.1 裝置內部微型SATA插頭**。
图55定义了内部微型SATA设备插头连接器的接口尺寸，包括信号段和电源段。
 
## 图55设备内部micro SATA插头连接器...............................................................。
 **6.2.4.2 内部微型SATA背板连接器**。
图56定义了内部微型SATA背板连接器的接口尺寸。
## 图56 内部micro SATA背板连接器.................................................................
  **6.2.4.3 内部micro SATA电源插座连接器*** 
图57定义了内部micro SATA电源插座连接器的接口尺寸。
## 图57 内部Micro SATA电源插座连接器 **6.2.4.4 内部Micro SATA连接器对盲配错位能力**。 
如图58所示，两个垂直轴的最大盲插错位能力分别为±1.50mm和±1.00mm。插头相对于插座的任何倾斜角度都会降低盲配能力。
## 图58 内部微型SATA连接器对盲插错位能力...................。
 **6.2.4.5 内部micro SATA引脚信号定义及触点配接顺序**。 
表10详细介绍了两个内部微型SATA插头选项的引脚名称、类型和接触顺序。表中还包括了信号、接地和电源引脚的简要说明。信号段共有7个引脚，电源段共有9个引脚。
## 表10 - 信号和电源内部微型SATA插头和标称配接顺序 **6.2.4.6 内部微型SATA连接器和线缆装配要求和测试程序**。
內置微型 SATA 連接器和纜線必須符合第 6.1.10 節中對標準內置 SATA 纜線和連接器的定義要求，但以下所列的例外情況除外。
表11.表11--独特的连接器机械测试程序和要求
## 表11 - 独特的连接器机械测试程序和要求。
去除力 EIA-364-13 2.5 N 500次循环后的最小值。
名称 类型 描述 电缆用途 1,2
背板
用途^2
##### S ig n al
##### S e gm en t
参考表3。
信号段和电源段分开的间距^3
P1 V 33 3.3 V 电源 2nd Mate 3 rd Mate
P2 V 33 3.3 V 电源，预充电 1 stMate 2 Mate
P3 GND 1 stMate 1 1stMate
P4 GND 1 stMate 1stMate
P5 V 5 5 V 电源，预充电^41 stMate 2nd Mate
P6 V 5 5 V 电源^42ndMate 3rdMate
P7 R 保留^52 ndMate 3rdMate
钥匙 钥匙 钥匙 NC NC
P8可选厂商专用^62第3个伴侣第3个伴侣。
##### P o w e r
##### S e g m en t
P9 可选厂商专用^62第3个伴侣第3个伴侣。
注：1.虽然显示了配接顺序，但使用电缆连接器插座时不支持热插拔。
2. 所有的配接顺序都假定连接器之间的角度偏移为零。
3. 信号段和电源段可以分开。
4. 5 V电源电压引脚是为了满足未来产品的要求，也可以选择在电源段插座上提供。本规范未来的修订可能要求提供5 V电源电压。
5. 与电源内部微型插座连接器中的P7引脚配接的相应引脚应始终接地。
6. 主机侧无连接。
 
背板连接器 以每分钟12.5毫米的最大速度测量解开连接器组件所需的力。
插入力
有线电源连接器（非锁定式
##### EIA-364-13 
以每分钟12.5mm的最大速度测量连接组件的连接力。
45 N 最大
拆卸力
有线电源连接器（非锁定式
##### EIA-364-13 
测量以每分钟12.5毫米的最大速度拆开连接器组件所需的力。
循环1至5的最小力为10 N. 循环50的最小力为8 N.
### 6.3 内部超薄电缆和连接器 
本节提供在 "Slimline "光盘驱动器中启用串行ATA所需的功能。
该定义支持以下功能：

- 支持Gen1(1.5 Gbps)和Gen2(3.0 Gbps)的传输速率。
- 支持背板（直接连接）和电缆连接使用模式
- 支持热插拔
- 支持12.7毫米、9.5毫米和7.0毫米的超薄设备。
- 仅5V电源输送 
该定义有以下限制条件。
- 不支持设备活动信号
- 不支持模拟音频
- 不支持外部电缆和连接器
- 不支持热插拔
- 温暖插头支持取决于使用模式 
#### 6.3.1 使用模式 
支持三种使用模式。内部固定卡槽（直接连接）、可移动卡槽和内部电缆。各种使用模式的要求在本节中具体说明。
内部固定卡槽要求。
- 支持12.7、9.5和7.0mm的超薄设备。
- 不需要支持1.8 "硬盘的直接连接。
- 不需要支持2.5 "硬盘的直接连接。
- 最小足迹
- 不需要设备存在检测 
可拆卸的海湾要求。
- 支持12.7毫米、9.5毫米和7.0毫米的超薄设备。
- 不需要支持1.8 "硬盘的直接连接。
- 不需要直接连接支持2.5 "硬盘。安装在载具转接器上必须符合Gen1i、Gen2i和Gen3i的有线使用模式。
- 需要暖插头和盲插
- 需要检测无电源设备的存在
- 无需软盘支持  
- 无需电池连接器支持
- 支持500次插入和取出。设计可扩展至更高的周期数。

内部电缆要求。
- 支持12.7mm、9.5mm和7.0mm的超薄设备。
- 不需要支持1.8 "硬盘的直接连接。
- 不需要支持2.5 "硬盘的直接连接。
- 不支持盲配
- 不支持设备存在检测
- 支持被动式和锁定式保持机制
- 支持6.1节中定义的内部单车道电缆和连接器。
- 支持50次插入和移除 
#### 6.3.2 概述..............................................................................................。

Slimline连接器设计用于将 "slimline "形式的驱动设备连接到串行ATA接口。该连接器的设计可以为9.5 mm和12.7 mm的超薄设备提供锁存选项。7毫米超薄设备可能不具备锁存选项。
该内部串行ATA连接器使用5 mm（参考）连接器高度作为低剖面。
该连接器的设计适用于目前使用的PATA（平行ATA）连接器超薄设计，几乎不需要改变超薄设备外壳、介质托盘或内部结构。预计在目前的超薄设备设计中，用SATA控制器和连接器简单地替换PATA PC板是可能的。
该连接器保留了目前SATA连接器的信号部分的设计，并可容纳目前可用的SATA信号电缆。
连接器的电源部分减少到6个引脚。连接器的+12 V和+3.3V都被移除，只剩下+5 V作为唯一的电源电压。
标准的+A、-A、+B和-B信号在连接器的信号部分。除了+5 V和GND之外，以下信号被添加到电源部分。
- DP--设备存在--表示设备与主机连接的有效低电平信号。设备应将DP引脚连接到地，电阻为1K欧姆，最大容差为±10%欧姆。该信号在有线环境下不支持。如果采用有线连接，且电缆固定位置，电缆应遵循背板要求。主机与DP引脚的连接是可选的。如果未使用，则不允许连接。如果主机要求使用DP功能，其最大电流应为4mA，最小为0mA。
- MD--制造诊断--器件厂商在器件测试时使用的信号引脚。不允许主机连接，器件连接是可选的。

#### 6.3.3 连接器的位置和禁区。
本节描述了连接器在超薄设备中的位置，参考了标准位置。本节介绍了连接器在超薄型设备中的位置，并参照标准位置，定义了避开区域，以实现盲插功能。
**6.3.3.1 位置**。
表12显示了7.0毫米、9.5毫米和12.7毫米超薄设备的连接器位置参考。

## 表12 - 薄型连接器位置参考表 
纤薄型驱动器水平垂直深度 7.0 mm 纤薄型驱动器左边缘至连接器 CL
将底边打到连接器舌片上边
将后缘推至连接器后壁 9.5 毫米 将左缘推至连接器 CL。
将底边打到连接器舌片上边
将后缘推至连接器后壁 12.7 毫米 将左缘推至连接器 CL。
将底边打到连接器舌片上边
将后缘打到连接器后壁 **6.3.3.2 隔离区**。
最小的面板开口是指最大的连接器尺寸加上细线设备内连接器位置的位置公差。

图59所示为7毫米超薄ODD的内部SATA连接器位置，仅供参考。更多细节可在 SFF-8553 中找到。
## 图 59 - 7.0 毫米超薄硬盘连接器位置  
-X-X-X-
- G-G- -X-X- -C-C-
BB BB 2 28.78.7RREFEF
REFREF 5.45.4 0 0.76.76 XXX
REFREF -B--B- 20.420 .4 21.2521 .25 128128 REFREF 9.5 9.5 RE F /REF / 1 12.7 REF2.7 REF 5.25.2
连接器的连接器
DATUMDATUM--B--B--。
KEEPKEEP OUT ZOZONENE -Z-Z-Z-
SECTIONSEC TIO NB-BB-B 0.6 X G0.6 X G 0.4 X0.4 X
AA
AA
## 图 60 - 9.5 mm/12.7 mm 薄型驱动器连接器位置 7 .0 mm 薄型设备。
## 图 61 - 7.0 毫米超薄型驱动器连接器位置（A-A 部分） **6.3.3.2.1 9.5 毫米超薄型驱动器** -Z-Z- 66 ±0.38±0.
## 38±0.38±0. 38 0.30.3REFREF ±0.38±0. 38 1 12.72.7RREFEF 0.4 Z0.4 Z -A--A-------。
## 图63 - 12.7毫米超薄型驱动器连接器位置（A-A部分）。
#### 6.3.4 配套接口 
串行ATA连接器仅根据其配接接口或前端特性进行定义。连接器后端特性，包括PCB安装特性和电缆终端特性未被定义。
某些信息性的尺寸可能被定义为表明在设计中的特定假设，以满足特定的形状、装配和功能要求。
 **6.3.4.1 7 mm细长型设备插头连接器**。
这是7毫米超薄设备中使用的连接器。图2和表1显示了设备插头连接器的接口尺寸，包括信号和电源段。这些图纸上的一般公差为+/-0.20毫米。
## 图64 - 7毫米超薄设备插头连接器接口尺寸  
## 图65 - 7.0毫米超薄设备插头接口尺寸 A-A节 
## 图66 - 7.0毫米超薄设备插头接口尺寸 B-B节。
## 图67 - 7.0 mm超薄型设备插头接口尺寸详图D。
###安装 图68--7.0mm超薄设备插头连接器接口尺寸可选按住接口尺寸可选按住安装 **6.3.4.1.1连接器引脚信号定义**。
连接器的针脚分配和说明请参见表13。
**6.3.4.1.2 外壳和触点的电气和机械要求**。 
内部SATA连接器和电缆必须符合6.1.10.1中对标准内部SATA电缆和连接器的要求。
**6.3.4.1.3 连接器和电缆装配要求和测试程序**。
连接器和电缆的装配要求和测试程序应与6.3.7中的要求一致。
 **6.3.4.2 9.5毫米和12.7毫米细线设备插头连接器**。
这是超薄设备中使用的连接器。
图69和表13显示了设备插头连接器的接口尺寸，包括信号和电源段。这些图纸的一般公差为+/-0.20mm。
## 图69--超薄型设备插头连接器接口尺寸..............................................。
  -A--A - ±±0 .0 80.08 1.231.23±0.05±0 .05 0.350.35±0.05±0 .05 45°45° 1.581.58±0.08±0 .0 8 3.13.1±0.08±0 .08 ．
RR±0.08±0 .08
TTOTAL 1OTAL 10 PLC AROUND0 PLC AROUND
L "形的基座。
TONGUES, EXTONGUES ONTONGUES, EXTOR ON
带触点的表面SSU RFACE WI TH C ONTACTS 0.250.25 1 1.95.95
## 图 70 - 薄型设备插头连接器接口尺寸（A-A 节） 1.251.25MINMIN 2 2 PLCPLC 30°30°。
## 图71 - 薄型设备插头接口尺寸（B-B部分）±0.05±0.05X X 45°45°。
ALL ALL AROUNDAROUND 0.30.3 4.254.25±0.05±0 .0 5.
MINMIN 0.350.35
RR0.350.35±0.08±0.08 .0mm.0mm MMININ
KEEPKEEP OUT ZO NEOUT ZONE 11
## 图72 - Slimline Device插头连接器接口尺寸（C-C节）........................。
 0.30.3±0.08±0.08 30°30° 30° 30 °
## 图73 - 薄型设备插头接口尺寸(细节F)...............................。
 66 .375.375 55 .57.57
MAXMAX 2 PLC2 PLC3.73.7
MINMI N 2 PLC2 PL C 7.57.5
OOFF--B--B--
## 图74 - 薄型设备插头接口尺寸(第2节) 
##### G-G) 32.732.7REFREF
下压保持(可选)(O PTI ONA L)
## 图75 - Slimline设备插头连接器，可选择固定安装..............................。
 
##### 在附件处进行高速小型化处理。
#### ATA国际组织 
信号段共有7个引脚，电源段有6个引脚。引脚定义如表13所示。请注意，引脚的编号从距离电源段最远的引脚开始。
## 表13 - Slimline Device Plug连接器引脚定义。
名称 类型 描述
缆线
使用方法
背板
使用方法
##### Sig n a lS e gm en t.
请参考表3。
信号段 "L"
中央连接器间隙
功率段 "L"
P1 DP 设备存在 3 个 rd mate 3 个 rd mate
P2 +5 V 2ndmate 2ndmate

P3 +5 V 2 ndmate 2ndmate
P4 MD 制造诊断 2nd mate 2nd mate
P5 Gnd 1 stmate 1stmate
P o w e r
##### S e g m en t
P6 Gnd 1 stmate 1stmate
电力领域的关键
注：1.所有引脚均为单排，功率段部分的间距为1.00毫米（.039"）。
2. 串行ATA超薄设备插头电源段中的接地引脚（连接器引脚P5和P6）应在串行ATA超薄设备上总线在一起。
3. Serial ATA slimline设备信号地与电源地之间的连接由厂商决定。
4. 4. DP和MD信号应参考电源部分的接地引脚P5和P6。
5. 串行 ATA 纤细线设备插头电源部分的 5 V 电源输送引脚（连接器引脚 P2 和 P3）应在串行 ATA 纤细线设备中一起总线化。
 
SIGNALSIG NAL SEGMENTSEGMENT（信号）。
POWERPOWER SEPPI N P1IN SEGMENTP1GMENT PIN PIN S1S1
PCB安装侧PCB安装侧
动力单元单元
关键字
SIGNALSIG NAL SSEGMENTEGMENT。
关键字
## 图 76 - Slimline 连接器针脚和特征位置 **6.3.4.2.1 Slimline 信号电缆插座连接器**。
使用标准的SATA信号线插座。参见6.1.4节。
**6.3.4.2.2 纤细电源线插座连接器**。
纤细的电源线插座连接器与设备插头的电源段对接，为设备带来电源。图77为电源插座连接器的接口尺寸。连接器的引脚输出是表13所示设备插头电源段的镜像。MD和DP连接器的引脚可选择存在于有线环境中。

##### 高速 SERIALIZED ATTACHMENT(连接处)。
#### ATA国际组织 
## 图77 - Slimline电源插座接口尺寸.....................................。
 
## 图78 - 超薄型电源插座，可选带锁扣的连接器 
## 图79 - 带凸点的超薄型电源插座连接器选件  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **6.3.4.3超薄主机插座连接器**。
纤细的主机插座连接器要与设备插头连接器直接盲配。主机插座连接器的接口尺寸如图80所示。需要有一个独立于连接器的适当的外部固定机构来保持主机PCB和设备的位置。薄型主机插座连接器没有设计任何固定机构。
## 图80 - 薄型主机插座连接器接口尺寸........................................。
 
##### 1.51. 5±0.08±0 .08 REFREF 
##### 39.6°39.6° 
##### REFREF 
##### 34.8°34.8 ° 
##### 0.920.92±0.08±0 .08 
##### 1.21.2±0.05±0.05 
## 图81-超薄型主机插座接口尺寸 C-C部分 1.41. 4±0.08±0 .0 8 2.42.4±0.08±0 .0 8 5.25.2±0.15±0.1 5 0.30.3±0.05±0 .0 5X X 45°45° PINSPIN S SS1 THRU S71 T HRU S7 1.41.4±0.15±0.1 5.
## 图 82 - 薄型主机插座接口尺寸 X-X 节。
##### 1.9±0.151.9±0.15 
##### PIN PIN P1 ONLYP1 ONLY 
##### PINSPINS P2至P6P2至P6。
##### 1.41. 4±0.15±0. 15 
## 图83--超薄型主机插座接口尺寸 Y-Y部分。
#### 6.3.5 背板连接器配置及盲配公差..........................。

如图84所示，两个垂直轴的最大盲配错位公差分别为±1.50mm和±1.20mm。插头相对于插座的任何倾斜角度都会减小盲插公差。

##### 高速 SERIALIZED ATTACHMENT(连接处)。
#### ATA国际组织 
GG 
GG.1 1.2 MAX.2 MAX 1.51.1.51.1.51. 2 MAX.2 MAX 1.51.1.51.1.51. 555 MMAXMMAXMMAXAXAXAX 1.63°1. 63°MAXMA X
OOF PF PLUGLUG
OOF REC EPTACLEF RECEPTACLELE
PLUGOF PLUG
拒收的问题
SECTECTIO NG-GG-G 
## 图84 - Slimline连接器对盲配错位公差表 
#### 6.3.6 连接器的标签 
参考6.1.9节。
#### 6.3.7 连接器和电缆的装配要求和测试程序。
连接器和电缆的装配要求和测试程序应符合下列规定： 1.
表6，但有以下例外情况： ## 表14 - Slimline连接器机械测试程序和要求

## 表14--超薄型连接器机械测试程序和要求。
拆除力
背板连接器
##### EIA-364-13 
测量以每分钟12.5 mm的最大速度解开连接器组件所需的力。
2.5 N. 500次循环后的最小值
插入力
有线电源连接器
不带插销
##### EIA-364-13 
以每分钟12.5mm的最大速度测量连接组件的连接力。
45 N 最大
拆卸力
有线电源连接器
不带插销
##### EIA-364-13 
测量以每分钟12.5毫米的最大速度拆开连接器组件所需的力。
循环1至5的最小力为10 N. 循环50的最小力为8 N.
插入力
有线电源连接器
带锁扣
##### EIA-364-13 

以每分钟12.5mm的最大速度测量连接组件的连接力。
45 N 最大
拆卸力
有线电源连接器
带锁扣
##### EIA-364-13 
施加25 N的静态非配接测试载荷。
在50次交配循环中没有损坏，也没有断开。
### 6.4 1.8 "硬盘的内部LIF-SATA连接器 
本节提供了启用新的较小的串行ATA 1.8 "HDD（硬盘驱动器）所需的功能。
该定义支持以下功能。
- 支持Gen1(1.5 Gbps)和Gen2(3 Gbps)传输速率。
- 支持FPC使用模式
- 支持8.0和5.0毫米的1.8 "薄型硬盘(FF)
- 支持3.3 V和5 V，以满足未来产品的需求。
- 支持供应商引脚，P18,19,20,21保留给HDD客户使用。
- 支持HDD制造使用的供应商引脚、P22和P23。
该LIF-SATA仅适用于内部8.0毫米和5.0毫米超薄型1.8英寸设备。
注：希望LIF-SATA接口符合Gen1i和Gen2i规格。
LIF-SATA 连接器只能与 FPC 电缆配接，符合性点应在配接组件之后，在那里进行必要的 Tx 和 Rx 测量。
#### 6.4.1 概述..............................................................................................

该内部LIF-SATA连接器设计用于将新型1.8 "薄型硬盘系列连接到串行ATA接口。
内部LIF-Serial ATA连接器的信号段和电源段均采用0.5 mm间距的配置。信号段的配置与内部标准Serial ATA接口相同。
ATA连接器，但电源段提供了现在的电压要求支持3.3V，并提供了未来的电压要求5V。
Device Activity Signal/Disable Staggered Spin up。最后，有6个供应商引脚，P18、19、20和21供硬盘客户使用，P22和P23供硬盘制造使用。

##### 高速序列化 ATTACHMENT(附件) 
#### ATA国际组织 
在使用该驱动器时必须小心，以免驱动器或连接器承受过大的压力。
#### 6.4.2 连接器位置............................................................................................
 **6.4.2.1 硬盘驱动器(HDD)外形上的连接器位置，- (参考)**。
图85所示为硬盘内部的LIF-SATA接口位置，仅供参考。请参考SFF-8146的外形尺寸定义和连接器位置。
## 图85 - 1.8 "硬盘的内部LIF-SATA连接器位置..................................................。
 **6.4.2.2 固态硬盘(SSD)外形尺寸上的连接器位置，-（参考）**。 
图86所示为固态硬盘散装型的内部LIF-SATA连接器位置，仅供参考。
## 图86 - 单面安装型1.8 "SSD散装的内部LIF-SATA连接器位置  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 6.4.3 配套接口 **6.4.3.1 设备内部LIF-SATA嵌入式连接器**。
#### 带有信号段和电源段的内部LIF-SATA嵌入式连接器。图87定义了内部LIF-SATA嵌入式连接器的接口尺寸，包括信号段和电源段。
 
推荐的PCB布局。
## 图87 - 器件内部LIF-SATA嵌入式连接器...............................................。
 
##### 高速 SERIALIZED ATTACHMENT(高速串行化接口) 
#### Serial ATA国际组织 **6.4.3.2 设备内部LIF-SATA表面安装型连接器**。
#### 安装型连接器。图88定义了内部LIF-SATA设备表面安装型连接器的接口尺寸。

推荐的 PCB 布局如下： ## 图 88 - 设备内部 LIF-SATA 表面安装型连接器
## 图88 - 设备内部LIF-SATA表面安装型连接器 **6.4.3.3 内部LIF-SATA的FPC**。 
图89定义了LIF-SATA的FPC的接口尺寸。
## 图89 - 内部LIF SATA的FPC。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 6.4.4 内部LIF-SATA引脚信号定义和触点配合顺序...............。

表15详细介绍了两种内部LIF-SATA插头选项的引脚名称、类型和接触顺序。表中还包括了信号、接地和电源引脚的简要说明。总共有24个引脚。
## 表15 - 信号和电源内部LIF-SATA插头 
名称 类型 描述
P1 GND
P2 V 33 3.3 V 电源
P3 V 33 3.3 V 电源
P4 GND
P5 V 5 5 V 电源
P6 V 5 5 V 功率^1
P7 GND
P8 DAS/DSS 设备活动信号/禁用交错旋转^2
P9 GND
P10 GND
P11 A+
P12 A-
差分信号对A
P13 GND
P14 B-
P15 B+
差分信号对B
P16 GND
P17 GND
P18 供应商 供应商专用
P19 供应商 供应商专用
P20 供应商 供应商专用
P21 供应商 供应商专用
P22 供应商供应商专用 - Mfg pin^3
P23 供应商 供应商专用 - Mfg pin^3
P24 GND

注：1.包含5 V电源电压引脚是为了满足未来的产品需求。本规范的未来修订版可能要求提供5 V电源电压。
2. 2. 与Pin8配接的相应引脚应始终接地。关于Pin8的具体可选用途，请参见6.4串行ATA 3.0修订版规范。
3. 3. 主机侧无连接。
 
#### 6.4.5 外壳和触点电气要求 
內部 LIF-SATA 連接器和纜線必須符合 Serial ATA 3.0 版 6.1.10「連接器和 FPC 組裝要求和測試程序」中對標準內部 SATA 纜線和連接器所定義的要求，但表 16 所列的例外情況除外。
## 表16 - 独特的连接器机械测试程序和要求 
FPC的插入力 以每分钟12.5mm的最大速度测量连接组件的插入力。
6 N 最大。
FPC的移除力 以每分钟12.5mm的最大速度，测量移除连接器组件所需的力。
6 N 最少10次循环
内部电缆应用的耐用性为10个周期。
以每小时200次循环的最大速度进行测试。
无物理损坏。
最小电流 - 将连接器安装到测试PCB上。
- 将电源引脚P2、P3、P5、P6并联起来，作为电源。
- 将P1、P4、P7、P9、P10、P13、P16、P17、P24的接地引脚并联，以便回线。
- 向并联的电源引脚提供2A的总直流电流，从并联的接地引脚返回。
- 当达到热平衡时记录温升，每引脚最低0.5A。
当接触位置通电时，连接器中任何一点的温升高于环境温度不得超过30℃。环境条件为25℃时仍为空气。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
### 6.5 外部电缆和连接器 
#### 6.5.1 外部单通道............................................................................................。

外部单通道系统在PC/笔记本电脑和使用Gen1i/Gen2i串行ATA设备的商品存储设备之间提供单通道连接。该接口用于使用位于PC机箱外的外部设备，类似于USB或1394硬盘和光驱。虽然这并不排除其他用途，但要求是基于这种使用模式得出的。
通过单独的方式向外部存储设备供电，这不属于本规范的范围。这种单独的方式预计将类似于为以下设备提供电源的方式。
USB 或 1394 外部驱动器。
本节定义了设备互操作性的外部互连、合规点和相关电气要求/参数。
主要的实现方式是
- 一个HBA连接到屏蔽的外部连接器上 缓冲器IC需要与Gen1i/Gen2i串行ATA主机接口，除非串行ATA主机符合Gen1m/Gen2m标准并设计用于直接外部连接。
- 设计用于外部使用的屏蔽式串行ATA电缆。
- 具有相应外部连接器的串行ATA设备外壳。除非串行ATA设备符合Gen1m/Gen2m标准并设计用于直接外部连接，否则需要一个缓冲IC来连接Gen1i/Gen2i串行ATA设备。

该实施例如图90所示。

## 图90--带外部电缆和单个设备外壳的HBA使用模式 
第二种潜在的实施方式是直接装配在主板上的Serial ATA主机通过尾纤与主板连接连接到屏蔽的外部连接器。在这种实施方式中，外部Serial ATA电缆和设备组件类似于图131，但在主板和外部电缆之间引入了另一条电缆和连接器对，在主机和设备之间放置了一个额外的不连续点。
外部单通道系统有两个符合点，每个屏蔽外部连接器处有一个。与其他电缆和连接器系统描述一样，IC/Phy与配接接口处的连接器之间的互连不在定义范围内，而被视为交付的Phy解决方案的一部分。在Phy/IC和屏蔽外部连接器之间具有额外连接的实施例应提供此类互连，作为工程解决方案的一部分。对于如图所示的实施例
图91，符合要求的点仍在屏蔽的外部连接器处。

##### 高速 SERIALIZED ATTACHMENT(连接处)。
#### ATA国际组织 
###电缆到磁盘......................................................................................................................... 图91--带延长线的板载串行ATA连接器与外部外部电缆到磁盘的使用模式。

典型的电缆长度为2米（6英尺）；长度足以从安装在地面的PC到放置在桌面上的设备。外部电缆两端的符合点应符合Gen2m电气规范。
使用标准的内部Serial ATA主机或不是专门设计用于直接外部连接的设备，需要一个缓冲IC作为实施的一部分。请注意，由于单
车道外部串行ATA电缆是直通式设计，（针脚对针脚），主机和设备外部连接，使用同一个外部连接器，针脚一位置相同，但信号定义相反。主机和设备连接信号分配请参考表3。
**6.5.1.1 外部串行ATA组件通用说明**。
本节中定义了五个组件以支持外部串行ATA。
- 一个屏蔽的外部电缆插座，用于屏蔽（外部串行ATA）布线。
- 一个完全屏蔽的RA PCB安装SMT插头，（和反向引脚输出版本）。
- 一个完全屏蔽的RA PCB安装通孔插头。
- 一个完全屏蔽的垂直PCB安装SMT插头。
- 一种全屏蔽的垂直PCB安装通孔插头。
 
包括脚印和建议的面板开孔，以鼓励多个供应商提高互操作性。
外部电缆连接器是第6节中定义的内部单通道连接器的屏蔽版本，但有以下基本区别。
- 外部连接器没有 "L "形特征，导引特征垂直偏移，尺寸缩小。这就避免了在外部应用中使用非屏蔽的内部电缆。
- 为了防止ESD损害，插入深度从5毫米增加到6.6毫米，触点安装在插座和插头的更后面。
- 固定功能是顶部和底部表面的屏蔽层中内置了弹簧。

外部串行ATA连接器渲染图。
## 图92 - 外部串行ATA电缆插座和直角插头渲染图 **6.5.1.1.1 外部串行ATA连接器机械图**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
## 图93 - 外部串行ATA电缆插座组件的机械尺寸............。
 
## 图94 - 外部串行ATA RA SMT插头的机械尺寸.................................。
 
##### 高速串行ATA连接处 
#### ATA国际组织 
## 图95 - 外部SATA RA SMT插头的机械尺寸 - 反向引脚输出  
## 图96 - 外部串行ATA RA通孔的机械尺寸...........................。
 
##### 高速串行化接口。
#### ATA国际组织 
## 图97 - 外部串行ATA垂直SMT插头机械尺寸..........................
 
## 图98 - 外部串行ATA垂直通孔插头的机械尺寸............。
 
##### 高速序列化接口 
#### 串行ATA国际组织 **6.5.1.2 外部串行ATA电气要求**。
外部电缆组件应符合表19中规定的电气特性。
单通道外部串行ATA数据接口Phy电气性能应符合以下规定。
- 表19中定义的电气特性，Gen1m和/或Gen2m的屏蔽外部连接器符合点。
- 支持热插拔和非带电设备连接。
- 设备接口处需采用交流耦合，主机接口处建议采用交流耦合。
 **6.5.1.3 外部串行ATA机械要求**。
外部连接器的机械性能规格应与6.5.1节中的内部单通道连接器规格一致，但有以下例外。
- 耐用性应达到2500次循环，信号触点的基本金属不暴露。
- 插入力应最大为40 N。
- 耐久性试验结束时，拆除力应至少为10 N。
 **6.5.1.4 外部串行ATA设备直连要求**。
串行ATA设备可能有专门设计的数据接口，用于直接连接在下列设备上
单车道外部串行ATA环境，而不需要缓冲IC。单通道外部串行ATA设备的数据接口应符合6.5.1.3节的所有外部串行ATA机械要求。Phy的电气性能应符合以下要求。
- 6.6节中定义的电气特性，Gen1m和/或Gen2m的屏蔽外部连接器符合点。
- 支持热插拔和非带电设备连接。
- 设备接口处需采用交流耦合，主机接口处建议采用交流耦合。

#### 6.5.2 外置多路连接器 

本节定义了标准的电缆组件和头，用于将多个串行ATA通道从RAID主机总线适配器连接到相邻的JBOD(只是一堆磁盘)单元的智能背板。RAID HBA和JBOD单元被设想为使用不同的电源。
这套电缆/连接器是基于SFF-8470规范的。SFF-8470规范也描述了串行连接SCSI（SAS）使用的电缆/连接器组。
**6.5.2.1 多线电缆一致性标准**。
外部多线电缆/连接器只能用于Gen1m/Gen2m和Gen1x/Gen2x信号电平。如果使用Gen1m/Gen2m信号电平，电缆长度限制在两米以内。如果使用Gen1x/Gen2x信号电平，则支持最长超过2米的电缆长度。
**6.5.2.1.1 电气参数**。
运行在Gen1m和Gen2m级别的外部多路电缆组件应满足表20中定义的电气特性。
运行在Gen1x和Gen2x级别的外部多线电缆组件应满足表21中定义的电气特性。
 **6.5.2.1.2 机械参数**。
详细的机械要求见SFF-8470，参考型4X带拇指螺丝。PCI附加卡的外形尺寸支持两个4X接口。
## 图99 -外部多通道电缆和连接器 **6.5.2.2 键控要求**。
串行ATA外部多线电缆/连接器可包括键控功能，这是SFF-8470的变体。串行ATA键位置如图100所示。
可选的键控功能允许在Serial ATA HBA和JBOD之间进行连接，但如果SAS设备没有带键槽的连接器，则不允许连接到SAS HBA或JBOD。如果存在，则外部多路电缆连接器阻挡键位置应为3、4和5，相应的配接连接器阻挡键位置应为1、2和6。

##### 高速串行化接点 
#### ATA国际组织 
## 图100 - 多芯电缆连接器的关键位置。 
## 图101 - 插头/插座的键控  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **6.5.2.3 4车道引脚分配**。
## 表17--多线引脚分配情况。
根据电缆支持的物理链路数量使用的信号引脚。
信号
一 二 三 四
Rx 0+ S1 S1 S1 S1
Rx 0- S2 S2 S2 S2
Rx 1+ N/C S3 S3 S3 S3
Rx 1-N/C S4 S4 S4
Rx 2+ N/C N/C S5 S5
Rx 2- N/C N/C S6 S6
Rx 3+ N/C N/C N/C S7
Rx 3- N/C N/C N/C S8
Tx 3- N/C N/C N/C S9
Tx 3+ N/C N/C N/C S10
Tx 2-N/C N/C S11 S11
Tx 2+ N/C N/C S12 S12
Tx 1-N/C S13 S13 S13
Tx 1+ N/C S14 S14 S14
Tx 0- S15 S15 S15 S15 S15
Tx 0+ S16 S16 S16 S16 S16
信号
地面
##### G1-G9 
##### CHASSIS 
##### GROUND 
住房
注：N/C：未连接
N/C：未连接。
#### 6.5.3 迷你SATA外置多线程 
本节定义了标准的电缆组件和头，用于将多个串行ATA通道从RAID主机总线适配器连接到相邻的JBOD(只是一堆磁盘)单元的智能背板。RAID HBA和JBOD单元被设想为使用不同的电源。
这种电缆/连接器系统是基于SFF-8086和SFF-8088规格的。SFF-8086和SFF-8088这两种规格也被SAS（Serial Attached SCSI）所采用。
**6.5.3.1 符合性标准**。 
外部多通道电缆/连接器应与Gen1m/Gen2m或Gen1x/Gen2x信号电平一起使用。
- 4条通道，SAS/串行ATA信号。
- 对于Gen1m和Gen2m应用，电缆长度最大为两米。
- 对于Gen1x和Gen2x应用，电缆长度最大为两米。
- RX、TX、RX、TX引脚排序，以减少串扰。
- 每对电缆之间有接地参考。
- 3.0 Gbps的性能。
- 适用于 "m "和 "x "电缆的键控功能。
 **6.5.3.1.1 电气参数**。
运行在Gen1m和Gen2m级别的外部多路电缆组件应满足表20中定义的电气特性。
运行在Gen1x和Gen2x级别的外部多线电缆组件应满足表21中定义的电气特性。
**6.5.3.1.2 机械参数**。
详细的机械要求见 SFF-8086 和 SFF-8088。
Mini SATA 外置多线电缆和连接器应使用 SFF-8086 和 SFF-8088 中定义的 26 线路版本插头和插座。
如果有Mini SATA外部多线程连接器，其拉环应是红色的（Pantone #207）。
**6.5.3.2 Mini SATA 外置多线的键控要求**。
Mini SATA 外部多路电缆/连接器应包括 SFF-8088 的键控功能。
串行ATA定义的键位如图102所示。
x级信号电平的独特键控要求，如图103所示。图104所示为m级信号电平的独特键控要求。
## 图102 Mini SATA外部多通道系统，主要特征  
##### 在附件处进行高速小型化。
#### ATA国际组织 

## 图103 Mini SATA外部多通道系统，"x级 "信号的关键插槽1和4。
## 图104 Mini SATA外部多通道系统，"m级 "信号的关键插槽7 **6.5.3.3 Mini SATA外部多通道引脚分配**。
钥匙7
钥匙槽7  
Mini SATA 外置多线连接器的针脚分配如图 105 所示。
## 图105 迷你SATA外部多线连接器针脚分布图 
信号信号引脚
讯号 GND A1
RX 0+ A2
RX 0- A3
SIGNAL GND A4
RX 1+ A5
RX 1- A6
SIGNAL GND A7
RX 2+ A8
RX 2-A9
信号灯 GND A10
RX 3+ A11
RX 3- A12
SIGNAL GND A13
讯号 GND B1
TX 0+ B2
TX 0-B3
SIGNAL GND B4
TX 1+ B5
TX 1-B6
SIGNAL GND B7
TX 2+ B8
TX 2-B9
SIGNAL GND B10
TX 3+ B11
TX 3- B12
SIGNAL GND B13
CHASSIS
地面
##### 住房 
A1 
A13 
B1 
B13  
##### 在附件处进行高速小型化。
#### ATA国际组织 
### 6.6 电缆和连接器电气规格............................................................。

本节的目的是规定所有电缆使用型号的电缆和连接器的电气特性。这里定义的电气特性描述了高速信号传输所需的相关电气特性。表22和表23中列出了一个测试方法的示例，可作为表征电缆、连接器和PCB信号路径（即微带和带状线迹）的工具。只要不同的测试方法和/或设备能提供同等的结果，就可以使用。
在进行表6和表9所列的所有测试之前和之后，电缆和连接器应满足下列电气要求。
#### 6.6.1 串行ATA电缆 **6.6.1.1 电气要求**。
表18列出了Gen1i、Gen2i或Gen3i级别的系统对内部单通道和多通道串行ATA电缆和连接器的电气要求。
## 表18 - 内部电缆/连接器测量参数和要求.................。

参数要求程序
配套连接器 差分阻抗 100 欧姆 ±15% P1
电缆绝对差分阻抗100欧姆±10% P2。
电缆对匹配阻抗±5欧姆P3。
共模阻抗 25 - 40 欧姆 P4
电缆的最大插入损耗(10-4500 MHz) 6 dB P5
最大串扰，单通道。
NEXT (10-4500 MHz) 26 dB 损耗 P6
最大串扰，多线。
CXT (10 - 4500 MHz) 30 dB损耗 P7
最大上升时间 85 ps (20-80%) P8
最大符号间干扰 50 ps P9
最大线对内偏移10 ps P10
注意：内部多通道和 Mini SATA 内部多通道的最大串扰与单通道不同。由於這些纜線是多線纜線，且有多個閘道，因此額外的要求是使用 CXT 方法測量串音。
表19中定义了Gen1m或Gen2m级别的系统对外部单通道电缆和连接器的电气要求。
#### 表19 - 外部单车道电缆/连接器测量参数和要求 
参数要求程序
配套连接器 差分阻抗 100 欧姆 ±15% P1
电缆绝对差分阻抗100欧姆±10% P2。
电缆对匹配阻抗±5欧姆P3。
共模阻抗 25 - 40 欧姆 P4
电缆的最大插入损耗(10-4500 MHz) 8 dB P5
最大串扰。NEXT (10-4500 MHz) 26 dB 损耗 P6
最大上升时间 150 ps (20-80%) P8
最大符号间干扰 50 ps P9
最大线对内偏移20 ps P10 
表20定义了Gen1m或Gen2m级别的系统对外部多线电缆和连接器的电气要求。
###要求 表20 - 有限的外部多线电缆/连接器测量参数和标准。
所需经费
参数要求程序
配套连接器差分阻抗100欧姆±10% P1
电缆绝对差分阻抗100欧姆±5% P2。
电缆对匹配阻抗±5欧姆P3。
共模阻抗 25欧姆-40欧姆 P4
电缆的最大插入损耗(10-4500 MHz) 8 dB P5
最大串扰。CXT (10-4500 MHz) 30 dB CXT P7
最大上升时间 150 ps (20-80%) P8
最大符号间干扰 50 ps P9
最大线对内偏移20 ps P10
注：用于Gen1m或Gen2m信号传输的外部多线电缆长度限制为2米。
表21中定义了Gen1x或Gen2x级别的系统对外部多线电缆和连接器的电气要求。
### 表 21 - 扩展的外部多线电缆/连接器 测量参数和测量方法 
所需经费
参数要求程序
配套连接器差分阻抗100欧姆±10% P1
电缆绝对差分阻抗100欧姆±5% P2。
电缆对匹配阻抗±5欧姆P3。
共模阻抗 25欧姆-40欧姆 P4
电缆的最大插入损耗(10-4500 MHz)16 dB P5。
最大串扰。CXT (10-4500 MHz) 30 dB CXT P7
最大上升时间 150 ps (20-80%) P8
最大符号间干扰 60 ps P9

最大线对内偏移20 ps P10
注：所有长度超过2米的外部多路电缆均采用Gen1x或Gen2x级别。
#### 6.6.2 电缆/连接器测试方法 **6.6.2.1 测试设备**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
下面的清单确定了执行表22和表23中概述的表征程序的建议设备的类型和性能。
- 高带宽采样示波器
- TDR模块--<35 ps (20% - 80%) 边缘率阶梯响应
- 矢量网络分析仪 - 4个端口，13.5 GHz BW o 建议20 GHz BW。
- 高性能同轴电缆 - =20 GHz BW
- 低抖动3.0 Gb/s模式源--20%-80%的上升时间最小为136 ps。(上升时间应尽可能接近136 ps。) **6.6.2.2 测试和测量条件**。
除非另有规定，否则所有测试和测量必须在以下条件下进行。
- 电缆/连接器的连接
- 温度：15°至35°C 15°至35°C
- 相对湿度：20%至80%。
- 大气压力：650毫米至800毫米汞柱 **6.6.2.3 试验夹具考虑因素**。
电缆/连接器配置的表征需要在被测单元(UUT)和测试设备之间建立一个接口，通常称为测试夹具。使用测试夹具的一个主要目的是尽可能消除PCB的不利信号完整性影响。在定义测试夹具时，应遵循以下准则。请考虑以下几点。
- 测试夹具应使用差分微带线（100±5欧姆），在一个接地平面上（单端50±2.5欧姆）。
- 应提供与输入信号迹线长度相同的开路或短路迹线，以实现以下功能： o 建立系统输入上升时间 o 同步脉冲 o 建立参考平面。
- 用于串扰测量的痕迹应相互偏离。
- 还应提供衰减参考测量的规定。
  **6.6.2.4 试验定义/方法**。
在准备进行测量时，测试程序中有许多步骤，这些步骤被称为通用程序。这些步骤包括校准、去偏斜、建立参考平面和建立上升时间参考轨迹。
在执行任何程序或收集数据之前，确保测试设备已被正确校准。
完成每个常用程序的方法见表22。

##### 高速 SERIALIZED ATTACHMENT(附件) 
#### ATA国际组织 
##表22--常见的互连测量程序方法..............................。

C1 最小化V+和V-、差分信号之间的偏移 1. 定义差分通道激励 a. 通道1/3正边沿阶跃响应（V+） b. 通道2/4负边沿阶跃响应（V-） 2. 差分响应--将差分信号（Vdiff）确定为范围响应，例如，使用数学函数得到Vdiff=V+- V-（CH1-CH2或CH3-CH4） 3. 通过调整V+(CH1/3)或V-(CH2/4)边缘向前或向后的时间，使V+(正)和V-(负)边缘之间的偏斜最小化，直到两个边缘对齐到1ps以内。

C2 在连接器上建立参考平面 1. 按照示波器固件中概述的校准程序进行校准。
2. 2. 在示波器固件中选择定义参考平面选项，在测试夹具的输入端建立一个参考平面。
3. 当建立一个新的参考平面时，使用精密的50欧姆负载或测试夹具的50欧姆负载端接的精密空气线。

C3 建立上升时间参考轨迹 1. 配置TDR模块，以产生差分阶跃脉冲响应，并确定跟踪的差分上升沿。
2. 识别脉冲响应的高电压和低电压值。
3. 识别20%和80%的电压水平，并验证阶跃脉冲的上升时间在25 ps和35 ps之间。调整阶跃脉冲响应在所需范围内的方法有两种：a.通过设备滤波设置系统上升时间。
#### 技术。滤波器编程等于 tr^2 ( 观察到的 ) tr^2 ( 刺激 ) b. 采集测量数据，并在波形查看器或 TDR SW 应用程序中执行后处理步骤，将采集的数据过滤到所需的上升时间。
4. 4. 一旦确定了正确的上升时间，使用 PCB 夹具上的参考线来验证上升时间。
 
表23中概述的测试方法和程序参考了表22中描述的常用程序。这些方法的实际规格要求值列于6.6.1.1节。
## 表23 - 互连测试方法/程序.........................................................。
P1 配接连接器 差分阻抗 1. 使用测量轨迹校准仪器和系统，然后按照普通程序C1、C2和C3进行校准。
2. 仪器的上升时间应设定或过滤结果为最小55 ps至最大70 ps（20-80%）的系统上升时间。系统上升时间应尽可能设置为接近70 ps（20-80%）的实际情况。
3. 测量并记录近端连接器差动阻抗的最大值和最小值。

P2电缆绝对差分阻抗 1. 使用测量痕迹校准仪器和系统，然后按照常见的程序C1、C2和C3进行校准。
2. 仪器上升时间应设置或过滤结果为最小55 ps至最大70 ps（20-80%）的系统上升时间。系统上升时间应尽可能设置为接近70 ps（20-80%）的实际情况。
3. 测量并记录任何连接器响应遗迹后的前 500 ps 电缆响应的 TDR 线路中的最大和最小电缆差动阻抗值。

P3 电缆对匹配 1. 使用测量痕迹校准仪器和系统，然后按照常见的程序C1，C2和C3。
2. 仪器上升时间应设置或过滤结果为最小55 ps至最大70 ps（20-80%）系统上升时间。系统上升时间应尽可能设置为接近70 ps（20-80%）的实际情况。
3. 测量并记录一对电缆内各电缆的单端电缆阻抗，如ZL1、ZL2。
4. 测量并记录任何连接器响应遗迹后的前500 ps电缆响应的TDR跟踪中的最大和最小电缆阻抗值，例如ZL1-max、ZL1-min和ZL2-max、ZL2-min。
5. 所需参数等于Zmax=ZL1-max-ZL2-max，Zmin=ZL1-min-ZL2-min。
 
##### 高速 SERIALIZED ATTACHMENT。
#### ATA国际组织 
P4 共模阻抗 1. 使用测量轨迹校准仪器和系统，然后按照通用程序C1、C2和C3进行校准。
2. 仪器上升时间应设置或过滤结果为最小55 ps至最大70 ps（20-80%）系统上升时间。系统上升时间应尽可能设置为接近70 ps（20-80%）的实际情况。
3. 将负边阶梯响应通道选择为正边阶梯响应，使两个通道都产生正边阶梯响应。
4. 测量来自第一阶梯发生器的TDR跟踪的均匀模式阻抗，在任何连接器响应的遗迹之后的前500 ps的电缆响应。
5. 5.在波形上执行数学函数，将偶数模式阻抗响应除以2，结果就是共模阻抗。
6. 对第二步发生器进行同样的测量和数学计算。
7. 7.各阶梯发生器的共模阻抗应符合要求。

P5 插入损耗 1. 用测量痕迹对仪器和系统进行校准，然后按照通用程序C1和C2进行校准。
2. 使用板上提供的IL参考迹线测量并存储夹具的插入损耗（IL），频率范围为10～4500MHz，如ILfixture。
3. 在10～4500MHz的频率范围内测量并记录样品的IL，其中包括夹具IL，例如ILsystem。
4. 样品的插入损耗由ILsample = ILsystem - ILfixture计算。
 
P6差分对差分串扰。下一步 1. 使用测量痕迹校准仪器和系统，然后按照常见的程序C1、C2和C3进行校准。
2. 用50欧姆的特性阻抗负载端接参考迹线的远端。
3. 测量并记录系统和夹具的串扰。它被定义为噪声底线，如Vnoise。
4. 用50欧姆的特性阻抗负载端接设备和听线的远端。
5. 将声源连接到设备对，将接收器连接到听线对的近端。
6. 在10～4500MHz的频率范围内测量NEXT，如：。
    VNEXT。
7. 验证采样串扰是否脱离了噪声底线，例如VNEXT > Vnoise。
 
##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
P7 多线（多干扰器）差分串扰。ML-CXT 1.使用测量轨迹校准仪器和系统，然后按照普通程序C1、C2和C3进行校准。使用测量轨迹校准仪器和系统，然后按照普通程序C1、C2和C3进行校准。
2. 2. 用50欧姆的特性阻抗负载端接参考线的远端。
3. 测量并记录系统和夹具的串扰。它被定义为噪声底线，如Vnoise。
4. 用50欧姆的特性阻抗负载端接设备和听线的远端。
5. 将声源连接到设备对，将接收器连接到听线对的近端。
6. 在10～4500MHz的频率范围内测量CXT，如VCXT。

7. 验证采样串扰是否脱离了噪声底线，如VCXT > Vnoise。

#### 8.

####  
#### = × = 71 1 ( ) 20
#### ( ) 20 log 10 
A
VCXT fl
#### MLCXT f 其中。
MLCXT(f)是在任何给定接收通道上观察到的频率f处的多线电缆组件串扰。
#### VCXT(f)A是接收机/受害者与侵略者A^1的任意组合之间在频率f处的相对串扰，它表现出小于40dB的隔离度。
f是10 MHz至4.5 GHz的频率范围。
A是1，2-7（接受者/受害者对侵犯者^1对组合）1．侵略者。任何被确定为Tx(输入)的车道都应被视为潜在的侵略者。
这包括近端和远端Tx车道 
注：
MLCXT加和计算考虑到任何侵略者^1相对于接收机/受害者对表现出小于40dB的隔离。

P8 差分上升时间 1. 使用测量轨迹校准仪器和系统，然后按照普通程序C1、C2和C3进行。
2. 将TDR阶跃脉冲响应发生器连接到被测信号路径的近端。
3. 记录被测信号路径远端的输出上升时间。

P9 信号间干扰
注意：由于偶然（测试系统引起的）DJ可能不会从最终结果中去掉，因此在进行此测量时，使用高质量（低抖动）的夹具和刺激系统是至关重要的。
1. 在测试夹具的输入端连接一个差分模式源。20％-80％的上升时间和下降时间的模式源应至少136 ps。上升和下降时间应尽可能地接近136 ps，以最大限度地减少所产生的DJ，并产生最准确的结果。通过夹具生成3.0 Gbps的LBP。孤位模式强调的是ISI。
2. 使用JMD，评估在电缆末端引入的确定性抖动（DJ）。

P10 线对内偏斜 1.使用测量痕迹校准仪器和系统，然后按照常见的程序C1、C2和C3进行校准。
2. 测量一对内各单端信号在电压摆动中点的传播延迟，例如：tdelay = Vmid+ - Vmid- 其中： 1. 
#### 2高、低、中
#### V V 
#### V 
####  
#### =.

### 6.7 电源段引脚 P11 定义（可选 
器件连接器电源段的P11引脚可由器件用于向主机提供活动指示，也可由主机用于指示是否应使用交错自旋。为了实现这两个目标，引脚P11在PHYRDY之前作为主机对器件的输入，用于交错自旋控制，然后在PHYRDY之后作为器件对主机的输出，用于活动指示。由P11引脚提供的活动指示
P11主要用于背板应用。有关桌面应用中活动LED生成的信息，请参考第13.14节。
器件可选择通过P11引脚支持活动指示，通过P11引脚支持交错自旋控制。
P11，或同时支持两种功能。如果这两种功能都不支持，那么P11引脚在设备上是表3中规定的无连接。
一台主机只能支持一个引脚P11功能，要么是接收活动指示，要么是交错旋起禁用控制。如果主机支持通过P11引脚接收活动指示，则主机 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织不得使用P11引脚来禁用交错自旋。如果主机不支持通过P11引脚接收活动指示，那么主机可以使用P11引脚来禁用交错自旋。
#### 6.7.1 设备活动信号 **6.7.1.1 电气定义**。
该器件提供的活动指示信号是一种低压低电流驱动器，旨在有效地集成到当前和未来的IC制造工艺中。该信号不适合直接驱动LED，在驱动LED之前，应首先使用器件外部的电路进行缓冲。
该活动信号基于开集电极或开漏式有源低电平驱动器。器件应能容忍活动信号对地短路。器件应容忍无连接的浮动活动信号。
表24和表25定义了器件和主机对活动信号的电气参数和要求。图106是一个活动信号的实施例，以示说明。请注意，主机不应依赖设备侧的特定电阻上拉值，设备也不应依赖特定的主机电阻值。不适应对来自多个设备的有线OR信号的直接支持。通过组合多个器件输入而产生单个活动信号的主机实现应在组合信号之前对其进行缓冲。
## 图106 - 活动信号电气框图示例 
表24和表25中的所有电压参考值都是设备连接器上的P12引脚接地。
表24和表25中的所有电压和电流都是在器件连接器的P11引脚处测量的。
R1
R2
D1
引脚P12
GND
引脚 P11 -活动 +VLED
LED驱动器
设备主机 +
VH-+
VD - 
ID +VHH
活动
分立
控制
RPU+V
功率段连接器 
## 表24--电源段P11引脚活动信号电气参数 **参数 最小值 最大值 说明与条件**。
VDIn -0.5 V 2.1 V 容许输入电压
VDAct 0 mV 225 mV 在ID小于或等于300 uA的条件下低速驱动时的器件输出电压。
VDInact -0.1 V 3.3 V 不低速驱动时的设备输出电压。
IDInact -10 uA 100 uA 未驱动时的设备泄漏电流 
## 表25 - 主机活动信号电参数 **参数 最小值 最大值 说明和条件**。
VHIn -0.5 V 3.3 V 容许输入电压
VHH 2.1 V 当设备不驱动信号为低时，呈现给设备的主机电压。参见6.7.2节的交错自旋控制）。
VHL -0.1 V 可提供给器件的最小允许主机电压。
IHAct 300 uA 当器件驱动信号为低电平时，输送到器件的主机电流。指定值在
VDActvoltage为0V。
**6.7.1.2 LED驱动电路（参考）**。
由主机提供的驱动活动LED的LED驱动电路是厂商特定的。图107示出了两种满足电气要求并提供适合驱动活动LED的信号的概念性驱动电路。驱动器电路的变化可以采用在活动时驱动LED，或通过使用反相或非反相缓冲安排在设备不活动时驱动LED。

##### 高速 SERIALIZED ATTACHMENT(高速 SERIALIZED ATTACHMENT)。
#### ATA国际组织 
## 图107 - 主机LED驱动电路示例 **6.7.1.3 功能定义**。
表26定义了两种活动信号状态及相应条件。
## 表26 - 活动信号功能状态..................................................................................。
 **状态条件**
信号有效(低电平驱动)指令未执行^1。
信号被否定（高阻抗） 所有其他条件
注释：1: 1. 对于不访问介质的命令，以及预期服务时间太短而无法目视信号的命令，设备可能会省略断言活动信号。
    未完成的命令不包括软件复位、开机复位或COMRESET命令协议。因此，在复位命令协议的复位签名返回之前，器件不得将P11引脚驱动为低电平。这在行为上与并行ATA DASP-信号不同。

#### 6.7.2 交错旋升禁用控制 **6.7.2.1 电气和功能定义**。
交错启动功能在第13.10节中定义。器件可选择提供支持，通过功率段连接器的P11引脚禁用交错自旋。交错旋起禁用控制是一个有源断言的低主机信号。
在设备旋转其介质之前，支持交错旋起禁用控制的设备应检测引脚P11是否被主机断言为低电平。如果引脚P11被断言为低，则设备应禁用交错自旋，并立即启动介质自旋。如果引脚P11在主机中没有连接(浮动)，通过引脚P11支持交错自旋禁用的器件应启用交错自旋。表27定义了设备检测交错自旋禁用的电信号要求。
## 表27--主机交错自旋控制电气要求 **参数 最小值 最大值 说明与条件**。
VHEnb 1.8 V VHHmax 呈现给器件的主机电压，以便在支持交错旋转控制的器件中不禁用交错旋转。为所有允许的 IDInact 漏电流指定的值。
VHDis -0.1 V 225 mV 在支持交错自旋控制的器件中，向器件提供的主机电压用于禁用交错自旋。为所有允许的 IDI 漏电电流指定的值。

由主机或存储子系统提供的交错自旋控制指示应是静态的，并且在应用电源时不应改变。如果在交错自旋禁用检测期间，信号被主机拉低，则该信号应保持低电平。如果主机发出交错旋起禁用信号，设备应禁用活动信号。
如果支持，器件应在施加直流电源后、PHYRDY被断定之前，对交错自旋禁用条件进行采样。
**6.7.2.2 交错上电禁用电路（信息）**。
通过拉低引脚P11来信号交错自旋禁用的主机电路是特定于供应商的。
图108示出了一个概念性的主机电路，它将满足信号交错自旋禁用的电气要求。
 主机可以将P11引脚静态短接至地，也可以主动将信号驱动至低电平。
## 图108 - 用于发出交错自旋禁用信号的主机电路示例。
引脚P12
GND
引脚P11 -活动
设备主机 +
VH-+
VD - 
身份证
活动
分立
控制
RPU+V
功率段连接器 
##### 在附件处进行高速小型化。
#### ATA国际组织 
### 6.8 预充电和设备存在检测 
对于存储子系统来说，需要具备热插拔能力，以及在存储子系统可能会移除单个插座电源的情况下无缝处理存在检测的能力。
#### 6.8.1 设备要求 
为了适应使用预充电功能的热插拔，以及存在检测的手段，串行ATA设备应将每个电源电压的所有电源输送引脚总线在一起。
#### 6.8.2 插座预充电(资料性)....................................................................。

串行ATA设备连接器是专门为适应强大的热插拔能力而设计的。设备连接器的一个特点是，插座能够通过使用预充电方案来限制瞬时浪涌电流。该方案依赖于每个电压的一个功率输送触点比其余触点长，以便使功率通过这个较长的触点通过限流装置输送。图109示出了一种利用预充电连接器特性的热插拔功率输送方案。
+
V1 - 
驱动器 
背面 
#### A 
#### B 
#### RL 
## 图109 - 典型的预充电配置 
限制新插入设备的浪涌电流的所有负担由插座/背板承担。对于特定的背板解决方案，准确的限流电阻尺寸取决于实施的细节。在确定限流电阻的尺寸时，需要考虑的一些变量包括。
- 器件插入速度
- 插入器件的有效电容
- 触点电流承载能力 
该小组对这些变量的调查表明，对于一个特定的应用，最大插入速度产生的接触预充电时间约为3毫秒。对几个磁盘驱动器供应商的调查表明，磁盘驱动器设备的典型有效电容约为20uF。为说明起见，在估计预充电电阻值的示例方案中假定了这些值。将有效电容充电至90%的满电所需的时间大约为2.2 - R - C。
EQ
EQ
#### C 
#### T 
#### R 
#### T R C 
####  
#### = 
#### =   
#### 2. 2 
#### 2. 2 
对于充电时间为3毫秒、有效电容为20uF的例子，由此得出的预充电电阻值约为。
#### =  
####  
#### = 68 
#### 2. 2 20 
#### 3 
#### uF 
#### 
#### R 
由于串行ATA电源导体支持高达1.5 A的电流，为了降低对器件实际有效电容的敏感性，计算出的电阻尺寸可以大幅减小，而不会产生不良后果。对于12 V电源轨，电阻可能小至8欧姆，但仍不超过预充电触点的载流能力。根据实际外壳子系统设计的细节，示例方案中典型的预充电电阻值可能在10-20欧姆的范围内。
#### 6.8.3 存在检测(信息) 
存在检测依赖于设备在热插入后使用OOB序列向主机发出信号，以指示其存在。这种方法假定设备被插入到热插座中，还假定插入的设备没有发生故障。在存储子系统中，这些假设可能是不合适的，因为这样的存储解决方案可能具有解除单个设备插座的电源的能力，以便使设备的插入/移除更安全。因此，需要一种用于确定在没有施加电源且设备不必工作的插座中的设备存在的方法。
一种可能的器件存在检测机制利用6.8.2节中概述的预充电电路。基本方法是通过测量图中A点和B点之间的阻抗来确定设备的存在。由于器件将各自的电源输送触点总线在一起，因此图中A点和B点之间的阻抗在没有器件存在的情况下为RL，而在插座中插入器件的情况下实际上为零。
图110示出了一种可能的电路，用于处理插座带电或不带电时的器件存在检测。该示例电路受所选元件和电源电压的公差积累的影响，并且仅作为概念性示例提出。

##### 高速 SERIALIZED ATTACHMENT(附件) 

#### 串行ATA国际组织+5V - 
驱动器 
主机 
#### AA 
#### RR LL ==2200  
#### 1122 VV 
#### CC 
#### ++ 
#### - - 
#### 333300 (^1100)  
#### 224400  
#### 1122 VV 
#### 333300  
#### 224400  
#### BB 
## 图110----存在检测实施示例 
##表28----另一个存在检测电路实例的比较器电压。
插座 电源插座 无电源插座
设备不存在 VA= 5.40 V VC= 5.17 V VA= 5.29 V VC= 5.17 V
器件存在 VA= 5.0 V VC= 5.17 V *VA= 5.05 V VC= 5.17 V *如果插入的器件对地的阻抗是有限的，那么VA应该比这个值低，这样会进一步增加电压差，增加裕度。
 
##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
## 7 物理层............................................................................................................................

本节介绍串行ATA的物理层。所提供的信息包括两种类型--信息性和规范性。除非另有说明，否则这些信息应被视为规范性信息，并作为必要的要求包含在本文件中，以便正确地将一台设备连接到另一台设备上。本规范性信息的结构是特意设计的，仅在兼容性所需的程度上限制和定义区域。所提供的信息和标明的信息只是为了帮助读者更好地理解规范性部分，并应仅作为例子。具体的实现可能会有所不同。
### 7.1 Phy电气规范的描述...............................................................。

以下是各种电气规范的术语。
- **Gen1i** 。第1代电气规格。这些是内部主机到设备应用的1.5 Gbps电气规范。
- **Gen1m** : 第1代电气规格适用于短背板和外部布线应用。这些都是1.5 Gbps的电气规格，旨在短1.5 Gbps的内部背板应用，使用外部单通道电缆的外部桌面应用，以及使用外部多通道电缆的系统到系统数据中心应用，长度可达2米。这些仅包括修改后的接收器差分输入规格。与Gen1m符合点相关的所有其他电气规格与Gen1i规格相同。本规范仅适用于这些有限的应用，而不是用于任何其他系统拓扑。
- **Gen1x** : 扩展长度1.5 Gbps电气规格。这些是针对长背板和系统到系统数据中心应用中的1.5 Gbps链路的电气规格，支持外部多线电缆，长度达2米以上。这些规格是基于SAS的参考资料。
- **Gen2i** 。第2代电气规格。这些是针对内部主机到设备应用的3.0 Gbps电气规格。
- Gen2m** : 第2代电气规范适用于短背板和外部桌面应用。这些是3.0 Gbps的电气规格，旨在短的内部背板应用，使用外部单通道电缆的外部桌面应用，以及使用长度达两米的外部多通道电缆的系统到系统数据中心应用。这些规格仅包括修改后的接收器差分输入规格。与Gen2m符合点相关的所有其他电气规格与Gen2i规格相同。本规范仅适用于此有限的应用，不用于任何其他系统拓扑。
- **Gen2x** : 扩展长度3.0 Gbps电气规格。这些是针对长背板和系统到系统数据中心应用中的3.0 Gbps链路的电气规格，支持外部多线电缆，长度达2米以上。这些规格是基于SAS的参考文献。
- **Gen3i** 。第3代电气规格。这些是针对内部主机到设备应用的6.0 Gbps电气规范。

#### 7.1.1 服务列表 
- 以指定的电压水平传输1.5 Gbps、3.0 Gbps或6.0 Gbps差分NRZ串行流。
- 在发射机上提供一个100欧姆的匹配终端（差分）。
- 串行化来自Link的10、20、40或其他宽度的并行输入，用于传输。
- 接收1.5 Gbps **,** 3.0 Gbps或6.0 Gbps差分NRZ串行流，数据速率为±350 ppm，与标称数据速率相差+0/-5000 ppm（由于SSC配置文件）。
- 在接收器处提供一个100欧姆的匹配终端（差分）。
 
- 从串行流中提取数据（以及可选的时钟）。

- 去掉串行流的序列化。
- 检测K28.5逗号字符，并提供位和字对齐的10、20、40或其他宽度的并行输出。
- 提供指定的OOB信令检测和传输。
- 使用OOB信令协议初始化串行ATA接口，并使用此OOB序列执行预定义的速度协商功能。
- 执行正确的开机排序和速度协商功能。
- 向Link层提供设备状态。
    - 设备存在。
    - 设备缺席。
    - 设备存在但未能进行通信协商。
- 可选择支持电源管理模式。
- 可选择执行发射机和接收机阻抗校准。
- 处理由于扩频发射机时钟引起的输入数据速率频率变化。
- 适应进入远端重定时环回的要求，以及其他BIST的要求，当接到命令时，激活FIS测试操作模式。

#### 7.1.2 低层电子器件框图（信息性 
以下框图是作为本文件以下部分的参考。尽管在本质上是信息性的，但这里描述的块的功能提供了适用于规范性规格的基础。所提供的各个模块是作为一种可能的实施例而提供的。
**7.1.2.1 物理设备框图**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
## 图111 -- -- 实体工厂整体框图(资料性) 
I o o
I
I
I o o
I
I
I
I
I
I o o o o o o o o
数据
检测
源TxClock
模拟
前面
结束
萃取
收回的
时钟
COMINIT*/
COMRESET
固定模式
控制块
DATAIN[0:n]* TX(+)*。
TX(-)* * 注：所有符合要求的设备都需要带星号(*)的信号。
HRESET*
SPDSEL
SLUMBER*
设备检测
PHYRDY*
部分*
FARAFELB*
NEARAFELB*
系统时钟
块
固定模式
RX(+)*
RX(-)*
逗号
COMWAKE*
RXCLOCK
SPDMODE
PHY内部错误
DATAOUT[0:n]* 
物理工厂整体框图说明
模拟前端 该模块是传输线的基本接口。该模块由高速差分驱动器和接收器以及OOB信号电路组成。
控制块 该块是逻辑电路的集合，用于控制物理设备电路的整体功能。
固定模式源 该块提供支持电路，根据需要生成模式，以实现ALIGNPactivity。
固定模式检测 该块提供支持电路，使其能够正确地处理
ALIGNPprimitives。
数据提取块 该块提供支持电路，用于从高速输入流中分离时钟和数据。
TX 时钟 该信号是物理工厂的内部信号，是调节串行流通过高速信号路径发送频率的参考信号。
TX + / TX - 这些信号是连接到串行ATA电缆的出站高速差分信号。
RX + / RX - 这些信号是连接到串行 ATA 电缆的入站高速差分信号。
DATAIN 从Link层发送到Phy层的数据，用于串行化和传输。
PHYRESET 该输入信号使Phy初始化到已知状态，并开始在接口上产生COMRESET OOB信号。
PHYRDY 表示Phy已成功建立通信的信号。该
Phy正与其接收机的输入信号保持同步，并在其发射机上发射有效信号。
SLUMBER 使Phy层过渡到Slumber电源管理状态。
PARTIAL 使Phy层过渡到Partial电源管理状态。
NEARAFELB 使 Phy 将串行数据流从发送器回环到接收器。
FARAFELB 使 Phy 将串行数据流从其接收器循环回发射器。
SPDSEL 使控制逻辑自动协商一个可用的接口速度或设置一个特定的接口速度。该输入的实际功能是特定于厂商的，因厂商而异。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速串行化接口）。
#### ATA国际组织 
SPDMODE 反映当前接口速度设置的输出信号。该信号的实际功能由厂商决定，因厂商而异。
SYSTEMCLOCK 该输入是大部分控制电路的时钟源，是建立传输接口速度的基础。
COMMA 该信号表示在入站高速数据流中检测到一个K28.5字符。
DATAOUT 由Phy接收并去串联的数据，并传递给Link层。
RX时钟/恢复的时钟
该信号来自于高速输入数据信号，并确定何时并行数据已经正确地在
DATAOUT引脚，并可传输到外部电路。
COMRESET / COMINIT

主机。来自OOB检测器的信号，表示正在检测COMINIT OOB信号。
设备：来自OOB检测器的信号，表示正在检测COMINIT OOB信号。来自OOB探测器的信号，表明COMPRESET(重新设置)。
正在检测到OOB信号。
COMWAKE 来自 OOB 探测器的信号，表示正在检测 COMWAKE OOB 信号。
 - - - + A - - - A 50
REF  
OOB信号
电压
调节器
COMWAKE
COMRESET /
COMINIT
TX数据
TX+
TXa 50  
Te r m i n a t i o n^
校准^
TX
RX
RX数据
RX+50
RX 50
探测器
PLL
压制
## 图112 - 模拟前端(AFE)框图[未显示外部AC帽] 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.1.2.2 模拟前端（AFE）框图说明**。
TX 该模块包含基本的高速驱动电子元件。
RX 该模块包含基本的高速接收器电子元件。
终端校准 该模块用于确定 RX 模块的阻抗，以便正确终止高速串行电缆。
Squelch 该模块建立了一个限制，以便可以正确地完成对共模信号的检测。
OOB信号检测器 该块对高速输入信号路径中的OOB信号进行解码。
PLL 该模块用于同步内部时钟参考，以便正确解码输入的高速数据流。
稳压器 该模块用于稳定其他模块所使用的内部电压，以便实现可靠的操作。该模块可能需要，也可能不需要，以保证电路平衡的正常运行。该模块的需求取决于具体实施情况。
TX+ / TX- 这与上一节所述的信号相同。物理工厂整体框图描述。
RX+ / RX- 这与上一节所述的信号相同。物理设备整体框图描述。
TxData 串行编码的 10b 数据，连接到高速串行差分线驱动器。
RxData 串行编码的 10b 数据，连接到高速串行差分线接收器。
COMWAKE 此信号与上节所述相同。物理工厂整体框图描述。
COMRESET / COMINIT
这与上一节所述的信号相同。物理工厂整体框图描述。
 - - - - + a -
- • - 50 
R
英孚 
O
O
B
Si gn al
Vo lta ge
R eg ul at or 50  
Te rm in at io n
C al ibr at io n 50 50
D et ec to r
PL
L
S qu el ch - - - - - + a -
------------A 50
RE
F  
O
O
B
Si gn al
Vo lta ge
R eg ul at or
COM-
WAKE
COM-
WAKE
COMRESET /
COMRESET /
COMINIT
COMINIT
TX数据
TX数据
TX+^
TX+
TX
TX a a 50  
Te rm ina tio n
图书馆 **TX** **TX** 
RX
RX
RX数据
RX数据
RX+
RX+ 50 **RX** **RX** 50
D et ec to r
PL
L
Sq ue lch
## Host AFE 
##设备AFE 
## 图113 - 模拟前端(AFE)布线............................................................................。
 [编者注：未显示外部交流耦合电容器] 
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.1.3 合规性测试 
本文档提供的电气规范，当主机、设备和互连满足这些规范时，就能满足组合成系统时的链路性能规范。本文件的这一部分概述了如何确定主机、设备或互连线是否符合电气规格。
互联符合本文件的规范。
每个电气规范都需要特定的测量、测试设置和数据模式。本节将所有这些要求联系在一起，以帮助读者了解符合性测试所需的内容。
表29、表30、表31、表32、表33和表34详细说明了SATA合规性的电气要求。每项要求都在第7.2.2节中定义。抖动在第7.3节中描述。第7.4节详细介绍了每种规格的测量方法。第7.5节讨论与OOB和电源管理有关的接口状态。第6.6节描述了
互联要求。
Phy层分为发射器、互连和接收器。
SATA链路是全双工点对点链路，因为每个方向上都存在连续的数据活动。为了对主机和设备进行合规性测试，全双工链路被分解成两条单工链路，一条用于主机向设备传输，另一条用于设备向主机传输。每条链路分别进行符合性测试。每个发送器到接收器的链路包含以下元素。
发射器（IC/PCB/SATA连接器）--至
互联（连接器/电缆或PCB/连接器）------。
接收器(SATA连接器/PCB/IC)
发射机
互联
接收器
发射器 IC 接收器 IC（第 1i 代可选择使用 AC 电容器）。
插座插座 插座插头
PCB印刷电路板
## 图114 - 单一链路 
在测试组成系统的SATA组件的合规性时，有五种合规性。

测量范围： 1. "传输信号"--检查主机/设备到实验室负载的符合点的传输信号质量。电气规格包括振幅、上升/下降时间、频率、抖动等。当驱动实验室负载时，电气规格适用于被测发射机在配接连接器上输出的信号。
    没有试图指定连接到电缆、背板或直接进入另一个设备的信号。实际的 "系统内 "信号可能会有所不同。
  2. "发射机"--从符合点检查发射机的所有指定特性。这包括差分和共模阻抗等规格。发射器 "包括IC，其中包括发射器、PCB、SATA连接器以及IC和SATA连接器之间的任何附加组件。
3. "接收器"--从符合性角度检查接收器的所有指定特性。这包括差分和共模阻抗等规格。
    接收器 "包括SATA连接器、PCB和包含接收器的IC，以及IC和SATA连接器之间的任何附加元件。
 "接收器公差"--当接收器呈现最坏情况下的 "实验室信号"，并与其主动发射器一起工作时，应满足指定的帧错误率。这需要仔细控制信号源，以产生最坏情况下的信号。
5. "互连"--使用测试设备，检查互连的所有规定特性。互联包括两端的SATA连接器对。测试要求和程序在6.6节中描述。

为了确定是否符合本文件的规范，当连接到测试设备时，应分别与被测试的主机、设备或互连进行测量。在主机、设备或互连设备连接在一起时，不进行符合性测试。除非另有规定，否则所有合规性测量都应通过配接的连接器对进行。
注：接收器公差表中的电气规格并不描述接收信号的特性；这些规格描述的是经过校准后的实验室来源信号。
实验室负载，并随后应用到接收器上。接收机容差表并没有描述信号从发射机通过互连线进入实验室的特性。
实验室负载。由于发射机和接收机的非理想阻抗匹配，系统中的接收信号有可能变差。
#### 7.1.4 链接性能.................................................................................................

使用一组参考帧（由帧内特定的一组有序测试模式定义），通过帧错误率来衡量主机和设备与互连的SATA系统的性能。一个运行中的主机-设备双工链路，如果满足以下条件，就会被称为 "双工链路"。
其两条单工链路的帧错误率（FER）规格被认为符合表29的要求。
串行ATA性能水平。主机或设备通过使用BIST激活FIS或其他供应商对被测设备的独特命令来生成各种测试模式。
### 7.2 电气规格 
本规范的目标是提供特性描述，以确保SATA组件、设备、主机和互连的互操作性。符合要求的组件的任何组合都应该提供所述的链路性能。其次，第7.4节中描述了对要求的验证方法。验证包括对单个SATA组件进行测试。
串行 ATA 设备和主机应符合表 29 中所示的电气规格。
表30、表31、表32、表33和表34。发射器由驱动集成电路(IC)、印刷电路板和配接的连接器对组成。接收器由接收器IC、印刷电路板和配接的连接器组成。
除非另有说明，所有规格都包括配接的连接器对。

##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 19 
##### 3 o f^6
##### 63 
#### 7.2.1 物理层需求表 
## 表29 - 一般规格...............................................................................................。

需要测量的区域：1、"T
##### E le c tr ic a lS p e ci fi c io n.
##### P a ra m e te rs
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D et a il
##### C ro s s-
##### Rf
##### S ec ti o n
##### M e as u re m e n t
##### C ro s s-
##### Rf
##### S ec ti o n
##### C ha n el
##### S p ee d
##### G b ps
##### N o m
##### 1.

##### 5 
##### 3 
##### .^0 
##### 6.

##### 0 
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^1 
##### - 
##### F b au d
##### G 
##### H z
##### N o m
##### 1.

##### 5 
##### 3 
##### .^0 
##### 6.

##### 0 
##### - 
##### - 
##### F 
##### E 
##### R 
##### , 
##### F ra m e
##### E rr o r
##### R at e
##### Max
##### 8.
 2 e
##### -^8 at
##### 95 
##### % co n fid e nc e le ve l.
##### 8 
##### .^2 e-
##### 8 a t^9
##### 5 % cof id e nc e le ve l
##### 8.
 2 e
##### -^8 at
##### 95 
##### % co n fid e nc e le ve l.
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^2 
##### 7.

##### 4 
##### .^1 
##### M in
##### 66 
##### 6.

##### 4 
##### 33 
##### 3 
##### 3 
##### 33 
##### .^2 
##### 1 
##### 6 
##### 7 
##### 16 
##### 6.

##### 6 
##### 08 
##### 3 
##### N o m
##### 66 
##### 6.

##### 6 
##### 66 
##### 7 
##### 3 
##### 33 
##### .^3 
##### 3 
##### 3 
##### 3 
##### 16 
##### 6.

##### 6 
##### 66 
##### 7 
##### T 
UI ,
##### U ni t
In te rv al p s
##### Max
##### 67 
##### 0.

##### 2 
##### 33 
##### 3 
##### 3 
##### 35 
##### .^1 
##### 1 
##### 6 
##### 7 
##### 16 
##### 7.

##### 5 
##### 58 
##### 3 
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 4 
##### M in
##### -^3 
##### 50 
##### -^3 
##### 5 
##### 0 
##### -^3 
##### 50 fto,l
##### T 
##### X 
##### F re q ue nc y
Log
##### T er m
##### A cc u racy pp m of
##### F b au d
##### Max
##### + 
##### 3 
##### 50 
##### + 
##### 35 
##### 0 
##### + 
##### 3 
##### 50 
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^4 
##### 7.

##### 4 
##### .^7 
##### M in
##### 3 
##### 0 
##### 30 
##### 3 
##### 0 fS
SC
##### , 
##### S pr ea d-
##### S p ec tr u m
##### M od u la tio n
##### F re q ue n cyh z
##### Max
##### 3 
##### 3 
##### 33 
##### 3 
##### 3 
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^5 
##### 7.

##### 3 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 4 
##### M in
##### -^5 
##### 35 
##### 0 
##### -^5 
##### 3 
##### 50 
##### -^5 
##### 35 
##### 0 
##### S 
##### S 
##### C to ,l
##### S pr ea d-
##### S p ec tr u m
##### M od u la tio n
##### D e vi a tio n pp m of.
##### F b au d
##### Max
##### + 
##### 3 
##### 50 
##### + 
##### 35 
##### 0 
##### + 
##### 3 
##### 50 
##### 7.

##### 2.

##### 2 
##### .^1 
##### .^6 
##### 7.

##### 3 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 4  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 19 
##### 4 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P a ra m e te rs
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D et ai l
##### C ro s s-
##### R e f
##### S ec ti o n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 20 
##### 0 
##### - 
##### (A 
##### C o n ly
##### ) 
##### (A 
##### C on ly
##### ) 
##### N o m
##### 25 
##### 0 
##### - 
##### (A 
##### C o n ly
##### ) 
##### (A 
##### C on ly
##### ) 
##### V cm ,dc
##### , 
##### D 
##### C 
##### C o up le d
##### C om m o n
##### M o d e
##### V ol ta ge m
##### V 
##### Max
##### 45 
##### 0 
##### - 
##### (A 
##### C o n ly
##### ) 
##### (A 
##### C on ly
##### ) 
##### 7.

##### 2 
##### .^2 
##### .^1 
##### .^7 
##### 7 
##### .^4 
##### .^5 
##### M in
##### 0 
##### - 
##### - 
##### - 
##### V cm,ac co up led
##### , 
##### A 
##### C 
##### C ou p le d
##### C om m o n
##### M o d e
##### V ol ta ge m
##### V 
##### Max
##### 2 
##### 00 
##### 0 
##### - 
##### - 
##### - 
##### 7.

##### 2 
##### .^2 
##### .^1 
##### .^8 
##### 7 
##### .^4 
##### .^2 
##### 9 
##### Z dif ,f
N om in al
##### D iff e re nt ia l
Im pe da nc e
##### O h m
##### N o m
##### 10 
##### 0 
##### - 
##### - 
##### 1 
##### 00 
##### 7.

##### 2 
##### .^2 
##### .^1 
##### .^9 
##### 7 
##### .^4 
##### .^2 
##### 6 
##### C ac co up lin g
##### A 
##### C 
##### C ou pl in g
##### C a pa ci ta nc e nF
##### M a x
##### 12 
##### 12 
##### 1 
##### 2 
##### 7.

##### 2 
##### .^2 
##### .^1 
##### .^1 
##### 0 
##### 7 
##### .^4 
##### .^1 
##### 7 ts et tle ,c ,m
##### C om m o n
##### M o d e
##### T ra n si en tS e tl e
##### Tim e n s
##### Max
##### 10 
##### - 
##### - 
##### - 
##### 7.

##### 2 
##### .^2 
##### .^2 
##### .^1 
##### 3 
##### 7.

##### 2 
##### .^5 
##### .^3 
##### M in
##### -^2 
##### .^0 
##### -^2 
##### .^0 
##### -^2 
##### .^0 
##### V tra ns
##### , 
##### S e qu en ci n g

##### T ra n si en t
##### Vol ta ge
##### V 
##### Max
##### 2.

##### 0 
##### 2 
##### .^0 
##### 2.

##### 0 
##### 7.

##### 2 
##### .^2 
##### .^1 
##### .^1 
##### 1 
##### 7 
##### .^4 
##### .^1 
##### 6  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 19 
##### 5 o f^6
##### 63 
## 表30-发射机规格 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m et er s
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### - 
##### - 
##### -^1 
##### .^2 
##### V tra ns
##### , 
##### S eq ue n ci ng
##### T ra ns ie n t
##### V o lta g e
##### L 
##### L 
##### V 
##### M a x
##### - 
##### - 
##### 1 
##### .^2 
##### 7 
##### .^2 
##### .^2 
##### .^1 
##### .^1 
##### 2 
##### 7 
##### .^4 
##### .^3 
##### 0 
##### M in
##### 85 
##### 8 
##### 5 
##### - 
##### 8 
##### 5 
##### - 
##### Z dif fTX
##### , 
##### T 
##### X 
##### P a ir
##### D iff er en tia l
Im p ed an ce
##### O hm
##### M a x
##### 11 
##### 5 
##### 11 
##### 5 
##### - 
##### 11 
##### 5 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 7 
##### .^4 
##### .^2 
##### 6 
##### Z s-e
TX
##### , 
##### T 
##### X 
##### S in gl e
##### - E n de d
Im p ed an ce
##### O hm
##### M in
##### 40 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^2 
##### 7 
##### .^4 
##### .^2 
##### 7  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 19 
##### 6 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m et er s
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 75 
##### M 
##### H z-
##### 15 
##### 0 
##### M 
##### H z
##### 14 
##### 14 
##### - 
##### - 
##### - 
##### - 
##### - 
##### 15 
##### 0 
##### M 
##### H z-
##### 30 
##### 0 
##### M 
##### H z
##### 8 
##### 8 
##### - 
##### 1 
##### 4 
##### 1 
##### 4 
##### - 
##### - 
##### 30 
##### 0 
##### M 
##### H z-
##### 60 
##### 0 
##### M 
##### H z
##### 6 
##### 6 
##### - 
##### 8 
##### 8 
##### - 
##### - 
##### 60 
##### 0 
##### M 
##### H z-
##### 1 
##### .^2 
##### G 
##### H z
##### 6 
##### 6 
##### - 
##### 6 
##### 6 
##### - 
##### - 
##### 1.

##### 2 
##### G 
##### H z-
##### 2 
##### .^4 
##### G 
##### H z
##### 3 
##### 3 
##### - 
##### 6 
##### 6 
##### - 
##### - 
##### 2.

##### 4 
##### G 
##### H z-
##### 3 
##### .^0 
##### G 
##### H z
##### 1 
##### - 
##### - 
##### 3 
##### 3 
##### - 
##### - 
##### R 
##### 
D^1 1 ,
TX
##### , 
##### T 
##### X 
##### D iff er en tia l
##### M od e
##### R et u rn
Lo ss
##### (A ll
##### V a lu es
##### M in
##### ) dB
##### 3.

##### 0 
##### G 
##### H z-
##### 5 
##### .^0 
##### G 
##### H z
##### - 
##### - 
##### - 
##### 1 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 3 
##### R 
##### 
D^1 1 ,
TX
##### , 
##### T 
##### X 
##### D iff er en tia l
##### M od e
##### R et u rn
Lo ss
##### S ta rt fo r sl op e dB
##### M in at 30
##### 0 
##### M 
##### H z
##### - 
##### - 
##### - 
##### - 
##### 14 
##### S lo pe of
##### T 
##### X 
##### D iff er en tia lMod e
##### R et u rn
##### Los s d
##### B /d ec
##### N o m
##### - 
##### - 
##### - 
##### - 
##### -^1 
##### 3 
##### T 
##### X 
##### D iff er en tia l
##### M od e
##### R et u rn
##### L os s
##### M a x
##### F re qu e nc y
##### G 
##### H z
##### M a x
##### - 
##### - 
##### - 
##### - 
##### 3 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^6 
##### 7 
##### .^4 
##### .^1 
##### 3  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 19 
##### 7 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m et er s
##### U n it s
##### L im it
Gen1i

Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 15 
##### 0 
##### M 
##### H z-
##### 30 
##### 0 
##### M 
##### H z
##### - 
##### 8 
##### 5 
##### - 
##### - 
##### 30 
##### 0 
##### M 
##### H z-
##### 60 
##### 0 
##### M 
##### H z
##### - 
##### 5 
##### 5 
##### - 
##### - 
##### 60 
##### 0 
##### M 
##### H z-
##### 1 
##### .^2 
##### G 
##### H z
##### - 
##### 2 
##### 2 
##### - 
##### - 
##### 1.

##### 2 
##### G 
##### H z-
##### 2 
##### .^4 
##### G 
##### H z
##### - 
##### 1 
##### 1 
##### - 
##### - 
##### 2.

##### 4 
##### G 
##### H z-
##### 3 
##### .^0 
##### G 
##### H z
##### - 
##### 1 
##### 1 
##### - 
##### - 
##### R 
##### LC 
C^1 1 ,
TX
##### , 
##### T 
##### X 
##### C o m on
##### M od e
##### R et u rn
洛氏（全
##### V al ue s
##### M in
##### ) dB
##### 3.

##### 0 
##### G 
##### H z-
##### 5 
##### .^0 
##### G 
##### H z
##### - 
##### 1 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^4 
##### 7 
##### .^4 
##### .^1 
##### 3 
##### 15 
##### 0 
##### M 
##### H z-
##### 30 
##### 0 
##### M 
##### H z
##### - 
##### 3 
##### 0 
##### 3 
##### 0 
##### - 
##### 30 
##### 30 
##### 0 
##### M 
##### H z-
##### 60 
##### 0 
##### M 
##### H z
##### - 
##### 2 
##### 0 
##### 2 
##### 0 
##### - 
##### 30 
##### 60 
##### 0 
##### M 
##### H z-
##### 1 
##### .^2 
##### G 
##### H z
##### - 
##### 1 
##### 0 
##### 1 
##### 0 
##### - 
##### 20 
##### 1.

##### 2 
##### G 
##### H z-
##### 2 
##### .^4 
##### G 
##### H z
##### - 
##### 1 
##### 0 
##### 1 
##### 0 
##### - 
##### 10 
##### 2.

##### 4 
##### G 
##### H z-
##### 3 
##### .^0 
##### G 
##### H z
##### - 
##### 4 
##### 4 
##### - 
##### 10 
##### 3.

##### 0 
##### G 
##### H z-
##### 5 
##### .^0 
##### G 
##### H z
##### - 
##### 4 
##### - 
##### - 
##### 4 
##### R 
##### 
C^1 1 ,
TX
##### , 
##### T 
##### X 
Im pe da nc e
##### B a la n ce (all va lu e s)
##### M in
##### ) dB
##### 5.

##### 0 
##### G 
##### H z-
##### 6 
##### .^5 
##### G 
##### H z
##### - 
##### - 
##### - 
##### - 
##### 4 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^5 
##### 7 
##### .^4 
##### .^1 
##### 3  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 19 
##### 8 o f^6
##### 63 
## 表31 -- -- 发射信号要求 
##### E le c tr ic a lS p e ci fi c io n.
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 4 
##### 00 
##### 4 
##### 00 
##### 40 
##### 0 
##### 4 
##### 00 
##### 4 
##### 00 
##### 40 
##### 0 
##### - 
##### 7.

##### 4 
##### .^5 
##### M in
##### - 
##### - 
##### - 
##### - 
##### - 
##### - 
##### 2 
##### 40 
##### 7.

##### 4 
##### .^3 
##### N om
##### 50 
##### 0 
##### - 
##### - 
##### - 
##### Max
##### 60 
##### 0 
##### 1 
##### 60 
##### 0 
##### 7 
##### 00 
##### 1 
##### 60 
##### 0 
##### - 
##### 7.

##### 4 
##### .^5 
##### V dif fT
##### ,X 
##### T 
##### X 
##### D iff er en tia l
##### O u tp u tV o lta g e m。
##### V p pd
##### Max
##### - 
##### - 
##### - 
##### - 
##### 9 
##### 00 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^7 
##### 7.

##### 4 
##### .^3 
##### 0 
##### .^4 
##### 5 - 
##### 0.

##### 5 
##### 5 
##### 0 
##### .^5 
##### 0 
##### .^4 
##### 5 
##### -^0 
##### .^5 
##### 5 
##### 0 
##### .^5 
##### - 
##### 7.

##### 4 
##### .^5 
##### U 
##### m inT
##### ,X 
##### T 
##### X 
##### M in im um
##### Vol ta ge
##### Mea su re m en t
In te rv al
##### U 
##### I 
##### - 
##### - 
##### - 
##### - 
##### 0 
##### .^5 
##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^8 
##### 7.

##### 4 
##### .^3 
##### .^2 
##### M in 20
##### - 
##### 8 
##### 0 % 
##### 1 
##### 00 
##### (.

##### 15 
##### )  (^67) (.^1 
##### 0 
##### ) 
##### 67 
##### (.

##### 20 
##### ) 
##### 33 
##### (^0 
##### .^2 
##### 0 )  t^2 0 - 80
TX
##### , 
##### T 
##### X 
##### R is e
##### /F a ll
##### Tim e p s（U
##### I) 
##### M ax 20
##### - 
##### 8 
##### 0 % 
##### 2 
##### 73 
##### (.

##### 41 
##### ) 
##### 27 
##### 3 
##### (.

##### 41 
##### ) 
##### 1 
##### 36 
##### (.

##### 4 
##### 1 
##### ) 
##### 68 
##### (^0 
##### .^4 
##### 1 ) 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^9 
##### 7.

##### 4 
##### .^4 ts ke wT
##### ,X 
##### T 
##### X 
##### D iff er en tia l
##### S ke w p s
##### Max
##### 20 
##### 20 
##### 15 
##### 2 
##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 0 
##### 7 
##### .^4 
##### .^1 
##### 5 
##### V cm ,ac
TX
##### , 
##### T 
##### X 

##### A 
##### C 
##### C om m o n
##### M o de
##### V o lta ge m
##### V p
- p 
##### Max
##### - 
##### 50 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 1 
##### 7 
##### .^4 
##### .^2 
##### 0  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 19 
##### 9 o f^6
##### 63 
##### E le ct ri c al
##### S p ec if ic a ti o n
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro s s-
##### Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 3 
##### G 
##### H z
斧头
##### - 
##### - 
##### - 
##### - 
##### 2 
##### 6 
##### V cm ,ac
TX
##### , 
##### T 
##### X 
##### A 
##### C 
##### C om m o n
##### M o de
##### V o lta ge d
##### B m
##### V (r m s)
##### 6 
##### G 
##### H z
斧头
##### - 
##### - 
##### - 
##### - 
##### 3 
##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 2 
##### 7 
##### .^4 
##### .^2 
##### 1 
##### D 
Vd iffO
O
##### ,B 
##### O 
##### O 
##### B 
##### D iff er e n tia l
##### D e lta m
##### V 
##### Max
##### - 
##### 2 
##### 5 
##### 25 
##### 2 
##### 5 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 4 
##### 7 
##### .^4 
##### .^2 
##### 3 
##### D 
Vc mO
OB
##### , 
##### O 
##### O 
##### B 
##### C o m on
##### M od e
##### D e lta m
##### V 
##### Max
##### - 
##### 5 
##### 0 
##### 50 
##### 5 
##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 5 
##### 7 
##### .^4 
##### .^2 
##### 2 
##### R 
##### /F ba ,l
##### T 
##### X 
##### R is e/
##### F a ll
Im b al a nc e
##### % 
##### Max
##### - 
##### - 
##### 20 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 6 
##### 7 
##### .^4 
##### .^1 
##### 9 
##### A m pb ,al
##### T 
##### X 
##### A m pl itu de
Im b al a nc e
##### % 
##### Max
##### - 
##### 1 
##### 0 
##### 10 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 7 
##### 7 
##### .^4 
##### .^1 
##### 8 
##### T 
##### J at
##### C o n ec to r,
##### C lk
##### - D a ta
##### ，fB
非盟
##### /D 
##### 5 
##### 00 
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### 0.

##### 3 
##### 7 
##### - 
##### 0.

##### 3 
##### 7 
##### - 
##### - 
##### D 
##### J a tC on ne ct or
##### , 
##### C lk
##### - D a ta
##### ，fB
非盟
##### /D 
##### 5 
##### 00 
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### 0.

##### 1 
##### 9 
##### - 
##### 0.

##### 1 
##### 9 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 8 
##### 7.

##### 3 
##### 7.

##### 4 
##### .^8 
##### 7.

##### 4 
##### .^9 
##### M in
##### 1 
##### .^1 
##### - 
##### 1.

##### 1 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
##### N o m
##### 2 
##### .^1 
##### - 
##### 2.

##### 1 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F un ct io n
##### B and w id th
##### (D 
##### 2 
##### 4.

##### 3 ,hig h pa ss
##### -^3 dB
##### ) 
##### M 
##### H z
##### Max
##### 3 
##### .^1 
##### - 
##### 3.

##### 1 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 20 
##### 0 o f^6
##### 63 
##### E le ct ri c al
##### S p ec if ic a ti o n
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro s s-
##### Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 0 
##### - 
##### 0 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
##### N o m
##### 0 
##### - 
##### 0 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### P e a k in g d
##### B 
##### Max
##### 3 
##### .^5 
##### - 
##### 3.

##### 5 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
##### M in
##### 69 
##### - 
##### 6 
##### 9 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
##### N o m
##### 72 
##### - 
##### 7 
##### 2 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### L ow
##### F re q ue nc y

##### A tt en ua tio n d.
##### B 
##### Max
##### 75 
##### - 
##### 7 
##### 5 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### L ow
##### F re q ue nc y
##### A tt en ua tio n
##### Mea su re m en t
##### F re q ue nc y kH z
##### 30 
##### ±^1 
##### % 
##### - 
##### 3 
##### 0 ± 
##### 1 % 
##### - 
##### - 
##### 7.

##### 3.

##### 2 
##### 7 
##### .^4 
##### .^8 
##### M in
##### - 
##### - 
##### - 
##### - 
##### 2.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
##### N o m
##### - 
##### - 
##### - 
##### - 
##### 4.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F un ct io n
##### B and w id th
##### (D 
##### 2 
##### 4.

##### 3 ,hig h pa ss
##### -^3 dB
##### ) 
##### (G e n^3
##### ) 
##### M 
##### H z
##### Max
##### - 
##### - 
##### - 
##### - 
##### 6.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
##### M in
##### - 
##### - 
##### - 
##### - 
##### 0 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
##### N o m
##### - 
##### - 
##### - 
##### - 
##### 0 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### P e a k in g
##### (G e n^3
##### ) d
##### B 
##### Max
##### - 
##### - 
##### - 
##### - 
##### 3.

##### 5 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 20 
##### 1 o f^6
##### 63 
##### E le ct ri c al
##### S p ec if ic a ti o n
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro s s-
##### Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### - 
##### - 
##### - 
##### - 
##### 3 
##### 5.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
##### N o m
##### - 
##### - 
##### - 
##### - 
##### 3 
##### 8.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### L ow
##### F re q ue nc y
##### A tt en ua tio n
##### (G e n^3
##### ) d
##### B 
##### Max
##### - 
##### - 
##### - 
##### - 
##### 4 
##### 1.

##### 2 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
Ji tt er
##### T ra n sf er
##### F u nc tio n
##### L ow
##### F re q ue nc y
##### A tt en ua tio n
##### Mea su re m en t
##### F re q ue nc y
##### (G e n^3
##### ) kH z
##### - 
##### - 
##### - 
##### - 
##### 4 
##### 20 
##### + 
##### /- 
##### 1 
##### % 
##### 7 
##### .^3 
##### .^2 
##### .^4 
##### 7.

##### 4 
##### .^8 
##### T 
##### J a fte r
##### C 
##### IC 
##### , 
##### C lk
##### - 
##### D at a ,f
文学士
UD
##### /^1 
##### 6 
##### 6 
##### 7 
##### U 
##### I 
##### Max
##### - 
##### 0.

##### 55 
##### - 
##### 0.

##### 5 
##### 5 
##### - 
##### D 
##### Jaf te r
##### C 
##### IC 
##### ，C lk
##### - 
##### D at a ,f
文学士
UD
##### /^1 
##### 6 
##### 6 
##### 7 
##### U 
##### I 
##### Max
##### - 
##### 0.

##### 35 
##### - 
##### 0.

##### 3 
##### 5 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 8 
##### 7.

##### 3 
##### 7.

##### 4 
##### .^8 
##### 7.

##### 4 
##### .^9 
##### T 
##### J b ef o re a and af te r.
##### C 
##### IC 
##### , 
##### C lk
##### - D at a
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### - 
##### - 
##### R 
##### J p- p m e as
##### .

##### + 
##### 0 
##### .^3 
##### 4 
##### R 
##### J be fo re
##### C 
##### IC 
##### , 
##### M 
##### F 
##### T 
##### P 
##### C lk
##### - D at a
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### - 
##### - 
##### 0 
##### .^1 
##### 8 p- p
##### (^2 
##### .^1 
##### 4 p s
##### 1 si gm a)
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^1 
##### 8 
##### 7.

##### 3 
##### 7.

##### 4 
##### .^8 
##### 7 
##### .^4 
##### .^1 
##### 0  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 20 
##### 2 o f^6
##### 63 
## 表32 - 接收器规格 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m e te r
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f

##### S e ct io n
##### M ea su re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 8 
##### 5 
##### - 
##### 8 
##### 5 
##### - 
##### Z dif fR
##### ,X 
##### R 
##### X 
##### P a ir
##### D iff er e nt ia l
Im pe da nc e
##### O h m
##### Max
##### 11 
##### 5 
##### - 
##### 11 
##### 5 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^3 
##### .^1 
##### 7 
##### .^4 
##### .^2 
##### 6 
##### Z s-e
RX
##### , 
##### R 
##### X 
##### S in gl e
##### - 
##### End ed
Im pe da nc e
##### O h m
##### M in
##### 4 
##### 0 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^3 
##### .^2 
##### 7 
##### .^4 
##### .^2 
##### 7  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 20 
##### 3 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m e te r
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M ea su re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 75 
##### M 
##### H z-
##### 15 
##### 0 M 
##### H z
##### 18 
##### 1 
##### 8 
##### - 
##### - 
##### - 
##### - 
##### - 
##### 1 
##### 50 
##### M 
##### H z-
##### 3 
##### 00 
##### M 
##### H z
##### 14 
##### 1 
##### 4 
##### - 
##### 18 
##### 1 
##### 8 
##### - 
##### - 
##### 3 
##### 00 
##### M 
##### H z-
##### 6 
##### 00 
##### M 
##### H z
##### 10 
##### 1 
##### 0 
##### - 
##### 14 
##### 1 
##### 4 
##### - 
##### - 
##### 6 
##### 00 
##### M 
##### H z-
##### 1.

##### 2 
##### G 
##### H z
##### 8 
##### 8 
##### - 
##### 10 
##### 1 
##### 0 
##### - 
##### - 
##### 1 
##### .^2 
##### G 
##### H z-
##### 2.

##### 4 
##### G 
##### H z
##### 3 
##### 3 
##### - 
##### 8 
##### 8 
##### - 
##### - 
##### 2 
##### .^4 
##### G 
##### H z-
##### 3.

##### 0 
##### G 
##### H z
##### 1 
##### - 
##### - 
##### 3 
##### 3 
##### - 
##### - 
##### R 
##### L 
DD 11,R
##### ,X 
##### R 
##### X 
##### D iff er en tia l
##### M od e
##### R e tu rn
Lo ss (all va lu e s)
##### M in
##### ) d
##### B 
##### 3 
##### .^0 
##### G 
##### H z-
##### 5.

##### 0 
##### G 
##### H z
##### - 
##### - 
##### - 
##### 1 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^3 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 3 
##### R 
##### L 
DD 11,R
##### ,X 
##### R 
##### X 
##### D iff er en tia l
##### M od e
##### R e tu rn
Lo ss d
##### B 
##### M in a t
##### 30 
##### 0 M 
##### H z
##### - 
##### - 
##### 1 
##### 8 
##### S lo p e o fR
##### X 
##### D iff er e nt ia l
##### M od e
##### R e tu rn
低频dB/d e c
##### N om
##### - 
##### - 
##### -^1 
##### 3 
##### R 
##### X 
##### D iff er en tia l
##### M od e
##### R e tu rn
Lo ss
##### M a x
##### F re qu en cy
##### G 
##### H z
##### Max
##### - 
##### - 
##### 6.

##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^2 
##### .^6 
##### 7 
##### .^4 
##### .^1 
##### 3  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 20 
##### 4 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m e te r
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M ea su re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 1 
##### 50 
##### M 
##### H z-
##### 3 
##### 00 
##### M 
##### H z
##### - 
##### 5 
##### 5 
##### - 
##### - 
##### 3 
##### 00 
##### M 
##### H z-
##### 6 
##### 00 
##### M 
##### H z
##### - 
##### 5 
##### 5 
##### - 
##### - 
##### 6 
##### 00 
##### M 
##### H z-
##### 1.

##### 2 
##### G 
##### H z
##### - 
##### 2 
##### 2 
##### - 
##### - 
##### 1 
##### .^2 
##### G 
##### H z-
##### 2.

##### 4 
##### G 
##### H z
##### - 
##### 1 
##### 1 
##### - 
##### - 
##### 2 
##### .^4 
##### G 
##### H z-
##### 3.

##### 0 
##### G 
##### H z
##### - 
##### 1 
##### 1 
##### - 
##### - 
##### R 
##### L 
CC 11,R
##### ,X 
##### R 
##### X 
##### C om m on
##### M od e
##### R e tu rn
Lo ss (all va lu e s)
##### M in
##### ) d
##### B 
##### 3 
##### .^0 
##### G 
##### H z-
##### 5.

##### 0 
##### G 
##### H z
##### - 
##### 1 
##### - 
##### - 
##### - 
##### 7 
##### .^2 
##### .^2 
##### .^3 
##### .^4 
##### 7 
##### .^4 
##### .^1 
##### 3  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 

##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 20 
##### 5 o f^6
##### 63 
##### E le c tr ic a lS p e ci fi c io n.
##### P ar a m e te r
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - R e f
##### S e ct io n
##### M ea su re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### 1 
##### 50 
##### M 
##### H z-
##### 3 
##### 00 
##### M 
##### H z
##### - 
##### 30 
##### 3 
##### 0 
##### - 
##### 3 
##### 0 
##### 3 
##### 00 
##### M 
##### H z-
##### 6 
##### 00 
##### M 
##### H z
##### - 
##### 30 
##### 3 
##### 0 
##### - 
##### 3 
##### 0 
##### 6 
##### 00 
##### M 
##### H z-
##### 1.

##### 2 
##### G 
##### H z
##### - 
##### 20 
##### 2 
##### 0 
##### - 
##### 2 
##### 0 
##### 1 
##### .^2 
##### G 
##### H z-
##### 2.

##### 4 
##### G 
##### H z
##### - 
##### 10 
##### 1 
##### 0 
##### - 
##### 1 
##### 0 
##### 2 
##### .^4 
##### G 
##### H z-
##### 3.

##### 0 
##### G 
##### H z
##### - 
##### 4 
##### 4 
##### - 
##### 1 
##### 0 
##### 3 
##### .^0 
##### G 
##### H z-
##### 5.

##### 0 
##### G 
##### H z
##### - 
##### 4 
##### - 
##### - 
##### 4 
##### R 
##### L 
DC 11,R
##### ,X 
##### R 
##### X 
Im p ed an ce
##### B al an ce (all va lu e s)
##### M in
##### ) d
##### B 
##### 5 
##### .^0 
##### G 
##### H z-
##### 6.

##### 5 
##### G 
##### H z
##### - 
##### 4 
##### - 
##### - 
##### 4 
##### 7 
##### .^2 
##### .^2 
##### .^3 
##### .^5 
##### 7 
##### .^4 
##### .^1 
##### 3  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 20 
##### 6 o f^6
##### 63 
## 表33--实验室信号（用于接收机公差测试）。
##### E le c tr ic al
##### S p ec if ic a ti o n
##### P ar a m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D et ai l
##### C ro ss
##### - R e f
##### S ec ti o n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 3 
##### 25 
##### 2 
##### 40 
##### 2 
##### 75 
##### 2 
##### 75 
##### 24 
##### 0 
##### 27 
##### 5 
##### - 
##### 7 
##### .^4 
##### .^6 
##### M in
##### - 
##### - 
##### - 
##### - 
##### - 
##### - 
##### 2 
##### 40 
##### 7 
##### .^4 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 2 
##### N o m
##### 4 
##### 00 
##### - 
##### - 
##### - 
##### - 
##### - 
##### Max
##### 6 
##### 00 
##### 1 
##### 60 
##### 0 
##### 7 
##### 50 
##### 75 
##### 0 
##### 16 
##### 00 
##### - 
##### 7 
##### .^4 
##### .^6 
##### V dif fR
##### ,X 
##### R 
##### X 
##### D iff e re nt ia l
In pu tV ol ta g e m
##### V pp d
##### Max
##### - 
##### - 
##### - 
##### - 
##### - 
##### 10 
##### 00 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^1 
##### 7 
##### .^4 
##### .^3 
##### 7 
##### .^4 
##### .^1 
##### 2 
##### 1 
##### 00 
##### (.

##### 15 
##### )  (^67) (.^1 
##### 0 ) 
##### 6 
##### 7 
##### (.

##### 2 
##### 0 ) 
##### - 
##### 7 
##### .^4 
##### .^4 
##### M in 20
##### -^8 
##### 0 % 
##### - 
##### - 
##### - 
##### 6 
##### 2 
##### (^0 
##### .^3 
##### 7 ) 
##### 7 
##### .^4 
##### .^4 
##### 7 
##### .^4 
##### .^1 
##### 2 
##### 27 
##### 3 
##### (.

##### 4 
##### 1 ) 
##### 1 
##### 36 
##### (.

##### 4 
##### 1 
##### ) 
##### - 
##### 7 
##### .^4 
##### .^4 t^2 0 - 80
RX
##### , 
##### R 
##### X 
##### R is e
##### /F a ll
##### Tim e p s（U
##### I) 
##### M ax 20
##### -^8 
##### 0 % 
##### - 
##### - 
##### 7 
##### 5 
##### (^0 
##### .^4 
##### 5 ) 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^2 
##### 7 
##### .^4 
##### .^4 
##### 7 
##### .^4 
##### .^1 
##### 2 
##### - 
##### 0.

##### 5 
##### 0 
##### .^5 
##### - 
##### 7 
##### .^4 
##### .^6 
##### U 
##### mi nR
##### ,X 
##### R 
##### X 
##### M in im u m
##### V o lta g e
##### M e as u re m e nt
In te rv a l
##### U 
##### I 
##### - 
##### - 
##### - 
##### 0.

##### 5 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^3 
##### 7.

##### 4 
##### .^3 
##### .^2 ts ke wR
##### ,X 
##### R 
##### X 
##### D iff e re nt ia l
##### S ke w p s
##### Max
##### - 
##### 80 
##### 5 
##### 0 
##### 7 
##### 5 
##### 3 
##### 0 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^4 
##### 7 
##### .^4 
##### .^1 
##### 5 
##### V cm ,ac
RX
##### , 
##### R 
##### X 
##### A 
##### C 
##### C o m on
##### M o de
##### V o lta g e m
##### V p- p
##### Max
##### 1 
##### 00 
##### 1 
##### 50 
##### 1 
##### 00 
##### 15 
##### 0 
##### 1 
##### 00 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^5 
##### 7 
##### .^4 
##### .^1 
##### 1  
##### H 
##### IG 
##### H 
##### S 
##### P 

##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 20 
##### 7 o f^6
##### 63 
##### E le c tr ic al
##### S p ec if ic a ti o n
##### P ar a m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D et ai l
##### C ro ss
##### - R e f
##### S ec ti o n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 2 
##### 2 
##### 2个FC M，AC
RX
##### , 
##### A 
##### C 
##### C om m o n
##### M od e
##### F re qu e nc y
##### M 
##### H z
##### Max
##### 2 
##### 00 
##### 20 
##### 0 
##### 2 
##### 00 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^6 
##### 7 
##### .^4 
##### .^1 
##### 1  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 20 
##### 8 o f^6
##### 63 
##### E le c tr ic al
##### S p ec if ic a ti o n
##### P ar a m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D et ai l
##### C ro ss
##### - R e f
##### S ec ti o n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### T 
##### J at
##### C o n ec to r,
##### C lk
##### - D at a
##### ，fB
非盟
##### /D 
##### 5 
##### 00 
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### 0.

##### 6 
##### 0 
##### 0.

##### 6 
##### 0 
##### - 
##### - 
##### D 
##### J a tC o n ct o r,
##### C lk
##### - D at a
##### ，fB
非盟
##### /D 
##### 5 
##### 00 
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### 0.

##### 4 
##### 2 
##### 0.

##### 4 
##### 2 
##### - 
##### - 
##### T 
##### J at
##### C o n ec to r,
##### C lk
##### - D at a
##### ，fB
非盟
##### /D 
##### 1 
##### 66 
##### 7 
##### U 
##### I 
##### Max
##### - 
##### 0.

##### 6 
##### 5 
##### - 
##### 0 
##### .^6 
##### 5 
##### - 
##### D 
##### J a tC o n ct o r,
##### C lk
##### - D at a
##### ，fB
非盟
##### /D 
##### 1 
##### 66 
##### 7 
##### U 
##### I 
##### Max
##### - 
##### 0.

##### 3 
##### 5 
##### - 
##### 0 
##### .^3 
##### 5 
##### - 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^7 
##### 7 
##### .^3 
##### 7 
##### .^4 
##### .^8 
##### 7 
##### .^4 
##### .^1 
##### 1 
##### T 
##### J a fte r
##### C 
##### IC 
##### , 
##### C lk
##### - D a ta
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### - 
##### - 
##### - 
##### - 
##### 0.

##### 6 
##### 0 
##### R 
##### J be fo re
##### C 
##### IC 
##### , 
##### M 
##### F 
##### T 
##### P 
##### C lk
##### - D a ta
##### JT 
##### F 
##### Def in ed
##### U 
##### I 
##### Max
##### - 
##### - 
##### - 
##### - 
##### 0 
##### .^1 
##### 8 p- p
##### (^2 
##### .^1 
##### 4 p s
##### 1 si gm a
##### ) 
##### 7.

##### 2 
##### .^2 
##### .^5 
##### .^7 
##### 7 
##### .^3 
##### 7 
##### .^4 
##### .^8 
##### 7 
##### .^4 
##### .^1 
##### 2  
##### H 
##### IG 
##### H 
##### S 
##### P 
##### E 
##### E 
##### D 
##### S 
##### E 
##### R 
##### IA 
##### L 
##### IZ 
##### E 
##### D 
##### A 
##### T 
##### A 
##### T 
##### T 
##### A 
##### C 
##### H 
##### M 
##### E 
##### N 
##### T 
##### S eria lA
##### T 
##### A 
In te rn a tio n al
##### Org a ni za tio n
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### G o ld
##### R e vi si o n pa ge
##### 20 
##### 9 o f^6
##### 63 
## 表34 - OOB规格 
##### E le ct ri c al
##### S p ec if ic a ti o n
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M in
##### 5 
##### 0 
##### 1 
##### 2 
##### 0 
##### 7 
##### 5 
##### 12 
##### 0 
##### 7 
##### 5 
##### N om
##### 1 
##### 00 
##### - 
##### 12 
##### 5 
##### - 
##### 12 
##### 5 
##### V th es ,h
##### O 
##### O 
##### B 
##### S ig n al
##### D e te ct io n
##### T h re sh ol d m
##### V pp d
##### Max
##### 2 
##### 00 
##### 2 
##### 4 
##### 0 
##### 20 
##### 0 
##### 24 
##### 0 
##### 20 
##### 0 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^2 
##### 7 
##### .^4 
##### .^2 
##### 4 
##### M in
##### 64 
##### 6.

##### 6 
##### 7 
##### 6 
##### 46 
##### .^6 
##### 7 
##### 64 
##### 6.

##### 6 
##### 7 
##### N om
##### 66 
##### 6.

##### 6 
##### 7 
##### 6 
##### 66 
##### .^6 
##### 7 
##### 66 
##### 6.

##### 6 
##### 7 
##### U 
##### IO 
OB
##### , 
##### U 
##### ID u rin g
##### O 
##### O 
##### B 
##### S ig na lin g p s

##### Max
##### 68 
##### 6.

##### 6 
##### 7 
##### 6 
##### 86 
##### .^6 
##### 7 
##### 68 
##### 6.

##### 6 
##### 7 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^3 
##### - 
##### M in
##### 1 
##### 03 
##### .^5 
##### N om
##### 1 
##### 06 
##### .^7 
##### C 
##### O 
##### M 
##### IN 
##### IT 
##### / 
##### C 
##### O 
##### M 
##### R 
##### E 
##### S 
##### E 
##### T a and
##### C 
##### O 
##### M 
##### W 
##### A 
##### K 
##### E 
##### T ra ns m it
##### B ur st
Le ng th n s
##### Max
##### 1 
##### 09 
##### .^9 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^4 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^1 
##### 7 
##### .^4 
##### .^2 
##### 5 
##### M in
##### 3 
##### 10 
##### .^4 
##### N om
##### 3 
##### 20 
##### .^0 
##### C 
##### O 
##### M 
##### IN 
##### IT 
##### / 
##### C 
##### O 
##### M 
##### R 
##### E 
##### S 
##### E 
##### T 
##### T ra ns m it
##### G a p
Le ng th n s
##### Max
##### 3 
##### 29 
##### .^6 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^5 
##### 7 
##### .^4 
##### .^2 
##### 5 
##### M in
##### 1 
##### 03 
##### .^5 
##### N om
##### 1 
##### 06 
##### .^7 
##### C 
##### O 
##### M 
##### W 
##### A 
##### K 
##### E 
##### T ra ns m it
##### G a p
Le ng th n s
##### Max
##### 1 
##### 09 
##### .^9 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^6 
##### 7 
##### .^4 
##### .^2 
##### 5  
##### S eria lA
##### T 
##### A 
##### R ev is io n
##### 3.

##### 0 
##### Gol d
##### R e vi si o n pa ge
##### 21 
##### 0 o f^6
##### 63 
##### E le ct ri c al
##### S p ec if ic a ti o n
##### P a ra m et er
##### U n it s
##### L im it
Gen1i
Gen1m
Gen1x
Gen2i
Gen2m
Gen2x
Gen3i
##### D e ta il
##### C ro ss
##### - Rf
##### S e ct io n
##### M e as u re m e n t
##### C ro s s-
##### R e f
##### S ec ti o n
##### M a y de te ct
##### 3 
##### 5 
##### _ 
##### T 
##### < 
##### 17 
##### 5 
##### S ha ll de te ct
##### 10 
##### 1.

##### 3 
##### _ 
##### T 
##### _ 
##### 11 
##### 2 
##### C 
##### O 
##### M 
##### W 
##### A 
##### K 
##### E 
##### G a p
##### D e te ct io n
##### W in d ow s n s
##### S h al ln ot de te ct.
##### T 
##### < 
##### 3 
##### 5或
##### T 
#####  
##### 17 
##### 5 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^7 
##### 7 
##### .^4 
##### .^2 
##### 5 
##### M a y de te ct
##### 17 
##### 5 
##### _ 
##### T 
##### < 
##### 52 
##### 5 
##### S ha ll de te ct
##### 30 
##### 4 
##### _ 
##### T 
##### _ 
##### 33 
##### 6 
##### C 
##### O 
##### M 
##### IN 
##### IT 
##### / 
##### C 
##### O 
##### M 
##### R 
##### E 
##### S 
##### E 
##### T 
##### G a p
##### D e te ct io n
##### W in d ow s n s
##### S h al ln ot de te ct.
##### T 
##### < 
##### 17 
##### 5 o r
##### T 
#####  
##### 5 
##### 25 
##### 7 
##### .^2 
##### .^2 
##### .^6 
##### .^8 
##### 7 
##### .^4 
##### .^2 
##### 5  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.2.2 Phy层要求详解 **7.2.2.1 一般规格详解**。
本节包含表 29 条目的详细内容。
**7.2.2.1.1 通道速度**。
一个参考值，显示通过该通道的标称数据速率。
**7.2.2.1.2 帧错误率**。
帧错误率是指使用从低层Phy层、Link层到传输层的链中所有中间电路块来衡量链路性能。帧错误率是系统级测试，而不是符合性测试。错误检测是在帧级使用CRC（Cyclic
冗余检查）错误检测机制，并分别向上层报告。
**7.2.2.1.3 单位间隔**。
这是工作数据周期（标称值，特定架构），不包括抖动。该值包括长期频率精度和扩频时钟FM频率偏差（四舍五入到4位）。
这是参考时钟每个周期的时间间隔值。
**7.2.2.1.4 TX频率长期稳定性**。
这规定了允许的频率变化与标称值之间的差异；这不包括由于抖动、扩频时钟或时钟源的相位噪声引起的频率变化。
**7.2.2.1.5 扩频调制频率**。
扩频频谱调制的调制频率。更多详情请见
扩频在7.3.3节。
**7.2.2.1.6 扩频调制偏差**。
这就是表27中标称Fbaud值的允许频率变化，当 Spread
采用频谱时钟（SSC）。这个偏差包括发射机时钟源的长期频率变化，以及发射机输出的SSC频率调制。频率变化限制使用7.4.11节中描述的SSC曲线测量。更多关于扩频的细节请参见7.3.3节。
**7.2.2.1.7 直流耦合共模电压 (Gen1i)**。

共模直流电平被定义为[(TX+)+(TX-)]/2和[(RX+)+(RX-)]/2，在配接的连接器处测量。
此要求仅适用于Gen1i直流耦合设计（无阻断电容），在连接器上保持共模直流电平。下图115所示的四种可能的共模偏置配置表明，只有DC耦合设计需要维持指定的共模电平以确保互操作性。交流耦合设计可能允许连接器上的直流电平浮动。定义为Gen1x、Gen2i的SATA接口。
Gen2x和Gen3i应是交流耦合的，本要求不适用于这些。

直流耦合接收器应将其输入的共模电平微弱地保持在表29中规定的Vcm,dc值。直流耦合发射机应以表29中规定的Vcm,dc值进行传输。
表29，而驱动成100欧姆的差分阻抗。
50 50
不适用
不适用 50 50
不适用
不适用
交流对交流耦合 50 50 >10k 250 mV 50 50
不适用
不适用
交流到直流耦合 50 50
不适用 250 mV 50 50
不适用
不适用
直流至交流耦合 50 50
不适用 250 mV 50 50 >10k 250 mV
直流对直流耦合
注：对于N/A，请参见7.4.16和7.4.30。
## 图115 - Gen1i的共模偏置示例（信息）....................................。
 
##### 在附件处进行高速 SERIALIZED。
#### 串行ATA国际组织 **7.2.2.1.8 交流耦合共模电压**。
如图115所示，定义为Gen1i的SATA接口可以是交流或直流耦合的。图115所示。
定义为Gen1x、Gen2i、Gen2x和Gen3i的SATA接口应是AC耦合的。
图116显示了一个完全交流耦合系统的例子。
在连接器上定义了SATA的合规点。表29中的交流耦合共模电压定义了交流耦合Phy中耦合电容IC侧的每个单端信号的开路直流电压水平，在Phy的所有可能的电源和电气条件下，包括断电和电源斜坡，它都应满足。由于Gen1x．
Gen2i、Gen2x和Gen3i规格只定义了在连接器处可观察到的信号特性，该值不适用于这些规格。表29中定义的共模瞬态要求被确定为足以限制瞬态条件下附加元件的应力，这是交流、耦合共模电压要求的唯一意图。因此，即使对于适用Vcm,ac耦合的Gen1i，以下情况也是真实的。只要满足表29的瞬态电压要求，可以使用规定范围外的交流耦合共模电压水平。
50 50
不适用
不适用 50 50
不适用
不适用
AC至AC耦合
注：对于N/A，请参见7.4.16和7.4.30。
## 图116 - Gen1x、Gen2i、Gen2x和Gen3i的共模偏置 **7.2.2.1.9 标称差分阻抗（Gen1i）**。
SATA系统中所有元件的标称阻抗。
**7.2.2.1.10 交流耦合电容**。
交流耦合实现中使用的耦合电容器的值。交流耦合对于Gen1i来说是可选的，而对于Gen1x、Gen2i、Gen2x和Gen3i来说是必须的。
耦合电容器特性（参考）：电容器的物理尺寸应尽可能小，以减少对地电容。应避免使用大于0603的体型（或小于300 pF的值），因为它们很可能导致不符合7.2.2.2.3和7.2.2.3.3中的回损要求。
电容器的物理尺寸应尽可能小，以减小对地电容。应避免采用大于0603的本体尺寸，因为它们很可能导致表30和表31中的回损要求不合格。
**7.2.2.1.11 序列暂态电压**。
该参数针对的是电源排序和电源模式变化期间串行数据总线上的瞬态电压。由于接收机或发射机都可能受到电源排序瞬态的影响，因此用 "侵略者 "来表示排序接口电路，用 "受害者 "来表示接收瞬态的接口电路。
为了限制电源排序期间受害者接收器或发射器电路看到的电压和能量，涉及到侵略者和受害者的几个参数。虽然受害者的参数，如共模电压和单端阻抗，会影响观察到的瞬态，但本次测量解决的是限制侵略者的贡献。
侵略者的共模电压、单端阻抗和交流耦合电容值决定了排序瞬态的水平。本次测量解决的是侵略者的共模电压。上电或断电斜坡的变化率也会影响这个电平。所提供的限制允许以比信号线的时间常数更快的速率上电或断电斜坡，尽管实际系统可能达不到这个速率。
 此项测量应包括在使用Phy的系统中以尽可能快的速度开机和关机的测试条件，以及任何电源模式转换。
**7.2.2.1.12 序列瞬态电压实验室负载（Gen3i）**。
该参数解决了在实验室负载的测试条件下，电源排序期间串行数据总线上的瞬态电压问题（实验室负载详情见7.2.2.4）。用实验室负载测量瞬态电压时，结合了偏置电压和串联终端的影响。不需要单独测量电路的阻抗。由于一些电路校准阻抗后，电源斜坡是竞争，测量阻抗在瞬态条件下变得具有挑战性。
为了防止高阻抗共模电压对受害电路造成过大的压力，必须进行开路电压测量，如7.4.16 "瞬态电压的排序 "中所述。
**7.2.2.2 发射机规格详情**。
本节详细介绍了表 30 的内容。
**7.2.2.2.1 TX对差分阻抗（Gen1i）**。
通过差分TDR观察连接器的100ps（最大）边缘（20%-80%）。
在差分模式下用TDR测量。
**7.2.2.2.2.2 TX单端阻抗(Gen1i)**。
由TDR看到，100ps（最大）的边缘看向连接器（20%-80%）。TDR被设置为在TX对的两个信号上同时产生正脉冲。单端阻抗是指每个信号的结果（偶模）阻抗。两个信号都应满足单端阻抗要求。
在Phy的所有可能的电源和电气条件下，包括断电和电源斜坡，都应满足这一要求。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### 串行ATA国际组织 **7.2.2.2.3 TX和RX差分模式回损(Gen2i、Gen2m)(Gen1i、Gen1m备用)**。
本规范用已知上升时间的入射步长的反射峰值和回波损耗来描述发射机输出阻抗和接收器输入阻抗。回波损耗测量应足以验证是否符合Gen1和Gen2的要求。
Gen2的要求。为了确保通过以前所要求的TDR差分阻抗方法的Gen1设计不因这一变化而失效，任何一种方法都足以验证是否符合Gen1的要求。不应要求用两种方法验证是否符合要求。
差模回波损耗是指在100欧姆阻抗水平下，差模入射功率与差模反射功率之比（以dB表示）。在系统环境中，控制设备和主机的回波损耗的目的是限制导致数据依赖性抖动的信号反射。当连接到匹配的信号源或负载时，这些信号反射会超过那些存在于合规性测试中的信号。
频率 (GHz) .15 .30 .60 .1.2 2.4 5.0
## 图 117 - 差分回波损耗限制 **7.2.2.2.4 TX 共模回波损耗（Gen2i、Gen2m）**。
共模回波损耗是指在25欧姆阻抗水平下，共模入射功率与共模反射功率之比（以dB表示）。在SATA中，预期的信号传播模式是差分模式。然而，系统中的不完善会在共模和差模之间产生一些耦合。这有三个后果：辐射发射、噪声敏感度和信号衰减。共模反射加剧了这些损害。共模回波损耗是对系统中共模反射幅度的限制。
频率（GHz） .15 .30 .60 1.2 2.4 5.0
## 图118 - 共模回波损耗限制........................................................................
 **7.2.2.2.5 TX阻抗平衡(Gen2i, Gen2m, Gen3i)**。
阻抗平衡是指100欧姆阻抗水平下的共模入射功率与25欧姆阻抗水平下的差模反射功率之比（以dB表示）。
阻抗平衡是对共模和差模之间耦合的一个约束。
频率 (GHz) .15 .30 .60 .1.2 2.4 5.0
## 图119 - 阻抗平衡限制  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.2.2.2.6 TX和RX差分模式回波损耗（Gen3i）**。
本规范用回波损耗来描述发射机输出阻抗和接收器输入阻抗。回波损耗规定为起始点和终止点，两者之间有确定的斜率。从起始频率到结束频率，回波损耗应保持在图120所示的线以下。
差模回波损耗是指在100欧姆阻抗水平下，差模入射功率与差模反射功率之比（以dB表示）。

 在系统环境中，控制设备和主机的回波损耗的目的是限制导致数据依赖性抖动的信号反射。当连接到匹配的信号源或负载时，这些信号反射会超过那些存在于合规性测试中的信号。
## 图120 - 差分回波损耗限制，Gen3i，TX和RX。
斜率13dB/dec
对数频率（千兆赫）
##### 0.30 3.0 
##### RL (dB)
##### 0.30 3.0 6.0 
##### - RL (dB)
对数频率（千兆赫）
##### TX RX  
发射信号要求详情
本节包含表 31 条目的详细信息。
**7.2.2.2.7 TX差分输出电压**。
在发射机上测量的差分电压[(TX+)-(TX-)]应符合第7.2节的相应电气规格。
这是在发射侧的串行ATA连接器上测量的，包括任何预加重。
对于Gen3i，最大差分输出电压同样在TX符合点测量，但最小差分输出电压在Gen3i CIC之后测量。(见7.4.3节) **7.2.2.2.8 TX最小电压测量间隔**。
UI内信号应满足最低电平的点。
**7.2.2.2.9 TX上升/下降时间**。
上升时间和下降时间在信号的20%到80%之间测量，见图121。上升和下降时间要求tr/f适用于差分转换(TX+ - TX-)，对于正常的情况下，也适用于差分转换。
OOB信号传递。
差分
数据线
上升时间 下降时间 80% 80% 20% 20%
Tr Tf
## 图121 - 信号上升和下降时间  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.2.2.2.10 TX差分斜度**。
TX差分偏移是指TX+信号上升/下降沿的单端中点与TX-信号下降/上升沿的单端中点之间的时间差。这是一个需要控制的重要参数，因为过大的偏移可能会导致互连远端的高频抖动和共模噪声水平增加。对接收器的影响将在7.2.2.5.4节中详细讨论。过大的TX差分偏移也会增加EMI辐射。
最小偏移
TX(+)
TX(-)
Diff-Rx
偏斜
迟到的倾斜
TX(+)
TX(-)
Diff-Rx
EARLY-SKEW
TX(+)
TX(-)
Diff-Rx
偏斜
## 图122 - TX线对内偏移 **7.2.2.2.11 TX交流共模电压(Gen2i、Gen1x、Gen2x)**。
在发射机连接器处测得的共模信号的最大正弦振幅。
当发射机受到峰-峰电压的正弦干扰信号，并从频率范围极端值扫频，扫频速率周期不短于33.33us时，发射机应符合7.2节的电气规格。
**7.2.2.2.12 TX交流共模电压（Gen3i）**。
在发射机连接器处测量的共模信号的最大正弦幅度。
使用第 7.4.21 节定义的共模电压测量技术，发射机提供的输出电压不得超过表 30 的规定。
**7.2.2.2.13 共模瞬态安顿时间（Gen1i）**。
在Gen1i发射机中，这是共模瞬变的最大时间，在转换到空闲总线状态和从空闲总线状态的过程中，共模瞬变稳定在其先前状态共模电压的25 mV以内。
**7.2.2.2.14 OOB 差分 Delta (Gen2i,Gen3i, Gen2m,Gen1x, Gen2x)**。
空闲总线状态期间的平均差值与从空闲总线状态过渡到突发期间的平均差值之间的差值。
在OOB传输过程中，发射机的不完善和不对称可能会产生错误信号，影响接收器的正确检测。OOB差分Delta描述了空闲和活动状态下发射机直流偏移的差异所产生的误差。由于发射机在空闲和活动状态之间交替使用不同的直流偏移，产生了交流误差电压，这是一个方波，频率约为1 / (2*106 ns) = 4.7 MHz。交流误差电压通过互连传播，并在接收器OOB检测器中引起偏移。
DVdiffOOB _V_ max _V_ max _V_ min _V_ min _V_ ( ) = 0 _t_ _V (t)_。
## 图123 - OOB差分三角(在交流耦合的合规点) **7.2.2.2.15 OOB共模三角(Gen2i、Gen3i、Gen1x、Gen2x)**。
空闲总线状态下的共模值与空闲总线状态转换时的突发共模值之差。
**7.2.2.2.16 TX上升/下降不平衡**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
TX+上升和TX-下降的匹配度由函数决定：绝对值(TX+,上升)
- TX-,fall)/平均值，其中平均值为(TX+,上升+TX-,下降)/2，上升和下降时间均为20-80%。

TX+的下降和TX-的上升的匹配度由函数决定：绝对值（TX+,下降-?
TX-,上升)/平均值，其中平均值为(TX+,下降+TX-,上升)/2，所有上升和下降时间为20-80%。
**7.2.2.2.17 TX振幅不平衡（Gen2i，Gen1x，Gen2x）**。
TX+和TX-的振幅匹配度由函数决定：绝对值（TX+振幅-TX-振幅）/平均值，其中平均值为（TX+振幅+TX-振幅）/2，所有振幅由模式（最流行）电压决定。
**7.2.2.2.18 时钟到数据传输抖动（Gen1i、Gen1m、Gen1x、Gen2i、Gen2m。
Gen2x，Gen3i)**。
发射机应满足每种情况下指定的参考时钟特性的抖动规格。
表31显示了发射机在符合SATA标准的情况下可能产生的最大抖动量，7.4.8节描述了测量方法。由于本规范将合规点放在连接器之后，因此在封装连接处、印刷电路板上和电路板连接器上产生的任何抖动都应包括在测量中。
**7.2.2.3 接收器规格的详细内容**。
此处详细说明了表 32 的内容。
**7.2.2.3.1 RX对差分阻抗(Gen1i)**。
通过差分TDR观察连接器的100ps（最大）边缘（20%-80%）。
在差分模式下用TDR测量。
**7.2.2.3.2 RX单端阻抗（Gen1i）**。
由TDR看到，100ps（最大）的边缘看向连接器（20%-80%）。
TDR设置为在RX对的两个信号上同时产生正脉冲。单端阻抗是指每个信号的结果（偶数模式）阻抗。两个信号都应满足单端阻抗要求。
在Phy的所有可能的电源和电气条件下，包括断电和电源升压，都应满足这一要求。
**7.2.2.3.3 RX 差分模式回波损耗（Gen2i、Gen2m）**。
接收机差模回损的测量方法与发射机差模回损类似。详见7.2.2.2.3节。
**7.2.2.3.4 RX共模回波损耗（Gen2i、Gen2m）**。
接收机共模回波损耗的测量方法与发射机共模回波损耗类似，详见7.2.2.2.4节。
详见7.2.2.2.4节。
**7.2.2.3.5 RX阻抗平衡（Gen2i、Gen2m）**。
接收机阻抗平衡的测量与发射机阻抗平衡类似。详见7.2.2.2.5节。
 **7.2.2.3.6 RX差分模式回波损耗（Gen3i）**。
接收机差模回损的测量方法与发射机差模回损类似。详情请参见7.2.2.2.6节。
**7.2.2.4 实验室负载详情**。
实验室负载是连接到被测设备的电气测试系统。来自UUT的串行发射机信号通过由连接器和电缆组成的 "匹配的SATA连接器对 "模块连接到HBWS，并将其端接到两个50欧姆（正负5欧姆）的负载。
电缆的阻抗应为 50 欧姆（正负 5 欧姆）。实验室的输入
负载（从匹配的SATA连接器背面到HBWS内的50欧姆负载）在100 MHz至5.0 GHz的带宽上的单个回损应大于20 dB，在5 GHz至8 GHz的带宽上应大于10 dB。被测通道之间的偏移在补偿后应小于10皮秒。LL由这个总组件组成。LL不包括 "另一半配接的连接器"，它被认为是UUT的一部分，但实际位于LL上。LL如图124所示。
合规性
Te s t Point
信号
实验室负荷(LL)
##### HBWS / JMD 50欧姆 50欧姆 50欧姆
电缆
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图124 -- -- 实验室负荷 
LL的电气特性应大于被测参数所需的性能，从而使LL对被测参数的影响可以在测量数据中成功补偿或解除。
**7.2.2.5 来自实验室的信号细节**。
本节包含表 33 条目的详细信息。
实验室源信号或实验室源信号是连接到被测设备的仪器和电气测试系统。LSS 以规定的 100 欧姆差分和 25 欧姆共模的阻抗水平向 UUT 提供信号。LSS还可以提供带有抖动和共模噪声等损伤的SATA信号。LSS可以由多个仪器与夹具组合而成，以创建一个有损伤的信号。

##### 高速序列化 ATTACHMENT(连接) 
#### ATA国际组织 
合规
RX信号指向UUT
实验室源信号
数据
信号
源 50 欧姆 50 欧姆 50 欧姆
电缆
DCB
DCB
直流电座（根据需要
SATA
适配器（插座
SATA接口
连接器对
## 图125 - LSS实验室来源信号 
实验室信号是实验室产生的信号，它被校准到100欧姆差分和25欧姆共模的阻抗匹配负载中，然后应用于被测接收器的RX+和RX-信号。
在Gen3i的情况下，Gen3i CIC被插入到应用于RX的信号路径中。(见7.4.12节)用于校准LSS的负载在100 MHz至5.0 GHz的带宽上的单个回波损耗应大于20 dB，在5 GHz至8 GHz之间应大于10 dB。在校准期间，实验室来源信号的特性应符合表33的规格。当该信号被应用于
被测接收器应满足表29的帧错误率规格。
 **7.2.2.5.1 RX差分输入电压**。
RX差分输入电压是指在符合性测试条件下，接收机应工作到所需链路性能水平的输入电压范围。这是接收机应容忍的一个输入条件范围（见7.4.11节）。
串行ATA系统的发送器和接收器的阻抗接近标称系统阻抗100欧姆。顺应点的电压强烈依赖于发送器、接收器和互连阻抗。RX差分输入电压从阻抗匹配的信号源输送到匹配的负载中（见图126）。当实际的接收器被替换成匹配负载时，电压的变化量取决于接收器的设计。这种变化是接收器设计负担的一部分。
Rs=100欧姆
VdiffRX
Vsrc RL = 100欧姆
## 图126 - RX差分输入电压条件................................................................。

RX差分输入电压并不能描述从互连线输送的电压。
在整个频率范围内，互连网输出阻抗不等于标称系统阻抗。它不是由互连网交付的匹配负载的电压，也不是由互连网交付的接收器的电压。7.4.5 节给出了证明这一点的计算示例。
**7.2.2.5.2 RX 上升/下降时间**。
上升时间和下降时间在信号的20%和80%之间测量。上升和下降时间要求t20-80RX适用于差分转换（适用于RX+和RX-Gen1和Gen2）。
Gen2）。) 对于Gen3i，最大和最小的RX上升时间和下降时间要求适用于Gen3i CIC之前的数据信号源。(见第7.4.12节) **7.2.2.5.3 RX最小电压测量间隔**。
在UI中，信号应满足最低电平的点。

##### 高速 SERIALIZED ATTACHMENT(附件)。
#### 串行ATA国际组织 **7.2.2.5.4 RX差分偏移(Gen2i, Gen1x, Gen2x, Gen3i)**。
RX差分斜度是指RX+信号上升/下降沿的单端中点和RX-信号下降/上升沿的单端中点之间的时间差，在RX连接器处测量。接收机应能容忍每一个RX偏移水平。
表33 ，由实验室信号产生。
接收机差分斜度是一个需要考虑的重要参数，因为过度的斜度可能会导致在高速差分接收机上看到的高频抖动和高频共模噪声增加。图127描述了晚期和早期偏斜信号如何影响差分接收器解析差分输入信号的时间。对于最小偏斜情况，当单端回转率达到最大时，在分频器处，UI宽度也达到最大。
然而，对于早期和晚期偏斜情况，情况并非如此。高频共模噪声是高速接收器工作点快速变化的结果。
第 7.4.15 节描述了适用的测量方法，该方法应该用于校准故意偏斜的实验室信号输出到接收机。
最小偏斜
RX(+)
RX(-)
Diff-Rx
偏斜
迟到的倾斜
RX(+)
RX(-)
Diff-Rx
EARLY-SKEW
RX(+)
RX(-)
Diff-Rx
偏斜
## 图127 - RX线对内偏移.................................................................................................。
  **7.2.2.5.5 RX交流共模电压(Gen2i, Gen1x, Gen2x)**。
交流共模信号的最大峰峰值正弦振幅[(RX+)+(RX-)]/2。
当受到正弦共模干扰信号时，接收机应在表 29 所列的帧误差率范围内工作，该信号的峰峰值电压 VcmRX,ac 的定义见表 29。
表33，并以不短于33.33us的扫频速率周期扫过表33定义的频率范围fcm,acRX。
**7.2.2.5.6 交流共模频率**。
所有接收机应能容忍该频率范围内的正弦共模噪声分量，振幅为Vcm,acRX。
**7.2.2.5.7 时钟数据接收机抖动容限（Gen1i、Gen1m、Gen2i、Gen2m。
Gen1x, Gen2x)**。
抖动容忍度是指接收器在抖动情况下恢复数据的能力。
 接收器应能工作的最小抖动量是表33中提供的抖动容限规格，7.4.11节描述了Gen1和Gen2的测量。
**7.2.2.5.8 时钟-数据接收器抖动容限（Gen3i）**。
有关Gen3i抖动容差测量的详情，请参见7.4.12。
**7.2.2.6 OOB规格详情**。
本节详见表34。
**7.2.2.6.1 OOB信号突发的产生**。
带外(OOB)信号是由低频、波形突发组成的波形组，中间夹杂着空闲间隙。这些信号在正常的数据流传输过程中不会出现，但在数据传输开始前的初始通知和校准期间，用于传达低频识别信息。OOB信号由规定的空闲时间和规定的突发时间组成，这种组合重复多次迭代。在空闲时间内，物理链路携带D.C.空闲。在突发时间内，物理链路携带低频信号转换，旨在作为包络检测手段的重复波形。这些突发时间被转化为ON/OFF时间，作为极低速通信的手段。OOB信号的OFF时间由波形突发之间的空闲时间长度决定。
OOB 脉冲串期间使用的信号模式应包括 D24.3 字符（首选）或 ALIGN 基元（允许），以 Gen1 速率传输。OOB脉冲串只需要产生一个包络，以便由A.C.耦合检测电路检测。脉冲串的
D24.3字符在Gen1速度下相当于一个方波模式，在2个UIoob周期内为 "1"，然后在2个UIoob周期内为 "0"，或者简单地说，一个周期为2.66 nsec的方波。所有的数据速度代应使用Gen1 OOB突发速度，为所有OOB检测电路建立一个单一的要求。
**7.2.2.6.2 OOB信号检测阈值**。
在OOB信令期间，由压制检测器检测到的作为活动的差分信号幅度。
小于表34中定义的最小Vthresh的VdiffRX信号不应被检测为活动。
大于表34中定义的最大Vthresh的信号电平应被检测为活动。

##### 高速序列化在附件中的应用 
#### 串行ATA国际组织 **7.2.2.6.3 OOB信号期间的UI（UIOOB）**。
OOB突发传输期间的平均数据周期（Gen1速度+/- 3%）。
**7.2.2.6.4 COMINIT/COMRESET和COMWAKE传输脉冲串长度**。
从突发的第一个交叉点（+100mV或-100mV）到最后一个交叉点（+100mV或-100mV）测量的突发长度，单位为ns。
**7.2.2.6.5 COMINIT/COMRESET 传输间隙长度**。
间隙长度（ns），从最后一个交叉点（+100mV或-100mV）开始测量。
COMINIT/COMRESET突发到下面的第一个交叉点（+100mV或-100mV）。
COMINIT/COMRESET突发。
**7.2.2.6.6 COMWAKE 发送间隙长度**。
间隙长度（ns），从最后一个交叉点（+100mV或-100mV）开始测量。
COMWAKE 突发到下一个 COMWAKE 突发的第一个交叉点（+100mV 或 -100mV）。
**7.2.2.6.7 COMWAKE 间隙检测窗口**。
三个定时范围定义了COMWAKE空隙的验证和失效；见表34。
落在定义的 "可检测 "范围内的突发之间的任何OOB空隙可被确认为有效的COMWAKE空隙。
落在 "应检测 "范围内的突发之间的任何OOB空隙应被识别为有效的COMWAKE空隙。
COMWAKE空隙。
任何落在 "不得检测 "范围内的突发之间的OOB间隙应被识别为无效的COMWAKE间隙（不得被识别为有效的COMWAKE间隙）。
**7.2.2.6.8 COMINIT/COMRESET 间隙检测窗口**。
定义COMINIT和COMRESET间隙的验证和无效的三个定时范围；见表34。
落在定义的 "可检测 "范围内的突发之间的任何OOB间隙可被识别为有效的COMINIT或COMRESET间隙。
落在 "应检测 "范围内的任何OOB突发之间的空隙应被识别为有效的
COMINIT或COMRESET间隙。
任何落在 "不得检测 "范围内的突发之间的OOB间隙应被识别为无效的COMINIT或COMRESET间隙（不得被识别为有效的COMINIT或
COMRESET间隙）。)
#### 7.2.3 回环 
除了满足表29至表34中的所有电气规格外，所有主机和设备都要满足以下要求
设备应提供远端重定时环回模式。其他两种回环模式是可选的，但如果实施，应符合7.2.3.2和7.2.3.3的规定。
a) 远端重定时 - 必需 b) 远端模拟 - 可选 c) 近端模拟（有效重定时） - 可选 **7.2.3.1 远端重定时**。
下面的图128说明了在架构框图层面上，远端设备的范围。
重新定时环回。由于这种环回方案需要远端连接接口的特定动作。
 该模式应通过10.3.9节所述的BIST激活FIS进入。
远端接口应保持在此远端重定时环回模式，直到收到远端重定时环回信号。
COMRESET/COMINIT OOB信号序列。
作为最低限度，远端重定时环回应包括远端电路，以便在远端接口的数据流被解串器和数据恢复电路(DRC)提取，然后通过串行器和发送器送回，并适当插入重定时。
如第 7.6 节所述，ALIGNPprimitives。数据可以进行解码和解扰，以便为设备的这些部分提供测试覆盖范围，但必须使用相同的加扰器序列对数据进行重新加扰。返回的数据应与接收到的数据相同，但返回的数据可以用不同的起始运行差异进行编码。
模拟
前面
结束
模拟
前面
结束
固定模式
资料来源
固定模式
检测
TX-
TX+ RX+
RX-
矽品
迴路
RX+
RX-^
数据
萃取
块
数据
萃取
块
TX+
TX-^
O
O
I
I
I
O
O
I
## 图128--远端重定时环回。 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.2.3.2 远端模拟（可选）**。
图129说明了远端模拟量模块的范围，在架构框图层面，远端模拟量模块的范围为：1.0-2.0。
回环。由于该回环方案需要远端连接接口的特定动作，因此应通过10.3.9节所述的BIST激活FIS进入该模式。
远端接口应保持在该远端模拟环回模式，直到收到远端模拟环回信号后，才会进入该模式。
COMRESET或COMINIT。
模拟
前面
结束
模拟
前面
结束
固定模式
资料来源
固定模式
检测
TX-
TX+ RX+
RX-
矽品
迴路
RX+
RX-^
数据
萃取
块
数据
萃取
块
TX+
TX-^
O
O
I
I
I
O
O
I
## 图129 - 远端模拟环回 **7.2.3.3 近端模拟（可选）**。
图130说明了近端模拟电路在架构框图层面的范围。
回环方案。这种环回方案需要远端连接的接口处于非传输模式，如沉睡，或部分接口电源管理状态。该模式的进入和退出由厂商决定。
模拟模式
前面
结束
固定模式
资料来源
固定模式
检测
TX-*
TX+*
## + 
## + 
## - 
## - 
矽品
迴路
RX+*
RX-*
数据
萃取
块
O
O
I
I
## 图130 - 近端模拟环回。
#### 7.2.4 测试模式要求..................................................................................。

测试模式应用于串行ATA接口的合规性测试。本节定义了用于合规性测试的各种模式。第7.4节中的各个部分定义了哪些模式用于特定测试。这些模式分为两类：a) 不合规模式 b) 合规模式。
不符合要求的模式是指那些用于基线抖动测量和评估信号质量的模式，给定的刺激。这些模式不符合所需的FIS格式，而只是一组8b/10b字符的重复选择。
符合要求的模式是指那些包含前导SOFP基元、指定模式作为数据内容，以及尾部CRCP和EOFP基元的指定模式。在使用这类模式的刺激期间，不会抑制双连续的ALIGNPprimitive。

##### 高速 SERIALIZED ATTACHMENT (高速序列化) 
#### ATA国际组织 
本节所引用的测试模式是作为激励来验证接口的符合性和信号完整性，使用的测试模式如下：a)不符合的测试模式用于抖动测量、物理连接介质测试和电参数测试。
b) 合规测试模式，用于帧错误率测试和系统内测试。
**7.2.4.1 不符合规定的模式**。
第7.2节的电参数应采用测量方法第7.4节中确定的图案进行验证。
a) 按7.2.4.3.5节规定的孤位模式。
b) 高频测试模式，按照4.1.59节的规定。
c) 中频测试模式，按照 4.1.78 节的规定。
d) 低频测试模式，符合 4.1.75 节的规定。
**7.2.4.2 符合要求的帧模式*** 
7.4.1.2节中规定的帧错误率应在受到任何实施确定的最坏情况下的合规模式以及以下一组合规模式时进行合规性测试： a) 根据7.2.4.3.5节的合规孤位模式。
b)符合7.2.4.3.6节的合规复合模式。
其中，限定前缀术语 "合规 "表示传输封装在数据FIS有效载荷中的引用模式，并用于串行ATA操作传输环境。
需要注意的是，引用模式应出现在网线上，引用模式的N个参数应延长，以达到最大帧长。
 这些符合要求的模式包含必要的SOFP前导基元、包含表示数据FIS的FIS类型的Dword头、指定的测试模式、计算出的CRC和尾部的EOFP，如图131所示。为了在SATA链路上生成这些模式，需要考虑到加扰问题。
SOFP 数据 FIS 标头 指定的测试模式 CRC EOFP
## 图131--符合规定的测试模式.........................................................................................。
  **7.2.4.3 测试位模式和序列特征**。
位序列模式有多种类型，强调低/高过渡密度模式，以及低/高频模式。
a)低过渡密度模式(LTDP)是指含有长长的1和0的模式，目的是通过改变差分信令电平两端的偏移时间来产生符号间干扰。
b) 高转换密度模式(HTDP)是指包含短的1和0的模式，其目的也是为了产生符号间干扰。
c)低频频谱含量模式(LFSCP)是对输入高通滤波电路的一个很好的测试，更具体地说，是由于边缘设计而引入的幅度信号失真。这些比特模式比那些具有高频频谱含量的比特模式是一个更好的测试。
d)同步开关输出模式(SSOP)是通过传输交替的一补位模式(10-bits)来实现的，以便在接收器处恢复。这些模式会产生最坏情况下的电源或芯片基板的噪声，并通过选择在恢复的比特模式并行接口处最大化电流极端值的比特测试模式序列来实现。这些模式将Ldi/dt噪声诱导到衬底电源，是对接收器电路的良好测试。
e)孤位图案(LBP)由某些10b图案的连续组合组成，从而产生孤位。这些模式创造了一个条件，即前面的4位运行长度导致了孤位的最小振幅，以及与周围段相比的时间宽度。这通常是接收数据恢复电路可能遇到的最坏情况。
f) 随机比特模式的目的是提供那些包含足够宽的频谱内容和最小峰值的模式，这些模式应该用于组件和系统级架构测量抖动输出和误码率性能。这些模式也旨在成为通用的基线模式刺激，用于系统/组件供应商比较测试，将传输抖动输出测量归于组件性能，而不是用于数据模式的频谱曲线。
以下各节中说明的测试模式以负的运行差异开始，仅用于说明目的，以便传达每个序列传输的编码10b模式。

##### 高速串行化的ATTACHMENT。
#### ATA国际组织**7.2.4.3.1 低过渡密度模式**。
低过渡密度比特模式(LTDP)，如下表35和表36所示，包含长长的1和0。这些模式由于符号间干扰而产生抖动。当7.2.4.3.6节描述的复合模式的一部分时，这种情况会加重。比特序列显示了两种情况，其中起始运行差距为负或正。
## 表35 - 以RD-开始的低转换密度模式(LTDP)。
传送令
D17.7(F1h)-D30.7(FEh)+D7.1(27h)+D14.7(EEh)+D17.7(F1h)-D30.7(FEh)
- 1000 1101 1110 0001 1110 0001 1110 0101 1100 1000 8 D E 1 E 1 E 5 C 8 -- 
D30.7(FEh)- D7.6(C7h)- D30.3(7Eh)- D30.3(7Eh)+ -
- 0111 1000 0111 1000 0110 0111 1000 1110 0001 1100 7 8 7 8 6 7 8 E 1 C 
D30.3(7Eh)- D30.3(7Eh)+ D30.3(7Eh)- D30.3(7Eh)+ -
- 0111 1000 1110 0001 1100 0111 1000 1110 0001 1100 7 8 E 1 C 7 8 E 1 C 上面的D字在长版中共重复2045次。
          上面的Dword在短版中共重复了125次。
D3.7(E3h)- D28.7(FCh)+ D3.7(E3h)- D28.7(FCh)+ -D3.7(E3h)- D28.7(FCh)+ -
- 1100 0111 1000 1110 0001 1100 0111 1000 1110 0001 C 7 8 E 1 C 7 8 E1 
长版共：3+2045=2048个D字。
短版共：3+125=128个Dword。

## ＃＃表36--以RD+为起点的低转换密度模式（LTDP）。
传令+D14.7(EEh)+D30.7(FEh)- D7.6(C7h)+D17.7(F1h)- + 0111 0010 0001 1110 0001 1110 0001 1010 0011 0111 7 2 1 E 1 E 1 A 3 7+D30.7(FEh)+D7.1(27h)+D30.3(7Eh)+D30. 3(7Eh)- + 1000 0111 1000 0111 1001 1000 0111 0001 1110 0011 8 7 8 7 9 8 7 1 E 3 + D30.3(7Eh)+ D30.3(7Eh)- D30.3(7Eh)+ D30.3(7Eh)- + 1000 0111 0001 1110 0011 1000 0111 0001 1110 0011 8 7 1 E 3 8 7 1 E3
以上Dword长版共重复2045次。
上面的Dword在短版中共重复了125次。

+ D28.7(FCh)+ D3.7(E3h)- D28.7(FCh)+ D3.7(E3h)- + 0011 1000 0111 0001 1110 0011 1000 0111 0001 1110 3 8 7 1 E 3 8 7 1 E.
长版共：3+2045=2048个D字。
简版共计：3+125=128个D字。
##### 在附件处进行高速小型化。
#### ATA国际组织**7.2.4.3.2高转换密度模式**。
如表37和表38所示，高转换密度模式是指那些包含短的1和0的模式。这些模式由于符号间干扰而产生抖动，当属于7.2.4.3.6节所述的复合模式时，抖动变得更加明显。
有两种类型的高转换密度图案值得关注：a)半速率高转换密度位图案序列b)四分之一速率高转换密度位图案序列。
这两种类型都用于高过渡密度测试模式。比特序列显示了两种情况，其中起始运行差距为负或正。
## 表37--从RD-开始的高转换密度模式（HTDP）。
传送令

             上面的D字在短版中共重复了32次。

             上面的D字在短版中共重复了32次。

             上面的D字在短版中共重复了32次。
- D25.6(D9h)- D6.1(26h)+ D25.6(D9h)- D6.1(26h)+ - 1001 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 9 9 以上的 Dword，长版共重复 512 次。
             上面的Dword在短版中共重复32次。
                长版总计：4*512=2048个Dword 短版总计：4*32=128个Dword。 
## 表38--从RD+开始的高转换密度模式(HTDP) 
传送令
D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ 1010 1010 1010 1010 1010 1010 1010 1010 1010 1010 1010
A A A A A A A A A A A A +
以上Dword长版共重复512次。
上面的D字在短版中共重复了32次。
D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 3 3 3 3 3 3 3 3 +
以上Dword长版共重复512次。
上面的D字在短版中共重复了32次。
D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ + 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 5 5 5 5 5 5 5 5 5 5 +
以上Dword长版共重复512次。
上面的D字在短版中共重复了32次。
D25.6(D9h)+ D6.1(26h)+ D25.6(D9h)+ D6.1(26h)+ + 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 +
以上Dword长版共重复512次。
上面的Dword在短版中共重复32次。
长版共：4*512=2048个Dword。
简版共计：4*32=128个D字。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.2.4.3.3 低频频谱内容模式（LFSCP）**。
如表39和表40所示，包含低频频谱分量的位图是对互连传输的良好测试，特别是任何交流耦合电容器。通过这些组件的不良传输会引入该测试模式所显示的信号失真。
位序列显示的是两种情况下的位序列，其中起始运行差距为负值或正值。
## 表 39 - 从 RD-开始的低频频谱内容模式 (LFSCP)。
传送令
D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)
- 0010 1101 0100 1011 0101 0010 1101 0100 1011 0101 2 D 4 B 5 2 D 4 B 5 - 
以上Dword长版共重复1023次。
上面的D字在短版中共重复了63次。
D20.2(54h)-D20.7(F4h)-D11.5(ABh)+D11.5(ABh)+D11.5(ABh)+D11.5(ABh)。
- 0010 1101 0100 1011 0111 1101 0010 1011 0100 1010 2 D 4 B 7 D 2 B 4 A +。
D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ + 1101 0010 1011 0100 1010 1101 0010 1011 0100 1010
D 2 B 4 A D 2 B 4 A +。
以上Dword长版共重复1023次。
上面的D字在短版中共重复了63次。
D11.5(ABh)+ D11.7(EBh)+ D20.2.(54h)- D20.2(54h)- + 1101 0010 1011 0100 1000 0010 1101 0100 1011 0101 ．
D 2 B 4 8 2 D 4 B 5 -- 
长版总计：2+2*1023=2048个Dword。
4095字节的D11.5，4095字节的D20.2。

1个D11.7过渡字节包括0000010运行，1个D20.7过渡字节包括11110101运行。
简版合计：2+2*63=128个Dword D11.5的255个字节，D20.2的255个字节 1个D11.7过渡字节，包括0000010运行，1个D20.7过渡字节，包括1111011运行。
## 表40--从RD+开始的低频光谱内容模式（LFSCP）。
传送令
D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ + 1101 0010 1011 0100 1010 1101 0010 1011 0100 1010
D 2 B 4 A D 2 B 4 A +。
以上Dword共重复1023次。
以上D字共重复63次，为简版。
D11.5(ABh)+ D11.7(EBh)+ D20.2.(54h)- D20.2(54h)- + 1101 0010 1011 0100 1000 0010 1101 0100 1011 0101。
D 2 B 4 8 2 D 4 B 5 -- 
D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)
- 0010 1101 0100 1011 0101 0010 1101 0100 1011 0101 2 D 4 B 5 2 D 4 B 5 - 
以上Dword共重复1023次。
以上D字共重复63次，为简版。
D20.2(54h)-D20.7(F4h)-D11.5(ABh)+D11.5(ABh)+D11.5(ABh)+D11.5(ABh)。
- 0010 1101 0100 1011 0111 1101 0010 1011 0100 1010 2 D 4 B 7 D 2 B 4 A +。
长版共：2+2*1023=2048个Dword 4095个字节的D11.5，4095个字节的D20.2 1个D11.7过渡字节包括0000010运行，1个D20.7过渡字节包括111101运行。
简版总计：2+2*63=128个Dword 255个字节的D11.5，255个字节的D20.2。
##### 高速 SERIALIZED ATTACHMENT(高速序列化) 
#### 串行ATA国际组织 **7.2.4.3.4 同步开关输出模式(SSOP)**。
表41和表42所示的同步开关输出位图案(SSOP)，将感应开关(Ldi/dt)噪声感应到接收器的衬底电源中，为噪声控制提供了良好的测试。SSOP模式，交替的1的补位模式(10-bits)，被应用到接收器上。比特序列显示了两种情况，其中起始运行差距为负或正。
## ＃表41 - 同步开关输出模式(SSOP)从RD-开始。
传送令
D31.3(7Fh)- D31.3(7Fh)+ D31.3(7Fh)- D31.3(7Fh)+
- 1010 1100 1101 0100 1100 1010 1100 1101 0100 1100 A C D 4 C A C D 4 C------。
以上Dword长版共重复2048次。
上面的Dword在短版中共重复128次，长版共：1*2048=2048个Dword。
长版共：1*2048=2048个Dword。
短版总计：1*128=128个Dword。
## ＃＃表42 - 以RD+为起点的同步开关输出模式（SSOP）。
传送令
D31.3(7Fh)+ D31.3(7Fh)- D31.3(7Fh)+ D31.3(7Fh)- + 0101 0011 0010 1011 0011 0101 0011 0010 1011 0011 5 3 2 B 3 5 3 2 B 3 +
以上Dword长版共重复2048次。
上面的Dword在短版中共重复128次，长版共：1*2048=2048个Dword。
长版共：1*2048=2048个Dword。
短版合计：1*128=128个Dword。
 **7.2.4.3.5 长位码模式（LBP）**。
表43和表44所示的孤位图案，是由相邻的10B图案组合而成，结果是以运行长度为四个零为前缀的孤位，并以运行长度为三个零为后缀。也会导致孤零位前缀的运行长度为两个一、一个零、两个一、一个零、四个一，后缀的运行长度为一个一。这是对恶劣信令条件下接收机抖动容限的一个很好的测试。孤位可能比预期的衰减和窄。比特序列显示的是两种情况下的比特序列，其中起始运行差值为负或正。
## 表43--从RD-开始的孤位码型(LBP)。
传送令
D12.0(0Ch)- D11.4(8Bh)+ D12.0(0Ch)- D11.3(6Bh)+ 。
- 0011 0110 1111 0100 0010 0011 0110 1111 0100 0011 3 6 F 4 2 3 6 F 4 3 +。
D12.0(0Ch)+ D11.4(8Bh)- D12.0(0Ch)+ D11.3(6Bh)- + 0011 0101 0011 0100 1101 0011 0101 0011 0100 1100 3 5 3 4 D 3 5 3 4 C- 
长版共：1*2048=2048个Dword。
短版总字数：1*128=128个字。
## ＃＃表44 - 以RD+为起点的长位模式（LBP）。
传送令^
D12.0(0Ch)+ D11.4(8Bh)- D12.0(0Ch)+ D11.3(6Bh)- + 0011 0101 0011 0100 1101 0011 0101 0011 0100 1100 3 5 3 4 D 3 5 3 4 C- 
D12.0(0Ch)- D11.4(8Bh)+ D12.0(0Ch)- D11.3(6Bh)+ 。
- 0011 0110 1111 0100 0010 0011 0110 1111 0100 0011 3 6 F4 2 3 6 F4 3 
##### + 
长版共：1*2048=2048个Dword。
短版总字数：1*128=128个Dword。
**7.2.4.3.6 复合模式（COMP）**。
对于抖动的测量，如表45和表46所示，复合模式应结合低频率、低过渡密度和高过渡密度模式。所有这些组合，但低频频谱含量类可在相对较短的测试时间间隔内进行，以获得良好的抖动性能测量。
而低频模式则需要在较长的时间间隔内进行测试，才能观察到低频抖动对接口的影响。

##### 高速串行化的接口 
#### ATA国际组织 

复合模式(COMP)强调链路内的接口元件的低频和高频抖动，测试元件，以及由于边缘接收器输入电路或接口元件引起的各种幅度失真。
需要注意的是，对于总共只有128个Dword的序列，128-Dword的复合模式太短，无法得到每个模式类型的足够数量的连续重复。
## ＃＃表45 - 以RD-为起点的复合比特模式（COMP）。
传送令^
D31.3(7Fh)- D31.3(7Fh)+ D31.3(7Fh)- D31.3(7Fh)+
- 1010 1100 1101 0100 1100 1010 1100 1101 0100 1100 A C D 4 C A C D 4 C------。
以上Dword长版共重复256次。
上面的D字在短版中共重复了16次。
D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)-
- 1010 1010 1010 1010 1010 10101010 1010 1010 1010 1010 A A A A A A A A A A A A------。
以上Dword长版共重复64次。
上面的D字在短版中共重复了4次。
D24.3(78h)- D24.3(78h)+ D24.3(78h)- D24.3(78h)+ - D24.3(78h)

          上面的D字在短版中共重复4次。
D10.2(4Ah)- D10.2(4Ah)- D10.2(4Ah)- D10.2(4Ah)- - D10.2(4Ah)- - D10.2(4Ah)- - D10.2(4Ah)-

          上面的D字在短版中共重复4次。
D25.6(D9h)- D6.1(26h)+ D25.6(D9h)- D6.1(26h)+ - D25.6(D9h)- D6.1(26h)+ -
- 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 9 9 9 9 以上 Dword 长版共重复 64 次。
       上面的D字在短版中共重复4次。
D17.7(F1h)- D30.7(FEh)+ D7.1(27h)+ D14.7(EEh)+ - -
- 1000 1101 1110 0001 1110 0001 1110 0101 1100 1000 8 D E 1 E 1 E 5 C 8 ......。
D30.7(FEh)- D7.6(C7h)- D30.3(7Eh)- D30.3(7Eh)+ -
- 0111 1000 0111 1000 0110 0111 1000 1110 0001 1100 7 8 7 8 6 7 8 E 1 C  
传送令
D30.3(7Eh)- D30.3(7Eh)+ D30.3(7Eh)- D30.3(7Eh)+ -
- 0111 1000 1110 0001 1100 01111000 1110 0001 1100 7 8 E 1 C 7 8 E 1 C
以上Dword长版共重复509次。
上面的D字在短版中共重复了29次。
D3.7(E3h)- D28.7(FCh)+ D3.7(E3h)- D28.7(FCh)+ - D3.7(E3h)- D28.7(FCh)
- 1100 0111 1000 1110 0001 1100 0111 1000 1110 0001 C 7 8 E 1 C 7 8 E1 
D12.0(0Ch)- D11.4(8Bh)+ D12.0(0Ch)- D11.3(6Bh)+ D12.0(0Ch)
- 0011 0110 1111 0100 0010 0011 0110 1111 0100 0011 3 6 F4 2 3 6 F4 3 
D12.0(0Ch)+ D11.4(8Bh)- D12.0(0Ch)+ D11.3(6Bh)- - + 0011 0101 0011 0100 1101 0011 0101 0011 0100 1100 3 5 3 4 D 3 5 3 4 C
以上2个D字，长版共重复128次。
以上2个D字在短版中共重复8次。
D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)
- 0010 1101 0100 1011 0101 0010 1101 0100 1011 0101 2 D 4 B 5 2 D 4 B 5
以上Dword在长版中共重复255次。
上面的D字在短版中共重复了15次。
D20.2(54h)- D20.7(F4h)- D11.5(ABh)+ D11.5(ABh)+ 。
- 0010 1101 0100 1011 0111 1101 0010 1011 0100 1010 2 D 4 B 7 D 2 B 4 A 
D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ + + + 1101 0010 1011 0100 1010 1101 0010 1011 0100 1010
D 2 B 4 A D 2 B 4 A
以上Dword在长版中共重复255次。
上面的D字在短版中共重复了15次。
D11.5(ABh)+ D11.7(EBh)+ D20.2.(54h)- D20.2.(54h)- - + 1101 0010 1011 0100 1000 0010 1101 0100 1011 0101 ．
D 2 B 4 8 2 D 4 B 5
- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)- D21.5(B5h)  
##### 在附件处进行高速小型化。
#### ATA国际组织 
传输令 1010 1010 1010 1010 1010 1010 1010 1010 1010 1010 1010 1010 10101010
A A A A A A A A A A A A A A A A AA
以上Dword长版共重复64次。
上面的D字在短版中共重复了4次。
D24.3(78h)- D24.3(78h)- D24.3(78h)- D24.3(78h)- D24.3(78h)- D24.3(78h)- D24.3(78h)

       上面的D字在短版中共重复4次。
D10.2(4Ah)- D10.2(4Ah)- D10.2(4Ah)- D10.2(4Ah)- - D10.2(4Ah)- - D10.2(4Ah)- - D10.2(4Ah)-

       上面的D字在短版中共重复4次。
D25.6(D9h)- D6.1(26h)+ D25.6(D9h)- D6.1(26h)+ - D25.6(D9h)- D6.1(26h)+ -
- 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 9 9 9 9 以上 Dword 长版共重复 64 次。
          上面的Dword在短版中共重复4次。
             长版共计：2048个Dword共计 256DW SSOP 256DW HTDP (64DW, 64DW, 64DW, 64DW) 512DW LTDP (1DW, 1DW, 509DW, 1DW) 256DW LBP ((1DW,1DW) x 128) 512DW LFSCP (255DW, 1DW, 255DW, 1DW) 256DW HTDP (64DW, 64DW, 64DW, 64DW) 

简版共计：128个D字共计16DW SSOP 16DW HTDP（4DW，4DW，4DW，4DW） 32DW LTDP（1DW，1DW，29DW，1DW） 16DW LBP（（1DW，1DW）×8） 32DW LFSCP（15DW，1DW，15DW，1DW） 16DW HTDP（4DW，4DW，4DW，4DW）。
## 表46 - 以RD+.................................................... 为起点的复合比特码型(COMP)

传输顺序^
D31.3(7Fh)+ D31.3(7Fh)- D31.3(7Fh)+ D31.3(7Fh)- + 0101 0011 0010 1011 0011 0101 0011 0010 1011 0011 5 3 2 B 3 5 3 2 B 3 +
以上Dword长版共重复256次。
上面的D字在短版中共重复了16次。
D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ 1010 1010 1010 1010 1010 1010 1010 1010 10101010
A A A A A A A A A A A A +
以上Dword长版共重复64次。
上面的D字在短版中共重复了4次。
D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 3 3 3 3 3 3 3 3 +
以上Dword长版共重复64次。
上面的D字在短版中共重复4次。
D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ + 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 5 5 5 5 5 5 5 5 5 5 +
以上Dword长版共重复64次。
上面的D字在短版中共重复4次。
D25.6(D9h)+ D6.1(26h)+ D25.6(D9h)+ D6.1(26h)+ + 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 +
以上Dword长版共重复64次。
上面的D字在短版中共重复4次。
D14.7(EEh)+ D30.7(FEh)- D7.6(C7h)+ D17.7(F1h)- + + 0111 0010 0001 1110 0001 1110 0001 1010 0011 0111 7 2 1 E 1 E 1 A 3 7 ．
D30.7(FEh)+ D7.1(27h)+ D30.3(7Eh)+ D30.3(7Eh)- + + 1000 0111 1000 0111 1001 1000 0111 0001 1110 0011 8 7 8 7 9 8 7 1 E 3.
D30.3(7Eh)+ D30.3(7Eh)- D30.3(7Eh)+ D30.3(7Eh)- + + 1000 0111 0001 1110 0011 1000 0111 0001 1110 0011 8 7 1 E 3 8 7 1 E 3
以上Dword长版共重复509次。
上面的D字在短版中共重复了29次。

##### 高速 SERIALIZED ATTACHMENT (高速) 
#### ATA国际组织 
传送令
D28.7(FCh)+ D3.7(E3h)- D28.7(FCh)+ D3.7(E3h)- + + 0011 1000 0111 0001 1110 0011 1000 0111 0001 1110 3 8 7 1 英 3 8 7 1 英
D12.0(0Ch)+ D11.4(8Bh)- D12.0(0Ch)+ D11.3(6Bh)- - + 0011 0100 0011 0100 1101 0011 0101 0011 0101 1100 3 5 3 4 D 3 5 3 4 C
D12.0(0Ch)+ D11.4(8Bh)- D12.0(0Ch)+ D11.3(6Bh)- +。
- 0011 0110 1111 0100 0010 0011 0110 1111 0100 0011 3 6 F 4 2 3 6 F 4 3 以上2个D字，长版共重复128次。
以上2个D字在短版中共重复8次。
D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ D11.5(ABh)+ + + 1101 0010 1011 0100 1010 1101 0010 1011 0100 1010
D 2 B 4 A D 2 B 4 A
以上Dword在长版中共重复255次。
上面的D字在短版中共重复了15次。
D11.5(ABh)+ D11.7(EBh)+ D20.2.(54h)- D20.2(54h)- - + 1101 0010 1011 0100 1000 0010 1101 0100 1011 0101。
D 2 B 4 8 2 D 4 B 5 
D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)- D20.2(54h)
- 0010 1101 0100 1011 0101 0010 1101 0100 1011 0101 2 D 4 B 5 2 D 4 B 5
以上Dword在长版中共重复255次。
上面的D字在短版中共重复了15次。
D20.2(54h)- D20.7(F4h)- D11.5(ABh)+ D11.5(ABh)+ 。
- 0010 1101 0100 1011 0111 1101 0010 1011 0100 1010 2 D 4 B 7 D 2 B 4 A  
传送令
D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ D21.5(B5h)+ + + 1010 1010 1010 1010 1010 1010 1010 1010 1010 10101010
A A A A A A A A A A A A A A A A AA
以上Dword长版共重复64次。
上面的D字在短版中共重复了4次。
D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ D24.3(78h)+ + + 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 3 3 3 3 3 3 3 3 3 3 3 33
以上Dword长版共重复64次。
上面的D字在短版中共重复4次。
D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ D10.2(4Ah)+ + + 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 0101 5 5 5 5 5 5 5 5 5 55
以上Dword长版共重复64次。
上面的D字在短版中共重复4次。
D25.6(D9h)+ D6.1(26h)+ D25.6(D9h)+ D6.1(26h)+ + + 1001 1001 1001 1001 1001 1001 1001 1001 9 9 9 9 9 9 9 9 9 9 9 9 9 99
以上Dword长版共重复64次。
以上D字在短版中共重复4次。
长版共计：2048个Dword共计256DW SSOP 256DW HTDP (64DW, 64DW, 64DW, 64DW) 512DW LTDP (1DW, 1DW, 509DW, 1DW) 256DW LBP ((1DW,1DW) x 128) 512DW LFSCP (255DW, 1DW, 255DW, 1DW) 256DW HTDP (64DW, 64DW, 64DW, 64DW)
简版共计：128个D字共计16DW SSOP 16DW HTDP（4DW，4DW，4DW，4DW） 32DW LTDP（1DW，1DW，29DW，1DW） 16DW LBP（（1DW，1DW）×8） 32DW LFSCP（15DW，1DW，15DW，1DW） 16DW HTDP（4DW，4DW，4DW，4DW）。
需要注意的是，复合模式的总字数只有128个Dword，太短了，无法为每种模式类型获得足够的连续重复次数。

简版共计：12
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.2.5 热插拔注意事项 **7.2.5.1 热插拔概述**。
本节的目的是提供串行ATA主机或设备被声明为 "可热插拔 "所需的最低规范要求。由于存在各种
热插拔事件，每一种类型的事件都有相关的电气和操作限制。这些事件定义如下，Hot-Plug Capability进一步分为：a) Surprise Hot-Plug capability b) OS-Aware Hot-Plug capability。
当主机或设备在没有任何限定词的情况下被声明为可热插拔时，这意味着该SATA接口是可突击热插拔的。
在本规范中，热插拔操作被定义为SATA主机和设备之间的插入或移除操作，当接口的任何一边供电时。
Gen1x/Gen2x/Gen1m和Gen2m接口必须满足以下要求，才能被归类为
热插拔能力。这些要求不适用于Gen1i和Gen2i有线接口，但是，在短背板应用中使用的Gen1i/Gen2i设备应具有热插拔能力。
热插拔能力的主机/设备不应受到任何电气损坏或永久的电气性能下降，并应在热插拔事件后，在适用的OOB操作后恢复合规的Tx/Rx操作。
- 异步信号热插拔/移除：**信号电缆随时被插入/拔出。由于主机/设备的电源是通过与信号电缆无关的替代机制获得的，因此主机/设备的电源仍然处于开启状态。这适用于外部单通道和多通道有线应用。
- 未通电的OS-Aware热插拔/移除：** 这定义为将设备插入/移除到已关闭电源的背板连接器（结合信号和电源）。在移除之前，主机被置于静止状态（此处未定义），并从背板连接器中移除设备的电源。插入后，背板供电；设备和主机都会初始化，然后正常工作。
    这里没有定义背板电源的开/关和主机进入/退出 "静止 "状态的机制。在OS-Aware事件期间，主机将被供电。
    这适用于 "短 "和 "长 "背板应用。
- **Powered OS-Aware Hot Plug / Removal:** 这定义为将设备插入/从已开机的背板连接器（结合信号和电源）中移除。插入后，设备和主机都会初始化，然后正常运行。在插入或移除之前，主机被置于静止状态（此处未定义），但设备的背板连接器一直处于供电状态。这里没有定义将主机转换到/退出 "静止 "状态的机制。在OS-Aware事件期间，主机是供电的。这适用于 "短 "和 "长 "背板应用。
- 惊喜热插/移除：**这定义为将主机或设备插入/移除到已开机的背板连接器（结合信号和电源）。插入后，设备和主机都会初始化，然后正常运行。通电的主机或设备不处于静止状态。

注意：这并不意味着系统级操作的透明恢复，因为数据可能会丢失，设备可能需要重新发现和初始化等。无论上述定义如何，都不建议移除仍在旋转的设备，系统设计者应防止这样做。
**7.2.5.2 电气要求**。 
必须采用交流耦合。额外的热插拔电气特性应包括考虑：共模瞬变、ESD和驱动体放电。
**7.2.5.3 共模瞬态（信息）**。
热插拔能力SATA组件的设计是为了处理热插拔事件，这是一项要求；本信息部分强调了热插拔操作期间遇到的最大瞬态事件。本节举例说明了表29中的一些热插拔相关规格（序列瞬态电压和共模瞬态结算时间），其中显示了对主机/设备的影响。
共模瞬态引起的最大电流受到Vcm和最小单端阻抗42.5欧姆的限制。因此，最坏的浪涌电流将是2 V / 42.5 Ohms = 47 mA。该电流的持续时间受时间常数C * Rtx ~ 0.5微秒的限制。假设ESD二极管不导通，通过在受害者端提供共模终端，该电流应进一步降低。
Vcm
Rrx
Rtx
##### C 
## 图132 - 共模瞬态电路示例 0 < Vcm < 2 V 21.25 < Rtx < 40 Ohms 21.25 < Rrx < 40 Ohms

C < 0.024 uF (两个0.012 uF电容器并联) 
"侵略者 "端瞬态传输到 "受害者 "端的最大电压步长为最大Vcm。这个电压加到 "受害者 "端的现有偏置电压上。由于终端器没有最大的单端限制，所以任何电阻分压器都不能保证减少这个步骤。然而，"受害者 "端的电压瞬变可能会受到ESD二极管结构的箝位作用的限制。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 **7.2.5.4 ESD(资料性)**。
对SATA连接器的接口引脚没有ESD要求。但是，建议热插拔主机和设备中使用的半导体符合以下ESD规格。
接收器和发射器半导体信号引脚和电源引脚应能承受至少2000V的电压，使用JEDEC EIA-JESD22-A114-B静电放电(ESD)的测试方法。
灵敏度测试人体模型（HBM）。
接收器和发射器的半导体信号引脚应能承受500 V，符合JESD22-C101-A标准。
静电放电-耐受性的现场诱导带电设备模型测试法。
微电子元件的阈值。
**7.2.5.5 驱动体放电(资料性)**。
对于所有串行ATA背板系统，设备罐或外壳应提供足够的电气连接，以便在连接器配接之前，将静电电位从设备本体地线释放到外壳地线。强烈建议所有Serial ATA背板系统，以及用于热插拔设备的设备罐，将导轨设计成导电的。设备罐应设计成与设备地有电气接地连接，罐系统内的导轨应连接到系统地。

#### 7.2.6 配套连接器对定义..........................................................................。

接收机和发射机的符合点在设备/主机I/O处，包括配接的连接器对。
图133显示了配接连接器对的细节。符合点包括插座引脚的 "尾部"。图134显示了插座引脚尾部的物理描述。
P lu g
设备/主机参考
飛機
合规
点
串行ATA
匹配的连接器对 
Rep ta cl e
## 图133 - 匹配的连接器对 
信号接口与配接对连接器引脚尾部的连接应注意尽量减少寄生电容或电感。连接器引脚、尾部是一条共面波导传输线，呈地、信号、信号、地（GSSG）配置。引脚、尾部的信号接口应保持GSSG配置。
R e c e p ta c le 2.3 0.8 1.27
## 图134 - 配套连接器对，引脚尾部细节  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.2.7 合规互连通道（Gen1x、Gen2x、Gen3i）。
顺应性互连通道被定义为一套应用于发射机配接连接器的校准物理测试电路，旨在代表损耗最高的互连。
顺应性互连通道（CIC）用于验证发射机配接连接器上的信号电气特性是否足以确保符合Gen1x、Gen2x和Gen3i接收机通过最坏情况介质传输的输入电气规格。这种最坏情况下的损耗作为频率函数的大小在数学上定义为发射机顺应性传递函数（TCTF）。有一个Gen3i TCTF。
Gen2x TCTF和Gen1x TCTF。任何线性的、无源的、差分的双端口（如SATA电缆），在所有频率下的损耗都大于TCTF，并且满足ISI损耗限制（定义如下）的，都被定义为CIC。(另见7.2.7.1.1节)。
一个零长度的测试负载（即实验室负载）加上适用的CIC（Gen1x/Gen2x/Gen3i）的组合被用来规范主机-控制器或设备发射器的特性。
Gen1x/Gen2x/Gen3i发射机信号的规定是：1: 1. 向实验室负载发射时，满足表31^1中Gen1x、Gen2x或Gen3i的所有参数。
2. 2. 当通过适当的 Gen1x 或 Gen2x CIC 向实验室负载传输信号，同时使用与第一次测试相同的发射机设置（重音、振幅等）时，满足表 31 中对 Gen1x 或 Gen2x 的输入摆动（VdiffTX）和抖动（CIC 后的 TJ 和 DJ）要求^2 （见 7.4.5 和 7.4.9 节）。当通过适当的Gen3i CIC向实验室负载传输时，在使用与第一次测试相同的发射机设置（强调、振幅等）时，满足表31对Gen3i的输入摆动（VdiffTx）和总抖动（CIC后的TJ）要求。

传输幅度响应。
 |Gen3i TCTF的S 21满足以下两个不等式^3 。| S 21 | ≤ -20 log 10 (e) {[3.0 x 10-6 (f 0.5)] + [1.1 x 10 -10 (f)] } dB for 50 MHz < f < 9.0 GHz, (f 以Hz表示), | S 21 | at 600 MHz - | S 21 | at 3000 MHz > 2.7 dB (^1) 注意，发射机顺应性规格是定义和测量成的。
实验室负载。由于实际接收机终端器的容差而导致的接收信号衰减或放大，以及由于实际接收机回波损耗而导致的额外接收信号ISI可能会进一步降低实际接收机的输入信号。发射机符合性规格预计只比接收器规格稍严。
(^2)虽然本规范不允许，但第二项要求可以通过TCTF对HBWS捕获的信号进行近似处理，仅使用以下方法来实现
第一个要求中的实验室负荷。
(^3)请注意，第一个表达式中的 "e "是自然对数的基数，约为2.71828。因此，第一个系数20 log 10 (e)，评价为约8.6859。该值是由奈培尔（定义为功率比的自然对数）到分贝的转换系数。
 
## 图135 - Gen3i的顺应性通道损耗 
第二个约束条件，称为ISI损耗，可以激励如下。|在十分之一的数据速率下，S21是一个重复的5-1-5-0模式的基本分量的衰减，这是8b/10b编码数据中最长的运行长度。同样，在一半的数据速率下，｜S 21｜是一个重复的...010101...模式的基本分量的衰减，是8b/10b编码数据中最短的运行长度。因此，对于这种TCTF的输出波形，ISI损耗近似于a)峰-峰电压(由长运行长度建立)和b)内垂直眼开度(由高频图案建立)之间的比率。任何
具有更平坦损耗特性（即具有更多宽带衰减）的TCTF将产生更少的符号间干扰（ISI），从而减少输出抖动。这个限制条件禁止了这样的TCTF。
TCTF的传输幅值响应，｜S 21｜，满足以下三个不等式^4：
Gen2x TCTF的传输幅度响应，|S 21 |，满足以下三个不等式^4 。| S 21 | ≤ -20 log 10 (e) {[1.7 x 10-5 (f 0.5)] + [1.0 x 10 -10 (f)] } dB for 50 MHz < f < 3.0 GHz, (f 以Hz表示), | S 21 | ≤ -10.7 dB for 3.0 GHz <f < 5. 0 GHz，且 | S 21 | 在 300 MHz - | S 21 | 在 1500 MHz > 3.9 dB (^4) 请注意，第一个表达式中的 "e "是自然对数的基数，约为 2.71828。因此，第一个因子，20 log 10 (e)，评估为大约8.6859。这个值是由奈培尔（定义为功率比的自然对数）到分贝的转换系数。
-11.1分贝 3.0 9.0
S 21 0 0.6
ISI 损耗 > 2.7dB
样品
合规
互联
频率(千兆赫)  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 -10.7dB 1.5 3.0
S 21 0 0.3
ISI损耗>3.9dB
样品
合规
互联
频率(千兆赫)
## 图136 - Gen2x的合规通道损失。
第三个约束条件，称为ISI损耗，可以激励如下。|在十分之一的数据速率下，S21是一个重复的5-1-5-0模式的基本分量的衰减，这是8b/10b编码数据中最长的运行长度。同样，在一半的数据速率下，｜S 21｜是一个重复的...010101...模式的基本分量的衰减，是8b/10b编码数据中最短的运行长度。因此，对于这种TCTF的输出波形，ISI损耗近似于a)峰-峰电压(由长运行长度建立)和b)内垂直眼开度(由高频图案建立)之间的比率。任何
具有更平坦损耗特性（即具有更多宽带衰减）的TCTF将产生更少的符号间干扰（ISI），从而减少输出抖动。这个限制条件禁止了这样的TCTF。
TCTF的传输幅度响应，|S 21|，满足以下三个不等式：
Gen1x TCTF的传输幅值响应，|S 21|，满足以下三个不等式。| S 21 | ≤ -20 log 10 (e) {[1.7 x 10-5 (f 0.5)] + [1.0 x 10 -10 (f)] } dB 对于50 MHz < f < 1.5 GHz，(f用Hz表示)，| S 21 | ≤ -7. 0 dB，1.5 GHz < f < 5.0 GHz，且| S 21 |在150 MHz -| S 21 |在750 MHz > 2.0 dB -7.0dB 0.75 1.5。
S 21 0 0.15
ISI损耗 > 2.0dB
样品
合规
互联
频率(千兆赫)
## 图137 - Gen1x的合规通道损耗 **7.2.7.1.1合规互连通道的校准**。
TCTF定义了最坏情况下的损耗，不包括从发射机到接收器的两个SATA连接器。然而，由于这两个连接器造成的损耗应包括在发射机特性中。也就是说，发射机应在TCTF定义的损耗加上两个匹配的SATA连接器对的情况下进行测试。
对于使用SMA连接器实现的CIC。
 从图145中可以看出，在CIC之后增加一个SATA适配器（插头），并驱动到实验室负载中，可以提供所需的TCTF总损耗（体现在CIC损耗中），加上两个SATA连接器的损耗。
#### 7.2.8 阻抗校准(可选) 
主机和设备可采用片上自适应阻抗匹配电路，以确保其发射机和接收机的最佳终端。
由于主机在开机序列中获得了第一次校准的机会，因此不能认为电缆的远端已经校准。出于这个原因，主机控制器应该利用一个单独的基准来执行校准。在桌面系统中，电缆为校准提供了最佳阻抗参考。
利用时域反射测量(TDR)技术，主机可以从其发射器发射一个阶跃波形，从而获得发射器相对于电缆的阻抗测量，并根据需要调整其阻抗设置。
在移动系统环境中，当电缆很小或不存在时，主机控制器应利用一个单独的基准(如准确的片外电阻)进行校准阶段。
另一方面，设备可能会假设电缆远端（主机侧）的终端已完全校准，并可能将其作为参考。使用主机端接 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织作为校准参考，允许在桌面和移动系统环境下运行的设备使用相同的硬件。
为阻抗校准过程产生的信号不得与OOB信号重复。
COMWAKE、COMINIT 或 COMRESET。阻抗校准过程中产生的信号不得超过第 7.2 节所述的正常工作电压水平。请参阅电源管理部分，了解开机期间执行校准的建议时间。
### 7.3 抖动 
抖动是指零点交叉点与理想位置在时间上的短期变化。抖动是指时间上从理想位置到零点的短期变化。
时钟"（在7.3.2节中定义）定义了时间上的理想位置。参考时钟法规定了抖动与SSC的分离，跟踪SSC和其他低频调制，但不跟踪抖动。抖动有几种类型，分为两类：确定性抖动和随机性抖动。确定性抖动是有界的，随机抖动不是。可容忍的抖动量受到信道所需的误码率性能的限制。在分析中使用两类抖动，因为它们的累积方式不同。
串行ATA数据流采用嵌入式时钟，没有单独发送时钟信号。在接收器处，Serial ATA数据流被重新时钟化，形成一个并行数字信号。这个过程需要足够的时序余量才能正常工作。抖动分析是在具有嵌入式时钟的系统中使用的时序分析。
在SATA系统中，随机抖动是总抖动的重要部分，导致偶尔发生错误。当发生位错误时，当接收到整帧的位时，就会检测到错误。
通过重新传输该帧来纠正位错误。如果在一帧内发生两个比特错误，纠正措施是一样的。帧重传时，信道上的数据吞吐量会降低。帧错误率是衡量信道性能的指标。
由于一部分抖动是随机的，所以对抖动的测量也具有随机性。也就是说，重复测量得到的结果是有一定差异的。随着每次测量样本量的增加，测量结果的扩散性也会降低。随机抖动的测量值是根据已知的置信度来确定的。
帧错误率测试是在兼容SATA的组件组合上进行的系统性能测试。要获得具有统计学意义的帧错误率估计值，必须有较大的样本量。在SATA通道上进行的帧错误率测试是漫长的，在Gen2速率下需要大约一个小时。
抖动测试是对单个SATA组件、设备、主机或互连进行的合规性测试，以确保系统性能。合规性测试有助于预测合规组件组合的性能。通常情况下，我们希望在短时间内而不是几个小时内进行抖动测量。因此，抖动测量是用小样本量进行的，并将结果外推以预测较大样本量的结果。
从小样本量到大样本量的结果外推涉及到假设。本规范定义了两个假设为规范性假设。第一，随机抖动具有高斯分布。第二，总抖动是确定性抖动加上随机抖动标准差的14倍之和。这些可以将确定性抖动和随机性抖动分开。
 以及对等效误码率10-12的总抖动的估计，其样本量要小得多。

#### 7.3.1 抖动定义 
抖动被定义为数据转换与相关参考值之间的时间差。
时钟事件。接收机的抖动是传输路径中总抖动的结果。
首先，抖动是在发射机中数据的时钟化过程中产生的。然后，发射机和接收机之间信道中的每个元素都会影响抖动。最后，接收机应能在抖动的情况下恢复数据，否则会出现错误。接收机的抖动容限应大于发射机产生的抖动和通过信道的预期抖动累积。
抖动预算取决于期望的误码率(BER)。SATA假设误码率的目标是小于10-12。抖动水平被定义为数据的参考时钟。参考时钟是使用PLL（硬件）或时钟恢复算法（软件）从串行数据流中提取的。
参考时钟到数据的抖动方法允许使用扩频时钟或非扩频时钟对设备或主机进行抖动测量。
#### 7.3.2 参考时钟定义 
参考时钟被定义为从串行ATA数据流中恢复的时钟。参考时钟是指从串行ATA数据流中恢复的时钟。
参考时钟提供了扩频时钟（SSC）和抖动之间的区别。
参考时钟跟踪SSC和抖动，但不跟踪抖动。此外，它还提供了确定SSC曲线的定义。参考时钟的提取是通过硬件或软件PLL进行的。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **7.3.2.1 Gen1i、Gen1m、Gen2i和Gen2m规范要求**。
对于Gen1i、Gen1m、Gen2i和Gen2m，参考时钟特性是由由此产生的JTF(抖动传输函数)特性控制的，该特性是通过取2型PLL输出(参考时钟)与源至PLL的数据流之间的时间差获得的。
PLL CLTF-3 dB角频率，以及其他可调节的CLTF参数，如峰值，由满足JTF要求的值决定。参见7.4.7节
(联合工作队资料)
基因1i和基因1m的联合TF对于编码的基因1来说，应具有以下特点： 1.
D24.3模式（1100110011 0011001100）。这是Gen1的MFTP，它是一种测试模式，具有类似时钟的特性，过渡密度为0.5。
Gen2i和Gen2m的JTF对于编码的Gen2来说，应具有以下特性： 1.
D24.3模式（1100110011 0011001100）。这是Gen2 MFTP，它是一种具有类似时钟特性的测试模式，过渡密度为0.5。
1）1）JTF的-3dB角频率应如表31抖动传输所示。
功能带宽（D24.3，高通-3dB）。
2）JTF的幅度峰值应如表31抖动传递函数所示。
峰值。
3）抖动传递函数低频衰减测量时的衰减。
表31中的频率应如表31抖动传递功能低。
频率衰减。
JTF-3dB角频率和幅度峰值要求应在施加正弦PJ的情况下进行测量，峰峰值幅度为0.3UI+/-10%。衰减在30
KHz应采用正弦相位(时间)调制方式测量，峰峰值幅度为20.8 ns +/- 10%。
**7.3.2.2 Gen1i、Gen1m、Gen2i和Gen2m资料性评论**。
典型的CLTF-3 dB角频率fBAUD /500可以提供一个接近要求的JTF特性，但由于2型PLL设计的差异，满足所需的JTF所需的实际CLTF设置可以有很大的差异。
希望JMD（报告抖动/应用抖动）的JTF的相位响应是2型PLL的输出到应用于数据流的时间差的JTF。
PLL。这是参考设计。在存在多个抖动分量频率的情况下，这些频率的相对相位决定了如何将它们组合起来，以构建最终的报告抖动值。在报告的抖动水平之间有差异的情况下，在
具有相同JFT幅值响应的JMD，JTF相位特性与参考设计最接近的JMD，才算正确。的JTF相位响应。
JMD是很重要的，但如果没有关于JMD处理方法的专有信息，就不一定能确定这一点，而且在某些类的JMD处理方法中，它是无法从外部观察到的。
JMDs。
2型PLL的输出到数据流的时间差的JTF应用于
PLL，或参考设计，定义了一个过渡密度为0.5的模式。由于这种2型PLL包含一个采样数据模式相位检测器，其增益随过渡密度成比例变化。
 JTF-3 dB角频率将随着应用模式的过渡密度而变化。对于一个设计良好的PLL，在开环响应中具有显著的相位余量，JTF-3dB角频率，会随着模式过渡密度的变化而成比例地移动。例如，2.1 MHz的JTF-3dB角频率，设置为过渡密度为0.5的模式，当应用过渡密度为1.0的模式，如D10.2模式时，将移到4.2 MHz。与0.5过渡密度相比，降低模式过渡密度时，也会观察到JTF-3dB角频率的比例降低。这就是预期的JMD对图案过渡密度变化的响应，因为参考设计会表现出这种情况。如果JMD以不符合这一特性的方式移动JTF-3dB角频率，或者根本不移动，那么对过渡密度明显不同于0.5的模式的抖动的测量可能会导致报告的抖动水平的差异。在JMD之间报告的抖动差异的情况下，具有-3dB角频率偏移的JMD，最接近参考设计的比例特性，它被认为是正确的。该特性可以使用上述测量-3dB角频率的条件，使用不同过渡密度的多个模式进行测量。
**7.3.2.3 Gen1x和Gen2x的规范要求**。
对于Gen1x和Gen2x，参考时钟PLL定义为2型PLL，角频率fc3dB=fBAUD /1667，给定过渡密度为1.0（对应于1010101010时钟样模式），阻尼系数=0.707最小至1.00最大。
**7.3.2.4 Gen3i规范要求**。
对于Gen3i来说，参考时钟的特性由产生的JTF（抖动传输）控制。
功能）特性，通过取第2类PLL输出（参考时钟）与源至PLL的数据流之间的时间差获得。PLL CLTF-3 dB角频率，以及其他可调节的CLTF参数，如峰值，由满足JTF要求的值决定。见7.4.8节的JTF信息）。
Gen3i的JTF对编码的Gen3 D24.3模式(1100110011 0011001100)应具有以下特征。这是Gen3的MFTP，它是一种具有类似时钟特性和过渡密度为0.5的测试模式。
1）JTF的-3 dB角频率应为4.2 MHz +/- 2 MHz.如表31所示。
抖动传递函数带宽（D24.3，高通-3dB）（Gen3）。
2）JTF的幅度峰值最大应为3.5dB，如表31所示。
抖动传递函数峰值（Gen3）。
3）420KHz时的衰减+/- 1%抖动传递函数低频衰减。
表31中的测量频率（Gen3）应为38.2 dB +/- 3 dB。
表31 抖动传递函数低频衰减（Gen3）。
JTF-3dB角频率和幅度峰值要求应在施加正弦PJ的情况下测量，峰-峰值幅度为0.3 UI +/- 10%。420KHz处的衰减应在施加正弦相位（时间）调制的情况下测量，峰峰值振幅为1.0ns+/- 10%。衰减是在40 dB/Dec斜率的JTF上测量的，在-3 dB角频率标称目标值的1/10处。这相当于在60KHz的理想40dB/Dec斜率下的72dB，与Gen2i相比，Gen3i的JTF BW增加了2倍。这种测量点的转变，可以提高实际测量效果，降低测试信号相位调制电平要求。
#### 7.3.3 扩频时钟 
串行ATA允许使用扩频时钟，或有意对发射机时钟进行低频调制。这种调制的目的是分散频谱能量，以减轻对无线电服务的无意干扰。SSC的调制频率应在表29中为fSSC定义的范围内。
调制频率偏差应在表29中对SSCtol的规定范围内。参考时钟的瞬时频率（每个周期）应在规定的TUI范围内。如果瞬时频率变化率过大，则抖动增大。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
SSC调制只是将频率移动到标称频率以下。这种技术通常被称为 "下展"。
7.3.3.1 示例 SSC 配置图（信息型
图138所示为三角频率调制曲线示例。一个调制周期内的调制曲线表示为：。
#####  
#####  
#####  
#####  
#####  
#####  
##### + a < < 
##### a + < < 
##### = 
##### ( ) , 
##### ( ) ；m m nom m nom m nom m nom f。
##### 1 t 2 f
##### 1 1 f 2 f f t 当2 f时。

##### 1 _1 f 2 f f t 当0 t f_ 其中fnom为非SSC模式下的标称频率，fmis为调制频率，为调制量，t为时间。
t 0.5 / fm 1 / fm fnom (1-)fnom
## 图138 - SSC概况示例。三角形 
以三角调制为例，图139所示为其频谱分布的宽度，在基频处的绝对传播量。

最高峰 
非SSC
SSC fnom of fnom
## 图139--光谱基频比较。
#### 7.3.4 抖动预算.........................................................................................................。

抖动有两种类型，随机抖动（RJ）和确定性抖动（DJ）。随机抖动是
高斯，且无边界。为方便起见，将标准差（RJ）乘以一个系数，该系数对应于目标误码率。对于目标误码率=10-12，相关的乘法系数为
串行ATA为14。
总抖动(TJ)为峰-峰，定义为。
##### TJ = (14 * RJ) + DJ 
表31和表33显示了符合要求的抖动值。抖动的测量将在7.4.8节中描述。
### 7.4 测量 
主机和设备连接在一起的SATA系统的性能是通过帧错误率来衡量的，使用一组参考帧，由帧内特定的一组有序测试模式定义。通过使用 BIST 激活 FIS 或其他供应商对被测设备的独特命令，命令主机或设备生成各种测试模式。
设备和主机的测量是为了确定是否符合本规范。
合规性测试是通过连接到测试设备的设备或主机来完成的。合规性测试不与连接在一起的设备和主机一起进行。除非另有规定，所有的符合性测量都应通过配接的连接器对进行。
表31中规定的数值是指被测设备在配接连接器处向实验室负载输出的信号。当连接到系统电缆或背板时，这些信号没有被指定。

##### 在连接处的高速小型化。
#### ATA国际组织 
表33中规定的数值是指来自任何信号源的输入信号，在被测设备上用实验室负载测量。
组成系统的各个组件都会影响系统的性能，而不是简单地将低级参数相加。有许多相互作用以及协议影响，如重试算法。
本规范的根本是对UUT（被测单元）的明确定义。UUT由主机/设备和配对连接器的插座侧组成。这就将信号放置在测试测量设置中的一个点上，在这个点上，UUT的所有规格都被定义在50欧姆的阻抗水平上，每条信号线对地的阻抗为100欧姆差分和25欧姆共模阻抗。这是主机和设备的符合点。
串行ATA Phy层的符合性应采用参数法进行测试。该方法使用重复模式和实验室负载，以便对被测设备进行准确、可重复的测量。
对几个参数的额外测量方法旨在提供快速的No-Go测试。这些方法使用任何有效的数据模式和实验室负载来快速生成被测设备性能的视觉 "图像"。例如，一种测量方法使用
数据眼来快速了解抖动。另一种使用模式测量来识别具有单一振幅值的潜在复杂信号。然而，这些No-Go测量方法都不能用于测试是否符合电气规范。这些测量方法对于获得有关被测装置性能的有用信息是很有价值的，这不仅仅是规范符合性问题。
两种方法都能产生电气性能的测量结果，但是，参数法应用于验证被测装置是否符合7.2节中的串行ATA要求，而其他方法可作为一般的No-Go测试。
#### 7.4.1 帧错误率测试 
帧错误率是衡量链路性能的指标，是一种系统级测试。由于除帧期间外，位错误被忽略，所以在系统运行过程中，帧错误率测试被作为衡量信道性能的方法。
串行ATA在帧级的错误检测采用CRC（Cyclic Redundancy Check）错误检测机制，并分别向上层报告。由于所有的帧都包括一个头和CRC字段，所以计算时在帧错误规范中包括这些开销字节。
比特错误率是衡量原始信道性能的指标，与Phy参数密切相关。8b/10b编码和SATA协议使位错率的测量变得复杂。
 一个位错误可能会导致几个相关的错误一起发生，这反过来又可能导致多个位错误计数。一个字符中可能会有一个单位错误，导致违码错误。后面的一个字符可能会出现差异性错误，是由同一个单位错误引起的。由于8b/10b编码，单位错误有很大的概率造成字节错误，或8b/10b码违规错误，因此单位错误相当于8位或10位错误。接收器检测到的缺失或多出的一个比特，会转化为一系列的错误，这些错误跨越多个字节边界，直到通过ALIGNPprimitives进行比特重新对齐。
在以下条件下，如果BER=0，那么FER也=0。因此，BER=0意味着
FER=0，任何产品在要求的置信度下，实现误码率为零的接收机性能，也满足误码率要求。反之则不一定 **7.4.1.1 帧误码率模式**。
帧错误率模式包含了位错误率测试位模式和序列模式的要素，从而对系统中的串口进行彻底的加压，同时利用上层的CRC错误检测，并从下层协议层向报告
应用层。
帧模式应由7.2.4.3.6节中引用的复合模式的集合组成，但对参数进行了扩展，以实现最大的帧长度。
请注意，所显示的符合要求的图案是线上预期的图案。当使用正常的FIS有效载荷机制发送时，FIS内的数据是经过加扰的。为了使正确的模式出现在网线上，需要执行 "预扰乱"，以便在传输层执行有效载荷扰乱后，指定的模式出现在链路上。
**7.4.1.2 帧错误率测量**。
在任何给定的8b/10b模式（包括帧错误）测试时，帧错误率（FER）应在95%的置信水平下测量和计算不大于8.200*10-8。
7.4.1.1节中引用的速率参考模式。串行ATA CRC错误检测机制用于测量FER。
帧错误率是根据数据FIS的最大尺寸，加上FIS头和CRC字的开销计算的。帧错误率假设目标位错误率为10-12。
# ( ) 12 8
## FER 8192 8 10 10 8.200 10  
## =+××=× 
需要注意的是，引用模式应出现在网线上，参考模式的参数应扩展到最大帧长8192用户有效载荷字节。
**7.4.1.3 实现目标置信度的数据传输量（告知性）**。
由于这是一个统计过程，每个测量值都有一个与传输帧数相关的置信度。例如，只有在给定的样本大小和错误阈值如表47所示的情况下，才应该声明接口帧错误率性能已经达到了置信度。
## 表47 - 帧错误率置信度与样本大小的关系表 
样品
尺寸(帧数)
帧错误数
##### 0 1 2 3 4 5 6 7 8 9 10 1.22*10^7 63.21%26.42% 8.03% 1.90% 0.37% 0.06% 0.01% <0.01%<0.01%<0.01%<0.01% 1.22*10^8 >99.99%99.95%99.72%98.97%97.07%93.29%86.99%77.98%66.72%54.21%41.70%
在给定的错误率下，样本大小取为传输总帧数的10倍。
8 8
#### 1 
#### 10 1.22 10 
#### 8.2 10 
#### ×= × 
#### ×  
##### 在附件处进行高速小型化。
#### ATA国际组织 
当进行1.22*10^8帧通过的测试时，宣布帧错误率为8.200*10-8，置信度大于95%的最大帧错误数为4。
**7.4.1.4位错误率测试（告知性）**。
影响误码率性能的基本错误有两类：位错误和突发错误。
为了公平地评估误码率性能，比特错误以及突发错误被分开考虑。这是因为接收机检测到的一个缺失或一个额外的比特会转化为一系列的错误，这些错误跨越多个字节边界，直到通过对齐序列重新对齐。这一系列的错误被定义为突发错误。
另一种类型的字节错误存在于整个字节未被接收的情况下。从上层协议来看，它表现为字同步的损失。它引起的突发错误，其跨度可能受到下一个对齐序列的上层协议传输惯例的限制。
这些错误中的任何一个都可能导致几个相关的错误紧密地发生在一起，这又可能导致多个明显的位错误事件。例如，一个字符中可能会有一个单一的位错误，从而导致代码违规错误。后面的一个字符可能会出现差异性错误，是由同一个单一错误引起的。
所有这些事件最终都会在解码过程中被识别并导致帧错误。
注：突发错误率测量不得用于合规性测试。
**7.4.1.4.1 位错误率测量**。
比特错误率，如果按字节测量和计算，在用第7.4.1.1节引用的参考测试模式进行测试时，比特错误率应不大于10-12比特错误。
帧错误率的测量构成了本规范适用的测试要求的基础。关于FER和BER之间的关系，请参见7.4.1。
 **7.4.1.4.2 实现目标误码率所需传输的数据量**。
由于这是一个统计过程，每个样本量都有相关的置信度。例如，对于给定的样本大小和表48所示的错误阈值，只有在95%的置信度下，才能声明接口的比特错误率性能已经达到。
## 表48 - 比特错误率置信度与样本大小的关系。
样品
大小（位） 位错误事件数-阈值 0 1 2 3 4 5 6 7 8 9 10 1.00*10^12 63.21%26.42% 8.03% 1.90% 0. 37% 0.06% 0.01% <0.01%<0.01%<0.01%<0.01% 1.00*10^13 >99.99%99.95%99.72%98.97%97.07%93.29%86.99%77.98%66.72%54.21%41.70%
当进行10^13位通过的测试时，宣布位错误率为10-12，置信度大于95%的错误事件的最大次数为4次。
#### 7.4.2 差分电压幅值的测量（Gen1、Gen2）。
差分电压幅度VdiffTX，应测量代表性数据模式中的位。在此测试中，必须使用直流平衡的模式（否则会引入偏移，使测量的平均值偏移）。
下图140所示的测试设置显示了连接情况。
合规性
点
TX
来自UUT的信号
实验室负荷(LL)
发射机
测试中
##### HBWS 50欧姆 50欧姆 50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图140 - 差分电压幅度测量.........................................................。

被测发射机将测试图案发送到HBWS。与N位图案的一个完整周期相对应的差分电压波形，有一些单位间隔对应于0位，有一些单位间隔对应于1位。图141示出了等效时间范围上显示的一个例子。
##### HIGH SPEED SERIALIZED ATTACHMENT（高速串行化）。
#### ATA国际组织 
单位区间边界
位1 位1
位 0 位 0
## 图141 -- -- 差分电压幅度测量模式示例 **7.4.2.1 测试最小差分电压幅度**。
这种测试有两个单独的程序。然而，这两个程序都需要执行一套共同的步骤。这些步骤在下面标为 "共同步骤"。在这些步骤之后，是描述两个选项之一的程序的其余部分（标为 "选项1或选项2步骤"）。
**7.4.2.1.1 通用步骤**。
常见步骤1：传输HFTP图案，对于1位对应的单位区间(UI)，根据UI的波形时间间隔[0.45 UI，0.55 UI]中采集的n个样本构建直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x n 2 _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
上面的不等式是基于一个要求，即收集足够的样本来定义一个至少95%概率的置信区间，且宽度不大于样本平均值的10%。

计算出以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### UH = x a 
常见步骤2：传输HFTP模式，对于0位对应的单位区间(UI)，根据在波形时间间隔[0.45 UI，0.55 UI]中收集到的n个样本构建一个UI的直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### LH = x + 
常见步骤3：传输MFTP模式。
 对于对应于两个连续1位的字符串的第二个1位的单位区间(UI)，根据在该UI的波形时间间隔[0.45 UI，0.55 UI]中采集的n个样本构建一个直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
##### 在附件处进行高速小型化。
#### ATA国际组织 
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### UM = x a 
常见步骤4：传输MFTP图案，对于连续两个0位的字符串的第二个0位所对应的单位区间(UI)，根据在波形外延[0.45 UI，0.55 UI]中收集到的n个样本构建一个UI的直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### LM = x + 
共同步骤5：计算以下两个差值的最小值。
DH = UH - LH
DM = UM - LM
即计算DHM=min（DH，DM）。
该值用于以下两个选项的最后一步。
**7.4.2.1.2 孤位模式测量，选项1**。
如果测试环境允许创建一个模式触发器，LBP模式用于进行以下测量。继续从上面的共同步骤5的过程与以下步骤的选项1。
如果测试环境不允许创建模式触发器，则继续从上面的共同步骤5的程序与下面的选项2步骤6开始。
方案1步骤6：传输LBP模式，对于孤1位对应的单位间隔(UI)，根据UI的波形时间间隔[0.45 UI，0.55 UI]中收集到的n个样本，构建一个直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### A = x a 
方案1步骤7：传输LBP图案，对于孤零零的0位对应的单位区间(UI)，根据在波形时间段[0.45 UI，0.55 UI]收集到的n个样本构建一个UI的直方图。UI的直方图中的样本数(n)应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### B = x + 
方案一 步骤8：由步骤1和步骤2中得到的A和B，计算。
VTestLBP=A-B 
##### 在附件处进行高速小型化。
#### ATA国际组织 
然后取VTestLBP和之前计算出的DHM的最小值（来自普通步骤5），即。
VTest = min (VTestLBP, DHM)
在以下情况下，通过最小振幅的测试。
VTest > VdiffTX(Min)
VdiffTX(Min)见表31第1.1.1节。否则，最小差分电压幅值测试未通过。如果最小电压幅值测试失败，则应增加样本数 n，并对更多的样本数再次进行测试。如果没有达到测试通过的数值 n，则意味着没有达到规范中对最小差分电压幅值的要求。
**7.4.2.1.3 孤位模式测量的近似，方案2**。
测试最小差分电压幅度，而不需要创建模式触发器。
 继续上面普通步骤5的过程，选项2的步骤如下。
方案2步骤6：传输LFTP模式，根据在波形时间段[0.45 UI，0.55 UI]收集的n个样本，构建一个直方图，用于前面3个0位的字符串或前面4个0位的字符串后面的第1位的UI。要求直方图样本是两种情况下收集的样本的结合。UI的直方图样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### A = x a 
方案2步骤7：传输LFTP模式，根据波形震时[0.45 UI，0.55 UI]中收集的n个样本，对前面3个1位的字符串或前面4个1位的字符串后面的第一个0位的UI构造一个直方图。要求直方图样本是两种情况下收集的样本的结合。UI的直方图样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
计算以下数值。
#### ] 
#### 1. 96 
#### [ 
#### n 
#### s 
#### B = x + 
方案2步骤8：传输LFTP模式，根据在波形震旦[0.45 UI，0.55 UI]中收集的n个样本，构建一个直方图，用于测量一串3个或4个 "1 "位中最后一个 "1 "位的UI。要求直方图样本是两种情况下收集的样本的结合。直方图中UI的样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
#### 称平均值，x=C 
方案2步骤9：传输LFTP模式，根据在波形震旦[0.45 UI，0.55 UI]中收集的n个样本，构建一个直方图，用于表示一串3个或4个 "0 "位中最后一个 "0 "位的UI。要求直方图样本是两种情况下收集的样本的结合。直方图中UI的样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / )  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织，其中。
#### x = 直方图测量模式下可从HBWS中读取的直方图中电压样本的平均值 s = 直方图中电压样本的标准偏差，也可从HBWS中读取 n = 对直方图有贡献的样本数 - 也可从HBWS中读取。
#### 求平均值，x=D 
方案二 步骤10: 传输一个LFTP模式，根据在波形时间[0.45 UI，0.55 UI]内收集的n个样本，构建一个直方图，用于4个 "1 "位串中最后一个 "1 "位的UI。直方图中UI的样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中。
#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水龙头中读取 s = 直方图中电压样本的标准偏差，也可从六溴水龙头中读取 n = 对直方图有贡献的样本数--也可从六溴水龙头中读取。
#### 称平均值，x=E 
方案2 步骤11：传输LFTP模式，根据在波形震旦[0.45 UI，0.55 UI]中收集的n个样本，构建一个直方图，用于4个'0'位串中最后一个'0'位的UI。直方图中UI的样本数（n）应大于或等于100，并应满足以下要求。
#### s x^2 n _
#### 1537 ( / ) 其中：

#### x = 直方图中电压样本的平均值，可在直方图测量模式下从六溴水厂读取 s = 直方图中电压样本的标准偏差，也可从六溴水厂读取 n = 对直方图有贡献的样本数 - 也可从六溴水厂读取。
#### 求平均值，x=F 
方案二 步骤12：根据步骤1和步骤2中得到的A和B，计算。
VTestAPP = (A + C + F) - (B + D + E)
然后取VTestAPP和之前计算的DHM的最小值，即。
VTest = min (VTestAPP, DHM)
在以下情况下，通过最小振幅的测试。
VTest > VdiffTX(Min)
VdiffTX(Min)见表31的1.1.1节。否则，最小差分电压幅值测试未通过。如果最小电压幅值测试失败，则应增加样本数 n，并对更多的样本数再次执行测试。如果不能得出一个数值n，而测试通过，则意味着没有达到规范中对最小差分电压幅值的要求。
图142说明了LFTP各部分的位置，显示在测量A、B、C、D、E和F值的范围内（见上面的步骤1至6）。

##### 高速 SERIALIZED ATTACHMENT(附件) 
#### ATA国际组织 
##### A 
##### E C 
##### B 
##### D F 
## 图142 - 高倍率范围(HBWS)上的LFTP模式 **7.4.2.2 最大差分电压幅度测试**。
要测试给定数据模式的最大差分电压幅度，请使用LFTP和MFTP作为数据模式执行以下步骤。要检查的波形部分被定义为。
高测试用户界面。
对于LFTP，使用4个 "1 "位串中的第四个 "1 "位。
对于MFTP，使用两个 "1 "位串中的第一个 "1 "位。
低测试用户界面。
对于LFTP，在一串4个 "0 "位中使用第四个 "0 "位。
对于MFTP，使用两个'0'位的字符串中的第一个'0'位。
第1步：对于高测试用户界面，在波形时间[0.0 UI，1.0 UI]中构建一个直方图，用于显示以下信息
UI。将直方图窗口的上边缘定位在VU mV处。
#### （最大） 
#### 2 
#### 1 
#### VU = VDIFFTX  
参见表31，1.1.1节的VdiffTX(Max)。
将直方图窗口的下边缘定位在0mV。让直方图以固定的时间持续时间T获取命中，使获取的命中数至少为10000。注意直方图命中数为NU。该直方图可以基于波形数据库中存储的数据。
对于相同的高测UI，在波形纪元[0.0 UI，1.0 UI]中构建一个直方图。
将直方图窗口的上边缘定位在VU+300 mV处。将直方图窗口的下边缘定位在VU mV处。注意直方图命中数为nu。
步骤2：对于低测试UI，构建一个直方图在波形epoch [0.0 UI，1.0 UI]。
将直方图窗口的上边缘定位在0 mV。将直方图窗口的下边缘定位在VL mV，其中。
####（最大） 
#### 2 
#### 1 
#### VL =a VDIFFTX 
让直方图获得与步骤 1 中使用的相同固定时间持续时间 T 的命中率（在实践中，使用与步骤 1 中收集的相同的波形数据库可以确保检查的时间持续时间相同）。请注意直方图的点击数为NL。
对于相同的低测试UI，在波形纪元[0.0 UI，1.0 UI]中构建一个直方图。将直方图窗口的下边缘定位在VL - 300 mV。将直方图窗口的上边缘定位在VL mV处。注意直方图的点击数为nl。
第三步：计算数值。
#### nu NU 
#### 
#### pu 
#### + 
#### = 
#### nl NL 
#### nl 
#### pl 
#### + 
#### =（注：计算出的pu和pl有两个值，一个是使用LFTP的，一个是使用MFTP的）。
第四步：如果：pu<0.05，pl<0.05，则通过最大幅值的测试（注：由于pl和pu有两个值，所以需要对每一对进行测试）。
否则，最大差分电压幅值测试未通过。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
#### 7.4.3 差分电压幅度的测量（Gen3i）。
Gen3i的差分信号的幅度测量采用不同的方法进行最大幅度和最小幅度的符合性测试。最大振幅是在TX顺应点测量到Lab Load的峰峰值。这限制了存在于接口中的信号的幅度。最小振幅是在Gen3i CIC之后，使用指定的方法测量最小开眼值，进入Lab Load。这为接收机提供了一个最小信号电平，其测量方式代表了一个典型的接收机如何处理信号。
实现以下所列的最大和最小差分幅度符合性限制
表31应是必填项。
 在两个测试中使用相同的发射机设置。
同样的方法和模式用于设置接收机的实验室信号。
公差测试，符合表33中规定的限制。
**7.4.3.1 最大差分电压幅度(Gen3i)**。
最大差分振幅应在TX顺应点测量，进入实验室。
负载。图156显示了这种测试连接的图纸。本顺应性测量应使用Gen3 MFTP，尽管有可能使用其他模式和信号路径特性，实际系统中可能存在额外的峰-峰最大幅度值。如果发射机支持这种信号调理，MFTP将因其运行长度而包含强调，并允许简单的边缘触发信号捕获。
最大振幅定义为使用HBWS在4个Gen3 UI的时间跨度内测量的500个波形的平均值的峰峰值。
**7.4.3.2 最小差分电压幅度（Gen3i）**。
最小的TX差分幅度应通过第7.2.7节中规定的Gen3i CIC测量，并终止到实验室负载。图157显示了这种测试连接的图纸。A
Gen3 LBP应用于该符合性测量，尽管有可能使用其他模式和信号路径特性，实际系统中可能存在较低的振幅。
当使用第7.3.2节中定义的Gen3i参考时钟JTF采集数据时，最小振幅被定义为UI的50%点的1E-12误码率轮廓的垂直开眼。
通常用于此测量的测试设备或JMD包括一个BERT或一个HBWS，并配有适当的硬件和软件，以测量或外推垂直浴盆曲线、眼误码率。
等高线图，或统计开眼角特征。由于一些JMDs推断出眼球的
从一个较小的人口规模捕获的误码率目标的开放，该测量是一个实际的眼开放的近似值。如果测试设备之间在目标误码率处报告的眼洞开度有差异，则从全群体垂直测量中获得的值将是实际眼洞开度的近似值。
BERT扫描应是这个测量的标准。这类似于测量抖动时以水平全人口BERT扫描作为TJ的标准。
所有的测试设备都要求有一个最小的信号幅度，以便能够测量1E-12误码率轮廓或等效数据。这个水平随着仪器类型、硬件和软件的不同而不同。
这个最小要求的仪器振幅会在报告的最小振幅测量值中引入误差。这种误差导致测试设备报告的最小振幅小于实际信号的最小振幅。应采用测试设备制造商提供的推荐方法对这种仪器误差进行修正，以确定实际的最小振幅值。如果某台测试设备没有这种推荐的修正程序，可以选择其他测试设备。
在测试设备没有支持的情况下，可以采用近似的修正方法。使用无源校准的衰减器，以最快的允许Gen3i上升和下降时间，分几步降低低噪声Lab Source Gen3 MFTP测试模式的振幅。如果将报告的振幅绘制在y轴上，并将使用校准衰减器和源计算出的理想振幅绘制在x轴上，y轴截距代表零振幅输入的理论报告振幅。对测量数据进行线性曲线拟合，可以将测量数据外推到y轴截距上。负值）然后将该y轴截距的绝对值作为正数加到仪器报告的最小眼值上。
开头值，以纠正这个误差项。由于这是一种统计测量，而测试设备可能包含显著的随机幅度变化。这种修正方法可能会有误差，因为它没有对随机幅度变化源进行卷积，但它可以将误差幅度降低到未修正的测量值以下。这可能导致仪器误差项可能过度修正。
#### 7.4.4 上升和下降时间 
被测波形的上升和下降时间定义为高低参考电平20%-80%的输出电平变化。被测波形的高参考电平是上部分的 "模式"，而低参考电平是下部分的 "模式"。
模式是用统计方法测量所需波形的，是概率密度函数的最常用值。测量模式幅度的分析区最小时间跨度应为8 UI。
因此．
 上升时间=X2 - X1；其中X2为低值与高值之间距离的80%对应的平均水平时间值，X1为低值与高值之间距离的20%对应的平均水平时间值位置。
而下降时间=X1 - X2；其中X1为低值与高值之间距离20%对应的平均水平时间值，X2为低值与高值之间距离80%对应的平均水平时间值位置。

##### 高速小车在附件中的位置。
#### ATA国际组织 
单项结束的
数据线
单项结束的
数据线
TX(+)
TX(+)
TX(-)
TX(-)
三色堇
跌幅 20% 20% 80% 80%
## 图143 - 单端上升和下降时间...........................................................................。

使用先前定义的LFTP模式测量所有Gen1和Gen2的上升和下降值。
Gen2电气规格。8 UI分析区内所有上升边缘的平均上升时间和所有下降边缘的单独平均下降时间都必须满足所需的上升和下降时间合规性限制。
对于Gen3i，上升和下降时间值，在20%和80%之间，仅用以下方法测量。
Gen3 LFTP。这最大限度地减少了在确定0%和100%参考水平时使用
模式 振幅测量法。测量的分析区应在8个UI的最小时间长度内进行。这是一个实验室负载测量。表 31 列出了差分 TX 测试模式的上升和下降时间符合限制。分析区内所有上升沿的平均上升时间和所有下降沿的单独平均下降时间应分别满足上升和下降时间符合性限制。用于接收器公差测试的差分数据信号源（见图162）的上升和下降时间符合性限值也是用这种方法和模式设定的。实验室信号源的符合性限值
信号列在表33中。
发射机差分缓冲线的上升和下降时间是用图144所示的负载夹具测量的。上升和下降时间应使用HBWS测量。

#### 7.4.5 发射机振幅..........................................................................................。

表31中规定的发射机振幅值指的是被测单元（UUT）在配接连接器处向实验室负载（LL）输出的信号（对于Gen1i、Gen2i、Gen1m。
Gen2m、Gen1x、Gen2x和Gen3i)，或从被测单元通过合规性测试系统进行测试。
将互连通道 (CIC) 连接到实验室负载（仅适用于 Gen1x、Gen2x 和 Gen3i）。当连接到系统电缆或背板上时，这些信号没有被指定。
**7.4.5.1 发射机振幅（Gen1 和 Gen2）**。
发射机最小振幅用三种波形分别测量。HFTP、MFTP和孤位模式（LBP）。振幅规格应根据第 7.4.2 节中概述的测量方法来满足。
最小振幅值是在表31中定义的TX最小电压测量间隔期间测量的。参考时钟（在7.3.2节中定义）定义理想（零抖动）零点交叉时间。最大振幅是根据7.4.2.2节中概述的测量方法，使用波形LFTP和MFTP测量的。
应使用图144中的设置来测量传输直流偏移电压（仅适用于Gen1i）。
HBWS测量的是直流电压，直流电阻块不应存在。
图144和图145是测量发射机振幅的测试设置。HBWS是测量振幅的标准。测试连接中的损耗可能很大，所以要谨慎地将这些损耗降到最低并进行估计。有几种方法可以用来估计布线损耗。第一种方法是使用两根不同长度的电缆，比较每根电缆的损耗。第二种是依靠电缆的公开数据。第三种方法是获得一种单独的测量电缆损耗的方法，如使用网络分析仪或功率计进行表征。
合规性
点
TX
来自UUT的信号
实验室负荷(LL)
发射机
测试中
##### HBWS 50欧姆 50欧姆 50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图144 -- -- 带实验室负载的发射振幅测试  
##### 在附件处进行高速小型化。
#### ATA国际组织 
发射机
测试中
主持人 /
设备
合规
点
TX
来自UUT的信号
SATA接口
连接器对
SATA接口
连接器对
合规
互联
渠道
DC 块（根据需要）（损耗大于 TCTF 并符合 ISI 损耗限制和 SMA 连接器。
SATA适配器(插座)
SATA 适配器（插座
SMA
连接器
SATA适配器（插头
实验室负荷(LL)
HBWS/JMD
## 图145--带顺应性互连通道的发射振幅测试。

本规范用电压描述了当驱动100的测试负载时的发射机电平。
欧姆差分（实验室负载，LL）和50欧姆单端对地。要将指定的最大电平与系统中的最大值联系起来，需要进行计算。计算的例子见 7.4.6 节。
**7.4.5.2 发射机振幅（Gen3i）**。
发射机最小振幅用孤位码型(LBP)测量。振幅规格应根据7.4.3节中概述的测量方法来满足。
最小振幅值是在表31中定义的TX最小电压测量间隔期间测量的。参考时钟（在7.3.2节中定义）定义理想（零抖动）零点交叉时间。最大振幅按照7.4.3节中概述的测量方法使用MFTP波形进行测量。
图156和图157是测量发射机振幅的测试设置。参见7.4.5.1节关于补偿测试连接中损失的建议。
#### 7.4.6 接收振幅...............................................................................................。

本节介绍设置接收振幅，这是许多测试中常见的测试条件。接收器的正常工作是其接收信号的能力。在7.4.11节中描述了这个测试的一个例子。表33中规定的值是指来自任何信号源的输入信号，在被测设备上用实验室负载测量。

合规性
点
##### HBWS 50欧姆 50欧姆
数据
信号
源 50 欧姆 50 欧姆 50 欧姆
电缆
DCB
DCB
直流电座（根据需要
## 图146--接收机振幅测试--设置水平。
合规
点
TX
来自UUT的信号
实验室源信号
接收器
测试中
数据信号源 50 欧姆 50 欧姆 50 欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图147 - 接收器振幅测试 
图146显示了一个例子，说明了布线中的损耗和信号源中的误差，以便进行接收器电平测试。这里不考虑SATA适配器的损耗，但可以单独测量。在设定测试接收机的电平时，HBWS被用作振幅的标准。考虑到布线中的损耗的等效方法也是可以接受的。
本规范用100欧姆阻抗的差分源驱动的电压来描述接收机电平。需要进行计算，将指定的最大接收机电平与系统中的最大接收机电平联系起来。最大接收机电平是通过信号源阻抗为100欧姆的驱动在HBWS上设定的。信号发生器电平设定好后，再将其施加到被测接收器上。接收器输入端的实际电压取决于接收器的输入阻抗。当接收器的输入阻抗达到最大值时，接收器上的电压就会达到最大值。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
Rs
瓦姆普
Vsrc RL
## 图148 - 接收器输入端的电压........................................................................................。

#### 1 
#### 11 
S
A
SRC LL
安培
SS
LL
#### R 
#### V 
#### V R 
#### V 
#### RR 
#### RR 
####  
#### + 
####  
#### == 
####  
#### ++ 
####  
接收机和发射机电阻端接值由低频时的回波损耗规范设定。回波损耗由以下公式给出。0 0
#### 20个日志 
#### ZZ 
#### RL 
#### ZZ 
#### !a 
#### =a "# 
#### "#$%+ 
而对电阻的实部进行求解，则可得到两种解20 1820（^018）20 20 20 
#### 110 110 
#### (1 0 0 ) 7 7. 6 4 
#### 10 1 10 1 
RL
#### RZ RL a aa
#### aa 
#### == = 
#### + + 20 1820 (^018) 20 20 
#### 10 1 10 1 
#### (1 0 0 ) 1 2 8. 8 
#### 110 110 
RL
#### RZ RL a aa
#### ++ 
#### == = 
#### a a 20 1420 0 14 20 20。
#### 110 110 
#### (1 0 0 ) 6 6. 7 3 
#### 10 1 10 1 
RL
#### RZ RL aa aa
#### aa 
#### == = 
#### ++ 20 1420 0 14 20 20
#### 10 1 10 1 
#### (1 0 0 ) 1 4 9. 9 
#### 110 110 
RL
#### RZ RL aa aa
#### ++ 
#### == = 
#### aa 
当接收器输入电阻最大时，可能在接收器处看到的最高振幅。

#### 100 
#### 0.7 1 
#### 100 
#### 0.7881 
#### 100 
#### 1 
#### 128.8 
#### VAMP 
####  
#### + 
#### == 
####  
#### + 
####  
当接收器输入电阻最低时，接收器的振幅最低。
#### 100 
#### 0.4 1 
#### 100 
#### 0.3497 
#### 100 
#### 1 
#### 77.64 
#### VAMP 
####  
#### + 
####  
#### == 
####  
#### + 
####   
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.4.7 长期频率精度 
选择测量长期频率精度的仪器有几个考虑因素。
 仪器时基的长期频率精度需要明显优于本规范中350ppm的限制，很多示波器不具备这个频率精度。
测量长期频率精度的方法是使用频率计数器。下图149所示的测试设置显示了连接情况。被测试的发射机发送一个
HFTP（D10.2）信号到频率计数器。该信号不得有SSC调制。频率计数器应设置足够长的门控周期，以减少噪声的影响；这可以通过将计数器分辨率设置为 10 Hz 或更高（1.5 GHz 时 350 ppm 为 525 kHz）来实现。计数器读取发射机的长期频率；其精度为百分比。
当存在SSC时，长期频率精度规格不适用，相反的是
测量SSC曲线(见7.4.11节)
还有一些仪器含有频率计数器，其精度明显优于350ppm。例如，一些BERT设备的时钟输入端有一个频率计数器。
合规性
点
TX
来自UUT的信号
LL 实验室负荷
频率计数器
发射机
测试中 50 欧姆 50 欧姆 50 欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图149 - TX长期频率测量。 
#### 7.4.8 抖动测量 
抖动是指数据转换与相关的参考时钟事件之间的时间差，被视为转换的理想点。抖动的原因可分为随机源（RJ）和确定性源（DJ）。虽然总抖动(TJ)是所有独立抖动源的概率密度函数的卷积，但本规范将随机抖动定义为高斯，总抖动为确定性抖动加14倍随机抖动。表31和表33的TJ规范选择的目标误码率为10-12。
7.4.8.1节中所述的BERT扫描法是唯一能测量实际的
TJ，并作为所有TJ估计方法的参考。估计TJ的方法对每个测量仪器都是独一无二的。
频率(f)
接收器
串行数据
时钟恢复
电路
收回的
时钟
收回的
数据
时钟恢复电路
具有低通功能HL
M ag ni tu de (d)
B )
## 图150-抖动的接收器模型 
抖动测量方法定义为时钟到数据抖动测量。图150是解串器输入的框图。串行数据被分成两条路径。一条路径送入时钟恢复电路，它成为用于锁存串行数据流的数据位的参考信号。这个时钟恢复电路有一个低通传输函数HL。这个低通函数就是PLL或时钟恢复电路的CLTF。接收器看到的抖动是恢复的时钟边沿到数据边沿位置的时间差。这个时间差函数如图151所示。接收器看到的抖动结果具有高通函数
HH图152所示。这个高通函数是系统的JTF（抖动传递函数）。这定义了所有抖动测量方法所要求的测量功能。
JTF(Gen1i，Gen1m，Gen2i，Gen2m)和CLTF角频率fc(Gen1x，Gen2x)所需的特性在7.3.2节中提供。在JMD的情况下，JTF可以简单地看作是正弦PJ输入的报告抖动与应用抖动之比。
CLTF和JTF都是由开环传输函数G(s)唯一定义的。由于CLTF分子和分母中G(s)的消除程度，定义CLTF并不能唯一地定义G(s)和随后的JTF，特别是当G(s)远大于1时，这对时钟恢复电路的抖动跟踪是必要的。这就是Gen1i、Gen1m、Gen2i和Gen2m直接指定JTF而不是CLTF的理由。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织的时钟恢复电路。当JMD的JTF满足规定的要求时，JMD报告的抖动水平将更接近代表本参考设计中应用于接收器的抖动。
时钟恢复
电路
时间
差异
接收器看到的抖动
#### + 
#### - 
## 图151--接收器的抖动。
频率(f)
时钟HLor CLTF
恢复功能
HH=1----HL或JTF，来自于：
差值函数
M ag ni tu de (d)
B) 0 -3
JTF fC CLTF fC
## 图152 - 接收器抖动，高通功能 
这个JTF(图152中的HH)模仿了接收机跟踪低频抖动分量(游走、SSC)的能力，而不把它们包括在抖动测量中。
 这种测量方法使任何测量仪器都能准确地测量接收机看到的抖动，并产生不同测量仪器之间的相关测量结果。
应该注意的是，JTF的角频率不是时钟恢复CLTF的角频率。在考虑时钟恢复电路引起的相位偏移之前，这一点可能并不明显。一般来说，矢量和HL(f)+HH(f)=1。所有的量都由变化的幅度和相位组成，作为频率的函数。这就解释了两个频率相关函数中的角频率和峰值的差异。
图153显示了JTF和CLTF如何与应用于接收器的抖动相关的更多细节。子图A)表示基于反馈环路的时钟恢复系统的通用控制系统框图。子图B）将相同的复杂变量转化为时钟恢复电路和时差函数的组合系统。可以看出
E(s)是接收器看到的抖动，同时也是时钟恢复电路中的误差信号。
子图C）提供了时钟恢复电路CLTF和组合系统JTF函数的定义式。

CLTF和JTF都是由开环传输函数G(s)唯一定义的。由于CLTF的分子和分母中G(s)的取消程度，特别是当G(s)远大于1时，定义CLTF并不能唯一地定义G(s)和随后的JTF，这对于时钟恢复电路的抖动跟踪是必要的。这就是Gen2i、Gen2m和Gen3i的合理性：直接指定时钟恢复电路的JTF而不是CLTF。当JMD的JTF满足指定的要求时，JMD报告的抖动水平将更接近代表本参考设计中应用于接收器的抖动。
时钟恢复
电路
#### + 
## - 
时差
接收器看到的抖动
G(s)
#### + 
## - Σ 
R(s) E(s)
H(s)=1
C(s)
A) 通用时钟恢复电路
C(s)
R(s)
E(s)
JTF = 1 1 + G(s) CLTF = R(s)
C(s) 1 + G(s)
G(s) =
R(s)
E(s) =
方程对单增益反馈有效。H(s) = 1
B) 带时差的时钟恢复电路
C) 确定联合工作队和地方政府工作队的方程。
所有的量都由幅度和相位组成
## 图153 - JTF和CLTF定义 **7.4.8.1 使用位错率测试仪(BERT)进行抖动测量**。
大多数用于测量抖动的仪器无法在10-12这样的极低位错率下直接测量TJ，因为需要时间来捕捉足够的过渡，以便进行统计学意义上的直接测量。相反，这些仪器捕获较小的样本量，并使用复杂的，在某些情况下是专有的算法来推断TJ。测定
通过外推法测量TJ可以大大减少测量抖动所需的时间，但经验表明，不同的基于外推法的方法可能产生不同的结果。另一种测量TJ的方法是通过使用BERT扫描方法。由于BERT扫描可以在合理的时间内直接测量10-12甚至更低速率的抖动，它还提供了一种调节TJ外推值的任何差异的方法。
BERT扫描方法利用了BERT上可用的可变时钟到数据定时路径。除此之外，应在BERT内部或外部使用符合7.3.2节所述要求的PLL来产生时钟参考。BERT扫描系统地增加或减少时钟到数据的时序，并直接测量每一个时间增量的误码率性能。这样做，直到在每一个时间上找到所需误码率的时间偏移 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织侧的单位区间。误码率直接在单位区间左右两边的每个定时点测量。
UI可以绘制出所谓的浴缸曲线。在所需的位错率下，一个UI的时间减去曲线之间的时间就是TJ。如果浴缸曲线上的那些点是来自直接测量的数据，而不是外推的，那么TJ就是直接测量的TJ。
另外，在相对于参考时钟的标称零点交叉时间的左边和右边进行BERT扫描，直接测量累积分布的尾部。
函数（CDF）直方图。该直方图在所需误码率下的宽度就是该误码率下的TJ。
确实存在从较高速率的时间扫描值推断BERT上的TJ的方法。虽然这种方法可以用来预测所需误码率下的TJ，但当使用BERT作为抖动标准与外推方法进行比较时，只能直接测量到所需误码率。
该标准还要求测量DJ，用于符合性测试。所有DJ的测量都是基于统计学的，包括从BERT中估算出的DJ。
 如果使用BERT测量TJ，则可使用该BERT确定的TJ值来估计DJ。从BERT TJ值估计DJ的方法在公有领域有描述^5这些方法涉及使用BERT扫描在不同BER水平下测量TJ。
在测量TJ并提取DJ和RJ分量时，经常会遇到RJ测量值高于实际随机抖动的情况。在系统中经常会遇到这种情况，因为系统的噪声会导致与串行ATA通道活动不相关的抖动。例如，来自系统的电源噪声，污染了发射机的位时钟发生器，可能导致位时钟的变化，直接影响抖动。
当进行随机抖动测量时，这种非相关的DJ通常包括在结果中，当乘以14时，可能导致不符合抖动规范。这是不合适的，因为非相关DJ是有界的、非高斯的，不应该乘以14。此外，非相关DJ包含在正常的DJ测量中。

从RJ测量中提取非相关DJ超出了本文的范围，因为这通常需要深入了解非相关DJ的特性，以及测量/提取它的适当算法。因此，读者有责任从RJ测量中确定非相关DJ的特征，然后提取其特征。
#### 7.4.9 传输抖动(Gen1i、Gen2i、Gen1m、Gen2m、Gen1x和Gen2x) 
表31中规定的传输抖动值是指从被测装置（UUT）在配接连接器处向实验室负载（LL）输出信号（适用于Gen1i、Gen2i、Gen1m、Gen2m。
Gen1x和Gen2x），或从被测设备通过合规互连通道（CIC）进入实验室负载（Gen1x和Gen2x）。当连接到系统电缆或背板时，这些信号没有被指定。测量的发射机抖动中包括了发射机、封装、印刷电路板线路和配对连接器的所有互连特性。由于 SATA 适配器也包括在测量范围内，因此适配器的良好匹配和低损耗是可取的，以使其对测量的发射机抖动的贡献最小化。
传输抖动是用7.2.4.1节中的每个指定模式来测量的。抖动的测量在7.4.8节中描述。传输抖动的测量是在(^5) "通过概率分布尾部的线性化来估计小概率 "中的一种。
功能"，S.B.Weinstein著，IEEE通信技术交易，COM-19卷。
6号，1971年12月。
  以下是Gen2i的两种设置和Gen1x和Gen2x的两种设置。对于 Gen1i、Gen2i、Gen1x 和 Gen2x，发射机直接连接到图 154 所示的实验室负载 (LL)。此外，对于 Gen1x 和 Gen2x，发射机通过顺应性连接到实验室负载 (LL)，如图 154 所示。
互连通道（见7.2.7节）进入图155所示的实验室负载。

合规性
点
TX
来自UUT的信号
实验室负荷(LL)
发射机
测试中
##### HBWS / JMD 50欧姆 50欧姆 50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图154 - 发射机抖动测试（Gen1i，Gen2i）....................................................................。

发射机
测试中
主持人 /
设备
合规
点
TX
来自UUT的信号
SATA接口
连接器对
SATA接口
连接器对
合规
互联
渠道
DC 块（根据需要）（损耗大于 TCTF 并符合 ISI 损耗限制和 SMA 连接器。
SATA适配器(插座)
SATA 适配器（插座
SMA
连接器
SATA适配器（插头
实验室负荷(LL)
HBWS/JMD
## 图155 - 使用合规互连通道进行发射机抖动测试（Gen1x、Gen2x）.......。

发射机的抖动是在实验室负载（LL）中测量的，或者是与
合规互连通道；两者都有非常好的阻抗匹配。实际系统中的抖动较高，因为负载和互连不匹配会导致反射和额外的数据相关抖动。一般来说，不可能消除SATA适配器对抖动的影响，因为不匹配导致的抖动取决于整个测试设置。

##### 高速串行化的附件 
#### ATA国际组织 
#### 7.4.10 传输抖动(Gen3i) 
表31中规定的传输抖动值指的是测量随机抖动(RJ)时，从被测设备(UUT)在配接连接器处输出信号到实验室负载(LL)，或者测量总抖动(TJ)时，从被测设备通过合规互连通道(CIC)输出信号到实验室负载。当连接到系统电缆或背板时，信号没有被指定。发射机、封装、印刷电路板痕迹的所有互连特性。
 和配接的连接器对包括在测量的发射机抖动中。由于 SATA 适配器也是测量的一部分，因此，为了使其对测量的发射机抖动的贡献最小化，适配器的良好匹配和低损耗是可取的。
随机抖动是用MFTP模式测量的，总抖动是用7.2.4.1和7.2.4.3.4节中的每个指定模式测量的。抖动的测量将在7.4.8节中描述。
首先，如图 156 所示，直接测量 Gen3 MFTP 模式的随机抖动至实验室负载。测量值应满足表31中Gen3i随机抖动(RJ)的传输抖动水平。本次测试中随机抖动的实际测量值称为测量随机抖动(RJmeas)，用于计算第二次发射机抖动测试的允许TJ电平，因此需要记录该值。
## 图156 - 发射机随机抖动测试（Gen3i）.................................................................。

第二次发射机抖动测试通过Gen3i顺应性测量总抖动（TJ）。
如图 157 所示，将互连通道（见第 7.2.7 节）接入实验室负载。
允许的总抖动 (TJ) 水平是根据第 7.4.8 节中的公式计算出来的，该公式将总抖动定义为确定性抖动 (DJ) 加随机抖动 (RJ) 标准偏差的 14 倍之和。表31列出了在第一次传输抖动测试中获得的RJmeas值上要加的最大DJ水平。RJmeas和允许的DJ之和定义了传输抖动应具有的最大TJ电平。
从JMD测得的RJ通常报告为标准偏差值（一个西格玛）。
RJ必须乘以14，将其转换为峰-峰值，然后再加到允许的DJ电平上，这是一个峰-峰值。

为了澄清第二个测试的最大允许TJ计算，提供了以下例子。表31中的数值提供了Gen3i TX抖动的符合性要求。以下数值只是一个例子。如果最大允许RJ为0.18 UI p-p，而第一次发射抖动测试的实际测量RJ (RJmeas)为0.10 UI p-p (1.19 ps 1 sigma)，允许的DJ附加值为0.34 UI p-p，那么第二次发射抖动的最大允许TJ为0.34 UI p-p。
抖动测试为。TJ (UI p-p) = DJ (UIp-p) + RJmeas (UI p-p) = 0.34 (UI p-p) + 0.10 (UI p-p) = 0.44 (UI p-p)。这就是被测发射机的最大允许TJ。可以看出，如果
从第一次测试中得到的RJmeas为0.18（UI p-p）的最大极限，允许的DJ加法为0.34（UI p-p），那么最大允许的TJ为0.52（UI p-p）。
串行接口
适配器（插座） **JMD** 
来自UUT的TX信号 50 Ohms 50 Ohms 50 Ohm
电缆
SATA接口
连接器对
合规
点
主持人 /
设备
发射机
测试中
CIC - 实验室负荷(LL)
CIC
M M (信号流)
## 图157 - 发射机总抖动测试(Gen3i) 
传输抖动应满足表31中所列的两项要求，使用本节中定义的RJ的第一项测试和TJ的第二项测试方法。用于Gen3i的方法
传输抖动测试旨在最大限度地减少RJ测量误差，并允许通过第7.4.8节所述的全群BERT扫描来验证TJ。这种方法还对DJ和RJ设置了一个上限，因此两者都不可能主导TJ。
发射机抖动是在实验室负载（LL）中测量的，或与实验室负载一起测量。
合规互连通道；两者都有非常好的阻抗匹配。实际系统中的抖动会更高，因为负载和互连通道不匹配会导致反射和额外的数据相关抖动。一般来说，不可能消除SATA适配器对抖动的影响，因为不匹配导致的抖动取决于整个测试设置。
#### 7.4.11 接收器容差 (Gen1i, Gen2i, Gen1m, Gen2m, Gen1x, and Gen2x) .........

接收机容差和共模干扰抑制的性能衡量标准是接收机对数据的正确检测。在测量接收机和共模容差时，有必要对发送到接收机的信号设置最大允许抖动和共模干扰，并监测数据误差。
数据信号源提供一个带抖动的数据信号，以及一个可控的上升/下降时间，并匹配输出阻抗。正弦波源提供具有匹配输出阻抗的共模干扰。这两个信号源与电阻分路器组合成被测接收器（见图159）。允许采用等效信号产生方法，提供具有抖动、共模干扰和阻抗匹配输出的数据。所有的 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织互连特性的接收器、配接的连接器对、印刷电路板的痕迹。
 和封装都包含在测量的接收器抖动容差中。
图158显示了一个设置，用于设置符合点的抖动和共模信号的电平，位于配对连接器的电缆侧。测量抖动时使用JMD作为标准，测量共模干扰时使用HBWS作为标准。由于在设定抖动水平时不包括SATA适配器，因此希望适配器具有良好的匹配性和低损耗，以最小化对测试中使用的接收器抖动量的贡献。与其他测量不同的是，通常不可能消除SATA适配器对抖动的影响，因为不匹配导致的抖动取决于整个测试设置。图159显示了一个生成Lab-Sourceed信号的示例方法。
接收机容差测试应在参数SSC的开启和关闭、最大和最小上升和下降时间、最小和最大振幅、指定频率范围内的共模干扰、7.2.4.3节中描述的测试模式LBP和全有效载荷COMP以及抖动（包括各种类型的随机和确定性抖动：数据依赖、周期性、占空比失真）的变化中进行。要求在所有信号变化中，接收器对损伤的容忍度。
符合点
常见的
模式
##### HBWS / JMD 50欧姆
分流器 50欧姆 50欧姆
电缆
DCB
DCB
直流电阻挡（根据需要） 50欧姆 50欧姆
数据信号
资料来源
正弦波
资料来源
## 图158 - 接收器抖动和CM公差测试设置水平。 
常见的
模式
分流器 50欧姆
电缆
DCB
DCB
直流电阻挡（根据需要） 50欧姆 50欧姆
数据信号
资料来源
实验室源信号
正弦波
资料来源
合规
点
来自UUT的RX信号
接收器
测试中
主持人 /
设备
SATA
适配器（插座
SATA接口
连接器对
## 图159 - 接收器抖动和CM容忍度测试..................................................................。

#### 7.4.12 接收器容差(Gen3i) 
接收机容差和共模干扰抑制的性能衡量标准是接收机对数据的正确检测。在测量接收机和共模容差时，有必要对发送到接收机的信号设置最大允许抖动和共模干扰，并监测数据误差。
数据信号源提供一个带抖动的数据信号，以及一个匹配的输出阻抗的可控上升/下降时间。额外的DJ（ISI）由CIC添加。正弦波源提供具有匹配输出阻抗的共模干扰。这两个信号源与电阻分路器组合到被测接收器中（见图162）。允许采用等效信号产生方法，提供具有抖动、共模干扰和阻抗匹配输出的数据。接收器的所有互连特性、配接的连接器对、印刷电路板痕迹和封装都包括在测量的接收器抖动容差中。
为了校准用于接收机容差测试的测试信号，数据信号源使用两个程序进行测量，一个是随机抖动(RJ)，另一个是总抖动(TJ)和共模信号内容。
下图中数据信号源的上升时间和下降时间应满足表33中列出的Gen3i实验室源信号的要求。这定义了CIC之前信号路径中的信号上升时间和下降时间特性。应使用第7.4.4节中描述的上升时间和下降时间方法来满足这一要求。
图160显示了设置随机抖动(RJ)电平的测试配置，其定义见第7.4.4节。
Gen3i实验室来源信号的表33。RJ电平使用Gen3i MFTP模式设置。与存在其他信号劣化的情况相比，这种方法可以最大限度地减少RJ的测量误差，并且应在添加额外的抖动分量和共模信号之前完成。
如上所述，在数据信号源的RJ电平设置后，进行这第二个程序。图161是设置总抖动(TJ)和共模信号电平的一个示例方法。实际的校准平面是在SMA连接器处，在接收器公差测试期间将应用到SATA到SMA适配器上。如图所示 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织161为虚线垂直线。JMD被用作测量抖动的标准，HBWS被用作测量共模干扰和信号幅度的标准。
由于在设定抖动水平时不包括SATA适配器，因此希望适配器具有良好的匹配性和低损耗，以减少对测试中使用的接收器抖动量的贡献。与其他测量不同的是，通常不可能消除抖动的影响。
抖动的SATA适配器，因为不匹配导致的抖动取决于整个测试设置。

在校准平面上测量测试信号的最小和最大振幅电平，采用与TX振幅测试中这些参数相同的方法进行。(所需方法见7.4.3节)一般情况下，Gen3 MFTP图案的最大峰峰值幅度是最大极限，而最小开眼值则为
1E-12误码率下的Gen3 LBP是最低限度。
图162显示了应用于被测接收机的校准实验室信号。
接收机容差测试应在参数SSC的开和关、最小和最大振幅、规定频率范围内的共模干扰、7.2.4.3节中描述的测试模式LBP和全有效载荷COMP以及抖动（包括各种类型的最大随机抖动和确定性抖动：数据依赖性抖动、周期性抖动、占空比失真）的变化中进行。在所有信号变化的情况下，要求接收机对损伤的容忍度。
## 图160 - 接收器抖动和CM容差测试 - 设置RJ电平(Gen3i)  
## 图161 - 接收器抖动和CM公差测试 - 设置TJ和CM水平(Gen3i) 
## 图162 -- -- 接收器抖动和CM容忍度测试(Gen3i) 
#### 7.4.13 回损和阻抗平衡。
回波损耗和阻抗平衡规格（适用于高于Gen1的速率）的目的是为了限制将主机/设备连接到系统中时产生的额外数据相关抖动。
主机和设备的测试设置在差模和共模中都是阻抗匹配的，并且具有良好的阻抗平衡，而系统环境可能不是。系统中会因为这些不完善而产生额外的数据依赖性抖动。主机/设备的回波损耗量化了对系统中反射水平的影响，阻抗平衡控制了差模和共模之间的转换。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
差动回波损耗是指在差动模式激励下，差动模式反射的幅度，用分贝表示。共模回波损耗是指在共模激励下共模反射的幅度。阻抗平衡被定义为给定共模激励的差模反射的幅度。这些因素中的每一个都会造成系统中额外的数据依赖性抖动，而不是测试设置中的抖动。
差模信号由21 21 21 dm dm定义。
#### vvv 
#### iii 
#### = a 
#### = a 
共模信号由21 21定义。
#### 2 
#### 2 cm cm
#### vv 
#### v 
#### ii 
#### i 
#### + 
#### = 
#### + 
#### = 
回波损耗由反射系数_RL_=a20 log&的大小来定义。
本规范以正弦波的反射幅度来描述发射机输出阻抗和接收器输入阻抗。在无损线路中，回波损耗随位置变化而保持不变。测试设置中的衰减损耗会导致测量的回波损耗比实际值高（匹配更好）。图163显示了一个补偿电缆中损耗的设置。短路和负载是假设的标准与RF连接器，例如SMA型连接器。
50 欧姆
电缆
DCB
DCB
##### VNA / TDR 50 Ohm 50 Ohm
负载50欧姆
电缆
DCB
DCB
##### VNA / TDR 50 Ohm 50 Ohm
负载
短
短
直流电座（根据需要
## 图163 - 回损测试-校准  
反射测试装置可以测量差模或共模下的反射。它可以由一个带处理软件的TDR、一个多端口矢量网络分析仪、混合耦合器和定向桥或一个2端口矢量网络分析仪和处理软件组成。
差分回波损耗、共模回波损耗和阻抗平衡可以用2端口矢量网络分析仪来测量。将VNA连接到主机/设备上，测量S参数（用50欧姆的参考阻抗）。混合模式S参数以及2端口S参数的差分回波损耗由11 22 12 21给出。
#### 11 20 log 11 20 log 
#### 2 
DD DD
#### ss ss 
#### RL S 
#### + aa 
#### = a =a 
共模回损由11 22 12 21给出。
#### 11 20 log 11 20 log 
#### 2 
CC CC
#### ss ss 
#### RL S 
#### +++ 
#### = a =a 
阻抗平衡由以下公式给出
#### 2 
#### 11 20 log 11 20 log^221221 
#### S S S S 
#### RLDC SDC 
#### a+a 
#### =a =a^11，其中混合模式S参数是用4端口VNA测量的，或者用2端口测量的。
S参数是用2端口VNA测量的。
对于上述方程，从单端到微分s参数的映射假设为50
欧姆单端参考源到100欧姆差分参考源和25欧姆共模参考源。
图164显示了测量差分回波损耗的测试设置。因为不包括SATA适配器。
 为了使其对测量回波损耗的贡献最小化，适配器的良好匹配和低损耗是可取的。如果测量和SATA适配卡是用S参数表征的，那么可以通过去嵌入过程来消除适配卡和测试设置的影响。
测试适配器的缺陷会影响被测设备的测量；它们会引入测量不确定性。例如，测试适配器中的衰减损耗会降低被测单元的反射，使得测量的回波损耗高于实际。0.5dB的衰减损耗（在5GHz时，FR4上约1英寸的PCB线）会导致测量的回波损耗比实际增加1dB。适配器的回波损耗可能会影响测量的回波损耗，因为适配器的反射会增加或减少被测设备的反射。一个回损为20dB的匹配良好的适配器可能会影响回损为5dB的被测设备的测量结果，影响幅度为±1dB。这些影响在较高频率下最为明显。
适配器通过以下测量不确定度方程影响测量反射（） 2 _sss_ 11 _m_ =+'''''' 00 01 10 11 _aa_ +01 10 11 11。 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 其中'10和'01为衰减损耗，'00为输入反射，'11为输出。
s 11 m为测量的反射，s 11 a为被测设备的实际反射。回波损耗与反射振幅有关。
为了获得最精确的测量结果，应先对适配器效应进行表征或校准，然后从测量中去掉或去除。
顺应性
到UUT点的信号
#### 接收器 
#### 
#### 50欧姆以下
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对（根据需要）直流母线
#### VNA/TDR 50欧姆 50欧姆
## 图164 - 回损测试 
当测量发射机的输出阻抗时，工作条件应是在传输MFTP期间。这是为了保证测量是在代表正常运行的运行模式下进行的。在发射机的每个差分端口上，外部激励的振幅不得超过-13.2 dBm 50 Ohms (139 mVpp)单端。
这个数字是根据发射机可能存在的最大反射信号得出的。最大传输信号700mVppd（-5.14 dBm 50欧姆，每个差分侧，HFTP最大上升/下降时间）；从差分回波损耗为8dB的接收器上反射出来，并直接附加。
当测量接收机的输入阻抗时，其工作状态应在PHYRDY
接口电源状态（见8.1节）。外部激励的振幅不得超过接收器每个差分端口上的-6.48 dBm 50欧姆（300 mVpp）。这个数字来自于接收器可能存在的最大信号，600 mVppd（Gen1i，-6.48 dBm 50欧姆，每个差分侧）。

#### 7.4.14 SSC Profile 
扩频时钟是对比特时钟进行有意的低频调制。SSC曲线是对比特时钟的调制。为了测量SSC曲线，需要一个频率解调器和低通滤波器。在硬件和软件上，有许多可能的实现方式。低通滤波器是必要的，以拒绝来自比特模式和抖动的不受欢迎的解调后频率成分。为了减少这些不受欢迎的信号，应使用HFTP比特模式。这可以通过使用BIST激活FIS来调用Transmit-FIS来产生。
只有选项。SSC 曲线测量也用于确定单位间隔值。
7.3.2节中定义的参考时钟应与相位检测器输出中的附加低通滤波器一起使用，以测量SSC曲线。该输出是直流耦合的，应该用具有足够长期频率精度的信号源进行校准。
应使用单枪捕获示波器测量零点交叉时间（通过插值），并执行调频解调器和低通滤波器功能。示波器的记忆记录应足够长，以达到低通滤波器的截止频率。
示波器时基的长期频率精度应明显优于本规范中350ppm的限制，不具备此频率精度的示波器可采用足够精度的单独信号源进入单独通道进行校准。
具有足够带宽的调制分析工具提供了测量的替代方法。
SSC配置文件。这些存在于一些频谱分析仪、调制分析仪中，或者可以作为一个单独的频率调制接收器来实现。当调频接收器具有直流耦合调制路径时，校准比较容易。
低通滤波器3dB截止频率应是调制率的60倍。
 滤波器的阻带抑制应大于或等于每十年20dB的二阶低通。
#### 7.4.15 线对内斜度 
对内斜度测量是对发射机和接收机的重要测量。对于发射机来说，它们是衡量SATA发射机硅片对称性的标准（见表31）。
对于接收器来说，它们是对处理互连导致的信号衰减能力的测量。在接收器上，对内偏移会对抖动水平产生不利影响。在系统中，对内偏移对辐射发射水平有直接影响。由于测量值通常只有几个皮秒，因此应注意将测量误差降至最低。
图165展示了使用HBWS及其内置处理的测量方法的测试设置。发射机的每个单端通道都被测量到实验室负载中，并带有
直流块。测量发射机偏斜时，使用HFTP和MFTP作为测试模式。通过数学上改变极性（算术符号）形成一个新的显示信号，并与原始信号一起显示。这样就为每个单端信号建立了交叉点，一个显示在显示器的上部，另一个显示在显示器的下部。如图168所示的发射机的例子，Ch5和Ch6是差分对的两个单端信号，M5跟踪是倒置的Ch5（-Ch5），M6是倒置的Ch6（-Ch6）。垂直光标用于测量交叉之间的时间作为对内偏斜。
接收机应在表33规定的RX差分Skew设置为最大时进行测试，以显示所需性能。可使用不同传播延迟的测试电缆或实验室信号发生器中数据信号源的主动控制来创建偏移。接收机偏移可与接收机振幅同时设置，如表 33 所示。
图166. 设置斜度时使用 HFTP 作为模式。斜度测量与上述发射机的测量方法相同。

##### 高速 SERIALIZED ATTACHMENT(高速附件)。
#### ATA国际组织 
合规
点
TX
来自UUT的信号
实验室负荷(LL)
发射机
测试中
##### HBWS 50欧姆 50欧姆 50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电座（根据需要
## 图165-发射机的线对内偏移测试。
合规
点
##### HBWS 50欧姆 50欧姆 50欧姆 50欧姆 50欧姆 50欧姆
电缆
DCB
DCB
直流电座（根据需要
数据信号源
## 图166 - 接收机线对内偏移测试设置水平。
合规
到UUT点的信号
接收器
测试下50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电阻挡（根据需要） 50欧姆 50欧姆
实验室源信号
数据信号
资料来源
## 图167----接收机线对内偏移测试。 
## 图168 -- -- 发射机的线对内偏移测试示例(10.8 pS) 
#### 7.4.16 瞬态电压排序 
图169显示了与被测接收器或发射器的连接。每条RX或TX线都以最小阻抗10兆欧的方式终止到地，其中包括探头和任何外部负载。在开机或关机顺序期间的电压瞬变值，或在Vp或Vn处看到的电源状态变化，应保持在规定的电压范围内。
合规性
点
#### 
#### 或 
#### 10兆欧以下最小值。
10兆欧姆以下
50欧姆
电缆
主持人 /
设备
SATA
适配器（插座
SATA接口
连接器对
Vp
Vn
## 图169 - TX/RX序列瞬态电压测量  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 7.4.17 交流耦合电容器 
此测量只适用于交流耦合的发射机和接收机。在SATA连接器上无法直接观察到交流耦合电容值。
为了测量该电容，应在交流耦合电容的两边探测每个信号。被测设备电源关闭，SATA连接器上不插任何东西。在IC内部有耦合的情况下，或者在IC和外部耦合电容之间没有接入信号的情况下，如图所示，该参数无法测量。
图170显示了每个耦合电容器的连接。每个耦合电容应低于规定的最大值。
SATA
连接器
耦合
电容器
主机/设备
电容表
##### IC 
接收人或
发射机
测试中
合规
点
## 图170 - 交流耦合电容测量................................................................。

#### 7.4.18 TX振幅不平衡......................................................................................。

该参数用于测量TX+和TX-信号的单端振幅的匹配度。该测量应采用图144所示的测试装置。该参数应采用HFTP和MFTP两种模式进行测量和满足。
 这里使用类似时钟的模式，使基于标准模式的振幅测量仅用于确定不平衡。差分振幅的测量采用不同的方法。
为了确定振幅不平衡，应确定所使用的类时钟模式的10至20个周期内TX+和TX-的单端模高和模低振幅。然后通过公式确定该模式的振幅不平衡值：绝对值(TX+振幅-TX-振幅)/平均值，其中平均值为(TX+振幅+TX-振幅)/2。
每种图案的振幅不平衡值应小于以下所列的最大值。
表31.
#### 7.4.19 发射机上升/下降不平衡........................................................................................。

该参数是测量发射机同时单端上升/下降或下降/上升时间的匹配情况。该测量应采用图144所示的测试装置。
该参数应以HFTP和MFTP两种模式进行测量和满足。

为了确定不平衡性，TX+和MFTP模式的单端20-80%的上升和下降时间。
对某一模式应确定TX-。然后通过两个公式确定该模式的两个不平衡值：绝对值(TX+,上升-TX-,下降)/平均值，其中平均值为(TX+,上升+TX-,下降)/2绝对值(TX+,下降-TX-,上升)/平均值，其中平均值为(TX+,下降+TX-,上升)/2。
每个模式的两个值都应小于表31中所列的最大值。
#### 7.4.20 TX交流共模电压(Gen2i、Gen2m) 
该参数是对共模噪声的测量，但不包括由于TX+/TX-不匹配和偏移造成的过渡期间的CM尖峰，后者受上升/下降不匹配和其他要求的限制。该参数的测量是通过如图144所示的配接连接器传输到实验室负载中实现的。发射器应采用MFTP（中频测试模式）。测量仪器可以是HBWS或其他模拟带宽至少为3*比特率/2的仪器。
TX+和TX-应使用单独的通道，共同模式为（TX++TX-）/2.这种原始的共同模式应使用一阶滤波器进行过滤，其截止值等于比特率/2，以去除边缘不匹配的噪声贡献。滤波器输出的峰-峰值电压为交流共模电压，并应保持在规定的限度以下。
#### 7.4.21 Tx交流共模电压(Gen3i) 
测量共模电压的方法是，在发射机的Tx+和Tx-输出之间，在设备或主机发射连接器处，连接一个计量级的功率组合器。
两个输出端都要用相位匹配的电缆连接到梳理器上，相位失配<= +/- 3 ps，减少测量过程中的相位失真。功率组合器的输出连接到一个有足够带宽的频谱分析仪，以测量数据速度的基频和2次谐波频率。例如：6.0 Gbps，基频=3 GHz。
测量应使用1 MHz的分辨率带宽。在测试期间，发射机应输出HFTP (D10.2)模式。
可使用等效方法。
dBmV电平理解为：0dBmV=1mV进50欧姆。
#### 7.4.22 OOB共模Delta..................................................................................。

该参数是衡量测试过程中空闲时间的共模电压之间的偏移量。
OOB的产生和OOB突发期间的共模电压。测试设置显示在
图144应用于此测量。本测量可采用HBWS或单枪瞄准镜，DUT应配置为发送一个OOB序列或多个OOB序列，仪器应配置为在一个序列中的第一个OOB突发前至少观察到价值40 Gen 1 UI的空闲时间，在一个序列的第一个OOB突发中至少观察到价值40 Gen 1 UI的突发活动。
共模信号为(TX++TX-)/2，该参数的空闲期间的共模电压由序列中第一个OOB突发之前的最后60 Gen1 UI价值时间内的40 Gen1 UI跨度的空闲时间的共模电压的平均值确定。该参数的活动时间内的平均共模电压是由序列中第一个突发的前60 Gen1 UI内的40 Gen1 UI时间跨度的共模电压的平均值确定的。活动时间跨度之所以取在第一个60 Gen1 UI内的 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织在序列中的第一个突发是为了尽量减少交流耦合RC时间常数对所产生的共模偏移的影响（如果存在的话）。
#### 7.4.23 OOB差分Delta. 
该参数是衡量空闲时间的差分电压与空闲时间的差分电压之间的偏移量。

OOB的产生和OOB突发期间的平均差分电压。图144所示的测试设置应用于此测量。HBWS或单射程可用于此测量，DUT应被配置为发送OOB序列或多个OOB序列。
OOB序列，并且仪器应配置成在一个序列中的第一个OOB突发之前观察到至少40 Gen 1 UI价值的空闲时间和在一个序列的第一个OOB突发中观察到至少40 Gen 1 UI价值的突发活动。
差分信号为TX+ - TX-，该参数的空闲期间的差分电压是通过在序列中的第一个OOB突发之前的最后60 Gen1 UI价值的时间内的40 Gen1 UI跨度的空闲时间的差分电压的平均值确定的。该参数的活动时间内的平均差分电压由序列中第一个突发的前60 Gen1 UI内的40 Gen1 UI时间跨度的差分电压的平均值确定。使用40 Gen1 UI的时间跨度可以确保无论突发内的起始时间是多少，信号都是在该时间跨度内。
直流平衡，平均值代表差分平均值。主动跨度取自序列中第一个突发的前60个Gen1 UI的原因是为了最大限度地减少交流耦合RC时间常数对所产生的差分偏移的影响（如果存在）。
#### 7.4.24 静噪检测器测试 
静噪检测器是接收OOB信号的重要功能。有两种情况需要测试：当高于最大阈值时，检测器应检测到，当低于最小阈值时，检测器不应检测到。图171显示了设置OOB信号适当电平的测试设置。注意，与7.4.6节中校准Lab-Sourceed信号幅度的方法相同。为确保检测的正确性，应进行多次测试，并对结果进行统计，以显示符合要求。
注意：OOB中的图案内容可能会影响检测。
应改变OOB突发中的空隙时间，以确保符合OOB时间规范（见表34）。
合规性
点
##### HBWS 50 Ohm 50 Ohm
电缆
DCB
DCB
直流电阻挡（根据需要）50欧姆
数据信号
来源与
OOB世代 50欧姆 50欧姆
## 图171 - 静噪检测器阈值测试-设置级别。 
合规
到UUT点的RX信号
接收器
测试下50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电阻挡（根据需要）50欧姆
数据信号
来源与
OOB世代50欧姆
## 图 172 - 静噪检测器阈值测试...........................................................................。

#### 7.4.25 OOB信号测试 
OOB信令用于在接收接口处于活动模式、低接口功率状态或测试模式的条件下发出特定动作的信号。
本节规定了一套测试要求，以确保OOB检测器电路在各种条件下符合OOB信号序列。
**7.4.25.1 上电序列** **7. 4.2 5.1.1 C a l i b r a t i o n **7. 
当主机控制器进行阻抗校准时，应调整自身的阻抗，使其满足7.2节的电气要求。
**7.4.25.1.2 速度协商**。
对于数据速度较高的兼容接口，应实施速度协商和过渡到较低的串行接口数据速率，按要求协商和过渡到较低的数据速度。对速度协商和过渡到较低速度的要求不超过
Gen1.
**7.4.25.1.3 接口电源管理序列** **7. 4.2 5.1.4 P a r t i a l** **7.4.25.1.3 接口电源管理序列 **7. 
接口应检测到OOB信号序列COMWAKE和COMRESET，当处于?
Partial接口电源管理状态。
当处于Partial状态时，接口应受到7.2.4.3节的低过渡密度位模式(LTDP)序列的影响；在收到有效的COMWAKE(或COMRESET)OOB信号序列之前，接口应保持在Partial状态。
在此Partial状态下，测量或计算出的功率耗散应小于Phy?
活动状态，但超过8.1节中定义的Slumber状态。
部分接口电源管理状态下的 "不超标 "功率耗散限制的要求被归类为厂商特定的要求，应作为实施性能规格的一部分进行记录。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### 序号 ATA国际组织 **7. 4.2 5.1.5 S l u m b e r**。
接口应检测到OOB信号序列COMWAKE和COMRESET，当处于?
Slumber接口电源管理状态。
当处于Slumber状态时，接口应受到7.2.4.3节的低过渡密度位模式(LTDP)序列的影响；在收到有效的COMWAKE(或COMRESET)OOB信号序列之前，接口应保持在Slumber状态。

在这种沉睡状态下的功率耗散，应测量或计算为小于Phy。
准备状态，且小于第8.1节中定义的部分状态。
斯伦贝谢接口电源管理状态下的 "不超标 "功率耗散限制要求被归类为厂商特有的要求，应作为实施性能规范的一部分进行记录。
#### 7.4.26 TDR差分阻抗 (Gen1i / Gen1m) 
本规范用已知上升时间的入射步长的反射峰值和回波损耗来描述发射机输出阻抗和接收器输入阻抗。回波损耗测量应足以验证是否符合Gen1和Gen2的要求。
Gen2的要求。为了确保替换下面概述的测试不致于失效
通过TDR差分阻抗的Gen1设计，该方法应足以验证是否符合Gen1的要求。不需要用这两种方法验证是否符合要求。
为了实现一致的测量，必须控制符合点的测试条件。这些条件包括信号发射(见7.2.6节)、回看测试装置和TDR的源匹配、TDR边缘的上升时间和形状，以及到TDR的反射回路上的衰减损耗。有多种方法可以控制和消除测试设置的影响。
在测量发射机的输出阻抗时，工作条件应是在传输MFTP期间。这是为了保证测量是在代表正常操作的工作模式下进行的。应用于有源发射机的 TDR 脉冲或激励的振幅不得超过 139 mVpp (-13.2 dBm 50 欧姆)单端。这个数字是由发射机可能存在的最大反射信号得出的。从差分回波损耗为8dB的接收器上反射出的最大发射信号700mVppd，并直接附加。
源匹配是指在符合点之前的TDR线路上有一个恒定的100欧姆差分阻抗水平。这可以通过阻抗控制的测试设置或校准程序来实现。
图173显示了在被测器件处设置上升时间的设置。上升时间应在符合点处准确设置。符合点处的TDR边沿形状受TDR发生器的边沿形状、测试设置中的衰减损耗以及在TDR处对接收信号进行的平均影响。

合规性
点
##### HBWS 50 Ohm 50 Ohm
电缆
DCB
DCB
直流电阻挡（根据需要）50欧姆
##### TDR 50欧姆 50欧姆
## 图173 - TDR差分阻抗测试-设置上升时间.............................................。

由于在设置上升时间时不包括SATA适配器，因此适配器中必须有良好的匹配和低损耗，以减少测量TDR阻抗的误差。
合规性
到UUT点的信号
接收人或
发射机
测试下50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电阻挡（根据需要）50欧姆
##### TDR 50欧姆
## 图174 - TDR阻抗测试。
#### 7.4.27 TDR单端阻抗(Gen1i / Gen1m) 
本规范用已知上升时间的入射阶梯的反射峰值值来描述发射机单端输出阻抗和接收器单端输入阻抗。为了实现一致的测量，必须控制符合点的测试条件。这些条件包括信号发射(见7.2.6节)、回看测试设置和TDR的源匹配、TDR边缘的上升时间和形状，以及到TDR的反射回路上的衰减损耗。有各种方法来控制和消除测试设置的影响。
源匹配是在符合点之前的TDR迹线上有一个恒定的50欧姆单端阻抗电平。这可以通过阻抗控制的测试设置或校准程序来实现。
图175显示了在被测器件处设置上升时间的设置。上升时间应在符合点处准确设置。符合点处的TDR边沿形状受TDR发生器的边沿形状、测试设置中的衰减损耗以及在TDR处对接收信号进行的平均化影响。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
合规
点
##### HBWS 50 Ohm 50 Ohm
电缆
DCB
DCB
直流电阻挡（根据需要）50欧姆
##### TDR 50欧姆 50欧姆
## 图175 - TDR单端阻抗测试设置上升时间。
由于设置上升时间时不包括SATA适配器，因此适配器中必须有良好的匹配和低损耗，以减少测量TDR阻抗的误差。
图178显示了与被测接收器或发射器的连接。对于单端测量。
 TDR应被设置为对两个信号同时产生正脉冲。单端阻抗是指独立观察每个信号的结果（偶数模式）阻抗。两个信号均应满足单端阻抗要求。
#### 7.4.28 直流耦合共模电压 (Gen1i / Gen1m) 
此测量仅适用于直流耦合发射机和接收机。下面对交流耦合信号或交流耦合探测的测量结果是一个接近或在0 V的值。图 176 显示了与被测接收器或发射器的连接。每条RX或TX线都以10兆欧的最小阻抗终止到地，其中包括探头和任何外部负载。共模为(Vp + Vn)/2，此项应在规定范围内。
## 图176 - 直流耦合共模电压测量..............................................。

合规性
点
发射机或接收机
测试下50欧姆
电缆
主持人 /
设备
SATA
适配器（插座
SATA接口
连接器对
Vp
Vn 10兆欧最小值。
最小10兆欧姆

#### 7.4.29 交流耦合共模电压 (Gen1i / Gen1m) 
此测量只适用于交流耦合的发射器和接收器。在SATA连接器上不能直接观察到交流耦合共模电压。
为了测量该电压，每个RX或TX信号应在IC和交流耦合电容之间进行探测。在IC内部有耦合的情况下，或IC与外部耦合电容之间没有接入信号的情况下，是无法测量的。
图177显示了与被测接收器或发射器的连接。每条RX或TX线都以10兆欧的最小阻抗对地端接，其中包括探头和任何外部负载。共模为(Vp + Vn)/2，此项应在规定范围内。
## 图177 - 交流耦合共模电压测量..............................................。

合规性
到UUT点的信号
接收人或
发射机
测试下50欧姆
电缆
主持人 /
设备
DCB
DCB
SATA
适配器（插座
SATA接口
连接器对
直流电阻挡（根据需要）50欧姆
##### TDR 50欧姆
## 图178 - TDR阻抗测试 
SATA
连接器
对子
耦合
电容器
主机/设备
##### IC 
接收人或
发射机
测试中
合规
点10兆欧最小。
伏特
Vn 10兆欧最小。

##### 在附件处进行高速隔离。
#### ATA国际组织 
#### 7.4.30 瞬态电压排序 - 实验室负载(Gen3i)..................................。

错误！未找到参考源。显示了与被测接收器或发射器的连接。每条 RX 或 TX 线路都使用实验室负载对地进行端接（实验室负载定义见 7.2.2.4）。在开机或关机顺序期间的电压瞬变值，或在Vp或Vn处看到的电源状态变化，应保持在规定的电压范围内。
在某些实验室负载配置中，会增加额外的直流阻断元件。在本测量中，实验室负载中不得添加任何额外的直流闭锁元件。
## 图 179 - 实验室负载瞬时电压排序 
### 7.5 接口状态............................................................................................................

#### 7.5.1 带外信令。
Phy应使用/检测到三个带外（OOB）信号。COMRESET。
COMINIT，COMRESET和COMWAKE。COMINIT、COMRESET和COMWAKE OOB信号应通过传输由四个Gen1 ALIGNPprimitives组成的脉冲串或由四个Gen1 Dword组成的脉冲串，每个Dword由四个D24.3字符组成，每个脉冲串的持续时间为160 UIOOB。每个突发之后是空闲期（在共模水平），其持续时间如图180和表49所示。
以前版本的串行ATA只允许ALIGN序列作为合法的OOB信号内容。本节中定义的备用OOB序列具有与下列不同的特性： 1.
在时域和频域的ALIGN序列。使用交替的OOB信号内容可能会导致与根据以前的Serial ATA规格版本设计的Gen1 Phys不兼容。因使用交替的OOB信号内容而导致的与根据早期SATA规格设计的Gen1 Phys之间的互操作性问题，由以下公司全权负责。
Phy传输这种替代内容。
在OOB信号传输过程中，信号线的差模和共模电平应符合7.2节规定的与正常数据传输相同的电气规格。在下面的图180中，显示了COMRESET、COMINIT和COMWAKE。OOB信号是通过检测差分对上相邻的活动脉冲串之间的时间间隔来观察的。接收器不需要检查OOB脉冲的持续时间。
实验室负载(LL)
发射机或接收机
测试中
合规
点
TX或RX
来自UUT的信号

##### HBWS 50欧姆 50欧姆 50欧姆
电缆
主持人 /
设备
##### SATA^ 
适配器（插座
SATA接口
连接器对
Vp
Vn 
即使它们是以明显的Gen1时间传输的，OOB突发传输也可以使用Gen2上升/下降时间传输。
任何小于或大于COMWAKE检测器关闭阈值的间距，都可以使用Gen2的上升/下降时间传输。
表34应否定COMWAKE检测器的输出。COMWAKE OOB信号用于使Phy脱离8.4.3.2节所述的掉电状态(Partial或Slumber)。该接口应至少在8.4.3.2节所述的COMWAKE检测器关闭阈值的最大时间内保持不活动。
表34最后一次突发后，以确保远端检测器正确检测到否定。设备应在一次COMWAKE结束时，保持接口不活动的时间不超过最大COMWAKE检测器关闭阈值加两个Gen1 Dwords（约228.3 ns），以防止易受串扰影响。
T1 T1
COMRESET/COMINIT
COMWAKE
T1 T2
## 图180-OOB信号...........................................................................................................。

## 表49 - OOB信号时间.....................................................................................................

时间值
T1 160 UIoob (106.7 ns 标称值)
T2 480 UIoob (320 ns 标称值) **7.5.1.1 空闲总线状态**。
在空闲总线状态下，差分信号减弱为零，而共模电平保持不变。
共模瞬态，不得超过7.2节中提到的最大振幅水平(Vcm,ac)，并应在7.2节的规定范围内稳定在前一状态共模电压的25 mV以内。
Tsettle,cm，引自7.2节。下图显示了几个发射机的例子，以及如何实现向空闲状态的转换和从空闲状态的转换。

##### 高速小型化的附件。
#### 序号 ATA国际组织（^100）^50 50 <50 <50 <50 50 100 ^50。 
##### 50 50 50 
闲置
TX+
TX- 250mV 250mV 500mV
闲置
TX+
TX- 10mA
注：通门阻抗加电阻应设置为50总。
## 图181 - 发射机示例 50 100 ^50 50 50 50 
闲置
TX+
TX- 5mA 5mA + - 250mV 50 100 ^50 50 50 50。
闲置
TX+
TX- 5mA 5mA + - Undef.

## 图182 - 发射机示例(结束)........................................................................
 **7.5.1.2 COMRESET** 
COMRESET总是来自主机控制器，并强制设备进行硬件复位。它通过传输由空闲总线条件分隔的数据突发来表示。
OOB COMRESET信号应包括不少于六个数据突发，包括突发间的时间间隔。COMRESET信号应是 1)只要系统硬复位，就应持续/不间断地进行；或 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 2)在系统硬件复位期间开始，并在否定系统硬件复位后一段时间结束，或3)在否定系统硬件复位信号后立即传送。
从硬件复位信号的断言开始，主机控制器应忽略从设备接收到的任何信号，直到COMRESET信号被传送。
每个突发应长160 Gen1 UI's(106.7 ns)，每个突发间的空闲状态应长480
Gen1 UI的长（320 ns）。COMRESET检测器寻找四个连续的脉冲串，间距为320 ns（标称）。
任何小于175 ns或大于525 ns的间隔应使COMRESET检测器输出无效。到Phy层的COMRESET接口信号应启动如下图183所示的复位序列。接口应在最后一个突发后至少保持525 ns的非活动状态，以确保远端检测器正确检测到否定。
设备
数据
设备
对齐
设备
校准
设备
COMWAKE
设备
发布
COMINIT
设备
COMINIT
主机
数据
主机
对齐
主机
D10.2
主机
发布
COMWAKE
主机
COMWAKE
主机
校准
主机
发布
COMRESET
主机
COMRESET
主机TX(设备RX)
主机/设备
关于
TX
RX)
设备（主机
## 图183 - COMRESET序列..........................................................................................。

说明： 1: 1. 主机/设备已接通电源，并正常运行，有某种形式的活动通信。
2. 主机中的某些条件导致主机发出COMRESET 3.主机释放COMRESET。一旦引起COMRESET的条件被释放，主机就会释放COMRESET信号，使总线处于静止状态。
4. 设备发出COMINIT--当设备检测到COMRESET的释放时，就会以COMINIT作出响应。如果设备启动较晚，这也是入口点。设备可以在任何时候通过发出COMINIT来启动通信。
5. 主机校准并发出COMWAKE。

6. 设备响应 - 设备在其RX对上检测COMWAKE序列并校准其发射机（可选）。在校准之后，设备发送一个6个突发COMWAKE序列，然后以设备支持的最高速度开始连续发送ALIGN序列。当ALIGNPD字发送了54.6us（2048个标称的Gen1 Dword时间）后，没有收到主机的响应，这是由从主机接收到的ALIGNPprimitives检测确定的，设备认为主机不能以该速度通信。如果还有其他速度，设备将尝试下一个支持的较低速度，以该速度发送ALIGNPDwords，时间为54.6 us（2048个标称Gen1 Dword次数）。一旦达到最低速度而没有得到主机的响应，设备就会进入错误状态。
7. 主机锁定--检测到COMWAKE后，主机开始以其支持的最低速度传输D10.2字符（见7.6）。同时，主机接收器锁定到ALIGN序列，并在准备好后，以接收到的相同速度向设备返回ALIGN序列。主机的设计应使其在任何给定速度下都能在54.6us(2048个标称Gen1 Dword时间)内获得锁定。主机在检测到COMWAKE的释放后，应允许至少873.8us(32768标称Gen1 Dword时间)来接收第一个ALIGNP。这样可以确保与多代和同步设计的互操作性。如果在873.8 us(32768标称Gen1 Dword次数)内没有收到ALIGNPis，主机就会重新启动上电序列--无限重复，直到被应用层告知停止。
8. 设备锁定--设备锁定到ALIGN序列，准备好后，发送SYNCP表示准备好开始正常工作。
9. 9.收到三个背靠背的非ALIGNPprimitives后，通信链路建立，可以开始正常操作。
 **7.5.1.3 COMINIT*** 
COMINIT总是来自设备，请求通信初始化。它与COMRESET信号在电气上是相同的，只是它由设备发出并发送给主机。设备按照下图184所示的顺序向主机请求复位。
设备
数据
设备
对齐
设备
校准
设备
COMWAKE
设备
发布
COMINIT
设备
COMINIT
主机
数据
主机
对齐
主机
D10.2
主机
发布
COMWAKE
主机
COMWAKE
主机
校准
主机TX(设备RX)
主机/设备
关于
TX
RX)
设备（主机
## 图184--COMINIT序列。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
说明。1. 主机/设备都有电源并正常运行，有某种形式的主动通信。
2. 设备中的某些条件导致设备发出COMINIT 3.主机校准并发出COMWAKE。
4. 设备响应 - 设备在其 RX 对上检测 COMWAKE 序列，并校准其发射机（可选）。在校准之后，设备发送一个6个突发的COMWAKE序列，然后以设备支持的最高速度开始发送一个连续的ALIGN序列流。当ALIGNPD字发送了54.6us（2048个标称Gen1 Dword时间）后，没有收到主机的响应，这是由检测从主机接收到的ALIGNPprimitives确定的，设备认为主机不能以该速度通信。如果还有其他速度，设备将尝试下一个支持的较低速度，以该速度发送ALIGNPDwords，时间为54.6 us（2048个标称Gen1 Dword次数）。一旦达到最低速度而没有得到主机的响应，设备就会进入错误状态。
5. 主机锁定--检测到COMWAKE后，主机开始以其支持的最低速度传输D10.2字符(见7.6节)。同时，主机接收器锁定到ALIGN序列，并在准备好后，以接收到的相同速度向设备返回ALIGN序列。主机的设计应使其在任何给定速度下都能在54.6us(2048个标称Gen1 Dword时间)内获得锁定。主机在检测到COMWAKE的释放后，应允许至少873.8us(32768标称Gen1 Dword时间)来接收第一个ALIGNP。这样可以确保与多代和同步设计的互操作性。如果在873.8us(32768标称Gen1 Dword次数)内没有收到ALIGNPis，主机就会重新启动上电序列--无限重复，直到被应用层告知停止。
6. 设备锁定--设备锁定到ALIGN序列，准备好后，发送SYNCP表示准备开始正常工作。
7. 7.收到三个背靠背的非ALIGNPprimitives后，通信链路建立，可以开始正常操作。
 **7.5.1.4 COMWAKE**。

COMWAKE可来自主机控制器或设备。它通过传输六个数据突发信号，并由一个空闲总线条件分开。
OOB COMWAKE 信号应包括不少于六个数据突发，包括突发间的时间间隔。
每个突发应长160 Gen1 UI，每个突发间空闲状态应长160 Gen1 UI。
COMWAKE探测器寻找四个连续的突发，间距为106.7 ns（标称）。
任何小于35 ns或大于175 ns的间隔应使COMWAKE检测器输出无效。COMWAKE OOB 信令用于使 Phy 脱离第 8.1 节所述的掉电状态(Partial 或 Slumber)。在最后一次突发后，接口应保持不活动状态至少175 ns，以确保远端检测器正确检测到否定。设备在COMWAKE结束时，应保持接口非活动状态不超过228.3 ns(175 ns+两个Gen1 Dwords)，以防止串扰的发生。
**7.5.1.5 设计示例（信息）**。
本节包括一个可能的设计实例，用于检测COMRESET/COMINIT和?
COMWAKE。只要符合本规范中列出的要求，其他设计实现方式也是可以的。

静噪检测器的输出被送入四个频率比较器。当连续三个周期的周期在RC时间常数确定的窗口内时，适当的信号被断言。
tdelay = 431 ns ±20% tdelay = 253 ns ±20% tdelay = 143 ns ±20% tdelay = 84.4 ns ±20%。
压制
I
COMINIT
O
COMWAKE ( - d q d q ( ( ( tdelay >= 143 ns ±20% tdelay = 500 ns ±20%(
爆破宽度
不太长
间距宽度
不太长 d q dq 重置
间距宽度
不太长
间距宽度
不太短
O ( d q d q ( ( d q dq 重置)
间距宽度
不太短
## 图185 - OOB信号检测器..............................................................................................。

下面的 "静噪检测器 "例子是利用一个内置磁滞的接收器来滤除任何不符合最小振幅的信号。静噪检测器接收器应是真差分的，以确保拒绝共模噪声。
全摆输出被送入一个脉冲发生器，通过二极管给电容充电。在没有信号的情况下，一个电阻将电容放电到地。当电容电压低于施密特触发缓冲器的接通阈值时，电路输出真实信号--表示信号电平不足。该电路应在所有电源管理状态下启用，因此，应在小功率预算下实施。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
图186和图185所示的OOB信号检测器图一样，只是为了显示功能（信息），只要符合7.2节的电气规范，在最恶劣的噪声环境（共模）条件下，可以使用其他解决方案来提高功耗。
静音
O (
RX+
RX- + 
##### I 
##### I 
## 图186 - 静噪检测器....................................................................................................。

#### 7.5.2 闲置总线状态................................................................................................。

在电源管理状态(部分和休眠)期间，电气接口应保持适当的共模电平，如第7.2节所述，在所有接口情况下，两个信号对的差值为零(所有四个导体的电压均为250 mV)，但设备和主机控制器均为交流耦合且允许导体对浮动的情况除外。
所有发射机设计应确保过渡到空闲总线条件和从空闲总线条件过渡到空闲总线条件不会导致导体上的差分基线的干扰。为了实现这一点，当处于部分电源管理模式时，交流耦合发射机应将其输出保持在零差分状态，并具有与正常工作相同的共模电平。当在沉睡电源管理模式下工作时，交流耦合发射机的共模电平允许浮动（同时保持零差动），只要它保持在7.2节所引用的限制范围内。
在空闲总线状态下，TX 输出保持在逻辑零或一状态是不可接受的，因为这将导致通信恢复时的基线偏移。
### 7.6 弹性缓冲区管理 
对于非跟踪实现，可能需要弹性缓冲电路来吸收主机和设备之间的轻微频率差异。最大的频率差异来自于符合SSC标准的设备与非SSC设备的通话。平均频率差刚刚超过0.25%，偏移量高达0.5%。
串行ATA规范是为了支持跟踪和非跟踪架构而编写的。
 非跟踪架构应在Phy层内包含弹性缓冲区。
需要注意的是，由于这个弹性缓冲区被设计成具有有限的长度，所以在Phy层协议层需要有一个机制，允许这个接收缓冲区被重置，而不需要在数据流中丢弃或增加任何位。这在接收长的连续数据流的过程中尤为重要。该Phy层协议不仅支持过采样架构，而且还能容纳无限的帧大小（帧大小受CRC多项式限制）。
链路层应跟踪一个可重置的计数器，该计数器至多每传输1024个字符(256个Dword)就滚动一次。在翻转前或在翻转前点（全部为 1），链路层应触发双重、连续的 ALIGNPprimitives 的发出，这些 ALIGNPprimitives 应包括在第 2 页。
字数。

通信建立后，链路层发出的第一和第二字应是双连续ALIGNPprimitive序列，后面最多有254个非ALIGNPDwords。该循环从另一个双连续ALIGNPprimitive序列开始重复。链路可以发出一个以上的双ALIGNPprimitive序列，但不得发送未配对的ALIGNP基元（即ALIGNPprimitives总是成对发送），除非对重定时环回有说明。
ALIGNP 由以下四个字符组成。(rd+) (rd-) 1100000101 0011111010 Align1 (K28.5) 0101010101 0101010101 Align2 (D10.2) 0101010101 01010101 Align3 (D10.2) 1101100011 0010011100 Align4 (D27.3) 
##### 高速 SERIALIZED ATTACHMENT(附件) 
#### ATA国际组织 
## 8 OOB和Phy电源状态 ...............................................................................................

### 8.1 接口电源状态 
串行ATA接口电源状态由设备和主机控制器控制。接口电源状态的定义如表50所述。
## 表50 - 接口电源状态 
国家说明
PHYRDY
Phy逻辑和主PLL都处于开启和激活状态。该接口是同步的，能够接收和发送数据。
部分
Phy逻辑是有电的，但处于降低功率状态。接口上的两条信号线都处于中性逻辑状态（共模电压）。从该状态的退出延迟应不超过10us，除非当自动部分向
支持休眠转换。当启用自动部分休眠转换时，从该状态的退出延迟应不长于最大的
沉睡退出延迟。
沉睡
Phy逻辑是供电的，但处于降低功率状态。只要交流耦合发射机的共模电平保持在表29条目交流耦合共模电压所引用的限制范围内，就允许其浮动（同时保持零差值）。从该状态的退出延迟应不超过 10 ms。
### 8.2 异步信号恢复（可选）..................................................................。

对于那些设备插入插座的使用模式（插入时施加电源）不适用的应用，Phys可支持异步信号恢复。
当信号丢失时，主机和设备都可以尝试恢复信号。主机或设备应以从PHYRDY到PHYRDYn的转换来确定信号丢失，这与进入链路层内的状态LSI：NoCommErr或LS2：NoComm有关。
请注意，PHYRDY的否定并不总是构成信号丢失(例如，Phy过渡到PhyRDYn)。
Partial/Slumber).信号的恢复与退出状态LS2:NoComm有关。信号的恢复与退出状态LS2:NoComm有关。如果设备试图在主机之前通过发出COMINIT来恢复信号，则设备应在包括COMINIT的OOB序列完成后返回其签名。如果主机支持异步信号恢复，当主机收到一个非请求的COMINIT时，主机应向设备发出COMRESET。非请求的COMINIT是指没有响应前一个COMRESET的COMINIT，其定义是主机不在?
HP2:HR_AwaitCOMINIT状态时，首次接收到COMINIT信号。
当响应一个未请求的COMINIT而向设备发送COMRESET时，主机应将状态寄存器设置为7Fh，并应将所有其他影子命令块寄存器设置为FFh。
当收到COMINIT响应COMRESET，而COMRESET与进入状态HP2B:HR_AwaitNoCOMINIT相关联时，影子状态寄存器的值应更新为FFh或80h，以反映设备已连接。
#### 8.2.1 非调用的COMINIT用法(告知性) 
向设备发出 COMRESET 会导致设备丢失软件设置，但第 13.5 节所述的支持软件设置保存的情况除外。如果
COMRESET是由于异步信号恢复和遗留模式（见4.1.72节）软件在使用。
 软件不会替换丢失的软件设置。应尽量减少向设备发出非命令的COMRESET，以确保遗留模式软件的稳健运行，避免无意中丢失关键的软件设置。
使用非命令的COMINIT的初衷是只在主机和设备之间信号丢失时使用。基于主机Phy初始化状态机，主机在接收到非请求COMINIT时，应假定要么连接了新设备，要么拔掉了电缆，与设备失去了通信。主机对非请求的COMINIT的正确响应是发出COMRESET，使设备进入已知状态。设备发出未经请求的COMINIT会导致主机发出COMRESET，这可能会改变设备的软件设置，使传统模式软件无法恢复。为了最大限度地减少这种不确定行为的可能性，设备应该只在Phy电压阈值低于最小值或作为错误恢复的最后手段时才发出未经请求的COMINIT。
### 8.3 OOB和签名FIS返回(信息) 
在OOB序列之后，一些符合旧版串行ATA规范的设备，只有在设备在OOB期间识别到COMRESET的情况下，才会向主机FIS发送带有设备签名的 "寄存器-设备"。为了确保与这些旧设备兼容的稳健主机解决方案，主机可以在系统开机事件中确保设备在电源被确定为良好后总是收到一个有效的COMRESET。热插拔感知软件应确保设备在热插拔事件中总是收到一个COMRESET。
作为主机变通的一种机制是在确定设备存在时，实现以下软件程序。1. 等待SError.DIAG.X被设置为1。
2. 通过向该位位置写一个1来清除SError.DIAG.X为零。
3. 向器件发出COMRESET（收到有效的COMINIT将X位设置为1，因此知道器件的电源是好的）。
4. 等待长达10毫秒的SError.DIAG.X被设置为1。
5. 5. 如果10毫秒后SError.DIAG.X仍未设置，则返回步骤3，如果超过重试次数则退出。
6. 此时，设备现在需要传输一个带有设备签名的寄存器FIS。

在这些条件下，还可以采用其他方法确保设备收到COMRESET。
### 8.4 开机序列状态机 
以下状态图规定了主机和设备Phy从上电到建立有源通信通道的预期行为。
在那些Phy依赖于检测接收到的ALIGNPprimitives或逗号序列进行状态转换的状态下，Phy应确保以兼容的信令速度准确检测ALIGNPprimitives，并有足够的实施保障措施，以确保在HP6:HR_AwaitAlign状态下，鉴于输入数据流中ALIGNPprimitives和D10.2的不同数据速率，不会出现ALIGNP的误检测。
#### 8.4.1 Host Phy初始化状态机 
如7.5.1.3节所述，COMINIT信号的接收应使主机重新初始化与设备的通信。不支持异步信号恢复的实现，应无条件地强制主机Phy初始化状态机过渡至
HP2B:HR_AwaitNoCOMINIT状态，当收到COMINIT时，无论其他条件如何。
支持异步信号恢复的实现应无条件地强制执行 
##### 在附件处进行高速小型化。
#### ATA国际组织 
当一个未请求的主机Phy初始化状态机过渡到HP1:HR_Reset状态时。
COMINIT被接收，而不考虑其他条件；如果COMINIT不是主动请求的，实施应强制主机Phy初始化状态机过渡到
HP2B:HR_AwaitNoCOMINIT状态，而不考虑其他条件。COMINIT的接收实际上是一个额外的过渡，进入HP2B:HR_AwaitNoCOMINIT或HP1:HR_Reset状态，出现在每个Host Phy状态中。为了简洁起见，所有的状态中都省略了这个隐含的过渡。
一个名为ResumePending的状态变量用于跟踪Host Phy是否已经到了电源管理状态，这样重新建立通信就是从低功率状态恢复的结果。如果从低功率状态恢复时没有收到COMWAKE信号，则Host Phy应允许设备重新传输COMWAKE，而不应传输一个
COMRESET到设备，除非上层明确触发COMRESET。如果一个
当从低功耗状态恢复时，没有收到器件发出的COMWAKE信号，主机可以向器件重新发送COMWAKE。
支持异步信号恢复的设计有一个状态变量，称为

RetryInterval（重试间隔），决定了尝试进行可选信号恢复轮询的速度。
RetryInterval 的值不得短于 10 ms。不实现可选重试轮询的实现可以认为RetryInterval的值是无限的。
## 表 51 - 状态图 主机 Phy 初始化状态机 
HP1: HR_Reset
传输COMRESET2，3，4。如果支持异步信号恢复，则清除ResumePending为0.^1。上电复位和显式复位请求被否定。 HR_AwaitCOMINIT 2.上电复位或显式复位请求被肯定。 上电复位或显式复位请求被确认。
注意事项 1. 该状态在响应开机复位或明确的复位请求时随时异步进入。对于支持异步信号恢复的主机，在收到来自HP2:HR_AwaitCOMINIT或HP2B:HR_AwaitNoCOMINIT状态以外的任何状态的COMINIT信号时，都会进入该状态。
2. 应至少传输6个脉冲串的COMRESET（且为6的倍数） 3. 如7.5.1.2节所述，COMRESET可以在该状态的持续时间内传输，也可以在该状态下开始传输，离开该状态后停止传输，也可以在离开该状态时传输。
4. 支持异步信号恢复的主机应在接收到的COMINIT信号去掉限定后10 ms内完成COMRESET的传输，以响应接收到的COMINIT导致过渡到此状态。

HP2：HR_AwaitCOMINIT接口静止。
1. 从设备检测到COMINIT。 HR_AwaitNoCOMINIT 2.未检测到来自设备的COMINIT，并且(不支持异步信号恢复或进入HP2:HR_AwaitCOMINIT状态后RetryInterval notelapsed)。
  HR_AwaitCOMINIT 3. 未检测到设备的 COMINIT，支持异步信号恢复，且进入 HP2:HR_AwaitCOMINIT 状态后 RetryInterval 已过。
  HR_Reset 
HP2B：HR_AwaitNoCOMINIT接口静止。
1. 未检测到设备的 COMINIT。 HR_Calibrate 2. 从设备检测到COMINIT。 HR_AwaitNoCOMINIT 接口静止.
注意事项 1. 对于不支持异步信号恢复的主机，除非在上电复位或明确的复位请求期间（在这种情况下，会进入HP1），否则任何时候响应COMINIT都会异步进入该状态。

HP3：HR_Calibrate 执行校准^1。
1. 校准完成或未执行旁路。 HR_COMWAKE 2. 校准未完成。 HR_Calibrate（校准）。
注意事项 1. 校准是可选的，如果绕过或不执行，直接进入HR_COMWAKE。如果旁路或未执行，直接进入HR_COMWAKE。

HP4: HR_COMWAKE 发送 COMWAKE。
1. 1. 未检测到设备的COMWAKE。 HR_Await COMWAKE 2. 检测到来自设备的COMWAKE。 HR_AwaitNoCOMWAKE 
HP5：HR_AwaitCOMWAKE接口静止。
1. 检测到设备的 COMWAKE。 HR_AwaitNoCOMWAKE 2. 没有从设备检测到COMWAKE，并且(不支持异步信号恢复或进入HP5:HR_AwaitCOMWAKE状态后RetryInterval notelapsed)。
  HR_AwaitCOMWAKE 3. 未检测到来自设备的COMWAKE，且支持异步信号恢复，自进入HP5:HR_AwaitCOMWAKE状态后RetryIntervalelapsed，且ResumePending = 0。
  HR_Reset 4. 未检测到来自设备的 COMWAKE，支持异步信号恢复，且自进入 HP5:HR_AwaitCOMWAKE 状态和 ResumePending = 1 以来 RetryIntervalelapsed。

##### HR_COMWAKE 
HP5B: HR_AwaitNoCOMWAKE 接口静止 1. 未检测到设备的 COMWAKE。 HR_AwaitAlign^ 2. 检测到来自设备的COMWAKE，HR_AwaitNoCOMWAKE。 HR_AwaitNoCOMWAKE接口静止。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
HP6: HR_AwaitAlign 主机以最低支持的速度传输D10.2字符^2 1. 从设备检测到ALIGNP(以任何支持的速度)^3.HR_AdjustSpeed 2.
        HR_AdjustSpeed 2.ALIGNP未从设备检测到，且自进入HR_AwaitAlign后已过了873.8 us (32768 Gen1 Dwords)。
  HR_Reset1,4 3.
  HR_AwaitAlign
##### 注意事项。 1. 主机无限期重试开机序列，除非应用层明确关闭。
2. 主机应按照OOB信令部分的规定，在COMWAKE被否定后不晚于533 ns（20个Gen1 Dwords）开始传输D10.2字符。
3. 主机设计人员应注意，在释放COMWAKE后（通过保持空闲条件超过175 ns），允许设备53.3 ns（2个Gen1 Dwords）开始发送字符。在这之前，总线处于空闲状态，可能会受到其他设备的串扰。需要注意的是，在这个窗口中的串扰不会导致ALIGNP的错误检测。
    例如：合规的主机可能会在短短112 ns内检测到COMWAKE的否定。
 这样的主机在检测到COMWAKE的发布后，应该至少等待116.3ns(175+53.3-112)才开始寻找ALIGNPprimitives。
4. 主机Phy初始化状态机可以使用过渡到HR_Reset作为速度协商的方法。

HP7：HR_SendAlign 传送ALIGNPat速度检测到 1.从设备检测到三个背靠背的非ALIGNP基元2。
HR_Ready 2. 未从设备检测到三个背靠背的非ALIGNP基元。 HR_SendAlign 1
##### 注意事项。 1. 除非应用层明确关闭，否则主机将无限期重试 2. 非ALIGNP基元可以通过在字节0位置出现K28.3控制字符来检测。
 
HP8：HR_Ready 从Link^1发送字。
1. 来自 Link 的部分信号被断言。 HR_Partial 2. 來自 Link 的 Slumber 訊號為有效，HR_Partial 2.  HR_Slumber 3. 未收到电源管理请求，且（不支持异步信号恢复或未启动信号恢复轮询 2 或检测到接收信号）。
  HR_Ready 4. 未收到电源管理请求，且支持异步信号恢复，未检测到接收信号，且未启动信号恢复轮询 2 。
  HR_Reset
##### 注意事项。 1. PHYRDY只有在HR_Ready状态下，且Phy与其接收机的输入信号保持同步，并在其发射机上发射有效信号时才会被断言。
2. 主机选择发起可选的信号恢复轮询的延迟是特定于实现的，但应大于ALIGNPtransmit间隔。

HP9：HR_Partial
接口静止。如果支持异步信号恢复，则设置ResumePending=1。
1. 来自Link的部分信号被否定，没有检测到设备1,2的COMWAKE。 
##### HR_COMWAKE 2.来自Link的部分信号被否定，且没有检测到设备1、2的COMWAKE。部分来自Link的信号被否定，并且从设备1,2检测到COMWAKE。 HR_AwaitNoCOMWAKE 3.来自Link的沉睡信号被断言，并且支持主机自动部分到沉睡的转换^3 HR_Slumber 4. 来自 Link asserted 的 Partial 信号。 HR_Partial
注意事项 1. 主机Phy应记住在Partial期间是否检测到COMWAKE，以确定唤醒请求是源于主机还是Phy。
2. 主机Phy只有在从Partial模式恢复后，且Phy准备启动通信后，才可进行此过渡。如果Phy尚未从Partial模式恢复，则应保持此状态。
3. 如果主机和设备支持主机自动Partial到Slumber的转换，则主机Phy可以过渡到HR_Slumber。请参考13.16了解更多关于自动部分模式到休眠模式转换的信息。
 
##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
HP10: HR_Slumber
接口静止。如果支持异步信号恢复，则设置ResumePending=1。
1. 来自Link的沉睡信号被否定，没有检测到来自设备^1的COMWAKE，2.  
##### HR_COMWAKE 2. 來自 Link 的 Slumber 訊號被否定，且偵測到裝置^1、2 的 COMWAKE，則設定 ResumePending = 1。 HR_AwaitNoCOMWAKE 3.来自Link的沉睡信号被确认。 HR_Slumber
注意事项 1. 主机Phy应记住在Slumber期间是否检测到COMWAKE，以确定唤醒请求是源于主机还是Phy。
2. 主机Phy只有在从Slumber模式恢复后，且Phy准备好启动通信后，才可进行此过渡。如果Phy尚未从沉睡模式恢复，则应保持此状态。

HP11：HR_AdjustSpeed 接口未定义但不静止^1 1 完成向适当速度的过渡。 HR_SendAlign 2 未完成向适当速度的转换。 HR_AdjustSpeed^1
注意事项 1. 一些实施方案可能会出现瞬态情况，即在其内部传输/接收速度变化期间传输无效信号。在速度转换期间，主机可能会在长达53 ns（两个Gen1 Dword）的时间内传输无效信号。在此期间可能不满足传输抖动和单位间隔时间要求，但应满足在此状态下传输的所有其他位。在速度转换时间内可能会出现相位偏移。

#### 8.4.2 设备Phy初始化状态机...............................................................。

如7.5.1.2节所述，COMRESET信号的接收应被设备视为硬件复位信号，无论其他条件如何，都应无条件强制Device Phy初始化状态机过渡到DP1:DR_Reset初始状态。接收COMRESET实际上是一个额外的过渡到DP1:DR_Reset状态，它出现在每个Device Phy状态中。为了简洁起见，所有状态中都省略了这个隐含的转换。
## 表 52 - 状态图 Device Phy 初始化状态机 
DP1: DR_Reset 1

接口静止^ 1. 未检测到COMRESET，开机复位被否定。 检测到COMRESET或开机复位。
        DR_COMINIT 检测到 COMRESET 或开机复位。
注意事项 1. 该状态在响应开机复位或收到主机的COMRESET信号时随时异步进入。

DP2.DR_COMINIT 传输 COMINIT1、2 1: DR_COMINIT 传输 COMINIT1, 2 1. 无条件 DR_AwaitCOMWAKE
注意事项 1. COMINIT传输的时间为6个脉冲串 2. 如第13.1节所示，设备应在10毫秒内响应COMINIT信号。 
DP2.DR_COMINIT DR_COMINIT 传输 COMINIT1、2 上电复位的否定或去掉收到的 COMRESET 信号的限定。
DP3: DR_AwaitCOMWAKE 接口静止1. 从主机检测到COMWAKE DR_AwaitNoCOMWAKE 2. 没有检测到主机的COMWAKE，并且(异步信号恢复没有实现，或者进入DP3:DR_AwaitCOMWAKE状态后RetryInterval notelapsed)。
  DR_AwaitCOMWAKE 3. 自进入DP3:DR_AwaitCOMWAKE状态后，未检测到来自主机的COMWAKE，且未执行异步信号恢复，RetryIntervalelapsed。
  DR_Reset
##### DP3B.DR_AwaitNoCOMWAKE接口静置1: 
DR_AwaitNoCOMWAKE 接口静止 1. 未检测到主机的 COMWAKE，并且是开机复位序列的一部分^1.
        DR_Calibrate 2. 没有检测到来自主机的COMWAKE，并且是部分/沉睡唤醒序列的一部分^1。

##### DR_COMWAKE 3.检测到主机的COMWAKE。从主机检测到COMWAKE，并且是部分/沉睡唤醒序列^1的一部分。 DR_AwaitNoCOMWAKE
注意事项 1. 设备应记住它是否被发送到Partial或Slumber模式，以便进行正确的唤醒操作。

DP4: DR_Calibrate 执行校准^1 1. 校准完成或未执行旁路。 DR_COMWAKE 2. 校准未完成。 DR_Calibrate(校准)
注意事项 1. 校准是可选的，如果绕过或不执行，直接进入DR_COMWAKE。如果旁路或不执行，直接进入DR_COMWAKE。

DR_COMWAKE DR_COMWAKE 发送 COMWAKE 1. 无条件的 DR_SendAlign  
##### 在附件处进行高速小型化。
#### ATA国际组织 
DP6: DR_SendAlign 传送 ALIGNP1,2,3,5 1.主机检测到 ALIGNP(设备锁定到输入数据)^4.
        DR_Ready 2. 未从主机检测到 ALIGNP，ALIGNP 基元以非最低速度传输了 54.6 us (2048^5 Gen1 ALIGNPprimitives) ^6.
  在最低速度^6的情况下，未从主机和传输了54.6 us (2048^5 Gen1 ALIGNPprimitives) 的ALIGNP基元中检测到ALIGNP。
  DR_Error 4. 未从主机和 ALIGNP 基元中检测到 ALIGNP，传输时间少于 54.6 us (2048 Gen1 ALIGNPprimitives)。
  DR_SendAlign
##### 注意事项。 1. 如果这是从休眠或部分电源管理状态恢复的一部分，设备应以先前协商的速度发送ALIGNPat。对于所有其他情况，ALIGNP应以设备支持的最快速度发送。
2. ALIGNP原件应仅以有效频率发送（如果PLL未锁定，则发送D10.2）。
3. 在按OOB信令部分的规定释放COMWAKE后，器件应确保接口处于活动状态（而不是静止状态）。
4. 设备设计人员应注意，在检测到COMWAKE被否定后，允许主机在533 ns（20个Gen1 Dwords）内开始发送D10.2字符。在这之前，总线处于空闲状态，可能容易受到其他设备的串扰。需要注意的是，在这个窗口中的串扰不会导致ALIGNP的错误检测。设备可以根据需要将这个超时时间延长到54.6 us (2048个Gen1 Dwords)(最大总时间为109.2 us)，以使接收机有时间锁定到主机ALIGNP。
5. 器件让总线空闲的时间不得超过53.3ns(2个Gen1 Dwords)长于所需的175ns，以否定COMWAKE。
6. 如果这是从沉睡或部分电源管理状态恢复的一部分，设备Phy不应因未能建立通信而降低速度。当未能建立通信时，它应该直接过渡到DR_Error状态，以启动COMWAKE序列的重试。

DP7：DR_Ready^1 来自Link的传输字^1。来自 Link 的部分信号被断言。 DR_Partial 2. 來自 Link 的 Slumber 訊號為有效，DR_Slumber 3.  DR_Slumber 3. 没有收到电源管理请求，（不支持异步信号恢复或检测到接收信号）。
  DR_Ready 4.未收到电源管理请求，且（不支持异步信号恢复或检测到接收信号）。未收到电源管理请求，且支持异步信号恢复，未检测到接收信号。
  DR_Error 5.未收到电源管理请求，且不支持异步信号恢复，未检测到接收信号。
##### 注意事项。 1. PHYRDY只有在DR_Ready状态下，且Phy与其接收机的输入信号保持同步，并在其发射机上传输有效信号时才会被断言。
 

DP8: DR_Partial Interface quiescent 1. 来自Link的部分信号被否定^1 DR_COMWAKE 2. 来自Link negated的部分信号和主机检测到的COMWAKE信号^1 DR_AwaitNoCOMWAKE 3.来自Link asserted的沉睡信号和设备自动部分到沉睡的转换启用^2 DR_Slumber 4. 来自Link的部分信号被检测到，并且设备自动部分转入休眠状态^2 DR_Slumber 4.
注意事项 1. 设备Phy只有在从Partial模式恢复后，并且Phy准备好启动通信后，才可以进行这种转换。如果Phy尚未从Partial模式恢复，则应保持此状态。
2. 如果启用了设备自动Partial到Slumber过渡，设备Phy可以过渡到DR_Slumber。关于自动部分模式到休眠模式转换的详细信息，请参考13.16。

DP9: DR_Slumber 接口静止 1. 来自链路的休眠信号被否定^1 DR_COMWAKE 2. 来自Link negated和主机检测到COMWAKE信号^1 DR_AwaitNoCOMWAKE 3. 来自Link asserted的Slumber信号 DR_Slumber 4.
注意事项 1. 设备Phy只有在从休眠模式中恢复过来，并且Phy准备好启动通信后，才可以进行这种转换。如果 Phy 尚未从 Slumber 模式恢复，则应保持此状态。

DP10: DR_ReduceSpeed Interface quiescent 1. Transition to a slower speed complete DR_SendAlign^1 2. 转移到较慢速度未完成 DR_ReduceSpeed^1 2.
注意事项 1. 当设备在为该速度定义的信令容差范围内准确地传输有效信号时，过渡到新的速度被定义为完成。

DP11：DR_Error 接口静止 1. 不是由于未能恢复而导致的错误，并且((不支持异步信号恢复)或(支持异步信号恢复，且进入DP11:DR_Error状态后未经过RetryInterval))   DR_Error 2. 从沉睡状态恢复或部分失败 DR_COMWAKE 3. 不是因为未能恢复而出错，支持异步信号恢复，且进入DP11:DR_Error状态后已过了RetryInterval。
  DR_Reset 
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 8.4.3 速度谈判。
在状态HP6:HR_AwaitAlign中，主机有可能以不同于主机等待的速度接收信号(即Gen1主机可能会收到来自设备的Gen2信号，或者Gen2主机可能会收到来自设备的Gen1信号)。当呈现高于支持的传入信令速度时，一些数据恢复电路可能会返回不可预测的恢复数据。相反，当接收到比预期更低的信令速度时，信号混叠效应可能会影响解码信号的准确性。由于恢复的数据可能是无效的，因此，实施例应确保ALIGNP基元在以下情况下准确解码。
HP6:HR_AwaitAlign状态，因为在该状态下恢复的数据有可能是由于以不同于主机预期的速度错误解码信号的结果。
为了减少对错误的ALIGNPdetection/handshake的敏感性，接收机应该完全限定整个接收到的ALIGN序列，而不是只依靠限定其中的一部分(例如只是逗号序列)。为确保从的过渡的额外手段。
HP6:HR_AwaitAlign准确遍历而不遍历响应数据恢复电路的杂散信号是为了确保一系列连续的ALIGNP基元被成功解码。其他可能的手段也可以确保ALIGNP检测的准确性。
设计者有责任确保与Phy初始化状态机相关的条件和状态转换被准确执行，并且不容易因接收到与当前选择的速度不同或不支持的速度的信号而产生错误的解码/转换。
设备不应依赖D10.2的主机传输作为确定主机通信速度的手段，因为D10.2传输是以最低支持的通信速度进行的，而不一定是以相互支持的最高数据速度进行协商。D10.2的传输只是为了抑制串扰和提供参考时钟，设备中D10.2的接收没有协议联锁
Phy初始化状态机。
**8.4.3.1 上电顺序时序图**。
下面的时序图和描述是为了清晰和提供信息。第8.4节提供的状态图包括规范性行为规范，是最终参考。

主机 TX (设备 RX)
主机^
功率^
On^
主机^
COMRESET^
主机^
释放^
COMRESET^
主机^
校准^
主机^
COMWAKE^
主机^
释放^
COMWAKE
主机^
Align^
主机
数据
主机^
功率^
关
主机^
D10.2
(RX)
设备
功率
On^
设备TX（主机
设备
COMINIT
设备
发布
COMINIT
设备

校准
设备
对齐
设备
数据
设备
功率
关
设备
COMWAKE
## 图187 - 开机程序  
##### 在附件处进行高速小型化。
#### ATA国际组织 
说明。1. 主机/设备断电--主机和设备断电。
2. 上电--主机侧信号调理将TX和RX对拉到中性状态（共模电压）。
3. 主机发出COMRESET 4.主机释放COMRESET。上电复位后，主机释放COMRESET信号，使总线处于静止状态。
5. 设备发出COMINIT--当设备检测到COMRESET的释放时，它将以COMINIT来响应。如果设备启动较晚，这也是入口点。设备可以在任何时候通过发出COMINIT来启动通信。
6. 主机校准并发出COMWAKE。
7. 设备响应 - 设备在其 RX 对上检测 COMWAKE 序列并校准其发射机（可选）。校准后，设备发送六个突发 COMWAKE 序列，然后以设备支持的最高速度开始发送连续的 ALIGN 序列流。当 ALIGNPprimitives 发送了 54.6 us（2048 个标称 Gen1 Dword 时间）后，没有收到主机的响应（由从主机接收的 ALIGNPprimitives 检测确定），设备认为主机不能以该速度通信。如果有其他速度可用，设备将尝试下一个较低的支持速度，以该速度发送 ALIGNPprimitives 54.6 us（2048 个名义 Gen1 Dword 次）。一旦达到最低速度而主机没有响应，设备将进入错误状态。
8. 主机锁定--检测到COMWAKE后，主机开始以其支持的最低速度传输D10.2字符（见7.6）。同时，主机接收器锁定到ALIGN序列，准备好后，以接收到的速度将ALIGN序列返回给设备。主机的设计应使其在任何给定速度下都能在54.6us(2048个标称Gen1 Dword时间)内获得锁定。在检测到COMWAKE的释放后，主机应允许至少873.8us(32768标称Gen1 Dword时间)来接收第一个ALIGNP。这保证了与多代和同步设计的互操作性。如果在873.8us(32768标称Gen1 Dword次数)内没有收到ALIGNPis，主机就会重新启动上电序列--无限重复，直到被应用层告知停止。
9. 设备锁定--设备锁定到ALIGN序列，准备好后，发送SYNCPprimitive，表示已经准备好开始正常工作。
10. 收到三个背靠背的非ALIGNPprimitives后，通信链路建立，可以开始正常操作。
 **8.4.3.2 Partial/Slumber to PHYRDY** **8.4.3.2.1 主机启动** 
主机可以通过在状态机中的 "主机COMWAKE "点进入开机序列，启动从部分或休眠状态的唤醒。校准和速度协商将被绕过，因为在开机时已经执行了校准和速度协商，而且系统性能取决于快速恢复延迟。因此，设备应以开机时确定的速度传输 ALIGNPprimitives。
**8.4.3.2.2 设备启动**。
设备可以通过在状态机中的 "设备COMWAKE "点进入开机序列，启动从部分或休眠状态的唤醒。校准和速度协商被绕过，因为它已经在开机时执行，而且系统性能取决于快速恢复延迟。因此，设备应以开机时确定的速度传输 ALIGNP 基元。
 **8.4.3.3 PHYRDY to Partial/Slumber** **8.4.3.3.1 主机发起** 
设备TX(主机RX)
主机TX(设备RX)
设备
PMACK
东道主
部分
裝置
部分
主机
PMREQ_P P
部分
模式
P
## 图188-PHYRDY至部分主机发起的。
注意：对于Slumber，除了PMREQ_PP被替换为PMREQ_SP，Partial被替换为Slumber外，其他顺序相同。
详细顺序。1. 主机应用层向主机传输层发送请求。
2. 2. 主机传输层向主机链路层发送请求。
3. 主机链路层将请求编码为PMREQ_PPprimitive，并传送给主机Phy层。
4. 主机Phy层将PMREQ_PPprimitives序列化并传送给设备Phy层。
5. 设备Phy将PMREQ_PPprimitives去序列化，并传输到设备Link层。
6. 设备链路层对PMREQ_PPprimitives进行解码，并将请求传送给设备传输层。
7. 7.设备传输层将请求传送给设备应用层。
8. 设备应用层处理并接受请求，向设备传输层发出接受请求。向设备传输层发出接受请求。
9. 设备传输层向设备链路层发送接受请求。

10. 设备链路层将接受情况编码为PMACKPprimitive，并向设备Phy层传输四次。
11. 设备Phy层向主机Phy层传输四到十六个PMACKPprimitives。
12. Device Link层将设备Phy层置于Partial状态。
13. 主机Phy层将PMACKPprimitives去序列化，并传送到主机Link层。
14. 主机Link层对PMACKPprimitives进行解码，并将接受情况传送给主机Transport层。
15. 主机链路层将主机Phy层置于Partial状态。
 
##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### 串行ATA国际组织 16. 主机传输层向主机应用层传输接受。
 **8.4.3.3.2 设备启动**。
设备TX(主机RX)
主机TX(设备RX)
主机
PMACK P
P
东道主
部分
裝置
部分
设备
PMREQ_P
部分
模式
## 图189 - PHYRDY至部分设备启动.....................................................................。

详细顺序。1. 设备应用层向设备传输层发送请求。
2. 设备传输层向设备链路层发送请求。
3. 设备链路层将请求编码为PMREQ_PPprimitive，并传送给设备Phy层。
4. 设备Phy层将PMREQ_PPprimitives序列化并传送给主机Phy层。
5. 主机Phy将PMREQ_PPprimitives去序列化，并传送给主机Link层。
6. 6. 主机Link层对PMREQ_PPprimitives进行解码，并将请求传送给主机Transport层。
7. 7.主机传输层将请求传送给主机应用层。
    注a在此上下文中，主机应用层不一定意味着BIOS或其他主机CPU编程。相反，应用层是芯片组逻辑的智能控制部分。
8. 主机应用层处理并接受请求。向主机传输层发出接受。
9. 主机传输层将接受的请求传送给主机链路层。
10. 主机链路层将acceptation编码为PMACKP，并分四次传送给主机Phy层。
11. 11.主机Phy层向设备Phy层传输四到十六个PMACKP原语。
12. 主机链路层断言Partial信号，使主机Phy层处于Partial状态。
13. 主机Phy层否定PHYRDY信号。
14. 设备Phy层去序列化PMACKP基元，并将其传输给设备Link层。
  15. 设备链路层对PMACKP基元进行解码，并将接受情况传送给设备传输层。
16. 设备Link层断言Partial信号，并使设备Phy层处于Partial状态。
17. 设备Phy层否定PHYRDY信号。
18. 18. 设备传输层向设备应用层发送接受信号。
 
##### HIGH SPEED SERIALIZED ATTACHMENT（高速串行化）。
#### ATA国际组织 
## 9 链接层 ...........................................................................................................................

### 9.1 概述 
链路层发送和接收帧，根据来自传输层的控制信号传输基元，并接收来自Phy层的基元，这些基元被转换为控制信号发送给传输层。Link层不需要认知帧的内容。
主机和设备Link层的状态机是相似的，但是当主机和设备都请求传输的所有权时，设备被赋予优先权。
#### 9.1.1 帧传输 
当传输层请求传输一帧时，链路层提供以下服务：a与对等的链路层协商传输一帧，如果主机和设备都请求传输，则解决仲裁冲突a在传输层数据周围插入帧包络（如SOFP、CRC、EOFP等）。
a 从传输层接收D字形式的数据。
a 计算传输层数据的CRC。
a 传输帧。
a 响应FIFO或对等Link层的请求，提供帧流控制。
a 接收来自对等Link层的帧接收确认。
a 向传输层报告传输良好或Link/Phy层错误。
a 执行8b/10b编码 a 对数据D字进行扰乱，使潜在的EMI辐射分布在更大范围内。
#### 9.1.2 帧接收 
当从Phy层接收到数据时，链路层提供以下服务：a向对等链路层确认接收帧的准备状态。
a 接收来自Phy层的编码字符形式的数据。
a将编码后的8b/10b字符流解码成对齐的D字数据。
a 去除帧周围的包络（即SOFP、CRC、EOFP）。
a 对接收到的Dword进行CRC计算。
a 应FIFO或对等Link层的请求，提供帧流控制。
a 将计算出的CRC与接收到的CRC进行比较。
a 向传输层和对等链路层报告良好的接收或链路/物理层错误。
a 对从对等链路层接收到的数据Dword进行解扰。
### 9.2 编码方法。
........................................................................................................

通过串行ATA传输的信息应与数据或控制字符指示器一起，每次一个字节(8位)编码成一个10位编码字符，然后逐位串行发送。通过串行ATA接收的信息应一次收集10位，组合成一个编码字符，并解码成正确的数据字符和控制字符。8b/10b码允许对所有256种八位数据组合进行编码。控制字符集的一个子集被串行ATA所利用。

#### 9.2.1 符号和约定。
串行ATA使用字母符号来描述数据位和控制变量。下面描述了这些符号之间的转换过程。本节还介绍了用于区分数据字符和控制字符的惯例。最后，将介绍数据字符和控制字符的翻译示例。
一个未编码的数据字节由八个位A、B、C、D、E、F、G、H和控制变量Z组成。
编码过程的结果是一个10位字符a,b,c,d,e,i,f,g,h,j。一个位是二进制0或二进制1。控制变量Z的值为D或K，当与一个字节相关联的控制变量的值为D时，该字节被称为数据字符。当与字节相关联的控制变量的值为K时，该字节被称为控制字符。
如果一个数据字节没有伴随着特定的控制变量值，则控制变量Z被假定为Z＝D，数据字节应被编码为数据字符。
下面的表53说明了字节中的编号未编码位、控制变量和编码方案中的字母标记位之间的关联。
## 表53--位指定.........................................................................................................。

数据字节
符号
##### 7 6 5 4 3 2 1 0 
控制
可变
未编码位符号 H G F E D C B A Z
每个字符都有一个名称Zxx.y，其中Z是控制变量的值(D代表数据字符，K代表控制字符)，xx是由E、D、C、B和A位依次组成的二进制数的十进制值，y是由H、G和F位组成的二进制数的十进制值。
下图190，显示了各种表示方法之间的关系。
字节 7 6 5 4 3 2 1 0 Z 7 6 5 4 3 2 1 0 Z 字节 + + 。
控制控制8+控制8+控制
输入到编码输出 HGF E D C B A Z H G F E D C B A Z 解码功能功能
编码解码功能 8B/10B编码器 8B/10B解码功能
从输入输出到编码 ab c d e i f g h j a b c d e i f g h j 解码函数函数 10 10。
Phy Phy 传输接收 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9
比特0先传送，比特0先接收。
## 图190 -- -- 命名法参考资料  
##### 在附件处进行高速小型化。
#### ATA国际组织 
下表54显示了控制和数据字节从字节符号到字符符号的转换。所选的例子具有特殊意义，在从数据符号转换到8b/10b码值时也会用到。
## 表54 - 转换示例................................................................................................

字节符号 BCh，控制字符 4Ah，数据字符。
比特符号
控制 76543210 变量 10111100 K
控制 76543210 变量 01001010 D
未编码的比特符号
##### HGFEDCBA Z 
##### 101 11100 K 
##### HGFEDCBA Z 
##### 010 01010 D 
按照Zxx.y的惯例，重新排列了比特符号。
##### Z EDCBAHGF 
##### K 11100 101 
##### Z EDCBAHGF 
##### D 01010 010 
字符名称 K 28 .5 D 10 .2.
#### 9.2.2 字符代码 
串行ATA使用的编码方案将未编码的数据和控制字节转换为字符。编码后的字符由Phy层通过串行线传输，在那里从Phy层接收到这些字符，并将其解码成相应的字节和控制值。
串行ATA使用Widmer和Franaszek描述的8b/10b编码方法的一个子集（见参考文献）。串行ATA编码使用所有256个数据字节编码，而只使用两个控制码。接收任何未使用的代码都是一类接收错误，称为代码违规。
**9.2.2.1 编码结构**。
8b/10b编码过程被定义为两个阶段。第一阶段使用5B/6B编码器将未编码输入字节的前5位编码成一个6位子块。该阶段的输入包括当前运行的差异值。第二阶段使用3B/4B编码器将数据字节的剩余3位和经5B/6B编码器修改后的运行差值编码成4位值。
在下面的推导中，假设控制变量（Z）的值为D。
 因此是一种隐性输入。
**9.2.2.2 运行差异的概念**。
运行差异是一个二进制参数，其值为负（-）或正（+）。
在传输任何编码字符后，发送器将为其计算一个新的值。
基于传输字符的值的运行差异。
在COMRESET、初始上电、退出任何电源管理状态或退出任何诊断模式后，接收机应假定其初始值为正值或负值。
运行差异。接收者在收到一个编码字符后，应根据以下规则和表格确定该编码字符是否有效，并根据收到的字符内容计算一个新的运行差异值。

以下规则用于计算发送方在发送一个编码字符后的新运行差异值（发送方的新运行差异值）和接收方在接收一个编码字符后的新运行差异值（接收方的新运行差异值）。
编码字符的运行差异应在两个子块上计算，其中前六位（abcdei）形成一个子块--六位子块。最后四位（fghj）形成第二个子块--四位子块。六位子块开始时的运行差异是最后一个编码字符结束时的运行差异，或者是上述第一个编码字符传输或接收的初始条件。四位子块开头的Running Disparity是由六位子块产生的Running Disparity。
编码字符结束时的Running Disparity--以及下一个编码字符的初始Running Disparity--是四位子块结束时的Running Disparity。
每个子块的运行差异应按以下方式计算。
如果子块中的1比0多，则任何子块末尾的运行差距为正值。如果六位子块的值是000111，则在六位子块的末尾也是正值，如果四位子块的值是0011，则在四位子块的末尾是正值。
如果子块包含的0比1多，则任何子块末尾的运行差距为负。如果六位子块的值是111000，那么它在六位子块末尾也是负值，如果四位子块的值是1100，那么它在四位子块末尾也是负值。
否则，对于任何一个0和1数目相等的子块，在Running?
子块末尾的差异性与子块开始时的差异性相同。
0和1数量相等的子块称为中性不等。
8b/10b码限制000111、111000、0011和1100子块的生成，以限制子块之间0和1的运行长度。包含000111或0011的子块只有在子块开始时的运行差距为正值时才会生成，导致子块结束时的运行差距为正值。同样，包含111000或1100的子块只有在子块开始时的运行差距为负值时才会生成，由此产生的运行差距也将为负值。
运行差距的规则将导致生成一个差距与前一个字符相反或中性的字符。
差距为非零（非中性）的子块为交替差距。
**9.2.2.3 数据编码**。
表55和表56描述了每个子块的代码和运行差异生成规则。其结果可用于生成数据字符表中的数据。
用于生成结果的数字逻辑可以在Franaszek和Widmer[2]中找到(见参考文献)。控制字符的生成在专利中也有涉及，但不在此赘述。
在后面的表格中，rd+或rd-代表当前（传入）的运行差距，rd'代表结果的运行差距。结果的运行差异列使用-rd表示运行差异极性的变化，而rd表示结果的子块具有中性差异。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
## 表55----5B/6B编码。
输入 abcdei 输出 输入 abcdei 输出
Dx EDCBA rd+ rd- rd'
Dx EDCBA rd+ rd- rd'
D0 00000 011000 100111 D16 10000 100100 011011 -RD
D1 00001 100010 011101 D17 10001 100011
D2 00010 010010 101101 -RD
D18 10010 010011
D3 00011 110001 rd D19 10011 110010
D4 00100 001010 110101 -rd D20 10100 001011
D5 00101 101001 D21 10101 101010
D6 00110 011001 D22 10110 011010 rd。
D7 00111 000111 111000路
D23 10111 000101 111010
D8 01000 000110 111001 -RD D24 11000 001100 110011 -RD
D9 01001 100101 D25 11001 100110
D10 01010 010101 D26 11010 010110 RD

D11 01011 110100 D27 11011 001001 110110 -RD
D12 01100 001101 D28 11100 001110 RD
D13 01101 101100 D29 11101 010001 101110
D14 01110 011100 rd
D30 11110 100001 011110
D15 01111 101000 010111 -RD D31 11111 010100 101011 -RD
## 表56 - 3B/4B编码。
输入 fghj 输出
Dx.y HGF rd+ rd- rd'
Dx.0 000 0100 1011 -rd.
Dx.1 001 1001
Dx.2 010 0101
Dx.3 011 0011 1100公路
Dx.4 100 0010 1101 -rd.
Dx.5 101 1010
Dx.6 110 0110 rd
Dx.P7 111 0001 1110
Dx.A7 111 1000 0111 -RD
注释。
如果[(rd>0)且(e=i=0)]或[(rd<0)且(e=i=1)]，A7取代P7 **9.2.2.4 编码示例**。
下表57中的编码示例说明了运行差异计算的方式。
第一个转换例子完成了数据字节值4Ah(这是D10.2的字符名)翻译成编码字符值 "abcdei fghj"="010101 0101"。这个值具有特殊的意义，因为(1)它是中性差值，而且还包含一个交替的零/一模式，它代表可能产生的最高数据频率。

在第二个例子中，对名为D11.7的8b/10b字符进行编码。假设传入的Running Disparity为正值，这个例子显示了Dx.P7/Dx.A7的替换。在初始rd+值的情况下，D10翻译成abcdei值为110100b，由此产生的Running?
6位子块的差值为正。由于[(rd>0) AND (e=i=0)]，对4位子块进行编码会触发Dx.A7对Dx.P7的替换条款。
## 表57 - 编码示例...................................................................................................。

初始 rd
角色
名称abcdei
輸出6位元子母
Block rd fghj
输出 4 位子块 rd
编码
角色
终止日期
- D10.2 010101 - 010101 - 010101 - + D11.7 110100 + 1000 - 110100 1000 - **9.2.2.5 8b/10b 有效编码字符**。
下表定义了有效的数据字符和有效的控制字符。这些表应用于生成编码字符（编码）以供传输。在接收过程中，该表用于查询和验证接收字符的有效性（解码）。
在表中，每个数据字符和控制字符有两列，代表两个编码字符。一列代表当前运行差异为负值时的输出，另一列代表当前运行差异为正值时的输出。

##### 高速 SERIALIZED ATTACHMENT(高速)。
#### 串行ATA国际组织 **9.2.2.5.1 数据字符**。
## 表58 - 有效数据字符 abcdei fghj 输出 abcdei fghj 输出。
名称字节
电流 rd-电流 rd+
名称字节
电流 rd-电流 rd+
D0.0 00小时 100111 0100 011000 1011 D0.1 20小时 100111 1001 011000 1001
D1.0 01h 011101 0100 100010 1011 D1.1 21h 011101 1001 100010 1001 1.
D2.0 02h 101101 0100 010010 1011 D2.1 22h 101101 1001 010010 1001
D3.0 03h 110001 1011 110001 0100 D3.1 23h 110001 1001 110001 1001
D4.0 04小时 110101 0100 001010 1011 D4.1 24小时 110101 1001 001010 1001
D5.0 05h 101001 1011 101001 0100 D5.1 25h 101001 1001 101001 1001
D6.0 06小时 011001 1011 011001 0100 D6.1 26小时 011001 1001 011001 1001
D7.0 07h 111000 1011 000111 0100 D7.1 27h 111000 1001 000111 1001
D8.0 08h 111001 0100 000110 1011 D8.1 28h 111001 1001 000110 1001
D9.0 09h 100101 1011 100101 0100 D9.1 29h 100101 1001 100101 1001
D10.0 0Ah 010101 1011 010101 0100 D10.1 2Ah 010101 1001 010101 1001
D11.0 0Bh 110100 1011 110100 0100 D11.1 2Bh 110100 1001 110100 1001
D12.0 0Ch 001101 1011 001101 0100 D12.1 2Ch 001101 1001 001101 1001
D13.0 0Dh 101100 1011 101100 0100 D13.1 2Dh 101100 1001 101100 1001
D14.0 0Eh 011100 1011 011100 0100 D14.1 2Eh 011100 1001 011100 1001
D15.0 0Fh 010111 0100 101000 1011 D15.1 2Fh 010111 1001 101000 1001
D16.0 10h 011011 0100 100100 1011 D16.1 30h 011011 1001 100100 1001
D17.0 11h 100011 1011 100011 0100 D17.1 31h 100011 1001 100011 1001......。
D18.0 12h 010011 1011 010011 0100 D18.1 32h 010011 1001 010011 1001
D19.0 13h 110010 1011 110010 0100 D19.1 33h 110010 1001 110010 1001
D20.0 14h 001011 1011 001011 0100 D20.1 34h 001011 1001 001011 1001
D21.0 15小时 101010 1011 101010 0100 D21.1 35小时 101010 1001 101010 1001
D22.0 16小时 011010 1011 011010 0100 D22.1 36小时 011010 1001 011010 1001
D23.0 17h 111010 0100 000101 1011 D23.1 37h 111010 1001 000101 1001
D24.0 18h 110011 0100 001100 1011 D24.1 38h 110011 1001 001100 1001
D25.0 19h 100110 1011 100110 0100 D25.1 39h 100110 1001 100110 1001
D26.0 1Ah 010110 1011 010110 0100 D26.1 3Ah 010110 1001 010110 1001
D27.0 1Bh 110110 0100 001001 1011 D27.1 3Bh 110110 1001 001001 1001
D28.0 1Ch 001110 1011 001110 0100 D28.1 3Ch 001110 1001 001110 1001
D29.0 1Dh 101110 0100 010001 1011 D29.1 3Dh 101110 1001 010001 1001
D30.0 1Eh 011110 0100 100001 1011 D30.1 3Eh 011110 1001 100001 1001
D31.0 1Fh 101011 0100 010100 1011 D31.1 3Fh 101011 1001 010100 1001(续) 
表58 - 有效数据字符（续） abcdei fghj输出 abcdei fghj输出
名称字节
电流 rd-电流 rd+
名称字节
电流 rd-电流 rd+

D0.2 40小时 100111 0101 011000 0101 D0.3 60小时 100111 0011 011000 1100。
D1.2 41h 011101 0101 100010 0101 D1.3 61h 011101 0011 100010 1100
D2.2 42h 101101 0101 010010 0101 D2.3 62h 101101 0011 010010 1100
D3.2 43h 110001 0101 110001 0101 D3.3 63h 110001 110001 0011
D4.2 44h 110101 0101 001010 0101 D4.3 64h 110101 0011 001010 1100
D5.2 45h 101001 0101 101001 0101 D5.3 65h 101001 1100 101001 0011
D6.2 46h 011001 0101 011001 0101 D6.3 66h 011001 1100 011001 0011
D7.2 47h 111000 0101 000111 0101 D7.3 67h 111000 1100 000111 0011
D8.2 48小时 111001 0101 000110 0101 D8.3 68小时 111001 0011 000110 1100
D9.2 49h 100101 0101 100101 0101 D9.3 69h 100101 1100 100101 0011
D10.2 4Ah 010101 0101 0101 0101 D10.3 6Ah 010101 1100 010101 0011
D11.2 4Bh 110100 0101 110100 0101 D11.3 6Bh 110100 1100 110100 0011
D12.2 4Ch 001101 0101 001101 0101 D12.3 6Ch 001101 1100 001101 0011
D13.2 4Dh 101100 0101 101100 0101 D13.3 6Dh 101100 1100 101100 0011
D14.2 4Eh 011100 0101 011100 0101 D14.3 6Eh 011100 1100 0011
D15.2 4Fh 010111 0101 101000 0101 D15.3 6Fh 010111 0011 101000 1100
D16.2 50h 011011 0101 100100 0101 D16.3 70h 011011 0011 100100 1100
D17.2 51小时 100011 0101 100011 0101 D17.3 71小时 100011 1100 100011 0011
D18.2 52小时 010011 0101 010011 0101 D18.3 72小时 010011 1100 010011 0011
D19.2 53h 110010 0101 110010 0101 D19.3 73h 110010 1100 110010 0011
D20.2 54h 001011 0101 001011 0101 D20.3 74h 001011 1100 001011 0011
D21.2 55h 101010 0101 101010 0101 D21.3 75h 101010 1100 101010 0011
D22.2 56h 011010 0101 011010 D22.3 76h 011010 1100 011010 0011
D23.2 57h 111010 0101 000101 D23.3 77h 111010 0011 000101 1100
D24.2 58h 110011 0101 001100 0101 D24.3 78h 110011 0011 001100 1100
D25.2 59h 100110 0101 100110 0101 D25.3 79h 100110 1100 100110 0011
D26.2 5Ah 010110 0101 010110 0101 D26.3 7Ah 010110 1100 010110 0011
D27.2 5Bh 110110 0101 001001 0101 D27.3 7Bh 110110 0011 001001 1100
D28.2 5Ch 001110 0101 001110 0101 D28.3 7Ch 001110 1100 001110 0011
D29.2 5Dh 101110 0101 010001 0101 D29.3 7Dh 101110 0011 010001 1100
D30.2 5Eh 011110 0101 100001 0101 D30.3 7Eh 011110 0011 100001 1100
D31.2 5Fh 101011 0101 010100 0101 D31.3 7Fh 101011 0011 010100 1100(续) 
##### 在附件处进行高速小型化。
#### ATA国际组织 
表58 - 有效数据字符（续） abcdei fghj输出 abcdei fghj输出
名称字节
电流 rd-电流 rd+
名称字节
电流 rd-电流 rd+
D0.4 80h 100111 0010 011000 1101 D0.5 A0h 100111 1010 011000 1010
D1.4 81h 011101 0010 100010 1101 D1.5 A1h 011101 1010 100010 1010 1.
D2.4 82h 101101 0010 010010 1101 D2.5 A2h 101101 1010 010010 1010
D3.4 83h 110001 1101 110001 0010 D3.5 A3h 110001 1010 110001 1010
D4.4 84h 110101 0010 001010 1101 D4.5 A4h 110101 1010 001010 1010
D5.4 85h 101001 1101 101001 0010 D5.5 A5h 101001 1010 101001 1010
D6.4 86h 011001 1101 011001 0010 D6.5 A6h 011001 1010 011001 1010
D7.4 87h 111000 1101 000111 0010 D7.5 A7h 111000 1010 000111 1010
D8.4 88h 111001 0010 000110 1101 D8.5 A8h 111001 1010 000110 1010
D9.4 89h 100101 1101 100101 0010 D9.5 A9h 100101 1010 100101 1010
D10.4 8Ah 010101 1101 010101 0010 D10.5 AAh 010101 1010 010101 1010
D11.4 8Bh 110100 1101 110100 0010 D11.5 ABh 110100 1010 110100 1010
D12.4 8Ch 001101 1101 001101 0010 D12.5 ACh 001101 1010 001101 1010
D13.4 8Dh 101100 1101 101100 0010 D13.5 ADh 101100 1010 101100 1010
D14.4 8Eh 011100 1101 011100 0010 D14.5 AEh 011100 1010 011100 1010
D15.4 8Fh 010111 0010 101000 1101 D15.5 AFh 010111 1010 101000 1010
D16.4 90h 011011 0010 100100 1101 D16.5 B0h 011011 1010 100100 1010
D17.4 91h 100011 1101 100011 0010 D17.5 B1h 100011 1010 100011 1010
D18.4 92h 010011 1101 010011 0010 D18.5 B2h 010011 1010 010011 1010
D19.4 93h 110010 1101 110010 0010 D19.5 B3h 110010 1010 110010 1010
D20.4 94h 001011 1101 001011 0010 D20.5 B4h 001011 1010 001011 1010
D21.4 95h 101010 1101 101010 0010 D21.5 B5h 101010 1010 101010 1010
D22.4 96h 011010 1101 011010 0010 D22.5 B6h 011010 1010 011010 1010
D23.4 97h 111010 0010 000101 1101 D23.5 B7h 111010 1010 000101 1010
D24.4 98h 110011 0010 001100 1101 D24.5 B8h 110011 1010 001100 1010
D25.4 99h 100110 1101 100110 0010 D25.5 B9h 100110 1010 100110 1010
D26.4 9Ah 010110 1101 010110 0010 D26.5 BAh 010110 1010 010110 1010
D27.4 9Bh 110110 0010 001001 1101 D27.5 BBh 110110 1010 001001 1010
D28.4 9Ch 001110 1101 001110 0010 D28.5 Bch 001110 1010 001110 1010
D29.4 9Dh 101110 0010 010001 1101 D29.5 BDh 101110 1010 010001 1010
D30.4 9Eh 011110 0010 100001 1101 D30.5 BEh 011110 1010 100001 1010
D31.4 9Fh 101011 0010 010100 1101 D31.5 BFh 101011 1010 010100 1010(续) 
表58 - 有效数据字符（续） abcdei fghj输出 abcdei fghj输出
名称字节
电流 rd-电流 rd+
名称字节
电流 rd-电流 rd+
D0.6 C0h100111 0110 011000 0110 D0.7 E0h 100111 0001 011000 1110
D1.6 C1h011101 0110 100010 0110 D1.7 E1h 011101 0001 100010 1110
D2.6 C2h101101 0110 010010 0110 D2.7 E2h 101101 0001 010010 1110
D3.6 C3h110001 0110 110001 0110 D3.7 E3h 110001 1110 110001 0001

D4.6 C4h110101 0110 001010 0110 D4.7 E4h 110101 0001 001010 1110
D5.6 C5h101001 0110 101001 0110 D5.7 E5h 101001 1110 101001 0001
D6.6 C6h011001 0110 011001 0110 D6.7 E6h 011001 1110 011001 0001
D7.6 C7h111000 0110 000111 0110 D7.7 E7h 111000 1110 000111 0001
D8.6 C8h111001 0110 000110 0110 D8.7 E8h 111001 0001 000110 1110
D9.6 C9h100101 0110 100101 0110 D9.7 E9h 100101 1110 100101 0001
D10.6 CAh 010101 0110 010101 0110 D10.7 EAh 010101 1110 010101 0001
D11.6 CBh 110100 0110 110100 0110 D11.7 EBh 110100 1110 110100 1000
D12.6 CCh 001101 0110 001101 0110 D12.7 ECh 001101 1110 001101 0001
D13.6 CDh 101100 0110 101100 0110 D13.7 EDh 101100 1110 101100 1000
D14.6 CEh 011100 0110 011100 0110 D14.7 EEh 011100 1110 011100 1000
D15.6 CFh 010111 0110 101000 0110 D15.7 EFh 010111 0001 101000 1110
D16.6 D0h 011011 0110 100100 0110 D16.7 F0h 011011 0001 100100 1110
D17.6 D1h 100011 0110 100011 0110 D17.7 F1h 100011 0111 100011 0001
D18.6 D2h 010011 0110 010011 0110 D18.7 F2h 010011 0111 010011 0001
D19.6 D3h 110010 0110 110010 0110 D19.7 F3h 110010 1110 110010 0001
D20.6 D4h 001011 0110 001011 0110 D20.7 F4h 001011 0111 001011 0001
D21.6 D5h 101010 0110 101010 0110 D21.7 F5h 101010 1110 101010 0001
D22.6 D6h 011010 0110 011010 D22.7 F6h 011010 1110 011010 0001
D23.6 D7h 111010 0110 000101 0110 D23.7 F7h 111010 0001 000101 1110
D24.6 D8h 110011 0110 001100 0110 D24.7 F8h 110011 0001 001100 1110
D25.6 D9h 100110 0110 100110 0110 D25.7 F9h 100110 1110 100110 0001
D26.6 DAh 010110 0110 010110 0110 D26.7 FAh 010110 1110 010110 0001
D27.6 DBh 110110 0110 001001 0110 D27.7 FBh 110110 0001 001001 1110
D28.6 DCh 001110 0110 001110 0110 D28.7 FCh 001110 1110 001110 0001
D29.6 DDh 101110 0110 010001 0110 D29.7 FDh 101110 0001 010001 1110
D30.6 DEh 011110 0110 100001 0110 D30.7 FEh 011110 0001 100001 1110
D31.6 DFh 101011 0110 010100 0110 D31.7 FFh 101011 0001 010100 1110（结束） **9.2.2.5.2 控制字符**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
## 表59 - 有效控制字符 abcdei fghj 輸出
名称字节
电流 rd-电流 rd+
说明
K28.3 7Ch 001111 0011 110000 1100
只发生在除 ALIGNP 之外的所有基元的字节 0 处。
K28.5 BCh 001111 1010 110000 0101 仅在ALIGNP的字节0处发生。
在串行 ATA 中，只有 K28.3 和 K28.5 控制字符有效，并始终用作四字节基元的第一个字节。K28.3 控制字符用于 ALIGNP 以外的所有基元的前缀，而 K28.5 控制字符用于 ALIGNP 的前缀。在计算基元内各字符之间以及各字符子块之间的运行差异时，基元内字符的编码遵循与非基元相同的规则。控制字符 K28.3 和 K28.5 会反转当前的运行差异。
ALIGNP 基元具有中性差异性，即 ALIGNP 结束时的运行差异性与 ALIGNP 开始时的运行差异性相同。
#### 9.2.3 传输摘要 **9.2.3.1 传输顺序** **9.2.3.1.1 字节内的位**。
编码字符内的位标为a、b、c、d、e、i、f、g、h、j。位 "a "应先传输，之后依次为 "b"、"c"、"d"、"e"、"i"、"f"、"g"、"h "和 "j"。请注意，位 "i "是在位 "e "和 "f "之间传输的，位 "j "是最后传输的，而不是按照字母表中的字母所表示的顺序。
**9.2.3.1.2 字节内的字节*** 
对于所有的传输和接收，串行ATA将所有的值组织为D字。即使是代表32位元的值，Dword也应被视为四个字节的集合。Dword内的字节的传输顺序应从最小的重要字节（字节0）到最重要的字节（字节3）。这种从右到左的传输顺序与光纤通道不同。图191说明了Dword中字节的排列方式和比特的发送顺序。
 8b Dword 输入 31 - - - 24 23 - - - 16 15 - - - 8 7 6 5 4 3 2 1 0 8b 到 10b 的转换。
首先a a a a a bit b b b b b送c c c c d d d d e e e e bits i i i移位f f f f f g g g g g h h h j j j j．
四个10b编码字符^
## 图191----比特排序和意义.................................................................................。
 **9.2.3.1.3 帧内D字**。
帧（如10.2.1节所述）应按升序D字顺序传输，从SOFPdelimiter开始，接着是帧内容的D字，然后是CRC，最后是EOFPdelimiter。
注意 虽然本规范讨论了作为有序字节系列的Dword传输的严格层次结构，但其目的不是限制实现更广泛的数据路径。在字大小的字段中执行传输是可能的，甚至是可取的。
 具有16(未编码)/20(编码)数据路径的8b/10b编码器确实存在。唯一的限制是每个字节的传输顺序和每个子块的运行差异应被保留。
#### 9.2.4 接收总结 
当接收到一个编码字符时，对应于接收者当前的 "编码字符列"。
运行差异性应搜索编码字符值。如果在表中找到了编码字符值，则应将收到的编码字符视为合法字符并进行解码，并将解码后的字符值提供给链路层。
如果接收到的编码字符在该列中没有找到，则应将该编码字符标记为代码违规，并向链路层报告。
**9.2.4.1 异步和检测码违例**。
由于8b/10b码的传播特性，有可能虽然检测到大部分错误，但一个位错误可能在错误发生几个字符后才被发现。下面的例子说明了这种影响。第一个例子显示一个位错误在被检测到之前传播了两个字符。第二个例子显示的是单个字符的传播。

##### 高速 SERIALIZED ATTACHMENT(高速序列化) 
#### ATA国际组织 
需要注意的是，串行ATA以Dword增量发送数据，但发送器和接收器以字节（字符）为单位进行操作。例子没有显示Dword的边界，所以在这些情况下，任何一种错误都有可能被推迟一个完整的Dword。
差错和代码违反的频率是信道质量的指标，并且直接对应于主机和设备之间物理串行链路的位错误率。
实施例可以选择对此类事件进行统计，并将其提供给外部固件或软件。
初始运行差异和每个字符的运行差异被显示出来。为了发现错误，请注意，Running Disparity实际上是在每个子块结束时计算的，随后转发到下一个子块。脚注指出了检测到差异性错误的位置。错误位用下划线表示。
## 表60 - 带有两个字符延迟的单位错误 rd 字符 rd 字符 rd 字符 rd
传送的字符流。
##### - D21.1 - D10.2 - D23.5 +。
发送的比特流。- 101010 1001 - 010101 0101 - 111010 1010 +
接收的比特流。- 101010 101 1 a + 010101 0101 + 111010 b1010 + 。
解码后的字符流。- D21．
违反守则b+c
##### 注：a位错误引入。1001b => 1011b b非中性差异的子块交替出现极性（即+ =>-）。在这种情况下，rd不会交替（它在连续两个子块中保持正值）。由此产生的编码字符不存在于数据或控制代码表中的rd+列中，因此识别出一个无效的编码字符。
c无论编码字符是否有效，都应在接收到的字符上计算运行差异。
## 表61--单位错误与一个字符延迟 rd 字符 rd 字符 rd 字符 rd
传送的字符流----D21.1----D23.4----D23.5+。
发送的比特流
##### - 101010 1001 - 111010 0010 - 111010 1010 + 
接收的比特流 - 101010 101 1 a + 111010 b0010 - 111010 1010 + 。
解码后的字符流
##### - D21.0 + 
违反守则b
- D23.5^+c 
注：a位错误引入。1001b => 1011b b
具有非中性差异的子块交替出现极性（即+ =>-）。在这种情况下，rd不交替（它在一行中的两个子块中保持正值）。由此产生的编码字符不存在于数据或控制代码表中的rd+列中，因此识别出一个无效的编码字符。
c 无论编码字符是否有效，都应在接收字符上计算运行差异。

### 9.3 传输概述 
串行线上的信息是一个8b/10b编码的字符序列。最小的通信单位是一个Dword，每个Dword的内容被分组，提供低级控制信息或在主机和附加设备之间传输信息。每个Dword的内容被分组，以提供低级控制信息或在主机和附加设备之间传输信息。
两种类型的结构是基元和帧。
基元由单个 Dword 组成，是主机和设备之间可以交换的最简单的信息单位。当对基元的字节进行编码时，所产生的模式很难被误解为任何其他基元或随机模式。基元主要用于传递实时状态信息、控制信息传输和协调主机/设备通信。基元中的所有字节都是常量，第一个字节总是一个特殊字符。由于所有的字节都是常量，所以基元不能用来传递变量信息。后面的章节描述了基元的确切内容，这些基元是由下面的内容组成的。
串行ATA。
一个帧由多个D字组成，并且总是以SOFP开头。
 后面是一个称为帧信息结构(FIS)的用户有效载荷，一个CRC，并以EOFP结束。CRC被定义为紧接在EOFP之前的最后一个非基元D字。在 SOFP 和 EOFP 基元之间允许有一定数量的流控制基元（HOLDP 或 HOLDAP，或用于维持 HOLDP 或 HOLDAP 状态的 CONTPstream），以节流数据流，达到速度匹配的目的。
图 192 显示了一个传输序列的示例。
基元
A
SOF
原始
FIS
内容
保持
原始
P HOLDA
原始
P EOF
原始
FIS内容P（续）CRC
原始
B
原始
C
原始
D
框架
X
框架
Y
## 图192 -- -- 传输结构 
### 9.4 基元 
#### 9.4.1 概述 
基元是用于控制和提供串行线状态的 D 字实体。
基元总是以控制字符开始；除了 ALIGNP 以 K28.5 控制字符开始外，所有基元都使用 K28.3 控制字符来表示基元的开始。因此，ALIGNP 是唯一包含逗号字符的基元。
在控制字符之后，另外三个字符被编码以完成 Dword。
表 62 是构成每个基元的字符组合的摘要。

##### 高速 SERIALIZED ATTACHMENT (高速序列化) 
#### Serial ATA国际组织 **9.4.1.1 原始差异**。
基元可以以正差或负差开始，以正差或负差结束。在对基元进行编码时，将应用正常的 8b/10b 编码差异规则。
ALIGNP 被选择为具有中性差异性，以便将其插入到数据流中而不影响先前编码字符的差异性。ALIGNP 结束时的差异性与 ALIGNP 之前传输的最后一个字符的结束差异性相同。
每个基元的描述和编码定义在下面的章节中。
**9.4.1.2 基元握手**。
有些基元是在收到其他基元时传送的，以确认收到。
例如，HOLDAP 是为响应收到 HOLDP 基元而传输的，R_OKP 或 R_ERRP 是为响应 WTRMP 而传输的。由于到电缆两端之间的时钟域不同，响应基元的数量可能与它们响应的基元数量不匹配。例如，设备可能发送五个 HOLDP 基元，但收到六个 HOLDAP 基元作为响应。这些基元的发送方和接收方都不需要计算基元的数量，也不需要匹配发送和接收的数量。在一些边界情况下，可以发送零数量的响应基元（如 HOLDAP）。
#### 9.4.2 基元描述 
下表包含基元口诀和每个口诀的简要说明。
## 表 62--基元说明 
原始名称 描述
ALIGNP Phy层控制。
收到ALIGNP后，Phy层根据需要重新调整内部操作，以正确执行其功能。此基元总是成对发送--不存在发送奇数 ALIGNP 基元的情况（除重定时环回外）。
CONTP
继续重复上一个基元。
CONTP 允许消除重复基元的长字符串。
CONTP 意味着只要没有接收到另一个基元，就会重复先前接收的基元。
DMATP DMA 终止。
此基元是作为对发送器的请求而发送的，用于终止一个 DMA 基元。
通过对发送的数据计算CRC，并以EOFP结束DMA数据传输，提前进行DMA数据传输。假设发送EOFP后，发送机上下文保持稳定。
EOFP帧结束。EOF该帧的CRC。P标志着一个帧的结束。前一个非原始Dword是
HOLDP 保持数据传输。
当发送方没有准备好下一个有效载荷数据时，HOLDP代替有效载荷数据在一个帧内传输。当接收方还没有准备好接收额外的有效载荷数据时，HOLDP也由接收方传输。
HOLDAP 保持确认。这个基元是在收到HOLDP时发送的。
PMACKP
电源管理确认。
当接收节点准备进入电源模式状态时，响应PMREQ_SP或PMREQ_PP而发送。
当接收节点准备进入电源模式状态时，响应PMREQ_SP或PMREQ_PP而发出。
电源管理拒绝。
当接收节点没有准备好进入电源模式状态或不支持电源管理时，响应PMREQ_SP或PMREQ_PP而发送。

基元名称 描述
PMREQ_PP
权力管理请求
部分。
该基元连续发送，直到收到PMACKPor PMNAKP。当收到PMACKP时，当前节点（主机或设备）停止传输PMREQ_PP，进入Partial电源管理状态。
PMREQ_SP
权力管理请求
沉睡
该基元连续发送，直到收到PMACKPor PMNAKP。当收到PMACKP时，当前节点(主机或设备)停止发送PMREQ_SP，进入斯伦贝谢电源管理状态。
R_ERRP 接收错误。
 当前节点（主机或设备）在接收到的有效载荷中检测到错误。
R_IPP
接待处
进度。当前节点（主机或设备）正在接收有效载荷。
R_OKP 接收无错误。当前节点(主机或设备)检测到接收的有效载荷没有错误。
R_RDYP 接收器准备好了，当前节点(主机或设备)正在接收有效载荷。当前节点(主机或设备)已准备好接收有效载荷。
SOFP 帧的开始。一个帧的开始。有效载荷和CRC跟随，直到EOFP。
SYNCP 同步 同步基元。
WTRMP 等待帧终止 在 EOFP 传输后，发送方发送 WTRMP，同时等待接收方的接收状态。
X_RDYP 传输数据准备就绪。当前节点(主机或设备)已准备好传输有效载荷。
#### 9.4.3 原始编码 
下表定义了每个基元的编码。
## 表 63 - 基元编码.....................................................................................................

基元名称
字节3
内容
字节2
内容
字节1
内容
字节0
内容
ALIGNP D27.3 D10.2 D10.2. K28.5
CONTP D25.4 D25.4 D10.5 K28.3
DMATP D22.1 D22.1 D21.5 K28.3
EOFP D21.6 D21.6 D21.5 K28.3
HOLDP D21.6 D21.6 D10.5 K28.3
HOLDAP D21.4 D21.4 D10.5 K28.3
PMACKP D21.4 D21.4 D21.4 K28.3
PMNAKP D21.7 D21.7 D21.4 K28.3
PMREQ_PP D23.0 D23.0 D21.5 K28.3
PMREQ_SP D21.3 D21.3 D21.4 K28.3
R_ERRP D22.2 D22.2 D21.5 K28.3
R_IPP D21.2 D21.2 D21.5 K28.3
R_OKP D21.1 D21.1 D21.5 K28.3
R_RDYP D10.2 D10.2 D21.4 K28.3
SOFP D23.1 D23.1 D21.5 K28.3
D23.1 D23.1 D21.5 K28.3 SYNCP D21.5 D21.4 K28.3
WTRMP D24.2 D24.2 D21.5 K28.3
X_RDYP D23.2 D23.2 D21.5 K28.3 
##### 高速 SERIALIZED ATTACHMENT(附件) 
#### ATA国际组织 
#### 9.4.4 DMATPPrimitive 
没有定义DMATPfacility的一致使用，它的使用可能影响软件的兼容性。
实现应该容忍本规范中定义的DMATPas的接收，但应避免DMATPin的传输，以减少潜在的交互问题。接收DMATP的一个有效响应是将DMATPas处理为R_IPP并完成传输。
例如，在从设备读取DMA的情况下，串行ATA设备可以用一个EOFP终止传输，并向主机发送一个Register Device to Host FIS，并适当更新错误和状态寄存器。在对设备进行DMA写的情况下，设备会发送一个DMA-主机FIS，并适当更新错误和状态寄存器。
激活FIS到主机，然后在收到SOFP后，必须接受所有数据，直到收到主机的EOFPf。由于设备一旦开始就不能终止这种传输，所以使用了一个特殊的中止基元。
在接收到DMA终止(DMATP)基元的过程中，可以在后道上发
数据FIS，向发送端发出信号，终止正在进行的传输。它既可用于主机到设备的传输，也可用于设备到主机的传输。接收DMATP信号应使接收方通过插入CRC和EOFP关闭当前帧，并返回空闲状态。
对于主机到设备的数据传输，主机在接收到DMATP信号后，应终止正在进行的传输，停用其DMA引擎，并以有效的CRC和关闭帧。
EOFP。主机DMA引擎应保留其停用时的状态，以便设备可以在稍后的时间通过传输另一个DMA Activate FIS重新激活DMA引擎来恢复传输。设备负责随后通过传输另一个DMA Activate FIS来恢复被终止的传输，或者以适当的状态关闭受影响的命令。
对于设备到主机的传输，设备收到DMATP信号后，导致传输永久终止，不可恢复。设备应终止正在进行的传输，并以有效的CRC和EOFP关闭帧，此后应通过为该命令指示适当的状态来清理受影响的命令。没有提供恢复用DMATP信号终止的设备到主机传输的设施。
一些实施例可能具有与响应DMATPsignal而关闭受影响的数据FIS相关的实施例依赖性延迟。例如，主机控制器可能具有小的发送FIFO，为了使DMA引擎准确地反映可恢复状态，可能必须在关闭受影响的数据FIS之前将已经由DMA引擎传输到发送FIFO的数据传输。保守的设计应该尽量减少DMATP的响应延迟，同时对其他设备的长延迟有一定的容忍度。
#### 9.4.5 CONTPPrimitive 
为了降低EMI，串行ATA中加入了数据加扰功能，如9.5节所述。数据的加扰很简单，在每个 SOFP 上重置用于生成加扰模式的线性反馈移位寄存器 (LFSR)。然而，由于可用的控制字符数量较少，基元的加扰并不那么有效或简单。为了适应EMI的减少。
 重复的基元通过 CONTP 的使用被抑制。
通过使用CONTP，任何重复的基元都可能被暗示继续重复。CONTP的接收者在接收到任何基元（不包括ALIGNP）之前，会忽略CONTP之后接收的所有数据。在发送 CONTP 后，发送方可以向接收方发送任何数据字符序列，只要不包含任何基元。CONTP的接收会导致最后一个有效基元被暗示为重复，直到接收下一个有效基元。

为了提高整体协议的稳健性，并避免基元中的接收错误导致的潜在超时情况，所有重复的基元应在 CONTP 传输之前至少传输两次。正确接收到的第一个基元是接收器内任何动作的启动器。这可以避免出现以下情况：例如，从主机发送 X_RDYP，然后是 CONTP，而 X_RDYP 接收不当，导致设备不返回 R_RDYP，并导致系统死锁，直到出现超时/重置条件。
CONTP的传输是可选的，但接收和正确处理CONTP的能力是必需的。插入一个或两个不跟在 CONTP 后面的重复基元是有效的（即数据、数据、HOLDP、HOLDP、HOLDP）。
数据、数据、HOLDP、数据）。)
CONTP 后面可插入以下基元：HOLDP、HOLDAP、PMREQ_PP。
PMREQ_SP、R_ERRP、R_IPP、R_OKP、R_RDYP、SYNCP、WTRMP 和 X_RDYP。
主机 Phy 初始化状态机在主机和设备之间的通信建立之前，会消耗前几个接收到的基元（见状态机）。
HP7:HR_SendAlign，见第8.4.1节）。) 为了确保在从LS3:L_SendAlign状态进入L1:L_IDLE状态或
LPM8:L_WakeUp2 状态(请参见第 9.6.2 节和第 9.6.5 节)，在从 LS3:L_SendAlign 状态或 LPM8:L_WakeUp2 状态转换到 LPM8:L_WakeUp2 状态后，不允许使用 CONTPis。
L1:L_IDLE状态，直到至少有10个非ALIGNPprimitives被传送，或者直到检测到收到SYNCPor ALIGNPhas以外的基元。
表 64 说明了 CONTP 在 FIS 传输中的用途。
## 表 64 - CONTP 使用示例 
发射机 接收机
XXXX XXXX
XXXX XXXX
X_RDYP XXXX
X_RDYP XXXX
CONTP XXXX
XXXX XXXX
XXXX R_RDYP
XXXX R_RDYP
XXXX CONTP
SOFP XXXX
数据(FIS类型) XXXX
DATA XXXX
数据 R_IPP
数据 R_IPP
数据控制
HOLDP XXXX
HOLDP XXXX
CONTP XXXX
XXXX XXXX
XXXX HOLDAP
XXXX HOLDAP 
##### 在附件处进行高速小型化。
#### ATA国际组织 
发射机 接收机
HOLDP CONTP
DATA XXXX
DATA XXXX
DATA XXXX
CRC XXXX
EOFP R_IPP
WTRMP R_IPP
WTRMP CONTP
WTRMP XXXX
CONTP XXXX
XXXX R_OKP
XXXX R_OKP
XXXX CONTP
XXXX XXXX
SYNCP XXXX
SYNCP XXXX
CONTP XXXX
XXXX XXXX
XXXX SYNCP
XXXX SYNCP
XXXX CONTP
XXXX XXXX
XXXX XXXX
注释： XXXX 扰乱数据值（非基元）。
XXXX 扰乱数据值(非基元)
DATA FIS有效载荷数据。
**9.4.5.1 CONTPPrimitive之后的数据加扰**。
CONTP之后的数据应是LFSR的输出，该LFSR实现的多项式与用于扰乱FIS内容的多项式相同。该多项式在第9.5节中定义。
所产生的LFSR值应在链路层传输前使用8b/10b的数据字符编码规则进行编码。
用于在CONTP之后提供数据的LFSR在检测到一个
COMINIT 或 COMRESET 事件。
由于 CONTP 后面的数据被链路层丢弃，因此 LFSR 的值在 CONTP 原子之间没有定义。也就是说，用于 CONTP 序列 N 的 LFSR 结果不需要从 CONTP 序列 N-1 的最后一个 LFSR 结果开始连续。
用于扰乱 FIS 有效载荷内容的 LFSR 值序列不应受到重复基元抑制期间使用的数据扰乱的影响。也就是说，在重复基元抑制期间，数据有效载荷LFSR不应提前，仅对使用数据有效载荷LFSR加扰的每个数据有效载荷字符提前。有关加扰和重复基元抑制的其他信息，请参见第7.5节。
 **9.4.5.2 持续基元的周期性重传（信息性） **9.4.5.2 定期重传基元 
为了能够确定总线所处的状态，建议定期重传一个持续的基元。唯一的要求是，重传发生的时间间隔要足够大，以便不会对EMI产生实质性影响。由于ALIGN序列需要以最多256个Dword的间隔发送，因此，为被抑制的基元流提供可见性的一个解决方案是在插入ALIGNPprimitives后立即重传被抑制的基元序列。例如，如果原始序列是
PRIM / PRIM / CONTP/垃圾... ... ALIGNP/ ALIGNP/ junk... 新的序列可能看起来像：
PRIM / PRIM / CONTP/ junk... ... ALIGNP/ ALIGNP/ PRIM / PRIM / CONTP/ junk......新的序列可以是：PRIM / PRIM / CONTP/ junk......。

实现所选择的实际间隔可以更长。目的是使基元流在逻辑分析器的正常深度内持续可见。
#### 9.4.6 ALIGNPPprimitive..................................................................................................

Link层应忽略ALIGNPprimitives的接收。Phy层可以自由地消耗接收到的ALIGNPprimitives。Phy 不消耗接收到的 ALIGNPprimitives 的实现应在 Link 层的输入处有效地丢弃接收到的 ALIGNPprimitives，或者应包含 Link 层处理，其产生的行为与 Phy 消耗所有接收到的 ALIGNPprimitives 而不提交给 Link 时产生的行为相当。
#### 9.4.7 流量控制信令延迟 
在串行ATA接口的往返握手中，有一个有限的管道延迟。为了避免流控情况下的缓冲区溢出，指定了从接收机发出HOLDP信号到收到发送机的HOLDAP信号的最大可容忍延迟。这样可以在接收FIFO中设置高水位线，以避免缓冲区溢出，同时避免缓冲区/FIFO空间过大。
在接收机想对接收的数据进行流控的情况下，它在后道上传输HOLDP字符。一定数量的接收D字后，有效数据停止，而
HOLDAP字符的接收。从发送HOLDP到接收HOLDAP之间的延迟越大，接收FIFO就需要越大。在一个HOLDP/HOLDAP序列中，从初始HOLDP的MSB到初始HOLDAP的MSB，最大允许延迟时间不超过20个Dword。
LSB先传输。接收机在向发射机传送HOLDP流控制字符后，应能容纳接收20 Dword的附加数据，发射机在接收到HOLDP时，应在20 Dword倍内响应HOLDAPin。20个Dword的延迟规范不适用于同一序列内HOLDPflow控制字符的任何后续传输。当每一个新的实例化的
HOLDP/ HOLDAP序列，接收机和发射机应满足20个Dword的延迟规范。
本规范中没有参考设计。指定的最大延迟数字是基于本文档中描述的层和状态。人们认识到，Link层可能有两个独立的时钟域--发送时钟域和接收时钟域。人们还认识到，Link状态机可以以Dword时钟速率运行，这意味着在三个潜在的时钟域之间有同步器。在实践中会追求更有效的实现，实际的延迟可能比这里指出的要少。这些数字代表了对规范在逻辑设计中的几乎字面解释。同步器被假定为任何时钟域的2.99个时钟的最坏情况，并被四舍五入到三个整时钟。串行
在Gen1i和Gen2i速度下，ATA电缆在1米内部电缆中所包含的内容不到一个Dword的一半，因此可以忽略不计。对于较长的电缆长度，电缆的影响不应忽视。Phy假设有两个Dwords的管道延迟，FIFO假设以Link状态机速率运行。两者之间不需要同步。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
下图概述了20个Dword延迟规范的由来。这个例子说明了当接收机在链路上发送HOLDP时，到接收到来自发送机的HOLDAPf时的往返延迟的组成部分。这对应于接收机在发送HOLDP后应能接受的Dword数量。
## 表65--往返延迟的组成例.......................................................。

接收机发送HOLDP 1个Dword 转换为40位数据。
1 个字 10b/8b 转换。
1 个字去扰。
3 个字 接收时钟和链路状态机时钟之间的同步。
1 個字 鏈路狀態機被通知已收到基元。
1 個字 連結狀態機採取行動。
1 Dword FIFO 收到基元接收的通知。
1个Dword FIFO停止向Link层发送数据。
1个Dword Link接到通知，插入HOLDAP。
1 Dword Link根据通知采取行动，插入HOLDAPinto数据流。
1 字词 Scrambling.1 字词 8b/10b 转换
1 字词 8b/10b 转换.
1 個字
同步到发送时钟（3个发送时钟，是Link状态机速率的4倍） 1个Dword 转换为10位数据 2个Dword Phy，发送端。
电缆上的 HOLDAP **9.4.7.1 电缆长度和流量控制延迟（信息）**。
适用于设计用于数据中心应用的主机和设备，其中使用的电缆长度超过1米。
 建议这些设计要考虑到对溢出延迟的潜在增加影响。当以1米电缆在3.0 Gbps下运行时，电缆在任何时间点上包含的内容不到半个Dword，因此在流量控制计算中忽略了来自电缆的延迟影响。然而，以8米电缆为例，当以3.0 Gbps的速度运行时，电缆中包含的内容几乎达到3个Dword。当使用长度超过1米的电缆时，在系统设计中应考虑到电缆对流控延迟的影响。
系统设计可以通过多种方式来考虑这些影响。一些例子包括。
- 可以选择满足更严格的流量控制要求的主机和/或设备。
- 可以选择具有较大的流控缓冲区并能吸收超过20个D字的延迟的主机和/或设备。
- 不要选择超过环境要求的过长电缆，因为这会影响流控延迟。
 
#### 9.4.8 原生用法示例（信息性 
表66、表67和表68是说明基本基元用法的例子。它们并没有显示调用CONTP的详细长序列。
###数据FIS............................................................................................................................... 表66--SRST从主机到设备的写入 传输突破设备到主机 
通过设备托管数据FIS
主机设备说明......。为了清楚起见，将前面的活动缩略为 "R_IPP DATA"。
R_IPP DATA n 传输数据的设备。
R_IPP DATA n+1
R_IPP HOLDP 设备发送 FIFO 为空，应用流控制。
R_IPP HOLDP 主机接收并解码 HOLDP 流控制。
HOLDAP HOLDP 主机确认流控制。设备内部死锁，没有数据了（设备挂起）。
HOLDAP HOLDP......。系统处于此状态，直到主机决定重置设备。
HOLDAP HOLDP......系统处于该状态，直到主机决定重置设备。
主机检测到SRST写入设备控制寄存器，需要打破死锁。
SYNCP HOLDP 主机发送 SYNCP 终止当前传输。
终止当前的传输，SYNCP HOLDP
设备接收并解码SYNCP，放弃正在进行的传输。
SYNCP SYNCP 主机发送SYNCP/设备发送SYNCP(均返回空闲状态)
SYNCP SYNCP
主机接收并解码SYNCP，现在可以启动新的FIS传输。
X_RDYP SYNCP 主机准备发送影子寄存器块寄存器进行SRST写。
X_RDYP SYNCP 设备解码 X_RDYP。
X_RDYP R_RDYP 设备表示准备接收。
X_RDYP R_RDYP 主机译码 R_RDYP
SOFP R_RDYP 主机启动一帧等等等等。
## 表67 - 命令影子寄存器块寄存器传输示例 
主机设备描述
SYNCP SYNCP空闲状态。
SYNCP SYNCP 空闲状态。
X_RDYP SYNCP 主机准备发送影子寄存器块寄存器。
X_RDYP SYNCP 设备解码 X_RDYPc。
X_RDYP R_RDYP 设备表示准备接收。
X_RDYP R_RDYP 主机解码 R_RDYP。
SOFP R_RDYP 主机开始一个帧。
DATA 0 R_RDYP 主机发送寄存器FIS D字0 /设备解码SOFP。
DATA 1 R_IPP 主机发送寄存器 FIS Dword 1 / 设备存储 DATA Dword 0。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
主机设备描述
DATA n R_IPP 主机发送 Register FIS Dword n / 设备存储 DATA Dword n-1.
CRC R_IPP 主机发送 CRC/设备存储 DATA Dword n. EOFP R_IPP 主机发送 EOFP/设备存储 CRC.
EOFP R_IPP 主机发送 EOFP/设备存储 CRC。
WTRMP R_IPP 设备对 EOFP 进行解码。
WTRMP R_IPP 设备计算出良好的 CRC 并释放 TF 内容。
WTRMP R_OKP 设备发送好结束。
WTRMP R_OKP 主机解码R_OKPas好结果。
SYNCP R_OKP 主机释放接口。
SYNCP R_OKP 设备由主机解码释放--被允许释放。
SYNCP SYNCP 闲置状态。
##表68--主机到设备的数据传输实例.....................................................。

主机设备描述
SYNCP SYNCP空闲状态。
SYNCP SYNCP 空闲状态。
X_RDYP SYNCP 主机准备发送影子寄存器块寄存器。
X_RDYP SYNCP 设备解码 X_RDYP。
X_RDYP R_RDYP 设备表示准备接收。
X_RDYP R_RDYP 主机解码 R_RDYP。
SOFP R_RDYP 主机开始一个帧。
DATA 0 R_RDYP 主机发送 DATA Dword 0 / 设备解码 SOFP。
DATA 1 R_IPP 主机发送 DATA Dword 1 / 设备存储 DATA Dword 0。
... .. ...
DATA x R_IPP 主机发送 DATA Dword x / 设备存储 DATA Dword (x-1).
HOLDP R_IPP
主机发送HOLD/设备存储DATA字(x)并解码
HOLDP.HOLDP HOLDAP设备确认HOLDP。
HOLDP HOLDAP设备确认HOLDP。
HOLDP HOLDAP 主机对 HOLDAP 进行解码，主机可以随时释放 HOLDPat。
DATA(n-2) HOLDAP 主机发送(n-2)个DATA Dword/设备解码DATA Dword。
DATA(n-1) R_IPP：主机发送(n-2)个DATA字/设备解码DATA字。
主机发送(n-1)个数据 Dword/设备存储(n-2)个DATA。
Dword.DATA(n)
DATA(n) R_IPP 主机发送第 n 个数据 Dword / 设备存储 (n-1)个 DATA Dword.CRC R_IPP 主机发送 CRC / 设备存储第 n 个 DATA Dword.
CRC R_IPP 主机发送 CRC/设备存储第 n 个 DATA Dword.EOFP R_IPP 主机发送 EOFP/设备存储 CRC.
EOFP R_IPP 主机发送 EOFP/设备存储 CRC。
WTRMP R_IPP 设备对 EOFP 进行解码。
WTRMP R_IPP 设备计算出良好的 CRC 并释放数据内容。
WTRMP R_OKP 设备发送好结束。

WTRMP R_OKP 主机解码R_OKPas效果良好。
SYNCP R_OKP 主机释放接口。
SYNCP R_OKP 设备被主机解码释放-被允许释放。
SYNCP SYNCP 闲置状态。

### 9.5 CRC和加扰功能 
帧的CRC(循环冗余检查)是一个D字(32位)字段，应跟在最后的
FIS 内容的 D 字和 EOFP 前面的字。CRC 计算涵盖 SOFP 和 EOFP 基元之间的所有 FIS 传输数据，但不包括任何中间基元和 CONTP 流内容。CRC 值应在编码传输（加扰）前和接收解码后对 FIS 的内容进行计算。
CRC值应在Dword数量上计算。如果一个FIS包含奇数字，FIS的最后一个字应在计算CRC时使用该Dword之前，用零填充到一个完整的Dword。
CRC应在Dword边界上对齐。
CRC应使用以下32位发生器多项式计算。
G(X) = X^32 + X^26 + X^23 + X^22 + X^16 + X^12 + X^11 + X^10 + X^8 + X^7 + X^5 + X^4 +X^2 +X + 1。
在计算开始前，CRC值应初始化为52325032h。
SOFP到EOFP之间的最大Dword数不得超过2064个Dword，包括FIS类型和CRC。
帧的内容在Phy层传输前应进行加扰处理。
加扰应通过对要传输的数据与线性反馈移位寄存器(LFSR)的输出进行XOR，对Dword量进行加扰。移位寄存器应实现以下多项式。
G(X) = X^16 + X^15 + X^13 + X^4 + 1。
串行移位寄存器在第一次移位前应以种子值FFFh初始化。
LFSR。在传输SOFP之前，移位寄存器应初始化为种子值。SOFP 和 EOFP 之间的所有数据字都将被扰乱，包括 CRC。
#### 9.5.1 FIS 数据的加扰与重复基元之间的关系 
串行ATA中使用了两个独立的加扰器。一个加扰器用于数据有效载荷编码，另一个加扰器用于重复基元抑制。用于数据有效载荷编码的加扰器应在帧的加扰有效载荷字符上（SOFP和EOFP之间）保持一致和连续的上下文，并且其上下文不应受到用于重复基元抑制的数据加扰的影响。
加扰适用于所有数据（非基元）D字。基元（包括ALIGNP）不会被加扰，并且不得推进数据有效载荷LFSR寄存器。同样，数据有效载荷
在重复基元抑制期间(即CONTPprimitive之后)，LFSR在传输Dword时不得提前。由于重复基元流可能发生在数据帧的中间--可能出现多个 HOLDP/HOLDAP 基元--因此应注意确保数据有效载荷 LFSR 仅对其加扰的每个数据有效载荷字符进行提前，而对基元或作为使用单独加扰器的重复基元抑制的一部分而传输的数据字符不进行提前。
#### 9.5.2 加扰与CRC的关系 
加扰的应用顺序如下。对于SOFP之后的Dword数据，该Dword应被用于计算CRC。相同的Dword值应被XORed。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织与加扰器输出，所得的Dword提交给8b/10b编码器进行传输。同样，在接收时，应使用10b/8b解码器对Dword进行解码，将加扰器输出与产生的Dword进行XOR，并将产生的Dword提交给链路层，随后用于计算CRC。CRC Dword应按照同样的规则进行加扰。
#### 9.5.3 禁止加扰（告知性）。
主机和设备应提供特定于厂商的手段，禁用扰乱数据的传输/接收。建议采用三种独立的控制方式--一种是禁用已传输的FIS有效载荷数据的加扰，第二种是禁用重复基元抑制的CONTP/垃圾方法，第三种是禁用已接收的解扰
FIS有效载荷数据。
使用加扰禁用功能的目的是为了测试性和设计调试，不建议将其作为最终用户功能。工程师/操作人员有责任确保电缆两端的配置方式使主机和设备可以进行通信（即如果设备上的加扰传输被禁用，那么主机上的加扰接收也应被禁用）。禁用有效载荷加扰的设备可能无法与其他不执行本建议的设备进行互操作。禁用加扰功能的系统可能不符合EMI法规要求。
### 9.6 链路层状态机 

#### 9.6.1 链路层转换表中使用的术语 1. LRESET.链路层COMRESET或COMINIT信号 链路层COMRESET或COMINIT信号 2．PHYRDYn。PHYRDY信号的否定。
3. PHYRDY：7.1.2节中定义的Phy状态。
4. DecErr: 解码错误。从 Phy 传输到 Link 的 32 位 Dword 解码错误 - 无效的 10b 模式 - 差分错误 - 第一字节中有控制字符但不允许控制字符的基元 - Dword 第一字节以外的任何控制字符 5. DatDword：正确形成的32位模式，但没有基元前导10b模式（K28.5或K28.3）。
6. COMWAKE：Phy中OOB检测器发出的信号，表示正在检测COMWAKE OOB信号。
7. AnyDword：任何类型的32位模式--即使是来自Phy的DecErr模式。 
#### 9.6.2 链接空闲状态图 
## 表69 - 状态图链路空闲。
##### L1: L_IDLE (^4) 传输 SYNC
P.
 1. 传输层请求帧传输和PHYRDY 2 .

#####  
HL_SendChkRdy或
DL_SendChkRdy^1 2．传输层请求过渡到Partial和PHYRDY 2,5 .
  L_TPMPartial 3.传输层请求过渡到Partial和PHYRDY 2,5 . 传输层请求过渡到Slumber和PHYRDY 2,5。
  L_TPMSlumber 4. X_RDYPreceived from Phy.  L_RcvWaitFifo 5. Phy层转发( PMREQ_PPor PMREQ_SP)和功率模式已启用并可接受。
        L_PMOff 6.Phy层转发(PMREQ_PPor PMREQ_SP)和电源模式已禁用或不可接受。        L_PMDeny 7.Phy层转发除(X_RDYPor PMREQ_PPor PMREQ_SP)以外的AnyDword，且没有来自传输层2、3的传输请求。
##### L_IDLE 8．PHYRDYn L_NoCommErr
注意事项 1. 主机Link层向HL_SendChkRdy状态过渡；设备Link层向DL_SendChkRdy状态过渡。
2. 即使检测到10b解码错误等错误，也会采取这种过渡。
3. 该语句也会忽略任何未被识别的序列或本规范中未定义的命令。
4. 从LS3:L_SendAlign状态或LPM8:L_WakeUp2状态进入此状态后，在至少传输了10个非ALIGNP基元或检测到SYNCPor ALIGNPhas以外的基元之前，不允许使用CONTP。
5. 主机不得试图在发出复位和收到设备复位签名之间启动接口电源状态转换。在未首先验证设备具有设备IDENTIFY DEVICE（或IDENTIFY PACKET DEVICE）数据结构中的信息所确定的这种能力之前，主机不应尝试发起接口电源管理请求。

L2: L_SyncEscape^1 传输SYNCP.
1. 除X_RDYPor SYNCPreceived from Phy以外的任何字(AnyDword)。        L_SyncEscape 2.从Phy接收到的除X_RDYPor SYNCP以外的任何字。X_RDYPor SYNCPreceived from Phy.L_IDLE 3.  L_IDLE 3.X_RDYPor SYNCPreceived from Phy. PHYRDYn L_NoCommErr^2
注意事项 1. 该状态与任何其他链路层状态异步进入，其中链路层已传输SYNCP以逃避FIS传输，也称为SYNC Escape。
2. 链路层应将此状态通知传输层，并使尝试的传输失败。
 
##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
LS1: L_NoCommErr 传输层Phy未准备好错误。
1. 无条件的L_NoComm 
LS2: L_NoComm传送ALIGNP^1。
1. PHYRDYn L_NoComm 2. PHYRDY L_SendAlign
注意事项 1. 同时停用Phy层的任何信号以中止操作。

LS3.L_SendAlign L_SendAlign 发送ALIGNP。
1. PHYRDYn L_NoCommErr 2. PHYRDY_IDLE 
LS4.L_RESET^1 L_RESET^1 将链路状态重置为初始条件。
1. LRESET 链接复位信号被检测到。 L_RESET 2. LRESET 链接复位信号被否定。 L_NoComm
注意事项 1. 当链路复位控制处于激活状态时，该状态异步进入。

#### L1：L_IDLE状态。当链路层完成一帧传输时，进入该状态。
处于该状态时，链路层传输SYNCP并等待Phy层的X_RDYPfrom Phy层或传输层的帧传输请求。
过渡L1:1a：当主机链路层收到来自的帧传输请求时。
传输层和Phy层准备就绪，Link层应向LT1．
HL_SendChkRdy状态。
过渡L1:1b：当设备链路层接收到从
传输层和Phy层准备就绪，Link层应向LT2．
DL_SendChkRdy状态。
过渡L1:2：当链路层接收到传输层发出的进入部分功率模式的请求，且Phy层准备就绪时，链路层应向下列状态进行过渡： 1.
L_TPMPartial状态。
过渡L1:3：当链路层收到传输层发出的进入Slumber power模式的请求，且Phy层准备就绪时，链路层应进行过渡到
L_TPMSlumber状态。

过渡L1：4。当链路层收到Phy层的X_RDYPfrom Phy层时，链路层应过渡到LR2. L_RcvWaitFifo状态。L_RcvWaitFifo状态。
过渡L1：5。当链路层收到来自Phy层的PMREQ_PP或PMREQ_SP，并启用了电源管理模式，且处于接受电源模式请求的状态时，链路层应过渡到LPM3: L_PMOff状态。

过渡L1:6。当链路层收到来自Phy层的PMREQ_PPor PMREQ_SPfrom Phy层，且未启用执行电源管理模式或未处于接受电源模式请求的状态时，链路层应过渡到LR0: L_PMDeny状态。如果IDENTIFY (PACKET) DEVICE数据中的字76位9设置为1，验证了接口电源状态被支持和启用，则该过渡仍然有效。
过渡L1:7。当链路层没有接收到来自PACKET DEVICE的帧传输请求时。
传输层，没有收到来自传输层的进入功率模式的请求，没有收到来自Phy层的X_RDYPfrom Phy层或没有收到来自Phy层的PMREQ_x，则链路层应过渡到L1：L_IDLE状态。
过渡L1:8。如果Phy层没有准备好，即使传输层正在请求操作，Link层也会过渡到L_NoCommErr状态。
#### L2: L_SyncEscape状态。当链路层发送SYNCPto逃避FIS传输时，进入该状态。链路层可能会因为传输层的请求或无效的状态转换而选择逃避FIS传输。这种状态只有SYNC Escape的发起者才会进入。
处于该状态时，链路层传输SYNCPand等待Phy层的SYNCPfrom Phy层，然后进入L_IDLE状态。如果收到X_RDYPis，链路层也会过渡到L_IDLE，以避免出现死锁状态。
过渡L2:1：当链路层从Phy接收到任何非X_RDYP的D字时。
SYNCP，链路层应向L2.L_SyncEscape状态过渡。L_SyncEscape状态。
过渡L2:2。当链路层收到Phy的X_RDYPor SYNCPfrom Phy时，链路层应过渡到L1：L_IDLE状态。
过渡L2:3。当主机链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LS1: L_NoCommErr状态。当检测到Phy层在试图处理另一个状态时出现非就绪状态时，即进入该状态。进入该状态预示着Link层出现了比较严重的错误状况。该状态只执行一次，以便将错误条件传递给传输层。
过渡LS1:1：无条件地过渡到LS1:L_NoComm。
#### LS2：L_NoComm状态。该状态直接从LS1:L_NoCommErr状态或LS4:L_RESET状态进入。在Phy发出建立通信并准备就绪的信号之前，链路层一直处于该状态。
过渡LS2:1: 只要Phy层保持未准备好，就会过渡到LS2:
L_NoComm。
过渡LS2:2。当Phy层发出准备就绪的信号时，就会过渡到LS3:
L_SendAlign。
#### LS3.L_SendAlign状态：L_SendAlign。L_SendAlign状态。每当需要向Phy层发送ALIGNPneeds时，就进入该状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
过渡LS3:1: 如果Phy层没有准备好，则过渡到LS1。
L_NoCommErr。
过渡 LS3:2: 如果 Phy 层表示准备就绪，则过渡到 L1: L_IDLE 状态。
#### LS4:3：如果Phy层表示准备就绪，则过渡到L1：L_IDLE状态。L_RESET状态。每当链路LRESET控制处于活动状态时，就会进入该状态。所有 
链接层硬件被初始化为并保持在一个已知的状态/值。在此状态下，所有来自其他层的请求或触发器都被忽略。在此状态下，Phy复位信号也会被断言。
过渡LS4:1: 当RESET控制处于活动状态时，将过渡到LS4:
L_RESET状态。
过渡LS4:2: 当RESET控制无效时，将过渡到LS2:
L_NoComm状态。
#### 9.6.3 链路传输状态图 
## 表70 - 状态图链路传输 
LT1：HL_SendChkRdy传送X_RDYP。
1. 从Phy.R_RDY接收到的R_RDY.L_SendSOF 2.  L_SendSOF 2.X_RDYPreceived from Phy.  L_RcvWaitFifo 3. 从Phy层接收到的除(R_RDYPor X_RDYP)1以外的任何Dword。
 HL_SendChkRdy 4. PHYRDYn L_NoCommErr^2 3.
注意事项 1. 忽略任何接收到的错误，如10b解码错误和无效基元。
2. 链路层应将此情况通知传输层，并使尝试的传输失败。

LT2：DL_SendChkRdy传送X_RDYP。
1. R_RDYPreceived from Phy.  L_SendSOF 2.从Phy.接收到的除R_RDYPreceived以外的任何Dword。 DL_SendChkRdy 3. PHYRDYn L_NoCommErr 3. 
LT3.L_SendSOF传送SOFP 1: L_SendSOF 传送SOFP 1. PHYRDY 1 L_SendData 2. PHYRDY 1 L_SendData 2.PPHYRDYn L_NoCommErr^2 3. PHYRDYn L_NoCommErr^2 3. SYNCPreceived from Phy.SYNCPreceived 1 L_IDLE^2 2.  L_IDLE^2

注意事项 1. 忽略任何接收到的错误，如10b解码错误和无效基元。
2. 2. 链路层应将此情况通知传输层，并使尝试的传输失败。
 
LT4.L_SendData 传输数据 L_SendData 传输数据 Dword 1. 从Phy 1,2接收到的更多要传输的数据和除(HOLDPor DMATPor SYNCP)以外的AnyDword 。
 L_SendData 2. 要传输的更多数据和从 Phy 接收的 HOLDP。 L_RcvrHold 3. 数据传输未完成，数据未准备好传输，从Phy接收到除SYNCP以外的其他任何字。
  L_SendHold 4. 从Phy接收到DMATPreceived或数据传输完成，以及从Phy接收到除SYNCPreceived以外的AnyDword.L_SendHold 5 5.  L_SendCRC 5 5.SYNCPreceived from Phy.L_IDLE 3 6.  L_IDLE 3 6.PHYRDYn L_NoCommErr^3 7.传输层表示请求转义当前帧 4 .
              L_SyncEscape 
注意事项 1. 忽略任何接收到的错误，如10b解码错误和无效基元。
2. 这使得在这段时间内有可能有一个反向通道。
3. 链路层应将此情况通知传输层，并使尝试的传输失败。
4. 当此条件为真时，相关的转接优先于所有其他退出此状态的转接。
5. DMATP信号是咨询性的，应尽早停止数据传输，但不要求立即停止。是可以停留在LT4: 当有更多的数据需要传输，且收到DMATPis时，可以保持L_SendData状态。

LT5: L_RcvrHold 发送HOLDAP。
1. 有更多数据要传输，并且从Phy接收到除(HOLDPor SYNCPor DMATP)以外的AnyDword，且没有DecErr。
  L_SendData 2. 传输更多数据，并从 Phy 接收到 HOLDP 或 DecErr.L_RcvrHold 3.         L_RcvrHold 3. 传输更多数据，并接收到来自Phy的SYNCPreceived。 L_IDLE^1 4.发送更多数据，并接收到来自Phy的HOLDP或DecErr。传输更多数据，并接收到来自 Phy 的 DMATPreceived L_SendCRC^3 5. PHYRDYn.  L_NoCommErr^1 6.传输层表示请求转出当前帧 2 .
 L_SyncEscape 7. 收到来自Phy.SYNCPreceived的请求。 L_IDLE^1
注意事项 1. 链路层应将此情况通知传输层，尝试传输失败。
2. 当此条件为真时，相关的转接优先于所有其他退出此状态的转接。
3. DMATP信号是咨询性的，应尽早停止数据传输，但不要求立即停止。当有更多的数据要传输，且收到DMATPis时，可以停留在LT5: L_RcvrHold状态。
 
##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
LT6: L_SendHold传送HOLDP。
1. 准备好传输的更多数据和从Phy接收到的除(HOLDPor SYNCP)以外的AnyDword。
        L_SendData 2. 更多数据已准备好传输，并从Phy接收到HOLDP。        L_RcvrHold 3. 数据传输未完成，数据未准备好传输，从Phy接收到除(SYNCPor DMATP)以外的AnyDword.L_SendHold 4.
  L_SendHold 4. 从Phy接收到DMATPreceived或数据传输完成，并且从Phy接收到除SYNCP以外的任何其他字。 L_SendCRC 3 5.收到来自Phy的SYNCPreceived.L_IDLE^1 6.  L_IDLE^1 6. PHYRDYn L_NoCommErr^1 7. 传输层表示请求转出当前帧 2 .
 L_SyncEscape
注意事项 1. 链路层应将此情况通知传输层，尝试传输失败。
2. 当此条件为真时，相关的转接优先于所有其他退出此状态的转接。
3. DMATP信号是咨询性的，应尽早停止数据传输，但不要求立即停止。当有更多的数据要传输，且收到DMATPis时，可以停留在LT6: L_SendHold状态。

LT7: L_SendCRC 发送CRC。
1. PHYRDY和SYNCP未收到Phy.L_SendEOF 1.  L_SendEOF 2. PHYRDYn L_NoCommErr^1 3. PHYRDY 和 SYNCP 从 Phy.SendCRC 收到。 L_IDLE^1
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。

LT8: L_SendEOF 发送 EOFP。
1. PHYRDY和SYNCPnot收到Phy.L_Wait 2.  L_Wait 2. PHYRDYn L_NoCommErr^1 3. 从Phy.PyRDY和SYNCP接收到的PHYRDY和SYNCP。 L_IDLE^1
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。
 
LT9: L_Wait 传输 WTRMP。
1. R_OKPreceived from Phy.  L_IDLE(良好状态) 2. 从Phy.L_IDLE接收到的R_ERRP(坏状态)3。 L_IDLE (坏状态) 3. SYNCP从Phy.L_IDLE^1接收到的信息 4.  L_IDLE^1 4. 从Phy.L_IDLE接收到的除(R_OKPor R_ERRPor SYNCP)以外的任何字。
        L_Wait 5. PHYRDYn L_NoCommErr^1 5.
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。

#### LT1：HL_SendChkRdy状态。当主机传输层请求进行帧传输时，进入此状态。
当处于该状态时，链路层传输X_RDYP并等待X_RDYPor R_RDYPf从
植物层。

注意--主机和设备有可能同时通过传输X_RDYP请求传输帧。如果主机在传输X_RDYP的同时收到X_RDYP，那么主机就会发送X_RDYP。
X_RDYP，主机应后退并进入L_RcvWaitFifo状态，推迟其所需的帧传输，直到设备完成其帧传输且总线空闲。
过渡LT1:1：当主机链路层接收到Phy层的R_RDYPfrom时，链路层应过渡到LT3: L_SendSOF状态。
过渡LT1:2：当主机链路层收到X_RDYPfrom Phy层时，链路层应过渡到LR2。L_RcvWaitFifo状态。
过渡LT1:3：当主机链路层从Phy层接收到除R_RDYPor X_RDYP以外的任何Dword时，链路层应向LT1：HL_SendChkRdy状态进行过渡。
过渡LT1：4。当主机链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LT2：DL_SendChkRdy状态。当设备传输层请求进行帧传输时，进入该状态。
处于该状态时，链路层传输X_RDYPand等待Phy层的R_RDYPfrom。
过渡LT2:1：当设备链路层收到Phy层的R_RDYPfrom时，链路层应过渡到LT3: L_SendSOF状态。
过渡LT2:2。当设备链路层没有收到Phy层的R_RDYPff时，该设备的
链路层应过渡到LT2：DL_SendChkRdy状态。
过渡LT2：3。当设备链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1：L_NoCommErr状态。
L_NoCommErr状态。

##### HIGH SPEED SERIALIZED ATTACHMENT 
#### ATA国际组织 
#### LT3.L_SendSOF L_SendSOF状态。当收到R_RDYPhas时进入该状态。
Phy层。
当处于此状态时，Link层传输SOFP。
过渡LT3:1：当设备链路层传输完SOFP后，链路层应过渡到LT4: L_SendDATA状态。
过渡 LT3:2: 当链路层检测到 Phy 层未准备好时，链路层应将此情况通知传输层，并过渡到 LS1: L_NoCommErr 状态。
过渡LT3:3。当链路层收到Phy层的SYNCPfrom时，链路层应将非法过渡错误状态通知传输层，并过渡到以下状态
L1:L_IDLE状态。
#### LT4.L_SendData状态: L1:L_IDLE状态。L_SendData状态。当SOFPhas被传输时，进入该状态。

处于该状态时，链路层从传输层获取一个数据Dword，将该数据Dword编码后，再将该数据Dword发送到传输层。
Dword，并进行传输。该Dword在编码前也被输入CRC计算。
过渡LT4:1：当链路层接收到除HOLDP、DMATP、或DMATP以外的任何Dword时。
来自Phy层和传输层的SYNCPprimitive表示有Dword可供传输，Link层应向LT4.SendData状态过渡。L_SendData状态。DMATPsignal是建议性的，应尽早停止数据传输，但不要求立即停止。因此，允许停留在LT4.L_SendData状态。当有更多的数据需要传输，且收到DMATPis时，可以保持L_SendData状态。
过渡LT4:2：当设备链路层收到HOLDPfrom Phy层时，链路层应过渡到LT5：L_RcvrHold状态。
过渡LT4:3。当传输层表示下一个Dword不可传输，且从Phy层接收到除SYNCPhas以外的任何Dword时，链路层应过渡到LT6：L_SendHold状态。
过渡 LT4:4: 当传输层表示该帧的所有数据已经传输完毕，并且从Phy层接收到除SYNCPhas以外的任何Dword时，链路层应向LT7: L_SendCRC状态进行过渡。当链路层收到来自Phy层的DMATP时，应通知传输层，并按第9.4.4节所述终止正在进行的传输，并应过渡到LT7：L_SendCRC状态。
过渡LT4：5。当链路层收到Phy层发来的SYNCPfrom Phy层时，链路层应通知传输层非法过渡错误状态，并应过渡到以下状态。
L1:L_IDLE状态
过渡LT4:6。当链路层检测到Phy层未准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LT4:7。当链路层收到传输层的通知，认为当前的帧传输应该逃逸时，应过渡到L_SyncEscape状态。
#### LT5：L_RcvrHold状态。当收到来自Phy层的HOLDPhas时，即进入该状态。
处于该状态时，链路层应传送HOLDAP。


过渡LT5:1。当链路层接收到除HOLDP、SYNCP、SYNCP以外的任何一个Dword时
来自Phy层的DMATPprimitive没有检测到解码错误，传输层表示有一个Dword可以传输，Link层应向LT4:
L_SendData状态。
过渡LT5:2：当设备链路层收到Phy层的HOLDPfrom Phy层或检测到解码错误时，链路层应过渡到LT5：L_RcvrHold状态。
过渡LT5：3。当链路层收到SYNCPfrom Phy层时，链路层应过渡到L1：L_IDLE状态。应通知传输层非法过渡错误条件。
过渡 LT5:4：当链路层接收到DMATPfrom Phy层时，应通知?
传输层，并按第9.4.4节所述终止正在进行的传输，应过渡到LT7: L_SendCRC状态。
过渡LT5:5。当链路层检测到Phy层未准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LT5:6。当链路层收到传输层的通知，称当前帧应被逃逸时，应过渡到L_SyncEscape状态。
过渡LT5:7：当链路层收到SYNCP的通知时，应过渡到L_SyncEscape状态。当链路层收到Phy层的SYNCPfrom Phy层时，链路层应通知传输层非法过渡错误状态，并应过渡到以下状态
L1:L_IDLE状态。
#### LT6：L_SendHold状态。当传输层表示某个Dword不可用于传输，且未从Phy层收到HOLDPhas时，则进入该状态。
处于该状态时，链路层应传输HOLDP。
过渡 LT6:1: 当链路层从 Phy 层接收到除 HOLDPor SYNCP 基元以外的任何 Dword，且传输层指示有 Dword 可供传输时，链路层应过渡到 LT4: L_SendData状态。
过渡 LT6:2: 当链路层从 Phy 层接收到 HOLDPfrom Phy 层，且传输层指示有 Dword 可供传输时，链路层应过渡到 LT5。
L_RcvrHold状态。
过渡LT6：3。当传输层指示一个Dword不可用于传输，并且从Phy层接收到SYNCPis以外的任何Dword时，链路层应过渡到LT6: L_SendHold状态。
过渡 LT6:4: 当传输层表示该帧的所有数据都已传输完毕，且从Phy层接收到除SYNCPhas以外的任何Dword时，链路层应向LT7: L_SendCRC状态进行过渡。当链路层收到来自Phy层的DMATP时，应通知传输层，并按第9.4.4节所述终止正在进行的传输，并应过渡到LT7:L_SendCRC状态。
过渡LT6:5。当链路层收到SYNCPfrom Phy层时，链路层应过渡到L1：L_IDLE状态。应通知传输层非法过渡错误条件。
过渡LT6：6。当链路层检测到Phy层还没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。

##### HIGH SPEED SERIALIZED ATTACHMENT 
#### ATA国际组织 
过渡LT6:7。当链路层收到传输层的通知，说明当前帧应进行逃逸时，应过渡到L_SyncEscape状态。
#### LT7：L_SendCRC状态。当传输层表示该帧的所有数据Dword都已传输完毕时，即进入该状态。
处于该状态时，链路层应传输该帧的计算CRC。
过渡LT7:1：当CRC传输完毕后，链路层应过渡到LT8：L_SendEOF状态。
过渡 LT7:2: 当链路层检测到 Phy 层没有准备好时，链路层应将此情况通知传输层，并过渡到 LS1: L_NoCommErr 状态。
过渡LT7:3。当链路层收到Phy层的SYNCPfrom时，链路层应将非法过渡错误状态通知传输层，并过渡到以下状态
L1:L_IDLE状态。
#### LT8：L_SendEOF状态。当帧的CRC已传输完毕时，进入该状态。
处于该状态时，链路层应传输EOFP。
过渡 LT8:1：当EOFPhas被传输后，链路层应向
LT9:L_Wait状态。
过渡 LT8:2: 当链路层检测到 Phy 层未准备好时，链路层应将此情况通知传输层，并过渡到 LS1: L_NoCommErr 状态。
过渡LT8:3。当链路层收到Phy层的SYNCPfrom时，链路层应将非法过渡错误的条件通知传输层，并过渡到以下状态

L1:L_IDLE状态。
#### LT9：L_Wait状态。当EOFPhas被传送时，进入该状态。

处于该状态时，链路层应传输WTRMP。
过渡LT9:1：当链路层收到Phy层的R_OKPfrom Phy层时，链路层应通知传输层，并过渡到L1：L_IDLE状态。
过渡 LT9:2：当链路层收到 Phy 层的 R_ERRPfrom Phy 层时，链路层应通知传输层，并过渡到 L1: L_IDLE 状态。
过渡LT9:3。当链路层收到SYNCPfrom Phy层时，链路层应通知传输层，并过渡到L1：L_IDLE状态。
过渡LT9:4：当链路层接收到除R_OKP、R_ERRP以外的任何Dword，或
来自Phy层的SYNCPprimitive，Link层应过渡到LT9: L_Wait状态。
过渡LT9:5。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。

#### 9.6.4 链路接收状态图 
## 表71 - 状态图 链接接收 
LR1: L_RcvChkRdy 发送 R_RDYP。
1. X_RDYPreceived from Phy.L_RcvChkRdy 1.  L_RcvChkRdy 2. 从Phy.X_RDY接收到的SOFP数据。 L_RcvData 3. 从Phy接收的除(X_RDYPor SOFP)以外的任何Dword。 
##### L_IDLE 4. PHYRDYn L_NoCommErr^1
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。

LR2.L_ RcvWaitFifo L_ RcvWaitFifo 传输SYNCP。
1. X_RDYPreceived from Phy and FIFO space available.  L_RcvChkRdy 2.X_RDYPreceived from Phy and FIFO space available. X_RDYPreceived from Phy and FIFO space not available.         L_RcvWaitFifo 3. 从Phy接收到X_RDYPreceived以外的任何Dword。 L_IDLE 4. PHYRDYn L_NoCommErr^1
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。

LR3.L_RcvData传输R_IPPor DMATP^1: L_RcvData传输R_IPPor DMATP^1。
1. 从Phy和FIFO空间接收到的DatDword）或从Phy接收到的HOLDAPreceived。        L_RcvData 2. 从Phy接收到的DatDword，且FIFO空间不足。
        L_Hold 3.从Phy接收到的HOLDP，且FIFO空间不足。从Phy接收到HOLDP，且FIFO空间不足。 L_RcvHold 4.收到来自Phy的HOLDP，但FIFO空间不足。从Phy接收到EOFP，但FIFO空间不足。 L_RcvEOF 5.从Phy.WTRMP接收到的WTRMP。 L_BadEnd 6. 从Phy.L_IDLE接收到的SYNCP。 L_IDLE 7. 从Phy.L_RcvEOF接收的除(HOLDPor EOFPor HOLDAPor SYNCPor WTRMP)以外的任何字。
        L_RcvData 8. PHYRDYn L_NoCommErr^2 9. 传输层表示要求逃离当前帧。 L_SyncEscape
注意事项 1. 如果传输层发出希望终止传输的信号，则传输DMATP代替R_IPP。
2. 2.链路层应将此情况通知传输层，并使尝试的传输失败。
 
##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
LR4: L_Hold传送HOLDP。
1. FIFO空间可用，且从Phy接收到除HOLDPor EOFPreceived以外的其他任何字。
        L_RcvData 2. FIFO 可用空间，且从 Phy.L_RcvHold 收到 HOLDP 或 EOFP 以外的任何字。 L_RcvHold 3. 从Phy.EOFP接收到的FIFO空间和HOLDP。 L_RcvEOF 4. 没有可用的 FIFO 空间，并且没有从 Phy 接收 EOFP，也没有从 Phy 接收 SYNCP，以及 PHYRDY L_Hold 5. PHYRDYn L_NoCommErr^1 6.从Phy.SYNCPreceived from Phy.L_IDLE 7.  L_IDLE 7.SYNCPnot收到来自Phy和PHYRDY的逃离当前帧的请求。传输层表示要求逃离当前帧。        L_SyncEscape 
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。

LR5: L_RcvHold 传输 HOLDAPor DMATP^1。
1. 从Phy收到的除(HOLDPor EOFPor SYNCP)以外的任何Dword。        L_RcvData 2. 从Phy接收的HOLDP。 L_RcvHold 3. 从Phy.EOFP接收到的EOFP(HOLDPor EOFPor SYNCP)。 L_RcvEOF 4. 从Phy.SYNCPreceived，L_IDLE 5.  L_IDLE 5. PHYRDYn L_NoCommErr^2 6.传输层表示请求逃离当前帧。        L_SyncEscape 
注意事项 1. 如果传输层发出希望终止传输的信号，则传输DMATP代替HOLDAP。
2. 2.链路层应将此情况通知传输层，并使尝试传输失败。

LR6: L_RcvEOF 传输R_IPP。
1. CRC检查未完成。 L_RcvEOF 2.CRC良好。 L_GoodCRC 3. CRC不良。 L_BadEnd 4. PHYRDYn L_NoCommErr^1
注意事项 1. 链路层应将此情况通知传输层，并使尝试的传输失败。
 
LR7: L_GoodCRC 传输 R_IPP。
1. 传输层表示结果良好。 L_GoodEnd 2. 传输层表示未识别的FIS.L_BadEnd 3.  L_BadEnd 3. 传输层尚未响应。 L_GoodCRC 4.传输层表示未识别 FIS。PHYRDYn L_NoCommErr^2 5.传输层或链路层表示在接收已识别的 FIS 时检测到错误。        L_BadEnd 6. SYNCPreceived from Phy.SYNCPreceived 5.  L_IDLE
注意事项 1. 第一次进入该状态时，链路层应通知传输层该帧的CRC有效。
2. 2. 链路层应将此状态通知传输层，并使尝试的传输失败。

LR8: L_GoodEnd 传输R_OKP。
1. SYNCPreceived from Phy.  L_IDLE 2. 除了从Phy.L_IDLE接收到的SYNCPreceived以外的任何字。 L_GoodEnd 3. PHYRDYn L_NoCommErr 

LR9: L_BadEnd传送R_ERRP。
1. SYNCPreceived from Phy.  L_IDLE 2.SYNCPreceived from Phy. 从Phy.L_IDLE接收到的SYNCPreceived以外的任何字。 L_BadEnd 3. PHYRDYn L_NoCommErr 
#### LR1: L_RcvChkRdy状态。当收到X_RDYPhas时进入该状态。
Phy层。
当处于该状态时，链路层应传输R_RDYPand等待Phy层的SOFPfrom。
过渡LR1:1：当链路层收到Phy层的X_RDYPfrom Phy层时，链路层应过渡到LR1：L_RcvChkRdy状态。
过渡LR1:2：当链路层收到SOFPfrom Phy层时，链路层应过渡到LR3: L_RcvData状态。
过渡LR1:3：当链路层从Phy层接收到除X_RDYP或SOFP基元以外的任何Dword时，链路层应将此情况通知传输层，并过渡到L1：L_IDLE状态。
过渡LR1：4。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LR2.L_RcvWaitFif状态 L_RcvWaitFifo状态。当接收到X_RDYPhas，且FIFO尚未准备好接收FIS时，进入该状态。
处于该状态时，链路层应传输SYNCP。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
过渡LR2:1：当链路层收到Phy层的X_RDYPfrom Phy层，且FIFO已准备好接受数据时，链路层应向LR1：L_RcvChkRdy状态进行过渡。
过渡LR2：2。当链路层收到Phy层的X_RDYPfrom Phy层，且FIFO尚未准备好接受数据时，链路层应过渡到LR2：L_RcvWaitFid状态。L_RcvWaitFifo状态。
过渡LR2:3。当链路层从Phy层接收到除X_RDYPf以外的任何一个Dword时，链路层应将此情况通知传输层，并向以下状态过渡
L1: L_IDLE状态。
过渡LR2：4。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LR3:L_RcvData状态。L_RcvData状态。当从Phy层接收到SOFPhas时进入该状态。
处于该状态时，链路层收到来自Phy层的编码字符序列，将其解码为Dword，并将Dword传递给传输层。该Dword也被输入到CRC计算中。当处于这种状态时，链路层要么传输R_IPPto信号传输继续进行，要么传输DMATP信号传输器终止传输。
过渡LR3:1：当传输层表示其FIFO中有空间时，链路层应向LR3进行过渡。L_RcvData状态。
过渡 LR3:2: 当传输层指示其 FIFO 中没有足够的空间时，应向 L_RcvData 状态过渡。
FIFO，链路层应过渡到LR4: L_Hold状态。
过渡LR3：3。当链路层收到Phy层的HOLDPfrom Phy层时，链路层应过渡到LR5：L_RcvHold状态。
过渡LR3:4。当链路层收到EOFPfrom Phy层时，链路层应向LR6: L_RcvEOF状态过渡。
过渡LR3:5。当链路层收到WTRMPfrom Phy层时，链路层应过渡到LR9：L_BadEnd状态。
过渡LR3:6。当链路层收到SYNCPfrom Phy层时，链路层应通知传输层接收中止，并应过渡到L1:
L_IDLE状态。
过渡LR3：7。当链路层接收到除HOLDP、HOLDAP以外的任何Dword时。
EOFP，或来自Phy层的SYNCPprimitive，Link层应向LR3.L_RcvData状态过渡。
L_RcvData状态。
过渡LR3:8。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LR3:9。当链路层收到传输层的通知，认为当前帧应进行逃逸时，应过渡到L_SyncEscape状态。
#### LR4:L_Hold状态。当传输层表示其接收FIFO中没有足够的空间时，即进入该状态。

处于该状态时，链路层应传输HOLDP，并可从Phy层接收编码字符。
过渡LR4:1：当链路层从Phy层接收到除HOLDP原语以外的任何Dword，且传输层表示现在其接收FIFO中有足够的空间可用时，进入该状态
FIFO，链路层应向LR3.L_RcvData状态过渡。L_RcvData状态。
过渡LR4:2: 当链路层接收到Phy层的HOLDPfrom Phy层，且传输层指示其FIFO中现在有可用空间时，链路层应过渡到
LR5: L_RcvHold 状态。
过渡LR4：3。当链路层收到Phy层的EOFPfrom Phy层时，链路层应过渡到LR6: L_RcvEOF状态。
 请注意，由于管道延迟，当处于L_Hold状态时，可能会接收到EOFPmay，在这种情况下，接收Link应利用其FIFO净空来接收EOFP并关闭帧接收。
过渡LR4:4：当传输层表示其FIFO中没有足够的可用空间，且Phy层已准备好时，Link层应过渡到LR4：L_Hold状态。
过渡LR4：5。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LR4:6。当链路层收到Phy层的SYNCPfrom时，链路层应将非法过渡错误的情况通知传输层，并应过渡到
L1: L_IDLE状态。
过渡LR4：7。当链路层收到传输层的通知，要求对当前帧进行逃逸时，应过渡到L_SyncEscape状态。
#### LR5：L_RcvHold状态。当收到来自Phy层的HOLDPhas时，进入该状态。
处于该状态时，链路层应在发送机准备好后发送HOLDAPto信号传输继续进行，或发送DMATPto信号发送机终止传输。
过渡LR5：1。当链路层从Phy层接收到除HOLDPor SYNCP基元以外的任何Dword时，链路层应向LR3进行过渡。L_RcvData状态。
过渡LR5:2: 当链路层从Phy层接收到HOLDPfrom Phy层时，链路层应过渡到LR5: L_RcvHold状态。
过渡LR5:3：当链路层接收到EOFP时，应过渡到LR5：RcvHold状态。当链路层收到EOFPfrom Phy层时，链路层应向LR6: L_RcvEOF状态过渡。
过渡LR5:4：当链路层收到SYNCPfrom Phy层时，链路层应过渡到L1：L_IDLE状态。应通知传输层非法过渡错误条件。
过渡LR5：5。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1：L_NoCommErr状态。
过渡LR5:6。当链路层收到传输层的通知，认为当前帧应进行逃逸时，应过渡到L_SyncEscape状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
#### LR6：L_RcvEOF状态。当链路层收到Phy层的EOFPfrom Phy层时，进入该状态。
处于该状态时，链路层应检查帧的计算CRC，并传送一个或多个R_IPPprimitives。
过渡LR6:1：如果CRC计算和检查尚未完成，链路层应过渡到LR6：L_RcvEOF状态。
过渡 LR6:2: 当 CRC 指示无误时，链路层应通知传输层并过渡到 LR7: L_GoodCRC 状态。
过渡LR6:3。当CRC指示有错误发生时，链路层应通知传输层
传输层并过渡到LR9: L_BadEnd状态。
过渡LR6:4: 当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LR7: L_GoodCRC状态。当帧的CRC经检查并确定为良好时，进入该状态。
处于该状态时，链路层应等待传输层检查帧并传输一个或多个R_IPPprimitives。
过渡LR7:1: 当传输层指示结果良好时，链路层应过渡到LR8: L_GoodEnd状态。
过渡 LR7:2: 当传输层指示未识别的 FIS 时，链路层应过渡到 LR9: L_BadEnd 状态。
过渡 LR7:3：如果传输层未提供状态，则链路层应过渡到 LR7: L_GoodCRC 状态。
过渡LR7:4：当链路层检测到Phy层没有准备好时，链路层应将该状态通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LR7:5。当传输层或链路层表示在接收识别的FIS过程中遇到错误时，链路层应过渡到LR9: L_BadEnd状态。
过渡LR7:6。当链路层接收到SYNCPfrom Phy层时，链路层应通知传输层非法过渡错误状态，并应过渡到
L1: L_IDLE状态。
#### LR8：L_GoodEnd状态。当帧的CRC经检查确定为良好时，进入该状态。
处于该状态时，链路层应传输R_OKP。
过渡LR8:1：当链路层收到SYNCPfrom Phy层时，链路层应过渡到L1：L_IDLE状态。
过渡LR8:2：当链路层从Phy层接收到SYNCPprimitive以外的任何Dword时。
 链接层应过渡到LR7: L_GoodEnd状态。

过渡LR8:3。当链路层检测到Phy层未准备好时，链路层应将此情况通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LR9：L_BadEnd状态。当帧的CRC经检查确定为坏时，或当传输层通知链路层收到的是
FIS无效。
当处于该状态时，链路层应传输R_ERRP。
过渡LR9:1：当链路层从Phy层接收到SYNCPf时，链路层应过渡到L1：L_IDLE状态。
过渡LR9:2：当链路层收到除SYNCPfrom Phy层以外的任何Dword时，链路层应过渡到LR9：BadEnd状态。
过渡LR9:3。当链路层检测到Phy层没有准备好时，链路层应将此情况通知传输层，并过渡到LS1：L_NoCommErr状态。
#### 9.6.5 链路电源模式状态图 
## 表72 - 状态图 链路电源模式...............................................................................。

LPM1.L_TPMPartial Transmit PMREQ_PP: L_TPMPartial Transmit PMREQ_PP.
1. PMACKPreceived from Phy layer.  L_ChkPhyRdy 2. 从Phy层接收的X_RDYPreceived。 L_RcvWaitFifo^1 3．SYNCPor R_OK从Phy层接收。 L_TPMPartial 4.SYNCPor R_OKPreceived from Phy layer. 除(PMACKPor PMNAKPor X_RDYPor SYNCPor R_OKPor PMREQ_PP 3 或以外的任何字。
PMREQ_SP 3 ) 1从Phy层收到。
##### L_IDLE 5.从Phy层接收到的PMREQ_PPor PMREQ_SP。从Phy层接收到的PMREQ_PP或PMREQ_SP。 L_TPMPartial^3 6.PHYRDYn L_NoCommErr^2 7.PMNAK从Phy层接收。 L_NoPmnak
注：1.该过渡事件中止了传输层提出的进入电源模式的请求。需要向传输层发出该事件的状态指示。
2. 这是一个意外的过渡，构成一个错误条件。需要因此向传输层发送一个错误条件。
3. 如果收到PMREQ_PPor PMREQ_SPis，主机应向L_IDLE状态过渡，但设备应向L_TPMPartial状态过渡。
 
##### HIGH SPEED SERIALIZED ATTACHMENT（高速串行化）。
#### ATA国际组织 
LPM2.L_TPMSlumber L_TPMSlumber传送PMREQ_SP。
1. 从Phy层接收的PMACKPreceived.L_ChkPhyRdy 2.  L_ChkPhyRdy 2.X_RDYPreceived from Phy layer. 从Phy层接收的X_RDYPreceived。 L_RcvWaitFifo^1 3．SYNCPor R_OK从Phy层接收。 L_TPMSlumber 4．除(PMACKPor PMNAKPor X_RDYPor SYNCPor R_OKPor PMREQ_PP 3或以外的任何字。
PMREQ_SP 3 ) 1从Phy层收到。
##### L_IDLE 5.从Phy层接收到的PMREQ_PPor PMREQ_SP。从Phy层接收到的PMREQ_PP或PMREQ_SP。 L_TPMSlumber^3 6.PHYRDYn L_NoCommErr^2 7.PMNAK从Phy层接收。 L_NoPmnak
注：1.该过渡事件中止了传输层提出的进入电源模式的请求。需要向传输层发出该事件的状态指示。
2. 这是一个意外的过渡，构成一个错误条件。需要因此向传输层发送一个错误条件。
3. 如果收到PMREQ_PPor PMREQ_SPis，主机应过渡到L_IDLE状态，但设备应过渡到L_TPMSlumber状态。

LPM3.L_PMOff L_PMOff 发送PMACKP^1。
1. 共发送4<=n<=16个PMACKPprimitives。 L_ChkPhyRdy 2. 发送的 PMACKPprimitives 少于 n 个。 L_PMOff
注：1.根据是否从Phy层接收到PMREQ_PPor PMREQ_SPwas设置标志。

LPM4.L_PMDeny传送PMNAKP。L_PMDeny传送PMNAKP。
1. 从Phy层接收到的PMREQ_PPor PMREQ_SPreceived.L_PMDeny 2.  L_PMDeny 2.从Phy层接收的PMREQ_PPor PMREQ_SP。从Phy层接收到的除(PMREQ_PPor PMREQ_SP)以外的任何字。 
##### L_IDLE 3. PHYRDYn L_NoCommErr 
LPM5: L_ChkPhyRdy 向Phy层断言部分/层(视情况而定)。
1. PHYRDY L_ChkPhyRdy 2. PHYRDYn L_NoCommPower 
LPM6: L_NoCommPower 维持部分/斯伦贝谢断言(视情况而定)。
1. 传输层请求唤醒或检测到COMWAKE。 L_WakeUp1 2.传输层未请求唤醒，且检测到COMWAKE。传输层未请求唤醒，也未检测到COMWAKE。        L_NoCommPower  
LPM7: L_WakeUp1 否定Partial和Slumber。
1. PHYRDY L_WakeUp2 2. PHYRDYn L_WakeUp2 2. 
LPM8: L_WakeUp2 传送ALIGNP.
1. PHYRDY L_IDLE 2.PPHYRDYn L_NoCommErrr PHYRDYn L_NoCommErr 
LPM9: L_NoPmnak 发送 SYNCP。
1. PMNAK从Phy层接收。 L_NoPmnak 2.从Phy层接收到的除(PMNAKP)以外的AnyDword。从Phy层接收到除(PMNAKP)以外的其他任何字。 
##### L_IDLE 
#### LPM1: L_TPMPartial 状态。当传输层表示需要过渡到部分功率状态时，即进入该状态。
过渡 LPM1:1: 处于该状态时，将传输 PMREQ_PPshall。当链路层收到PMACKPa时，应过渡到LPM5:L_ChkPhyRdy状态。
过渡LPM1:2: 如果链路层收到X_RDYPa，应过渡到LR2。
L_RcvWaitFifo状态，从而有效地中止请求，进入电源模式状态。
过渡LPM1:3：如果链路层收到SYNCPor R_OKPprimitive，则认为对面还没有处理PMREQ_PPyet，需要时间。
 应过渡到LPM1.L_TPMPartial状态。应过渡到L_TPMPartial状态。
过渡LPM1:4。如果主机链路层收到来自Phy层的任何D字，而不是一个
PMACKP、PMNAKP、X_RDYP、SYNCPor R_OKPprimitive，则中止进入Partial状态的请求，并应过渡到L1：L_IDLE。如果设备链路层从Phy层接收到除PMACKP、PMNAKP、X_RDYP、SYNCP、PMREQ_PP以外的任何Dword。
PMREQ_SP，或R_OKP基元，则中止进入Partial状态的请求，并应过渡到L1: L_IDLE。
过渡LPM1:5。主机链路层不应进行此过渡，因为它只适用于设备链路层。如果设备链路层收到主机的PMREQ_PPor PMREQ_SPfrom主机，则应通过过渡到LPM1来保持此状态。L_TPMPartial。
过渡LPM1:6。如果链路层检测到Phy层尚未准备好，则解释为错误条件。应将此条件通知传输层，并过渡到LS1: L_NoCommErr状态。
过渡LPM1:7。如果链路层收到PMNAKP，则进入Partial状态的请求将被中止，并应过渡到LPM9: L_NoPmnak状态。
#### LPM2: L_TPMSlumber状态。当传输层表示希望过渡到Slumber电源状态时，则进入该状态。
过渡LPM2:1：当处于该状态时，应传输PMREQ_SPshall。当链路层收到PMACKP时，应过渡到LPM5：L_ChkPhyRdy状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
过渡LPM2：2。如果链路层收到X_RDYP，则应过渡到LR2. L_RcvWaitFifo状态。L_RcvWaitFifo状态，从而有效地中止请求，进入电源模式状态。
过渡LPM2:3。如果链路层收到SYNCPor R_OKP,则认为对面尚未处理PMREQ_SPyet，需要时间。的过渡。
LPM2.L_TPMSlumber状态。将进入L_TPMSlumber状态。
过渡LPM2:4。如果主机链路层收到来自Phy层的任何D字，而不是一个
PMACKP、PMNAKP、X_RDYP、SYNCP或R_OKPprimitive，则中止进入Slumber状态的请求，并应过渡到L1：L_IDLE。如果设备链路层从Phy层接收到除PMACKP、PMNAKP、X_RDYP、SYNCP、PMREQ_PP以外的任何Dword。
PMREQ_SP，或R_OKPprimitive，则中止进入Slumber状态的请求，并应过渡到L1：L_IDLE。
过渡LPM2:5：主机链路层不应进行此过渡，因为它只适用于设备链路层。如果设备链路层收到主机的PMREQ_PPor PMREQ_SPfrom主机，则应通过过渡到LPM2来保持此状态。L_TPMSlumber。
过渡LPM2:6。如果链路层检测到Phy层还没有准备好，这将被解释为错误条件。应将此条件通知传输层，并过渡到L_NoCommErr状态。
过渡LPM2:7。如果链路层收到PMNAKP，则进入Slumber状态的请求将被中止，并应过渡到LPM9: L_NoPmnak状态。
#### LPM3: L_PMOff状态。当链路层收到PMREQ_SPor PMREQ_PPwas时，即进入该状态。每执行一次该状态，链路层都会发送PMACKP。
过渡 LPM3:1: 如果已经传输了 4<=n<=16 个 PMACKPprimitives，则应过渡到 L_ChkPhyRdy 状态。
过渡 LPM3:2: 如果传输的 PMACKPprimitives 少于 n 个，则应过渡到 L_PMOff 状态。
#### LPM4: L_PMDeny状态。当链路层接收到任何进入电源模式的基元，且电源模式当前处于禁用状态时，即进入该状态。链路层应传输PMNAKPto通知对端不允许进入电源模式。
过渡LPM4:1：如果链路层继续接收到进入任何电源模式的请求，比过渡回相同的LPM4。L_PMDeny状态。
过渡 LPM4:2: 如果链路层收到除电源模式请求基元以外的任何 Dword，则链路层假定电源模式请求已被删除，并应过渡到 L1: L_IDLE 状态。
过渡LPM4:3：如果链路层检测到Phy层已成为未准备好的状态，则解释为错误条件。应将此条件通知传输层，并过渡到LS1: L_NoCommErr状态。
#### LPM5: L_ChkPhyRdy状态。每当希望Phy层进入低功率状态时，就会进入该状态。在该状态下的每一次执行都会向Phy层发出进入该状态并停用PHYRDY信号的请求。根据情况向Phy层断言Partial或Slumber。

过渡LPM6:1：如果Phy层还没有处理进入省电状态的请求，也没有停用PHYRDY信号，那么Link层应保持在LPM5。

L_ChkPhyRdy状态，并继续请求Phy层进入电源模式状态。
过渡 LPM6:2: 当 Phy 层处理完电源模式请求并停用 PHYRDY 信号后，应过渡到 LPM6: L_NoCommPower 状态。
#### LPM6: L_NoCommPower状态。当Phy层否定了它的 
PHYRDY信号，表示其处于Partial或Slumber状态。在这种状态下，链路层等待OOB检测器发出COMWAKE信号的接收信号(对于其他设备发起的唤醒)，或者等待传输层请求唤醒。
过渡 LPM6:1 : 如果传输层请求唤醒或 OOB 信号检测器指示接收 COMWAKE 信号，则应过渡到 LPM7。
L_WakeUp1
过渡 LPM6:2 : 如果传输层未请求唤醒，且 OOB 检测器未指示接收 COMWAKE 信号，则应过渡到 LPM6。
L_NoCommPower。
#### LPM7: L_WakeUp1状态。传输层发起唤醒时进入该状态。在此状态下，链路层应向Phy层否定Partial和Slumber，并等待Phy层的PHYRDY信号被断言。在此状态下，Phy层正在执行唤醒序列。
过渡 LPM7:1 当Phy层断言其PHYRDY信号时，应过渡到： 1．
LPM8: L_WakeUp2.
过渡 LPM7:2: 如果 Phy 层仍未准备好，则应过渡到 LPM7。
L_WakeUp1.LPM8:L_WakeUp2
#### LPM8: L_WakeUp2 状态。当Phy层通过断言其PHYRDY信号确认发起的唤醒请求时，即进入该状态。在此状态下，链路层应传输ALIGN序列，并过渡到L1: L_IDLE状态。
过渡 LPM8:1 如果Phy层保持PHYRDY asserted，则应过渡到Phy层。
L1：L_IDLE状态。
过渡 LPM8:2 如果Phy层否定了PHYRDY，这是一个错误条件。应通知传输层该条件，并过渡到LS1: L_NoCommErr状态。
#### LPM9: L_NoPmnak状态。当链路层表示拒绝了进入Slumber或Partial状态的请求时，即进入该状态。链路层每执行一次该状态，都会传送SYNCP。在此状态下，链路层等待收到任何不是来自Phy层的PMNAKPf的Dword。
过渡LPM9:1：如果链路层收到PMNAKP，那么链路层应保持在?
LPM9:L_NoPmnak状态，并继续等待收到非PMNAKPfrom Phy层的基元。
过渡LPM9:2：如果链路层从Phy层接收到PMNAKP以外的任何Dword，则中止进入电源管理状态的请求，并应过渡到L1: L_IDLE。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### ATA国际组织 
## 10 传输层 ..................................................................................................................

### 10.1 概述 
传输层不需要认知帧的传输和接收方式。传输层不需要认识到帧是如何传输和接收的。
传输层只是简单地构造帧信息结构（FIS）进行传输，并对接收到的帧信息结构进行分解。主机和设备传输层状态的不同在于FIS内容的来源不同。传输层不维护上下文，在
ATA命令或以前的FIS内容。
#### 10.1.1 FIS建设 
当上层请求构建FIS时，传输层提供以下服务。 根据请求的FIS类型，收集FIS内容。
 将FIS内容按适当的顺序放置。
 通知Link层需要传输帧，并将FIS内容传递给Link。
 管理Buffer/FIFO流量，通知Link需要流量控制。
 接收Link层的帧接收确认。
 向上级请求层报告传输良好或错误。
#### 10.1.2 FIS分解 
当收到来自链路层的FIS时，传输层提供以下服务。 接收来自链路层的FIS。
 确定FIS类型。
 将FIS内容分发到FIS类型所指示的位置。
 对于宿主传输层来说，接收到FIS后，还可能会导致构建一个
FIS要返回给设备。
 向上层报告接收良好或错误
### 10.2 帧信息结构（FIS） ...............................................................................

#### 10.2.1 概述 
AFIS是一组D字，如前所述在主机和设备之间传递信息。基元用于定义FIS的边界，可以插入基元来控制信息流的速率。本节描述了FIS的信息内容（称为有效载荷），并假定读者知道支持信息内容所需的基元。
信息字段的内容分为三类，(1)寄存器类型，(2)设置类型，(3)数据类型。(1)寄存器类型，(2)设置类型，(3)数据类型。对于每个类别，每个帧的组织在下一节中定义。

#### 10.2.2 有效载荷内容 
有效载荷的类型和布局由位于有效载荷第一个D字的字节0中的帧信息类型字段指示。见图194为例。该示例类型主要用于将影子寄存器块寄存器的内容从主机传输到设备。可以参考表73来刷新读者对ATA适配器的影子寄存器块组织的简化版本的记忆。
## 表73 - 简化的影子寄存器块寄存器编号 
寄存器访问操作
A2 A1 A0 读写 0 0 0 数据端口 0 0 1 错误特征 0 1 0 扇区计数 [15:8], [7:0] 0 1 1 LBA 低 [31:24], [7:0] 1 0 0 LBA 中 [39:32], [15:8] 1 0 1 LBA 高 [47:40], [23:16] 1 1 0 设备/磁头
CS 0
活动 1 1 1 状态命令
CS 1 active^110 备用状态设备控制
以下章节详细介绍了可能的有效载荷类型。SOFP、EOFP和
为清晰起见，删除了HOLDP基元。
### 10.3 FIS类型 
下面的章节定义了每个单独的FIS的结构。
#### 10.3.1 FIS类型值 
所有FIS的FIS类型字段的值已被选定，以提供额外的鲁棒性。
在可能不缓冲完整FIS的最小缓冲实现中，状态机可能会在结束CRC被检查之前开始对接收到的FIS类型值采取行动。
由于FIS类型值可能会在完整的FIS的完整性被检查到它的结尾CRC之前被执行，因此FIS类型字段值的选择是为了最大限度地提高FIS的完整性。
它们之间的汉明距离。
图193列举了FIS类型值及其分配。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
27h 寄存器 FIS - 主机到设备 34h 寄存器 FIS - 设备到主机 3 9h DMA 激活 FIS - 设备到主机 41h DMA 设置 FIS - 双向 46h 数据 FIS - 双向 58h BIST 激活 FIS - 双向 5Fh PIO 设置 FIS - 设备到主机。
A1h 设置设备位 FIS - 设备到主机
A6h 保留给未来的串行ATA定义
B8h 保留给未来的串行ATA定义
BFh 保留给未来的串行ATA定义
C7h 供应商专用
D4h 供应商专用
D9h 保留给未来的串行ATA定义
## 图193 -- -- FIS类型值分配 **10.3.1.1 未识别的FIS类型**。
设备或主机可能会收到图193中未定义或供应商特定的FIS类型。FIS的接收器决定是否处理未定义或保留为 "未识别 "的FIS类型。在某些情况下，接收器可能会接受未定义的或供应商特定的
FIS。主机和设备应在使用前协商任何可能传输的未定义或厂商特定的FIS类型。
如果接收方决定将某一FIS类型视为未识别，则应在收到该FIS类型时遵循第9.6节中的链路层状态机定义。
#### 10.3.2 数据FIS上的CRC错误 
在数据FIS上发生串行ATA CRC错误后，如果设备传输设备到主机的FIS，应将ERR位设置为1，并将状态字段中的BSY位和DRQ位清零，将错误字段中的ABRT位设置为1。建议设备在Error字段中将7位（即ICRC位）也设置为1。参见ATA8-ACS。
在串行ATA CRC错误后，没有设备到主机的FIS传输，在最后一个数据FIS上的
PIO-in命令，也没有在ATAPI命令数据包传输中出现串行ATA CRC错误之后。
因此，在这两种情况下，设备没有机制向主机指示串行ATA CRC错误。主机应该检查SError寄存器，以确定在这两种情况下是否发生了Link层错误。
#### 10.3.3 所有FIS类型.........................................................................................................。

在以下所有的FIS结构中，应适用以下规则。1. 所有保留字段应以全零的形式写入或传输 2. 在读取或接收过程中，所有保留字段应被忽略。
 
#### 10.3.4 寄存器--主机到设备.....................................................................................。
 0 特性(7:0) 命令 CR R R PM 端口 FIS 类型 (27h) 1 设备 LBA(23:16) LBA(15:8) LBA(7:0)
特性(15:8) LBA(47:40) LBA(39:32) LBA(31:24) 2 3 控制 ICC 计数(15:8)^ 计数(7:0)^ 7 6 5 4 3 2 1 0 4 保留 (0) 保留 (0) 保留 (0) 保留 (0)。
## 图194 - 寄存器--主机到设备FIS布局 
如果本 FIS 中的字段没有被命令定义，则该字段应为该命令保留。
字段定义
FIS类型 - 设置为27h的值。定义FIS字段的其余部分。
 定义FIS的长度为5个D字。
C - 当由于命令寄存器的更新而进行寄存器传输时，该位被设置为1。当寄存器传输是由于设备控制寄存器的更新时，该位被清零。在设备控制寄存器中，将C位设置为1，将SRST位设置为1。
控制字段是无效的，并导致不确定的行为。
命令 - 包含影子寄存器的命令寄存器的内容。
Block.LBA(7:0) - 包含影子寄存器LBA低寄存器的内容。
LBA(7:0) - 包含影子寄存器的 LBA 低寄存器的内容。
Block.Control - 包含影子寄存器的设备控制寄存器的内容。
控制 - 包含影子寄存器的设备控制寄存器的内容。
Block.LBA(15:8)
LBA(15:8) - 包含影子寄存器的LBA中间寄存器的内容。
Block.LBA(39:32) - 包含影子的扩展地址域的内容。
LBA(39:32) - 包含 Shadow 的扩展地址字段的内容。
注册块
LBA(23:16) - 包含影子寄存器的LBA高寄存器的内容。
Block.LBA(47:40)
LBA(47:40) - 包含 Shadow 的扩展地址字段的内容。
注册块
设备 - 包含影子寄存器块的设备寄存器的内容。
特性(7:0) - 包含影子寄存器的特性寄存器的内容。
Block.特征(15:8)--包含Shadow的扩展地址域的内容。
Features(15:8) - 包含 Shadow 的扩展地址域的内容。
注册块
PM端口--当端点设备通过端口倍增器连接时，指定FIS应传送到的设备端口地址。该字段由主机设置。
R - 保留 - 应清零。
Count(7:0) - 包含影子寄存器的扇区计数寄存器的内容。
块。
Count(15:8) - 包含 Shadow 的扩展地址栏的内容。
注册块 
##### 在附件处进行高速小型化。
#### ATA国际组织 
LBA(7:0) - 包含影子寄存器的 LBA 低寄存器的内容。
Block.LBA(31:24) - 包含影子的扩展地址字段的内容。
LBA(31:24) - 包含 Shadow 的扩展地址字段的内容。
注册块
ICC--异步命令完成(ICC)包含的值由主机设置，用于通知设备一个时间限制。如果一个命令没有定义该字段的使用，则应保留。
**10.3.4.1 说明**。
寄存器-主机到设备FIS用于将影子寄存器块的内容从主机传输到设备。这是向设备发出ATA命令的机制。
**10.3.4.2 传输**。
寄存器的传输--主机到设备FIS是由对命令寄存器的写入操作启动的，或对设备控制寄存器的写入操作启动的，其值与主机适配器的影子寄存器块中设备控制寄存器的当前值不同。启动传输后，影子寄存器块的当前内容被传输，并根据传输是命令寄存器被写入还是设备控制寄存器被写入的结果，设置FIS中的C位。主适配器应在对启动传输的Command寄存器进行写入操作后400 ns内将影子状态寄存器中的BSY位设置为1。如果对设备控制寄存器的写入，主机适配卡应在对设备控制寄存器进行写入操作后的400 ns内将影子状态寄存器中的BSY位设置为1。
控制寄存器将SRST位的状态从零变为1。主机适配卡不得设置影子状态寄存器中的BSY位，因为对设备控制寄存器的写入不会将SRST位的状态从零变为1。
需要注意的是，Serial ATA主机适配器强制执行相同的访问控制。
影子寄存器块作为并行ATA设备对命令块寄存器的强制。
具体来说，禁止主机写入特征(7:0)、计数(7:0)、LBA(7:0)。
当状态寄存器中的BSY位或DRQ位被设置时，LBA(15:8)、LBA(23:16)或设备寄存器。
寄存器。当BSY位或DRQ位被设置时，对命令寄存器的任何写入都将被忽略，除非写入是为了发出设备复位命令。
**10.3.4.3 接收**。
一旦接收到有效的注册表--主机到设备FIS，设备就会更新其本地的注册表副本。
命令和控制块寄存器的内容。然后设备要么启动执行命令寄存器中指示的命令，要么启动执行设备控制寄存器中指示的控制请求，这取决于FIS中C位的状态。
有一些遗留的BIOS和驱动程序在发出命令之前就写入设备控制寄存器来启用中断。为了避免不必要的开销，只有在状态与前一个值发生变化时，才会将这个FIS传送给设备。

#### 10.3.5 寄存器--设备到主机.....................................................................................。
 0 错误状态 RI R R PM 端口 FIS 类型 (34h) 1 设备 LBA(23:16) LBA(15:8) LBA(7:0)

保留 (0) LBA(47:40) LBA(39:32) LBA(31:24) 2 3 保留 (0) 保留 (0) 计数器(15:8)^ 计数器(7:0) 4 保留 (0) 保留 (0) 保留 (0) 保留 (0)。
## 图195--寄存器--设备到主机的FIS布局。
领域定义
FIS类型 - 设置为34h的值。定义FIS的其他字段。定义FIS的长度为5个D字。
LBA(15:8) - 包含影子寄存器的LBA中间寄存器的新值。
Block.LBA(39:32) - 包含影子的扩展地址域的内容。
LBA(39:32) - 包含 Shadow 的扩展地址字段的内容。
注册块
LBA(23:16) - 包含影子寄存器的LBA高寄存器的新值。
Block.LBA(47:40)
LBA(47:40) - 包含 Shadow 的扩展地址字段的内容。
注册块
设备 - 包含影子寄存器块的设备寄存器的新值。
错误 - 包含影子寄存器块的错误寄存器的新值。
I--中断位。该位反映设备的中断位线。器件不得根据接收到的nIEN位的状态来修改该位的行为。
注册主机到设备的FIS。
PM端口 - 当端点设备通过端口乘法器连接时，指定FIS接收的设备端口地址。该字段由端口
乘法器。端点设备应将此字段设置为0h。
R--保留，--应清零。
Count(7:0) - 包含 Shadow 的扇区计数寄存器的新值。
寄存器块。
Count(15:8) - 包含 Shadow 的扩展地址字段的内容。
注册块
LBA(7:0) - 包含影子寄存器的 LBA 低寄存器的新值。
Block.LBA(31:24) - 包含影子的扩展地址字段的内容。
LBA(31:24) - 包含 Shadow 的扩展地址字段的内容。
注册块
状态--包含状态（和备用状态）寄存器的新值。
影子寄存器块。
**10.3.5.1 说明**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
Register - Device to Host FIS用于设备更新主机适配器的Shadow Register Block的内容，这是设备指示命令完成状态或改变主机适配器Shadow Register Block内容的机制。这是设备指示命令完成状态或改变主机适配器的影子寄存器块内容的机制。
**10.3.5.2 传输**。
寄存器的传输--设备到主机 FIS由设备发起，以更新主机适配器的影子寄存器块的内容。寄存器的传输 - 设备到主机
主机FIS通常是作为设备完成命令的结果。
寄存器-设备到主机FIS只能用于设置状态寄存器中的SERV位，以便在当前BSY位或DRQ位被设置的情况下，为总线释放命令请求服务。
状态寄存器；设置设备位FIS应用于设置SERV位，当BSY位和
DRQ位在状态寄存器中均被清零。传送的SERV位与状态寄存器中的
寄存器--设备对主机的FIS写入影子状态寄存器，因此当FIS因设备完成命令而传输时，该位应准确反映待处理服务请求的状态。
**10.3.5.3 接收**。
当接收到一个有效的寄存器-设备到主机FIS时，接收到的寄存器内容被转移到主机适配器的影子寄存器块。
如果影子状态寄存器中的BSY位和DRQ位都被清除，当寄存器-设备-主机FIS接收到有效的寄存器-设备-主机FIS时，就会将接收到的寄存器内容传送到主机适配器的影子寄存器块。
设备到主机的FIS被主机适配器接收，那么主机适配器应丢弃接收到的FIS的内容，并且不更新任何影子寄存器的内容。
#### 10.3.6 设置设备位-设备到主机..........................................................................。
 0 错误 RStatus Hi R 状态 Lo N I R R PM 端口 FIS 类型 (A1h)
特定议定书1
## 图196 - 设置设备位 - 设备到主机FIS布局 
领域定义
FIS类型 - 设置为A1h值。定义FIS字段的其余部分。定义FIS的长度为两个D字。
I - 中断位。该位标志着主机适配器进入中断待定状态。如果主机正在执行标记队列命令（READ FPDMA
QUEUED、WRITE FPDMA QUEUED或NCQ QUE MANAGEMENT），只有当接收到帧时，影子状态寄存器中的BSY位和DRQ位都为零时，主机才应进入中断待处理状态。如果主机正在执行本地队列命令（READ FPDMA
QUEUED、WRITE FPDMA QUEUED或NCQ QUE MANAGEMENT)与设备，无论BSY位或影子状态寄存器中DRQ位的当前状态如何，都会进入中断待定状态.设备不得根据接收到的nIEN位的状态修改该位的行为，在
注册主机到设备FIS。
N - 通知位。该位向主机发出信号，表明设备需要注意。如果该位设置为1，主机应询问设备，并确定需要采取何种类型的行动。如果该位被清零。
 设备没有向主机请求关注。请参阅第13.8节。

错误 - 包含影子寄存器块的错误寄存器的新值。
PM 端口 - 当端点设备通过端口倍增器连接时，指定接收 FIS 的设备端口地址。该字段由端口乘法器设置。
端点设备应将此字段设置为0h。
Status-Hi--包含Shadow的状态寄存器的第6、5、4位的新值。
寄存器块。
状态-Lo-包含影子寄存器的状态位 2、1 和 0 的新值。
寄存器块。
特定协议--该字段的值仅定义为与本地命令一起使用。
排队协议。详情请参阅13.6。除了本地命令队列（例如异步命令队列）以外的任何用途，该字段应清零。
通知）。)
R - 保留 - 应清零。
**10.3.6.1 说明**。
设置设备位FIS被设备用来加载影子寄存器块位，设备对这些位有独占的写访问权限，这些位是错误寄存器的8个位和状态寄存器的6个位。这些位是错误寄存器的8位和状态寄存器的8位中的6位。该FIS不改变状态寄存器的BSY位或DRQ位。
FIS包括一个位，用于在BSY位和状态寄存器的DRQ位发生变化时，向主机适配器发出信号，以产生中断。
当接收到该FIS时，影子状态寄存器中的DRQ位均被清零。
一些串行ATA到并行ATA的桥接解决方案可能会根据其目标市场的要求选择不支持该FIS。
**10.3.6.2 传输**。
设备发送一个Set Device Bits FIS，以改变错误寄存器中的一个或多个位，或者改变错误寄存器中的一个或多个位。
影子寄存器块中的状态寄存器。该FIS应被设备用来设置该设备的状态寄存器。
状态寄存器中的SERV位，用于请求服务总线释放命令。当用于此目的时，设备应将中断位设置为1。
**10.3.6.3 接收**。
当收到Set Device Bits FIS时，主机适配器应将Error字段的数据加载到影子Error寄存器中，将Status-Hi字段的数据加载到影子寄存器的第6、5和4位。
状态寄存器，并将状态-Lo字段的数据输入影子状态寄存器的2、1和0位。影子状态寄存器的BSY位和DRQ位不得改变。如果
FIS中的中断位设置为1，如果接收到该FIS时，影子状态寄存器中的BSY位和DRQ位均清零，则主机适配器应进入中断等待状态。
#### 10.3.7 DMA激活--设备到主机 0 保留 (0) 保留 (0) R R R PM端口 FIS类型 (39h)
## 图197 -- -- DMA激活 -- -- 设备到主机FIS布局..............................................................。

字段定义
FIS类型 - 设置为39h的值。定义FIS字段的其余部分。定义FIS的长度为一个Dword。

##### 高速 SERIALIZED ATTACHMENT(附件) 
#### ATA国际组织 
PM端口 - 当端点设备通过端口乘法器连接时，指定FIS接收的设备端口地址。此字段由端口
乘法器。端点设备应将此字段设置为0h。
R - 保留 - 应清零。
**10.3.7.1 说明**。
DMA Activate FIS由设备用于向主机发出信号，以继续进行主机到设备的DMA数据传输。
可能会出现这样的情况：主机需要发送多个数据FIS，以完成整个数据传输请求。主机应等待成功接收到DMA激活FIS后，再发送所需的每一个数据FIS。
**10.3.7.2 传输**。
器件向主机传送一个DMA激活，以便启动从主机到器件的DMA数据流，作为相应DMA写命令的数据传输部分的一部分。
当传输该FIS时，设备应准备好随后接收一个数据--主机向
来自主机的设备FIS与相应命令的DMA数据。
**10.3.7.3 接收**。
收到DMA激活后，如果主机适配器的DMA控制器已经被编程和武装，主机适配器应启动数据FIS的传输，并在该FIS中传输DMA控制器上下文所指示的主机内存区域对应的数据。如果主机适配卡的DMA控制器尚未编程和布防，主机适配卡应设置一个内部状态，表明DMA控制器已被设备激活，一旦DMA控制器已被编程和布防，则应向设备传输一个数据FIS，其中应包含DMA控制器上下文所指示的主机内存区域对应的数据。
#### 10.3.8 DMA 设置--设备到主机或主机到设备（双向） 0 保留 (0) 保留 (0) A I D R PM 端口 FIS 类型 (41h)
DMA缓冲区标识符低1
DMA缓冲区标识符高2

保留 (0) 3
DMA缓冲器偏移4
DMA传输计数 5 6 保留 (0)
## 图198 - DMA设置 - 设备到主机或主机到设备的FIS布局。
领域定义 
FIS类型 - 设置为41h的值。定义FIS的其他字段。定义FIS的总长度为7个D字。
DDirection - 指定在这个FIS之后，后续传输的数据是从发射机到接收机，还是从接收机到发射机，如果设置为1，方向是发射机到接收机，如果清零，方向是接收机到发射机。
AAuto-Activate - 如果设置为1，响应数据传输方向为Host-to-Device的DMA Setup FIS，将使主机启动第一个数据的传输。
传输的DMA上下文建立后，向设备发送FIS。
设备不应传输DMA激活FIS来触发主机传输第一个数据FIS。如果清零，则当数据传输方向为主机到设备时，需要DMA激活FIS来触发主机传输第一个数据FIS。
DMA Buffer Identifier Low/High - 该字段用于识别主机内存中的 DMA 缓冲区。本规范中没有描述其内容，而是取决于主机。缓冲区标识符由主机提供给设备，设备将其回传给主机。这允许实现传递一个物理地址或，或者，在更复杂的实现中，缓冲区标识符可以是一个分散收集列表或其他信息，可以识别一个DMA "通道"。
DMA缓冲区偏移 - 这是进入缓冲区的字节偏移。位[1:0]应为零。
DMA传输计数--这是要读取或写入的字节数。Bit zero应为0。
I 中断 - 如果中断位设置为 1，当 DMA 传输计数用尽时，将产生一个中断待定。设备不应根据寄存器主机中接收到的nIEN位的状态来修改该位的行为，以使该位的状态为1。
设备 FIS。
PM端口--当端点设备通过端口倍增器连接时，指定FIS应传送到或接收的设备端口地址。该字段由主机设置，用于主机到设备的传输，该字段由
设备到主机传输的端口倍增器，端点设备应将此字段设置为0h，用于设备到主机的传输。端点设备应将此字段设置为0h，用于设备到主机的传输。
R - 保留 - 应清零。
**10.3.8.1 说明**。
DMA设置--设备到主机或主机到设备的FIS是一种机制，通过这种机制，第一方的设备可以在DMA设置的基础上，将设备与主机之间的数据进行交换。
启动对主机内存的DMA访问。该FIS用于要求主机或设备在传输数据之前对其DMA控制器进行编程。FIS允许实际的主机内存区域被抽象化(取决于实现)，让内存区域通过代表主机授予设备访问的内存区域的基础内存描述符来引用。对于内存描述符抽象的具体实现没有定义。
设备或主机在之前的某个时间通过特定的实现机制，例如向规范发出的命令或规范中定义的命令，被告知64位DMA缓冲区标识符/描述符。缓冲区内的随机访问是通过使用缓冲区偏移来完成的。
第一方DMA是一种超集能力，传统模式设备或传统模式设备驱动程序不一定支持，但对于适应未来的功能是必不可少的。
**10.3.8.2 传输**。
设备或主机传输DMA设置-设备到主机或主机到设备FIS作为执行DMA访问的第一步。DMA设置-设备到主机或主机到设备的目的是为一个或多个数据传输建立DMA硬件上下文。

##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
只有在改变DMA上下文时，才需要进行DMA设置--设备到主机或主机到设备。多个数据 - 主机到设备或设备到主机的FIS可能会在任何一个方向上跟随，例如，如果传输计数超过最大的数据 - 主机到设备或设备到主机的传输长度，或者当数据传输被中断时。当多个数据--主机到设备或设备到主机的FIS被中断时。
设备到主机FIS遵循DMA设置--设备到主机或主机到设备FIS，设备或主机应将FIS中包含的数据按顺序放置在地址中；也就是说，如果一个FIS的最后一个Dword被放置在（或从）地址N中，则后续数据的第一个Dword--主机到
设备或设备到主机应放在（或从）地址N+4，除非有一个中间的。
DMA设置--设备到主机或主机到设备FIS用于改变DMA上下文。该机制允许有效地将数据流导入缓冲区。
**10.3.8.3 接收**。
当收到一个DMA设置--设备到主机或主机到设备的FIS时，FIS的接收方应验证收到的DMA设置请求。
 如果缓冲区标识符和指定的偏移量/计数是有效的，则使用
FIS。缓冲区标识符和缓冲区/地址验证的具体实现没有规定。在有效的DMA设置--设备到主机或主机到设备FIS的D位清零后，DMA设置--设备到主机或主机到设备FIS的接收方会响应一个或多个数据--主机到设备或设备到主机FIS，直到DMA计数用完。在一个有效的DMA设置-设备到主机或主机到设备的FIS（D位设置为1）之后，FIS的接收器应准备接受一个或多个数据-主机到设备或设备到主机的FIS，直到DMA计数用尽。
在DMA传输完成后，如果出现以下情况，应产生一个中断等待条件
中断位设置为1。DMA传输完成的定义取决于系统，但通常包括传输计数耗尽或DMA控制器检测到错误。
注意 第一方DMA访问分为两组：命令/状态传输和用户数据传输。中断通常不会在用户数据传输中产生。本规范中没有定义命令/状态传输的最佳中断方案。
**1 0. 3. 8. 3. 1 A u t o - A c t i v a t e**。
从主机到设备的第一方 DMA 传输需要同时传输 DMA Setup
FIS 和后续的 DMA 激活 FIS，以触发主机向设备传输数据。
由于设备可能只在准备从主机接收后续数据FIS时才选择提交DMA设置FIS，因此，通过在DMA设置FIS中设置自动激活'A'位为1，使DMA设置FIS自动激活DMA控制器，可以消除DMA激活FIS的额外事务。
在主机按照第13.3.2节的定义明确启用优化之前，设备不应试图使用该功能。主机对 DMA Setup FIS 的响应是："自动激活'A'位"。
当主机未启用自动激活时，自动激活位设置为1，未定义自动激活。
**10.3.8.4 HBA执行第一方DMA数据相位原子性**。
主机总线适配器应确保第一方DMA数据阶段不中断。除非
影子状态寄存器中的ERR位被设置，主机应确保在接收到DMA设置FIS和相关传输计数用尽之间，除了请求的数据有效载荷或软件复位的FIS外，没有其他FIS从主机传输到设备。

#### 10.3.9 BIST Activate - Bidirectional 0 Reserved (0) Pattern Definition R R R PM Port FIS Type (58h)
T A S L F P R V (^1) Data1 [31:24] Data1 [23:16] Data1 [15:8] Data1 [7:0] (^2) Data2 [31:24] Data2 [23:16] Data2 [15:8] Data2 [7:0] ## 图199 - BIST Activate - Bidirection。
## 图 199 - BIST 激活 - 双向...................................................................................。

字段定义
FIS类型 - 设置为58h的值。定义FIS字段的其余部分。
PM端口--当端点设备通过端口倍增器连接时，指定FIS应传送到或接收的设备端口地址。该字段由主机设置，用于主机到设备的传输，该字段由?
设备到主机传输的端口倍增器，端点设备应将此字段设置为0h，用于设备到主机的传输。端点设备应将此字段设置为0h，用于设备到主机的传输。
R - 保留 - 应清零。
模式定义
F - 远端模拟(AFE)回环(可选)
L - 远端重定时回环* 发射机应插入额外的ALIGNP基元。
T--仅远端传输模式
A - ALIGNP 旁路（不传输 ALIGNP 基元）（仅与 T 位组合时有效
S - 旁路扰频（仅与T位组合时有效）。
P - 原始位。(仅与T位组合时有效)(可选)
V - Vendor Specific Test Mode（厂商特定测试模式）。导致所有其他位被忽略。
Data1 - 数据信息的第 1 个字，用于确定作为 BIST 激活 FIS 的结果传输的模式。仅当 T 位被设置为 1 时适用。
数据2 - 数据信息的字#2，用于确定BIST激活FIS后传输的模式。仅当 T 位被设置为 1 时适用。
**说明**10.3.9.1 
BIST Activate FIS 应用于将接收器置于几种环回模式之一。
BIST Activate FIS是一种双向FIS，可由主机或设备发送。
发送方和接收方有不同的责任，以确保双方的适当合作。发送和接收FIS的状态机是对称的。本规范中没有定义引起BIST激活FIS传输的方法。
传输FIS的状态机并不试图指定发送者在成功传输请求后所采取的行动。在
应用层接到FIS成功传输的通知后，发送方的应用层将自己的应用层、传输层和物理层准备到支持数据流传输的适当状态。在接收方确认接收到FIS之前，FIS不会被认为是成功传输的，正如本规范的各个章节所描述的正常FIS传输。BIST 激活 FIS 的发送方应在接收到 R_OKPuntil 后连续发送 SYNCPprimitives，直到它准备好在 BIST 交换中与接收方交互。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
同样，接收FIS的状态机也没有规定接收方的应用层的动作。一旦接收到FIS，接收方的应用层就会将自己的应用层、传输层和物理层放入状态，对发送方的数据进行适当的重传。接收者在正确接收到良好的BIST激活FIS(良好的CRC)后，表示成功地传送了
FIS通过R_OKP传送到发送端，并且至少已经收到一个良好的SYNCP。一旦进入自检模式，接收器应继续允许处理COMINIT或COMRESET信号，以退出自检模式。
注意，BIST模式的目的是用于检测/观察测试，以及支持传统的实验室设备，而不是用于系统内自动测试。
F、L和T位的设置是相互排斥的。F、L和T位的设置是相互排斥的。
BIST 激活 FIS，以确保只设置其中一个位。请参阅表 74 了解 BIST 激活 FIS 中的有效位设置。
## 表74 - BIST激活FIS模式和位设置 
BIST 测试模式 F L T P A S V。
远端模拟环回 1 0 0 0 0 0 0 0 0
远端重定时回环 0 1 0 0 0 0 0 0 0
远端传输与ALIGNs，加扰数据。
##### 0 0 1 0 0 0 0 
远端传输，带ALIGNs，未解扰数据
##### 0 0 1 0 0 1 0 
远端传输不含
ALIGNs, 加扰数据
##### 0 0 1 0 1 0 0 
远端传输不含
ALIGNs，未编排的数据
##### 0 0 1 0 1 1 0 
远端传输带有 ALIGNs 的基元 0 0 1 1 0 na 0
远端传输不含ALIGNs的基元 0 0 1 1 1 na 0
供应商专用 na na na na na na 1
键：0--位应清零 1--位应设为1
F : 远端模拟(模拟前端-AFE)环回模式被定义为一种厂商可选的模式，在这种模式下，原始数据被接收，并重新传输，不需要任何重新定时或重新同步等。由于测试的往返特性以及缺乏重定时，远端AFE Loopback的实现是可选的。这种模式的目的是为了快速显示连通性，测试失败并不代表系统故障。
L：远端重定时环回模式(Far End Retimed LoopbackMode)定义为接收机对数据进行重定时，并重传重定时数据的模式。重定时环回模式的发起者应考虑到环回设备每256次最多消耗两个ALIGNPprimitives（一个ALIGN序列）。
传输的Dword，如果需要在返回的数据流中存在任何ALIGNPprimitives，则应在传输的数据流中插入额外的ALIGNPprimitives。启动器应以每传输256个Dword的正常时间间隔在单次突发中传输额外的ALIGN序列（而不是以一半的时间间隔插入ALIGN序列）。
回环设备可以从接收到的数据中删除零个、一个或两个ALIGNPprimitives，它可以插入一个或多个ALIGN序列。如果一个或多个ALIGNPprimitives直接在发起者插入的ALIGNPprimitives之前或之后，它可以插入一个或多个ALIGNPprimitives(导致由至少两个ALIGNPprimitives组成的ALIGN序列)，或者如果没有在发起者的ALIGNPprimitives之前或之后，它可以插入两个或多个ALIGNPprimitives。回环重定时的一个副作用是，返回的数据流可能具有奇数个ALIGNPprimitives的实例，然而，返回的ALIGNP基元总是以突发形式存在，如果发起者传输了双ALIGN序列(四个连续的ALIGNPprimitives)，那么返回的数据流应包括长度不短于两个ALIGNPprimitives的ALIGNPburst(尽管ALIGNPburst的长度可能是奇数)。重定时环回模式的发起者不应假设环回设备返回的ALIGNP基元的相对位置与发起者发送的ALIGNPprimitives的相对位置之间存在任何关系。
在重定时环回模式下。
 启动器应只传送有效的8b/10b字符，以便环回设备在重新传送前对其进行10b/8b解码和重新编码。如果环回设备对传入的数据进行解扰，则负责用相同的解扰序列对其进行重新解扰，以确保返回的数据与接收的数据没有变化。
环回设备对其发射机和接收机的运行差值不能保证相同，因此环回启动器应对返回的数据进行10b/8b解码，而不是使用原始的10b返回流进行数据比较。环回设备应不加修改地返回所有接收到的数据，并应无视协议对基元的处理。只有
OOB信号和ALIGNP处理由环回设备执行，而其他所有的数据都是重传，不需要解释。
T：远端传输模式被定义为可用于调用远端设备的模式。
在收到BIST激活FIS后，按照位于Data1和Data2中的内容定义，发送数据模式的接口。注意，Data1和Data2应仅在T位激活时适用，表示 "远端传输模式"。并不要求Data1和Data2内的值必须是 "远端传输模式"。
Data2相等。这两个D字可以编程为任何值。
该数据由以下位修改。
P：传输基元位。当该位在远端传输模式下设置时，下面两个 D 字的最低阶字节将被视为 K 字，以确定适当的传输基元。基元的编码在第 9.4 节中定义。BIST 激活 FIS 的发送方有责任确保 BIST 激活 FIS 中包含的值是由 BIST 激活 FIS 的发送方提供的。
数据1和数据2是K字符的有效D字符版本（即K28.5的BCh）。该位的设置仅在T位被设置时适用。
A：ALIGNP序列旁路模式。设置为1时，不发送ALIGNPprimitives。当设置为 1 时，不发送 ALIGNPprimitives。
A 位未被断言，ALIGNPprimitives 会按照本文档中的定义正常发送。该位的设置仅在T位被设置时适用。
S: 旁路扰乱模式被定义为一种模式，可用于在 BIST 激活期间发送数据或模式，这些数据或模式未被扰乱，但被编码和解码为正常和合法的 8b/10b 值。该位的设置仅在T位被设置时适用。当P位被设置为1时，S位被忽略。
V : 厂商独特模式是特定的实施方式，应保留给各个厂商使用。在此模式下，所有其他位都被忽略。
**10.3.9.2 传送** 
发起者向接收者发送BIST Activate，以启动BIST运行模式。
**10.3.9.3 接收**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
在收到BIST激活后，接收方应按照BIST激活的规定开始操作。
FIS，详见本文件。
#### 10.3.10 PIO 设置 - 设备到主机.................................................................................。
 0 错误状态 RI D R PM 端口 FIS 类型 (5Fh) 1 设备 LBA(23:16) LBA(15:8) LBA(7:0)
保留 (0) LBA(47:40) LBA(39:32) LBA(31:24) 2 3 E_Status 保留 (0) Count(15:8)^ Count(7:0)
保留 (0) 传输计数 4
## 图200 - PIO设置 - 设备到主机FIS布局...................................................................。

字段定义
FIS类型 - 设置为5Fh的值。定义FIS字段的其余部分。定义FIS的长度为5个D字。
LBA(15:8) - 保存命令块的LBA(15:8)寄存器的内容。
LBA(39:32) - 包含影子寄存器 LBA(39:32) 字段的内容。
块
LBA(23:16) - 包含命令块的 LBA(23:16) 寄存器的内容。
LBA(47:40) - 包含影子寄存器的 LBA(47:40) 字段的内容。
块
D--指定数据传输方向，当设置为1时，传输方向为从设备到主机，当清零时，传输方向为从主机到设备。当设置为1时，传输方向为从设备到主机，当清零时，传输方向为从主机到设备。
Device - 保存命令块的 Device 寄存器的内容。
状态--包含命令块的状态寄存器的新值，用于启动主机数据传输。
错误--包含命令块的错误寄存器的新值，在所有后续数据到设备帧结束时。
I--中断位。该位反映了设备的中断位线。设备不得根据接收到的nIEN位的状态来修改该位的行为，在
寄存器--主机到设备FIS。
PM端口 - 当端点设备通过端口乘法器连接时，指定FIS接收的设备端口地址。该字段由端口
乘法器。端点设备应将此字段设置为0h。
R - 保留 - 应清零。
Count(7:0) - 保存命令块的 Count(7:0) 寄存器的内容。

Count(15:8) - 包含影子寄存器的 Count(15:8) 字段的内容。
块
LBA(7:0) - 包含命令块的 LBA(7:0) 寄存器的内容。
LBA(31:24) - 包含影子寄存器的 LBA(31:24) 字段的内容。
块 
E_Status - 包含后续数据 FIS 结束时命令块的状态寄存器的新值。
传输计数 - 保存在后续数据 FIS 中要传输的字节数。
FIS。传输计数值应为非零，低阶位应为零（传输的字节数为偶数）。
**10.3.10.1 说明**。
PIO设置--设备到主机的FIS由设备用于向主机适配器提供有关PIO数据阶段的足够信息，以使主机适配器能够有效地处理。
PIO数据传输。对于PIO数据传输，设备应向主机发送PIO设置--------。
在每次完成数据传输所需的数据传输FIS之前，设备到主机FIS。从主机到设备的数据传输以及从设备到主机的数据传输都应遵循这一算法。由于ATA标准中严格的时序限制，因此，从设备到主机的数据传输，以及从设备到主机的数据传输都应遵循这一算法。
PIO设置FIS包括起始和结束状态值。这些值被主机适配器用于首先向主机软件发出PIO写数据的准备信号（BSY位被清空为0，而PIO位则被清空为0。
DRQ 位被设置为 1），并在 PIO 写入脉冲串之后，通过将 DRQ 位清零并可能将 BSY 位设置为 1，向主机软件发出正确的信号。
**10.3.10.2 在数据传输之前，由设备传输PIO设置。
主机到设备** 
设备在完成一个命令的总数据传输所需的每一次PIO数据有效载荷传输之前，向主机传送一个PIO设置--设备到主机FIS，为PIO数据有效载荷传输做准备。设备在FIS中包含了要放置在主机上的值。
PIO数据有效载荷传输开始时的影子状态寄存器，以及数据有效载荷传输结束时要放在影子状态寄存器中的值。设备应准备接收数据FIS，以响应传输PIO设置FIS。
**10.3.10.3 在主机向数据传输之前，接收主机的 PIO 设置。
设备** 
当接收到PIO设置-设备到主机的FIS时，主机应更新所有的Shadow寄存器，并将E_Status值保存在一个临时寄存器中。传输长度值应被加载到一个倒计时寄存器中。当检测到影子状态寄存器的变化时，主机软件继续对数据影子寄存器进行一系列的写操作，主机适配器应收集数据影子寄存器的值，以产生对设备的数据FIS。数据影子寄存器的每一次写入都会导致另一个数据字被连入数据FIS中，倒计时寄存器也相应地被递减。E_Status的值应转移到影子寄存器中。
在倒计时寄存器达到终端计数后400 ns内，状态寄存器。在传输长度代表奇数字的情况下，应将最后一个字放在最后一个D字的低阶（字0），并在传输前将最后一个D字的高阶字（字1）垫上0。完成一个命令的整体数据传输所需的每一个数据FIS都要重复这个过程。
**10.3.10.4 设备在数据传输前传输 PIO 设置，从
设备到主机** 
设备在完成一个命令的总数据传输所需的每一次PIO数据有效载荷传输之前，向主机传送一个PIO设置--设备到主机FIS，为PIO数据有效载荷传输做准备。设备在FIS中包含了要放置在主机上的值。
PIO数据有效载荷传输开始时的影子状态寄存器，以及数据有效载荷传输结束时放在影子状态寄存器中的值。在传输PIO设置FIS后，设备应准备传输数据FIS。

##### 高速串行化的ATATACHMENT 
#### 串行ATA国际组织 **10.3.10.5 在设备向主机传输数据之前，主机接收PIO设置**。
在收到PIO设置-设备到主机的FIS后，主机应在临时寄存器中保留状态、错误和E_Status值。传输长度值应被加载到一个倒计时寄存器中。从设备接收到数据FIS后，主机应更新所有的影子寄存器，主机软件接着从数据影子寄存器中执行一系列读操作。对数据影子寄存器的每一次读取都会导致倒计时寄存器相应地被递减。E_Status值应转移到Shadow寄存器中。
在倒计时寄存器达到终端计数400 ns内的状态寄存器。
 完成一个命令的整体数据传输所需的每一个数据FIS都要重复这个过程。
#### 10.3.11 数据--主机到设备或设备到主机（双向）.......................................。
 0 保留 (0) 保留 (0) R R R PM 端口 FIS 类型 (46h)
N个数据字（最小为一个字-最大为2048个字）n^。
## 图201--数据--主机到设备或设备到主机的FIS布局。
领域定义
FIS类型 - 设置为46h的值。定义FIS字段的其余部分。定义FIS的长度为n+1个Dword。
Dwords of data - 包含要传输的实际数据。只传输32位字段。
当只传输部分 Dword 时，最后一个 Dword 用零填充。
注意 a单个数据中可发送的最大用户数据量--------。
主机到设备或数据 - 设备到主机的FIS是有限的。请参阅说明。
PM端口--当端点设备通过端口倍增器连接时，指定FIS应传送到或接收的设备端口地址。此字段由主机设置，用于主机到设备的传输，此字段由
设备到主机传输的端口倍增器，端点设备应将此字段设置为0h，用于设备到主机的传输。端点设备应将此字段设置为0h，用于设备到主机的传输。
R - 保留 - 应清零。
**10.3.11.1 说明**。
数据--主机到设备和数据--设备到主机FIS用于传输有效载荷数据，例如从硬盘驱动器上的若干扇区读取或写入的数据。该FIS既可以由设备生成向主机传输数据，也可以由主机生成向设备传输数据。该FIS通常只是导致数据传输的事务序列中的一个元素，数据FIS之前和之后的事务为主机和设备建立了适当的上下文。
有效载荷的字节数不是一个明确的参数，而是通过计算SOFP和EOFP之间的D字数，并扣除FIS类型和CRC D字来推断的。
有效载荷大小不得超过2048个Dword（8192字节）。非数据包设备，无论是否有网桥，都应在它们的47字中报告SET MULTIPLE限制为16个扇区或更少。
IDENTIFY DEVICE信息。
在传输长度代表奇数字的情况下，最后一个字应放在最后一个D字的低阶（字0）和最后一个D字的高阶（字1）。
Dword在传输前应加零。
**10.3.11.2 传输**。
在传统模式PIO读、DMA读和第一方DMA写到主机内存的数据传输阶段，设备向主机传送数据-设备到主机FIS。设备应在数据FIS之前，根据特定命令序列的需要，进行任何必要的上下文设置事务。例如，在第一方 DMA 主机内存写入之前，应先进行 DMA 设置 - 设备到主机 FIS，以便为接下来的数据 FIS 建立适当的上下文。
在数据传输阶段，主机向设备传输一个数据--主机到设备FIS，其内容为
PIO写、DMA写和第一方DMA读主机内存。在FIS之前，应根据特定的命令序列，进行任何必要的上下文设置事务。例如，在向设备进行传统模式 DMA 写入之前，应先进行 DMA 激活------。
设备到主机的FIS，主机已经预先建立了DMA上下文。
当用于传输数据进行DMA操作时，多个数据--主机到设备或设备到主机。
主机FIS可沿任一方向进行。当传输计数超过最大数据--主机到设备或设备到主机的传输长度或数据传输中断时，可能会发生分段。
当用于响应 PIO 设置传输数据时，数据 FIS 应包含前一个 PIO 设置 FIS 的传输计数字段中指示的字节数。
如果一个传输被分成多个FIS，所有中间FIS应包含一个完整的Dword的整数。如果数据传输的总字数是奇数，那么最后一个FIS的最后一个D字的高阶字（字1）应在传输前用0填充，并在接收时丢弃。
串行ATA协议不允许传输奇数字节。
**10.3.11.3 接收**。
无论是主机还是设备，都不希望缓冲整个数据FIS，以便在处理数据之前检查FIS的CRC。数据FIS的错误数据接收应反映在整个命令完成状态中。

##### 高速序列化在附件中的应用 
#### ATA国际组织 
### 10.4 主机传输状态....................................................................................................。

FIS接收在本质上是异步的。在非数据FIS传输的情况下：
 主机可能会被来自设备的非数据FIS接收先发制人。主机应暂缓待发传输，并处理设备传来的FIS，然后再尝试重发待发FIS。
#### 10.4.1 主机传输空闲状态图.........................................................................。

HTI1：HT_HostIdle 主机适配器等待帧或帧请求。
1. 命令寄存器 FIS 传输等待 HT_CmdFIS 2.控制寄存器 FIS 传输等待 HT_CntrlFIS 1 3. 幀接收由 Link 層指示 HT_ChkTyp^3 4. DMA 設定 FIS 傳輸待定 HT_DMASTUPFIS 5. BIST 啟動 FIS 傳輸待定 HT_XmitBIST 6. 之前的 FIS 為 PIO 設定，應用層表示資料方向為主機到裝置 HT_PIOOTrans2 2.
##### 注：1.如果设备控制影子寄存器中SRST位的状态发生改变，则控制寄存器FIS的传输是强制性的，如果SRST位的状态没有改变，则是可选的。如果在另一个非控制寄存器FIS传输已经待定的情况下，触发了SRST位修改值的控制寄存器FIS传输，则所有待定的非控制寄存器FIS传输将被中止。如果SRST位的状态与之前在控制寄存器FIS传输中的值相比没有修改，那么待定的非控制寄存器FIS传输将不会被中止。
2. PIO Setup FIS应设置PIO Setup是最后一次接收的FIS的指示。应用层向设备传输数据的指示可由应用层对影子寄存器块中的数据寄存器执行写操作来确定。
3. 在此状态下，FIS接收应优先于其他所有转态。
 
HTI2：HT_ChkTyp接收FIS类型检查。
1. 寄存器 FIS 类型检测到 HT_RegFIS 2.设置设备位 FIS 类型检测到 HT_DB_FIS 3.DMA 激活 FIS 类型检测到 HT_DMA_FIS 4.PIO 设置 FIS 类型检测到 HT_PS_FIS 5.DMA 设置 FIS 类型检测到 HT_DS_FIS 6.BIST FIS 类型检测到 HT RcvBIST 7. 检测到数据 FIS 类型，之前的 FIS 不是 PIO 设置 HT_DMAITrans 1 8. 检测到数据FIS类型，之前的FIS为PIO设置HT_PIOITrans1^1 9. 接收到未辨識的 FIS HT_HostIdle 10. 收到 Link 層的非法轉換錯誤通知 HT_HostIdle 10.
注：1.PIO Setup FIS应设置PIO Setup是最后一次发送的FIS的指示，这样该状态可以决定是过渡到DMA数据传输，还是PIO数据传输。

#### HTI1：HT_HostIdle状态。当传输层完成一个帧信息结构(FIS)事务时，进入该状态。
当处于该状态时，传输层等待影子Command寄存器被写入，影子Device Control寄存器被写入，或Link层表示正在接收FIS。
TransitionHTI1:1：当一个命令寄存器FIS传输待定时，传输层应过渡到HTCM1：HT_CmdFIS状态。命令寄存器FIS在对命令影子寄存器进行写操作后即成为待定状态，并在FIS传输成功时停止待定，如链路层所示。
过渡 HTI1:2：当控制寄存器 FIS 传输待定时，传输层应过渡到 HTCR1: HT_CntrlFIS 状态。当对设备控制影子寄存器进行写操作，使 SRST 位的状态从以前的值改变时，或当对设备控制影子寄存器进行写操作，不改变 SRST 位的状态时，控制寄存器 FIS 将成为待定状态。控制寄存器FIS在链路层指示的FIS成功传输时停止等待。
过渡HTI1:3：当链路层指示正在接收FIS时，传输层应向HTI2：HT_ChkTyp状态进行过渡。
过渡HTI1:4。當應用層表示要發送 DMA 設定 FIS 時，傳輸層應向 HTI2: HT_ChkTyp 狀態過渡。
传输层应向HT_DMASTUP0:HT_DMASTUPFIS状态进行过渡。
过渡HTI1:5。当应用层请求向设备传输BIST请求时，传输层应过渡到HTXBIST1:HT状态。
过渡HTI1:6。当应用层请求向设备传输数据，且之前的FIS为PIOSetup类型时，传输层应过渡到HTXBIST1:HT状态。
HTPS3:HT_PIOOTrans2状态。应用层通过对影子寄存器块中的数据寄存器进行写入，向设备发出传输PIO数据的信号。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
#### HTI2：HT_ChkTyp状态。当链路层表示正在接收FIS时，进入该状态。
当处于这种状态时。
 传输层检查传入FIS的FIS类型。
过渡HTI2:1：当传入的FIS为寄存器类型时，传输层应通知FIS的类型。
链路层认为它已经收到了一个有效的FIS，并向HTR1: HT_RegFIS状态进行过渡。
过渡HTI2：2。当传入的FIS为Set Device Bits类型时，传输层应通知链路层已收到有效的FIS，并过渡到HTR1：HT_RegFIS状态。
HTDB0:HT_DB_FIS状态。
过渡HTI2:3。當傳入的 FIS 為 DMA 啟動型時，傳輸層應通知 Link 層已接收到有效的 FIS，並過渡至 HTDA1.HT_DMA_FIS 狀態。
HT_DMA_FIS状态。
过渡HTI2：4。當傳入的 FIS 為 PIO 設定型時，傳輸層應通知 Link 層已收到有效的 FIS，並過渡至 HTPS1: HT_PS_FIS 狀態。
过渡HTI2：5。當傳入的 FIS 為 DMA 設定類型時，傳輸層應通知 Link 層已收到有效的 FIS，並過渡至 HTDS1: HT_DS_FIS 狀態。
过渡HTI2：6。当传入的 FIS 为 BIST 激活类型时，传输层应通知链路层已收到有效的 FIS，并过渡到 HTDS1: HT_DS_FIS 状态。
HTRBIST1:HT_RcvBIST状态。
过渡HTI2:7。当传入的FIS是数据类型，而之前的FIS不是PIO时
设置类型，传输层应通知链路层已收到有效的FIS，并向HTDA5:HT_DMAITrans状态进行过渡。
过渡HTI2:8。當傳入的 FIS 為資料型，而之前的 FIS 為 PIO 設定型時，傳輸層應通知 Link 層已收到有效的 FIS，並過渡至 HTPS5:HT_PIOITrans1 狀態。
过渡HTI2:9。当接收到的FIS为未识别或不支持的类型时，HTPS5:HT_PIOITrans1状态下，传输层应通知链路层已收到有效的FIS，并进行过渡。
传输层应通知链路层收到未识别的FIS，并向HTI1：HT_HostIdle状态进行过渡。
过渡HTI2:10：当传输层收到链路层通知非法状态转换时，传输层应向HTI1：HT_HostIdle状态进行过渡。

#### 10.4.2 主机传输传输命令FIS图解 
该协议建立一个包含主机适配器影子寄存器内容的FIS，并在软件驱动程序或BIOS写入主机适配器影子Command寄存器时将其发送给设备。
HTCM1：HT_CmdFIS构造寄存器--主机到设备的FIS，C位设为1，从影子寄存器的内容，并通知Link进行传输。
1. FIS 轉移完成 HT_CmdTransStatus 2. 收到 Link 层发出的非法过渡错误通知 HT_HostIdle 3. Link层表示帧接收HT_HostIdle 4. 
##### HTCM2.HT_CmdTransStatus 
HT_CmdTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. Status checked and no error detected HT_HostIdle 2. 狀態已檢查且未偵測到錯誤 (^1) HT_HostIdle
注意：1.当响应检测到的错误返回HT_HostIdle状态时，相关的FIS仍然等待传输。
#### HTCM1：HT_CmdFIS状态。当写入影子Command寄存器时，进入该状态。
当处于该状态时，传输层应构造一个寄存器--主机到设备FIS，C位设为1，通知链路层要传输FIS，并将FIS传递给链路层。
过渡HTCM1:1：当整个FIS已经传递给链路层时，传输层应向链路层表示FIS传输完成，并进行过渡。
HTCM2：HT_CmdTransStatus状态。
过渡HTCM1:2：当传输层收到链路层发出的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
过渡HTCM1:3：当链路层指示收到FIS时，传输层应向HTI1:HT_HostIdle状态进行过渡。
#### HTCM2：HT_CmdTransStatus状态。当整个FIS已经传递给链路层时，就会进入该状态。
当处于该状态时，传输层应等待Link层和Phy层的结束状态，为
FIS，并在必要时采取相应的错误处理措施。
过渡HTCM2:1：当FIS状态已处理完毕，且未检测到错误时。
传输层应过渡到HTI1：HT_HostIdle状态。
过渡HTCM2：2。当FIS状态已被处理且检测到错误时，传输层应过渡到HTI1: HT_HostIdle状态。相关的FIS仍然等待传输。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### ATA国际组织 
#### 10.4.3 主机传输传输控制FIS图.......................................................。


该协议建立一个包含主机适配器影子寄存器内容的FIS，并在软件驱动程序或BIOS写入主机适配器影子设备控制寄存器时将其发送给设备。
HTCR1：HT_CntrlFIS构造寄存器--主机到设备的FIS，C位从影子寄存器的内容中清零，并通知Link进行传输。
1. FIS 傳輸完成 HT_CtrlTransStatus 2. 收到 Link 层发出的非法过渡错误通知 HT_HostIdle 3. Link层表示帧接收 HT_HostIdle 4. 
##### HTCR2.HT_CtrlTransStatus 
HT_CtrlTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. Status checked and no errors detected HT_HostIdle 2. 狀態已檢查且未偵測到錯誤 (^1) HT_HostIdle
注意：1.当响应检测到的错误返回HT_HostIdle状态时，相关的FIS仍然等待传输。
#### HTCR1：HT_Cntrl_FIS状态。该状态是在写入影子设备控制寄存器时进入的。
当处于该状态时，传输层应构造一个寄存器--主机到设备FIS，C位清零，通知链路层要传输FIS，并将FIS传递给链路层。
过渡HTCR1:1：当整个FIS已经传递给链路层时，传输层应向链路层表示FIS传输完成，并进行过渡。
HTCR2：HT_CtrlTransStatus状态。
过渡HTCR1:2：当传输层收到链路层的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
过渡HTCR1:3：当链路层指示收到FIS时，传输层应向HTI1:HT_HostIdle状态进行过渡。
#### HTCR2：HT_CtrlTransStatus状态。当整个FIS已经传递给链路层时，进入该状态。
处于该状态时，传输层应等待FIS的Link和Phy结束状态，必要时采取相应的错误处理动作。
过渡HTCR2:1：当FIS状态已处理完毕，且未发现错误时，传输层应过渡到HTI1：HT_HostIdle状态。
过渡HTCR2:2。当FIS状态已被处理且检测到错误时，传输层应过渡到HTI1: HT_HostIdle状态。相关的FIS仍然等待传输。

#### 图10.4.4 主机传输传输DMA设置--设备到主机或主机到设备FIS状态**状态图**。
该协议将一个DMA设置--设备到主机或主机到设备的FIS传送给接收器。这个
FIS是发送方要求接收方为第一方的DMA控制器编程的请求。
DMA 传输，后面是一个或多个传输数据的数据 FIS。DMA设置 -
设备到主机或主机到设备的FIS请求包括传输方向指示器、主机缓冲区标识、主机缓冲区偏移、字节数和中断标志。
HTDMASTUP0.HT_DMASTUPFIS
HT_DMASTUPFIS
根据应用层提供的内容构建DMA设置--主机到设备或设备到主机FIS，并通知Link进行传输。
1. FIS 传输完成 HT_DMASTUPTrans 状态 2.收到 Link 层的非法过渡错误通知 HT_HostIdle 3. 收到Link层发出的非法过渡错误的通知HT_HostIdle 3. Link层表示帧接收 HT_HostIdle 4. 
##### HTPDMASTUP1.HT_DMASTUPTransStatus 
HT_DMASTUPTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. Status checked and no error detected HT_HostIdle 2. 狀態已檢查且未偵測到錯誤 (^1) HT_HostIdle
注意：1.当响应检测到的错误返回HT_HostIdle状态时，相关的FIS仍然等待传输。
HTDMASTUP0: HT_DMASTUPFIS 状态。当应用程序请求传输一个DMA设置--主机到设备或设备到主机的FIS时进入该状态。
当处于该状态时，传输层应构造一个DMA设置--主机到设备或设备到主机的FIS。
主机FIS，通知链路层要传输FIS，并将FIS传递给链路层。
过渡HTDMASTUP0:1：当整个FIS传到链路层后。
传输层应向链路层指示FIS传输完成，并向HTDMASTUP1：HT_DMASTUPTransStatus状态进行过渡。
过渡HTDMASTUP0:2：当传输层收到链路层发出的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
过渡HTDMASTUP0:3。当链路层表示接收到FIS时，传输层应向HTI1：HT_HostIdle状态过渡。
传输层应向HTI1:HT_HostIdle状态进行过渡。
HTPDMASTUP1：HT_DMASTUPTransStatus状态。当整个FIS已经传递到链路层时，就会进入该状态。
当处于此状态时。
 传输层应等待FIS的Link和Phy结束状态，必要时采取相应的错误处理动作。
过渡HTDMASTUP1:1：当FIS状态已处理完毕，且未检测到错误时。
传输层应过渡到HTI1: HT_HostIdle状态。

##### 高速 SERIALIZED ATTACHMENT。
#### ATA国际组织 
过渡HTDMASTUP1:2：当FIS状态已被处理，并检测到错误时，则
传输层应过渡到HTI1：HT_HostIdle状态。相关的FIS仍待传输。
#### 10.4.5 主机传输传输BIST激活FIS..........................................................。

该协议建立一个BIST Activate FIS，告诉设备准备进入相应的
内置自检模式。传输成功后，主机传输层进入空闲状态。应用层在检测到设备传输成功后，应再使主机的传输层、链路层和物理层进入相应的模式，传输FIS定义的测试数据模式。传输层的手段。
链路层和物理层进入自检模式，本规范未作定义。
HTXBIST1: HT_XmitBIST 根据本规范提供的内容构建 BIST 激活 FIS。
应用层并通知Link转移。
1. FIS传输完成 HT_TransBISTStatus 2. 收到Link层发出的非法过渡错误通知 HT_HostIdle 3. Link层表示帧接收HT_HostIdle 4. 
##### HTXBIST2.HT_TransBISTStatus: 
HT_TransBISTStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查完成 HT_HostIdle 2. 状态检查和至少一个错误检测到HT_HostIdle^1。
注意：1.由于错误而重新传输BIST激活FIS不是必须的，但允许。

#### HTXBIST1：HT_XmitBIST状态。进入该状态是为了向设备发送BIST FIS。

过渡HTXBIST1:1：当整个FIS传到链路层后，传输层应向链路层表示FIS传输完成，并向HTXBIST2:HT_TransBISTStatus状态进行过渡。
过渡HTXBIST1:2：当传输层收到链路层发出的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
过渡HTXBIST1:3：当链路层表示正在接收FIS时，应向
传输层应向HTI1:HT_HostIdle状态进行过渡。
#### HTXBIST2：HT_TransBISTStatus状态。当整个FIS已经传递到链路层时，进入该状态。
过渡HTXBIST2:1：当FIS传输完成后，传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTXBIST2:2：当FIS传输完成后，传输层应过渡到HTI1:HT_HostIdle状态。当 FIS 传输完成，且至少检测到一个错误时，传输层应过渡到 HTI1:HT_HostIdle 状态。相关的FIS可能会继续等待传输。

#### 10.4.6 主机传输分解寄存器FIS图解 
该协议接收来自设备的包含新的影子寄存器内容的寄存器-设备到主机FIS，并将该内容放入影子寄存器中。
HTR1: HT_RegFIS 将来自设备的FIS内容放入相应的保持寄存器中。
1. FIS 傳輸完成 HT_RegTransStatus 2. HT_RegTransStatus 2. 從 Link 層收到非法轉換錯誤通知 HT_HostIdle 3.
HTR2: HT_RegTransStatus 检查 Link 和 Phy 的传输结果，如果发生错误，采取适当的措施。
1. 状态检查 HT_HostIdle 
#### HTR1：HT_RegFIS状态。该状态是在链路层表示正在接收FIS，且该FIS为寄存器类型时进入。
当处于该状态时，传输层应分解寄存器FIS，并将其内容放入相应的保持寄存器中。
过渡HTR1:1：当整个寄存器-设备到主机的FIS已经放入保持寄存器中时，传输层应过渡到HTR2：HT_RegTransStatus状态。
Transition HTR1:2：当传输层收到链路层的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
#### HTR2：HT_RegTransStatus状态。该状态是指整个FIS已经放入保持寄存器中。
当处于该状态时，传输层应等待链路层和Phy层结束状态，为
FIS，并在必要时采取相应的错误处理动作。
过渡HTR2:1：当FIS状态已处理完毕且未发现错误时，应将保持寄存器的内容放入影子寄存器中，如果中断位被置位，则将
传输层应设置中断等待标志。传输层应过渡到
HTI1: HT_HostIdle状态。
 当FIS状态已经处理完毕，并检测到至少一个错误时，保持寄存器的内容不应转移到影子寄存器，错误状态应返回给设备，传输层应过渡到HTI1：HT_HostIdle状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
#### 10.4.7 主机传输分解设置设备位FIS状态图。
该协议接收来自设备的Set Device Bits FIS，其中包含新的Error和Status。
影子寄存器的内容，并将这些内容放入错误和状态影子寄存器中。阴影寄存器的内容。
Set Device Bits FIS 也可以包含 SActive 寄存器内容和异步通知内容。
HTDB0:HT_DB_FIS Receive Set Device Bits FIS 1.FIS 状态检查，未检测到错误 HT_Dev_Bits 2.FIS 状态检查，检测到错误。FIS 狀態檢查且未偵測到錯誤 HT_HostIdle  HT_HostIdle 
HTDB1:HT_Dev_Bits 載入錯誤暫存器及狀態暫存器的 bits 1. HT_HostIdle **HTDB0:HT_DB_FIS 状态** 。当链路层表示正在接收 FIS，且 FIS 为 Set Device Bits 类型时，进入该状态。

处于该状态时，传输层应等待FIS接收完成，并等待Link层和Phy层结束状态的发布。
**传输HTDB0:1** 。当FIS接收完成且未检测到错误时，传输层应等待FIS接收完成，并等待Link和Phy层结束状态的发布。
传输层应过渡到HTDB1:HT_Dev_Bits状态。
 **过渡HTDB0:2** 。当FIS接收完成并检测到错误时，传输层应向设备返回错误状态，并过渡到HTI1:HT_HostIdle状态。
 **HTDB1:HT_Dev_Bits状态** 。当接收到Set Device Bits FIS无误后，进入该状态。

当处于该状态时，接收到的FIS的Error字段中的数据将被加载到主机适配器的影子Error寄存器中。接收到的FIS的Status-Hi字段中的数据将被加载到影子状态寄存器的第6、5和4位。接收到的FIS的Status-Lo字段中的数据应加载到影子状态寄存器的位2、1和0中。影子状态寄存器中的BSY位和DRQ位不得改变。如果FIS中的中断位被设置为1，并且影子状态寄存器中的BSY位和DRQ位都被清零，那么主机适配器将进入中断等待状态。
**过渡HTDB1:1:**传输层应过渡到HTI1:HT_HostIdle状态。
 
#### 10.4.8 主机传输层分解DMA激活FIS图： 1. 
该协议接收DMA激活FIS，请求进行DMA数据输出传输。数据传输是从主机到设备，DMA Activate FIS 使主机适配器在后续的 Data FIS 中传输数据。
HTDA1：HT_DMA_FIS 1.状态检查，未发现错误。 HT_DMAOTrans1 2. 状态检查并检测到错误 HT_HostIdle 3. HT_HostIdle 3.收到链路层的非法转换错误通知。
HTDA2：HT_DMAOTrans1 DMA控制器初始化？1. DMA控制器未被初始化，HT_DMAOTrans1 2.  HT_DMAOTrans1 2. DMA控制器已初始化，HT_DMAOTrans2 3.  HT_DMAOTrans2 3.SRST asserted, or DEMA controller initialized. SRST asserted, 或要求 DEVICE RESET 命令 HT_HostIdle。
HTDA3: HT_DMAOTrans2 啟動 DMA 控制器 1. 傳輸未完成，且傳遞 2048 個字 HT_DMAOTrans2 2. 傳輸未完成且傳送 2048 個字 HT_DMAEnd 3. 鏈路層發出中止通知 HT_DMAEnd 4.傳輸完成 HT_DMAEnd 5.傳輸未完成，傳輸 2048 Dwords。傳輸完成 HT_DMAEnd 5. 收到 Link 層的非法轉換錯誤通知 HT_HostIdle 6. SRST asserted，或要求DEVICE RESET命令 HT_HostIdle 6.
HTDA4: HT_DMAEnd 检查 DMA 控制器完成 1. DMA 控制器动作完成，未检测到错误 HT_HostIdle 2. DMA控制器的动作完成，检测到错误，HT_HostIdle 3.  HT_HostIdle 3. Link層通知中止，未偵測到錯誤 HT_HostIdle 4.DMA控制器動作完成，未偵測到錯誤 HT_HostIdle 5.DMA控制器動作完成，未偵測到錯誤。從 Link 層發出 Abort 通知，偵測到錯誤。 HT_HostIdle 
HTDA5: HT_DMAITrans 如果初始化，激活DMA控制器，接收数据FIS。
1. 傳輸未完成 HT_DMAITrans 2. SRST asserted，或设备复位指令发出 HT_HostIdle 3. 傳輸完成 HT_DMAEnd 4. 傳輸完成 HT_DMAEnd 4.收到 Link 層的非法轉換錯誤通知 HT_HostIdle
#### HTDA1：HT_DMA_FIS状态。该状态是在链路层表示有一个 "FIS "时进入的。
正在接收FIS，传输层已确定正在接收DMA激活FIS。
当处于这种状态时，传输层应确定被激活的DMA传输的方向。

##### 高速 SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
过渡HTDA1:1：传输层应向HTDA2进行过渡，HT_DMAOTrans1状态。
HT_DMAOTrans1状态。如果没有检测到错误，则会发生这种转换。
过渡HTDA1:2：当检测到错误时，将状态传递给链路层，并将状态传递给传输层。
应用层。
 传输层应向HTI1：HT_HostIdle状态进行过渡。
过渡HTDA1:3：当传输层收到链路层的非法状态转换通知时，传输层应向HTI1：HT_HostIdle状态进行过渡。
#### HTDA2：HT_DMAOTrans1状态。该状态是在判断出 
正在激活的DMA传输是主机到设备的传输。
当处于这种状态时，传输层应确定DMA控制器是否已经初始化。
过渡HTDA2:1：当DMA控制器尚未初始化时，传输层应过渡到HTDA2：HT_DMAOTrans1状态。
过渡HTDA2:2。當 DMA 控制器已被初始化時，傳輸層應轉換至 HTDA3: HT_DMAOTrans2 狀態。
过渡HTDA2:3。當主機寫入設備控制暫存器使SRST位斷言，或要求DEVICE RESET指令時，傳輸層應通知Link層發出SYNC Escape，傳輸層應轉換至HTI1:HT_HostIdle狀態。
#### HTDA3：HT_DMAOTrans2状态。该状态是在DMA控制器被初始化后进入的，当处于该状态时，传输层应向HTI1:HT_HostIdle状态过渡。
当处于该状态时，传输层应激活DMA控制器，并将数据传递给Link层。
过渡HTDA3:1：当传输未完成，且传输的有效载荷数据少于2048个Dword时，传输层应过渡到HTDA3：HT_DMAOTrans2状态。
轉換HTDA3:2：當傳輸未完成，但已傳輸2048 Dwords的有效負載資料時，通知Link層關閉目前的訊框，Transport層停用DMA引擎，並轉換至HTDA4: HT_DMAEnd狀態。
过渡HTDA3：3。当链路层通知收到DMA Abort基元时，传输层应过渡到HTDA4: HT_DMAEnd状态。
过渡HTDA3:4。当请求的 DMA 传输完成后，传输层应转入 HTDA4: HT_DMAEnd 状态。
过渡HTDA3:5：当传输层收到传输层的通知时，应过渡到HTDA4：HT_DMAEnd状态。當傳輸層收到 Link 層通知有非法狀態轉換時，傳輸層應轉換至 HTI1: HT_HostIdle 狀態。
过渡HTDA3:6。当主机通过向设备控制寄存器写入SRST位，或请求DEVICE RESET命令时，传输层应通知Link层发送SYNC Escape，传输层应过渡到HTI1：HT_HostIdle状态。
#### HTDA4：HT_DMAEnd状态。当DMA数据传输完成后，进入该状态。
 
处于该状态时，传输层应确保DMA控制器的活动已经完成。
过渡HTDA4:1：当DMA控制器完成活动后，无论其传输次数是否用尽，还是因达到2048个Dword数据有效载荷限制而被停用，传输层都应过渡到HTI1：HT_HostIdle状态。如果没有检测到错误，则会发生这种过渡。
注意：主机不应假定接收到的数据是有效的（即使有一个有效的CRC收据的
FIS），直到设备返回命令完成状态。
过渡 HTDA4:2：当检测到错误时，应将状态报告给链路和FIS。
应用层。传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTDA4:3。当链路层通知收到DMA Abort基元时，应截断传输，并通知链路层附加CRC并结束该帧。
当确定传输无误完成时，传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTDA4:4：当收到链路层通知收到DMA Abort基元时，应截断传输，并通知链路层追加CRC并结束帧，当确定传输无误时，应过渡到HTI1:HT_HostIdle状态。
当确定传输完成错误时，传输层应向应用层报告状态，并向HTI1:HT_HostIdle状态过渡。
#### HTDA5：HT_DMAITrans状态。当传输层确定被激活的DMA传输是从设备到主机时，就会进入该状态。
当处于该状态时，如果DMA控制器被初始化，传输层应激活DMA控制器。从设备接收到一个数据帧，应将接收到的数据D字放入数据FIFO中。
当处于此状态时，传输层应等到链路层开始接收到
DMA数据帧和数据可供主机读取。
过渡HTDA5：1。当传输未完成时，传输层应过渡到HTDA5：HT_DMAITrans状态。这包括主机DMA引擎尚未编程的情况，因此传输被保留，直到DMA引擎准备将接收到的数据传输到目的存储器位置。

过渡HTDA5:2：当主机写入设备控制寄存器的SRST位被断言，或已向ATAPI设备写入设备复位命令时，应通知链路层发送SYNCP，传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTDA5:3。当请求的DMA传输完成后，传输层应转入HTDA4:HT_DMAEnd状态。
過渡 HTDA5:4: 當傳輸層收到 Link 層通知有非法狀態轉換時，傳輸層應轉換至 HTI1: HT_HostIdle 狀態。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
#### 10.4.9 主机传输分解PIO设置FIS状态图 
该协议接收一个请求传输PIO数据的PIO设置FIS。如果方向是从主机到设备，则传输层向包含PIO数据的设备传输一个数据FIS。如果传输方向是从设备到主机，则传输层接收到来自设备的数据FIS。PIO数据应在一个Data FIS中发送。
HTPS1：HT_PS_FIS 确定请求的PIO传输方向。
1. 传输主机到设备，没有发现错误。D位清零。
  HT_PIOOTrans1 2.将设备传输到主机，未检测到错误，D位清零。傳送裝置至主機，未偵測到錯誤，D 位清零。D 位被清零，HT_HostIdle 3.
  HT_HostIdle 3. 检测到错误，HT_HostIdle 3.  HT_HostIdle 4. HT_HostIdle 4.收到 Link 层的非法转换错误通知。
HTPS2: HT_PIOOTrans1 将从FIS接收到的初始寄存器内容放入影子寄存器中。
1. 无条件 HT_ HostIdle 
HTPS3.HT_PIOOTrans2 等待Link层表示数据传输完成 1: HT_PIOOTrans2 等待 Link 层表示数据传输完成 1. 傳輸未完成 HT_PIOOTrans2 2. 傳輸完成 HT_PIOEnd 3. 傳輸完成 HT_PIOEnd 3. 傳輸失敗 HT_PIOEnd 4. 收到 Link 層的非法轉換錯誤通知 HT_HostIdle 5. SRST 斷言，或要求 DEVICE RESET 指令 HT_HostIdle 5.
HTPS4: HT_PIOEnd 将 PIO REQ FIS 的结束寄存器内容放入影子寄存器中。
1. HTPS4: HT_PIOEnd 将 PIO REQ FIS 的结束寄存器内容放入影子寄存器中.  HT_HostIdle 2. 检测到错误 HT_HostIdle 2. 
HTPS5: HT_PIOITrans1 等待数据帧中收到初始PIO数据。
1. 接收到的 PIO 数据可用。 HT_PIOITrans2^1 2. SRST asserted 或 DEVICE RESET 指令 HT_HostIdle 3. HT_HostIdle 3. 收到 Link 層的非法轉換錯誤通知 HT_HostIdle 4.
注意：1.当过渡到HT_PIOITrans2状态时，应将PIO设置FIS的起始状态和中断位值转移到影子状态寄存器中，然后中断信号应反映中断位的值。
 
HTPS6：HT_PIOITrans2 等待Link层表示数据传输完成。
1. 傳輸未完成 HT_PIOITrans2 2. 傳輸完成 HT_PIOEnd 3. 傳輸完成 HT_PIOEnd 3. 從 Link 層收到中止通知 HT_PIOEnd 4. 收到 Link 層的非法轉換錯誤通知 HT_HostIdle 5. SRST 斷言，或要求 DEVICE RESET 指令 HT_HostIdle 5.
#### HTPS1：HT_PS_FIS状态。该状态是在Link层表示有一个叫 "FIS "的东西时进入的。
正在接收FIS，并且传输层已经确定正在接收一个PIO Setup FIS。
当处于这种状态时，传输层应确定请求的PIO传输方向，并说明最后发送的FIS是一个PIO Setup。
过渡HTPS1:1：当请求的传输方向是从主机到设备时（D位清零），传输层应向HTPS2：HT_PIOOTrans1状态进行过渡。
如果没有检测到错误，则会发生这种过渡。
过渡HTPS1:2：当请求传输的方向是从设备到主机（D位清零）时，传输层应向HTI1:HT_HostIdle状态进行过渡。如果没有检测到错误，则会发生这种过渡。
过渡HTPS1:3：当检测到错误时，应向链路层报告状态。偵測到錯誤時，應向 Link 層報告狀態。
传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTPS1:4。当传输层收到链路层的非法状态转换通知时，传输层应向HTI1:HT_HostIdle状态进行转换。
#### HTPS2：HT_PIOOTrans1状态。该状态是在请求方向为 
PIO的数据传输是从主机到设备。
当处于该状态时，传输层应将FIS初始寄存器内容放入影子寄存器中，FIS字节数，如果FIS指示这样做，则设置中断等待标志。
过渡HTPS2:1：当FIS初始寄存器内容已放入影子寄存器中，如有请求则设置中断挂起，传输层准备开始传输请求的PIO数据FIS时，传输层应向HTI1:HT_HostIdle状态进行过渡。
#### HTPS3．HT_PIOOTrans2状态。该状态是当PIO数据在 
PIO FIFO要传递给Link层。
当处于这种状态时。
 传输层应等待链路层指示所有数据已经传输完毕。
注意由于软件驱动程序或BIOS看到DRQ位设为1，BSY位清为0，所以继续写数据寄存器填充PIO FIFO。
过渡HTPS3:1：当传输未完成时，传输层应过渡到?
HTPS3.HT_PIOOTrans2状态。HT_PIOOTrans2状态。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### ATA国际组织 
过渡HTPS3:2：当达到该DRQ数据块的字节数时，传输层应过渡到HTPS4：HT_PIOEnd状态。
过渡HTPS3:3。當連線層通知收到 DMA Abort 基元時，傳輸層應轉換至 HTPS4: HT_PIOEnd 狀態。
过渡HTPS3:4。當傳輸層收到 Link 層通知有非法狀態轉換時，傳輸層應轉換至 HTI1:HT_HostIdle 狀態。
过渡HTPS3:5。当主机通过向设备控制寄存器写入SRST位，或请求DEVICE RESET命令时，传输层应通知Link层发送SYNC Escape，传输层应过渡到HTI1:HT_HostIdle状态。
#### HTPS4：HT_PIOEnd状态。当PIO数据传输完成后，进入该状态。

当处于该状态时，传输层应将接收到的结束寄存器内容从
PIO请求FIS放入影子寄存器中。
过渡HTPS4:1：当PIO请求FIS的结束寄存器内容已经放入影子寄存器中，且没有检测到传输错误时，传输层应过渡到HTI1：HT_HostIdle状态。
注意：主机不应假定接收到的数据是有效的（即使有一个有效的CRC收据的
FIS），直到设备返回命令完成状态。
过渡HTPS4:2：当前一个PIO设置FIS的结束寄存器内容已经放入影子寄存器中时，传输层应过渡至
HTI1:HT_HostIdle状态。对于传输中的数据，传输层应将传输过程中遇到的错误通知链路层，错误应反映在帧结束握手中。如果该传输不是PIO数据在命令的最终传输，设备应通过向主机传送适当的寄存器FIS来反映错误状态。如果该传输是命令中相关PIO数据的最终传输，则错误状态无法检测。
对于数据出传输，设备检测到的错误应反映在帧结束握手中。设备应通过向主机传送适当的寄存器FIS来反映错误状态。
#### HTPS5：HT_PIOITrans1状态。当PIO数据传输方向为设备到主机时，进入该状态。
当处于该状态时，传输层应等待Link层开始接收PIO数据帧，数据可供主机读取。
过渡HTPS5：1。当影子数据寄存器中的数据可供主机读取时,则
传输层应将PIO Setup帧中接收到的初始寄存器内容放入影子寄存器中，并过渡到HTPS6：HT_PIOITrans2状态。
过渡HTPS5:2：当主机通过向设备控制寄存器写入SRST位，或请求DEVICE RESET命令时，传输层应通知链路层发送SYNC Escape，传输层应过渡到HTI1：HT_HostIdle状态。
过渡HTPS5：3。当传输层收到链路层的非法状态转换通知时，传输层应过渡到HTI1:HT_HostIdle状态。

#### HTPS6：HT_PIOITrans2状态。当PIO中的PIO数据可用时，进入该状态。
FIFO要被主机读取，并且初始影子寄存器内容已经设置。
当处于这种状态时，传输层应等待链路层指示数据传输完成了
过渡HTPS6:1：当传输未完成时，传输层应过渡到。
HTPS6：HT_PIOITrans2状态。
过渡HTPS6:2：当达到该DRQ数据块的字节数时，传输层应过渡到HTPS4：HT_PIOEnd状态。
过渡HTPS6:3。當連線層通知收到 DMA Abort 基元時，傳輸層應轉換至 HTPS4: HT_PIOEnd 狀態。
过渡HTPS6:4：当传输层收到链路层通知有非法状态转换时，传输层应向HTI1:HT_HostIdle状态进行过渡。
过渡HTPS6:5。当主机通过向设备控制寄存器写入SRST位，或请求DEVICE RESET命令时，传输层应通知链路层发送SYNC Escape，传输层应过渡到HTI1：HT_HostIdle状态。
 传输层应
#### 10.4.10 主机传输分解DMA设置FIS状态图 
该协议接收一个FIS，设置主机适配器DMA控制器，允许根据第一方DMA协议传输后续的数据FIS。对于不使用自动激活的第一方 DMA 写入请求，设备会发出一个单独的 DMA 激活 FIS 来触发主机数据传输的开始。
HTDS1: HT_DS_FIS 用 DMA Setup FIS 的内容初始化第一方 DMA 传输的 DMA 控制器。
1. 检测不到错误，且(DMA Setup FIS中的D位设置为1)或(Dbit清零且DMA Setup FIS中的Auto-Activate位清零)。
  HT_HostIdle 2. HT_HostIdle 2.  HT_HostIdle 3. HT_HostIdle 3.收到Link层的非法转换错误通知 HT_HostIdle 4. HT_HostIdle 4.未偵測到錯誤，且(在DMA Setup FIS中，D bit清零，Auto- Activate bit設定為1)。
  HT_DMAOTrans2
#### HTDS1：HT_DS_FIS状态。该状态是在链路层表示有一个 "FIS "时进入的。
正在接收FIS，且传输层已确定该FIS为DMA设置类型。
当处于这种状态时，传输层应将DMA控制器的内容从
FIS.
过渡HTDS1:1：当DMA控制器已经初始化，且请求为读（方向设置为1）或请求为写（方向清零），且DMA Setup FIS中Auto-Activate为零时，传输层应过渡到HTI1：HT_HostIdle状态。
如果没有检测到错误，则会进行这种转换。

##### 高速序列化在附件上的应用 
#### ATA国际组织 
过渡HTDS1:2：当检测到错误时，应向链路层报告状态。该
传输层应过渡到HTI1:HI_HostIdle状态。
过渡HTDS1:3：当传输层收到链路层的非法状态转换通知时，传输层应向HTI1:HT_HostIdle状态进行过渡。
过渡HTDS1:4。當 DMA 控制器已被初始化，且請求為寫入(方向清零)，且 DMA Setup FIS 中 Auto-Activate 為 1 時，傳輸層應轉換至 HT_DMAOTrans2 狀態。如果没有检测到错误，则进行此过渡。
#### 10.4.11 主机传输层分解BIST激活FIS状态图。
该协议接收到一个BIST激活FIS，指示主机进入几个Bindustrial
自检模式，使主机重传其接收的数据。如果支持该模式，主机的应用层将传输层、链路层和/或物理层的发送和接收部分置于适当的状态，以执行环回操作。
HTRBIST1: HT_RcvBIST 确定所请求的环回模式的有效性。
1. 状态检查，未检测到错误，环回模式有效 HT_BISTTrans1 2. 状态已检查，未检测到错误，环回模式无效或不支持。
  HT_HostIdle 3. 状态检查，检测到错误 HT_HostIdle 4. HT_HostIdle 4.收到 Link 层的非法转换错误通知 HT_HostIdle 5.状态检查，未发现错误，回环模式无效或不支持。
##### HTRBIST2.HT_BISTTrans1: 
HT_BISTTrans1
通知应用层所需的 BIST 模式 1. 无条件 HT_HostIdle 
#### HTRBIST1：HT_RcvBIST状态 。当链路层表示正在接收FIS，传输层确定正在接收BIST激活FIS时，进入该状态。
当处于该状态时，传输层应确定环回请求的有效性。
过渡HTRBIST1:1：如果没有检测到接收错误，且FIS内容指示了主机支持的环回请求形式，则传输层应进行过渡。
HTRBIST2：HT_BISTTrans1状态。
Transition HTRBIST1:2：如果没有检测到接收错误，并且FIS内容显示了主机不支持的环回请求形式，则传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTRBIST1:3：如果显示接收错误，传输层应过渡到HTI1:HT_HostIdle状态。
过渡HTRBIST1:4。当传输层收到链路层的非法状态转换通知时，传输层应向HTI1:HT_HostIdle状态进行过渡。
#### HTRBIST2：HT_BISTTrans1状态。当传输层确定收到有效的BIST Activate FIS时，进入该状态。

在收到有效的FIS后，传输层通知应用层应将传输层、链路层和物理层置于适当的模式下，将收到的数据循环回发射机。本规范没有定义执行此操作的方法。
过渡HTRBIST2:1：当应用层得到通知后，传输层应过渡到HTI1:HostIdle状态。
### 10.5 设备传输状态 

#### 10.5.1 设备传输空闲状态图 
DTI0: DT_DeviceIdle 设备等待 FIS 或 FIS 请求。
1. 传输寄存器-设备到主机的FIS，由应用层请求 DT_RegDHFIS 2.传输设置设备位的FIS，由应用层请求。
##### DT_DB_FIS 3、传输应用层请求的PIO设置FIS。
##### DT_PIOSTUPFIS 4.传输应用层请求的DMA激活FIS。
##### DT_DMAACTFIS 5、传输应用层请求的DMA设置FIS。
##### DT_DMASTUPDHFIS 6.应用层请求的数据FIS的传输。
##### DT_DATAIFIS 7.传输应用层请求的BIST激活FIS DT_XmitBIST 8. 链路层表示接收到帧 DT_ChkTtype 
DTI1: DT_ChkTyp 收到 FIS 类型检查。
1. 寄存器--主机到设备FIS类型检测到DT_RegHDFIS 2.数据FIS类型检测到DT_DATAOFIS 3.DMA设置FIS类型检测到DT_DMASTUPHDFIS 4.BIST激活FIS类型检测到DT_RcvBIST 5. 从链路层收到的非法过渡错误通知或未识别的FIS类型 DT_DeviceIdle 5.
#### DTI0：DT_DeviceIdle状态。当传输层完成一个帧信息结构(FIS)事务时，进入该状态。
处于该状态时，传输层等待应用层指示要传输FIS或链路层指示要接收FIS。
过渡DTI0:1：当应用层指示要传输寄存器-设备到主机FIS时，传输层应过渡到DTR0：DT_RegDHFIS状态。
过渡DTI0:2：当应用层指示要传输一个设置设备位的FIS时，传输层应过渡到DTDB0:DT_DB_FIS状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
过渡DTI0：3。当应用层表示要传输PIO设置FIS时，传输层应过渡到DTPIOSTUP0: DT_PIOSTUPFIS状态。
过渡DTI0:4：当应用层指示要传输DMA Activate FIS时，传输层应过渡到DTDMAACT0：DT_DMAACTFIS状态。
过渡DTI0：5。当应用层表示要传输DMA设置FIS时，传输层应过渡到DTDMASTUP0：DT_DMASTUPDHFIS状态。
DT_DMASTUPDHFIS状态。
过渡DTI0：6。当应用层表示要传输数据FIS时，传输层应向DTDMASTUP0: DT_DMASTUPDHFIS状态过渡。
传输层应向 DTDATAI0：DT_DATAIFIS 状态进行过渡。
过渡DTI0:7 。当应用层指示要传输BIST激活FIS时，传输层应向DTXBIST1:DT XmitBIST状态进行过渡。
过渡DTI0:8。当链路层表示正在接收FIS时，传输层应过渡到DTI1：DT_ChkTyp状态。
#### DTI1：DT_ChkTyp状态。当传输层处于空闲状态，且链路层表示正在接收FIS时，进入该状态。
处于该状态时，传输层检查接收到的FIS的FIS类型。
过渡DTI1:1：当接收到的FIS是寄存器--主机到设备的FIS类型时，会在
传输层应向DTCMD0：DT_RegHDFIS状态进行过渡。
过渡DTI1:2：当传入的FIS是数据-主机到设备FIS类型时，传输层应过渡到DTDATAO0：DT_DATAOFIS状态。
过渡DTI1:3：当传入的FIS为DMA设置FIS类型时，传输层应向DTSTP0：DT_ DMASTUPHDFIS状态进行过渡。
过渡DTI1:4。当传入的FIS为BIST激活FIS类型时，传输层应过渡到DTRBIST1:DT_RcvBIST状态。
过渡DTI1:5。当传输层收到链路层的非法状态转换通知或FIS类型未被识别时，传输层应向以下状态过渡
DTI0：DT_DeviceIdle状态。
#### 10.5.2 Device Transport发送Register - Device to Host状态图......................。

该协议构建一个包含寄存器内容的Register - Device to Host FIS，并在应用层请求传输时将其发送给主机。
DTR0：DT_RegDHFIS 根据寄存器的内容构建Register - Device to Host FIS，并通知Link进行传输。
1. FIS传输完成 DT_RegTransStatus 2. 收到Link层的非法过渡错误通知 DT_DeviceIdle 3. 
DTR1: DT_RegTransStatus 检查 Link 和 Phy 的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查，没有发现错误。 DT_DeviceIdle 2. 状态检查，检测到错误。 DT_RegDHFIS 
#### DTR0: DT_RegDHFIS 状态。进入该状态时，应用程序请求传输寄存器-设备到主机FIS。
当处于此状态时。
 传输层应构造一个寄存器--设备到主机的FIS，并将此信息告知
链路层表示要传输FIS，并将FIS传递给链路层。
过渡DTR0:1：当整个FIS传到链路层后，传输层应向链路层表示FIS传输完成，并向
DTR1：DT_RegTransStatus状态。
过渡DTR0:2：当传输层收到链路层的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。
#### DTR1：DT_RegTransStatus状态。该状态是指整个FIS已经传递给链路层的时候。
当处于该状态时，传输层应等待Link层和Phy层结束状态，为
FIS，必要时采取相应的错误处理动作。
过渡DTR1:1：当FIS状态已处理完毕，且未检测到错误时，传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTR1:2：当FIS状态已被处理，且检测到错误时，传输层应过渡到DTI0：DT_DeviceIdle状态。
传输层应将状态报告给链路层，并通过过渡到本次传输重试。
DT_RegDHFISstate。
#### 10.5.3 Device Transport发送Set Device Bits FIS状态图................................。

当应用层请求传输时，该协议向主机适配器发送Set Device Bits FIS。
DTDB0：DT_DB_FIS 通知链路传输 Set Device Bits FIS 1.FIS 传输完成 DT_SDBTransSt atus 2. 收到 Link 层的非法转换错误通知 DT_DeviceIdle 3.
##### DTDB1: 
DT_SDBTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查且未检测到错误 DT_DeviceIdle 2. 状态检查，检测到错误。 DT_DB_FIS  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 **DTDB0:DT_DB_FIS状态:**当应用层请求传输Set Device Bits FIS时进入该状态。

当处于该状态时，传输层应构造一个Set Device Bits FIS，通知链路层要传输FIS，并将FIS传递给链路层。
**过渡DTDB0:1:**当整个FIS传给链路层后，传输层应向链路层表示FIS传输完成，并向其进行过渡。
DTDB1:DT_SDBTransStatus状态。

过渡DTDB0:2：当传输层收到链路层的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。
**DTDB1:DT_SDBTransStatus状态** 。当整个FIS已经传递给链路层时，就会进入该状态。

当处于此状态时，传输层应等待Link层和Phy层结束状态，为
FIS，并在必要时采取相应的错误处理措施。
过渡期 DTDB1:1：当 FIS 状态已处理完毕，且未检测到错误时，该
传输层应过渡到DTI0:DT_DeviceIdle状态。
**过渡DTDB1:2:**当FIS状态已被处理并检测到错误时，则
传输层应将状态报告给链路层，并通过过渡到本次传输的
DTDB0:DT_DB_FIS状态。

#### 10.5.4 设备传输传输PIO设置--设备到主机FIS状态图.........。

该协议向主机传输一个PIO Setup - Device to Host FIS。在这个PIO Setup帧之后，应根据PIO Setup帧中D位的状态，传输或接收一个包含PIO数据的数据帧。
DTPIOSTUP0．
DTPIOSTUP0：DT_PIOSTUPFIS
根据应用层提供的内容，构造PIO设置--设备到主机FIS，并通知Link进行传输。此
FIS应包括开始和结束寄存器内容、字节数和中断标志。
1. FIS传输完成 DT_PIOSTUPTransSt atus 2. 收到链路层的非法过渡错误通知 DT_DeviceIdle 3.
##### DTPIOSTUP1: 
DT_PIOSTUPTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查，未发现错误。 DT_Device Idle 2. 状态检查，检测到错误。 DT_PIOSTUPFIS 
#### DTPIOSTUP0：DT_PIOSTUPFIS状态。该状态是在应用层请求传输PIO设置-设备到主机FIS时进入。
当处于该状态时，传输层应构造一个PIO Setup - Device to Host FIS，通知链路层要传输FIS，并将FIS传递给链路层。

过渡DTPIOSTUP0:1：当整个FIS已经传递给链路层时，则
传输层应向链路层指示FIS传输完成，并向DTPIOSTUP1：DT_PIOSTUPTransStatus状态进行过渡。
过渡DTPIOSTUP0:2：当传输层收到链路层的通知进行非法状态转换时。
 传输层应向DTI0：DT_DeviceIdle状态进行过渡。
#### DTPIOSTUP1：DT_PIOSTUPTransStatus状态。该状态是在整个 
FIS已传递给Link层。
当处于此状态时，传输层应等待FIS的Link和Phy结束状态，并在必要时采取相应的错误处理动作。
过渡DTPIOSTUP1:1：当FIS状态已处理完毕，且未检测到错误时，则?
传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTPIOSTUP1 : 2 : 当FIS状态已被处理，并检测到错误时，该
传输层应将状态报告给链路层，并通过过渡到本次传输的
DT_PIOSTUPFIS状态。
#### 10.5.5 设备传输传输DMA激活FIS状态图。
该协议将DMA激活FIS传送给主机适配器。在DMA激活FIS之后，主机将向设备发送一个数据FIS。
DTDMAACT0.DT_DMAACTFIS
DTDMAACT0： DT_DMAACTFIS
构建DMA 从提供的内容中激活FIS。
应用层并通知Link转移。
1. FIS传输完成 DT_DMAACTTransSt atus 2. 收到 Link 层的非法过渡错误通知 DT_DeviceIdle 3.
##### DTDMAACT1: 
DTDMAACT1：DT_DMAACTTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查，没有发现错误。 DT_DeviceIdle 2. 状态检查，检测到错误。 DT_DMAACTFIS 
#### DTDMAACT0：DT_DMAACTFIS状态。当应用层请求传输DMA Activate FIS时，进入该状态。
当处于该状态时，传输层应构造一个DMA Activate FIS，通知链路层要传输FIS，并将FIS传递给链路层。
过渡DTDMAACT0:1：当整个FIS已经传递给链路层时，则
传输层应向链路层指示FIS传输完成，并向DTDMAACT1: DT_DMAACTTransStatus状态。
过渡DTDMAACT0:2：当传输层收到链路层发出的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。

##### HIGH SPEED SERIALIZED ATTACHMENT 
#### ATA国际组织 
#### DTDMAACT1: DT_DMAACTTransStatus状态。此状态进入是当整个 
FIS已传递给Link层。
当处于这种状态时，传输层应等待FIS的Link和Phy结束状态，并在必要时采取适当的错误处理动作。
过渡DTDMAACT1:1：当FIS状态已经处理完毕，且没有检测到错误时，则
传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTDMAACT1 : 2 : 当FIS状态已被处理，并检测到错误，则
传输层应将状态报告给链路层，并通过过渡到本次传输的
DT_DMAACTFIS状态。
#### 10.5.6 设备传输传输DMA设置--设备到主机FIS状态图。
该协议向主机适配卡传输一个DMA设置--设备到主机FIS。该FIS是设备对主机适配卡的请求，要求主机适配卡对DMA控制器进行编程，以便进行第一方DMA传输，并在后面跟着一个或多个数据FIS，根据传输方向将数据传输到主机适配卡或从主机适配卡传输。DMA Setup - Device to Host（设备到主机）请求包括传输方向指示器、主机缓冲区标识符、主机缓冲区偏移、字节数和中断标志。
DTDMASTUP0:
DT_DMASTUPDHFIS
根据应用层提供的内容构建DMA设置--设备到主机FIS，并通知Link进行传输。
1. FIS传输完成 DT_DMASTUPTrans状态 2. 收到 Link 层的非法传输错误通知 DT_DeviceIdle 3.
##### DTDMASTUP1: 
DT_DMASTUPTransStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查，未发现错误。 DT_DeviceIdle 2. 状态检查，检测到错误。 DT_DMASTUPDHFIS 
#### DTDMASTUP0：DT_DMASTUPDHFIS状态。当应用层请求传输DMA设置-设备到主机FIS时，进入该状态。
当处于该状态时，传输层应构造一个DMA Setup - Device to Host FIS，通知链路层要传输FIS，并将FIS传递给链路层。
过渡DTDMASTUP0:1：当整个FIS已经传递给链路层时，则
传输层应向链路层指示FIS传输完成，并向DTDMASTUP1：DT_DMASTUPTransStatus状态进行过渡。
过渡DTIDMASTUP0：2：当传输层收到链路层发出的非法状态转换通知时，传输层应向DTI0:
DT_DeviceIdle状态。
#### DTDMASTUP1：DT_DMASTUPTransStatus状态。当整个FIS已经传递给链路层时，进入该状态。

当处于该状态时，传输层应等待FIS的Link和Phy结束状态，并在需要时采取相应的错误处理动作。

过渡DTDMASTUP1:1：当FIS状态已处理完毕，且未检测到错误时，则
传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTDMASTUP1:2：当FIS状态已经处理完毕，并检测到错误，则
传输层应将状态报告给链路层，并通过过渡到本次传输的
DT_DMASTUPDHFIS状态。
#### 10.5.7 设备传输传输数据-设备到主机FIS图...........................。

该协议构建了一个数据-设备到主机FIS。
DTDATAI0：DT_DATAIFIS 根据应用层提供的内容构建Data - Device to Host FIS内容，并通知Link进行传输。
1. 无条件 DT_DATAITrans。
##### DTDATAI1: 
DTDATAI1：DT_DATAITrans
将数据FIFO中的数据Dword传递给Link层 1. 传递未完成 DT_DATAITrans 2. 传输完成 DT_DATAIEnd 3. 应用层请求终止传输中的 DMA。
  DT_DATAIEnd 4.应用层请求终止传输中的DMA。收到Link层发出的非法传输错误通知 DT_DeviceIdle 5.
DTDATAI2: DT_DATAIEnd 检查 Link 和 Phy 的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查，没有发现错误。 DT_DeviceIdle 2. 状态检查，检测到错误。 DT_DeviceIdle 3. 应用层请求终止传输中的DMA，未检测到错误。
  DT_DeviceIdle 4.应用层在传输中请求终止DMA，未检测到错误。应用层请求终止传输中的DMA，检测到错误。
  DT_DeviceIdle 5.应用层请求终止传输中的DMA，检测到错误。收到链路层的非法转换错误通知 DT_DeviceIdle 5.
#### DTDATAI0：DT_DATAFIS状态。当应用层请求传输数据-设备到主机FIS时，进入此状态。
当处于该状态时，传输层应将部分DMA数据传递给链路层。
过渡 DTDATAI0:1：当准备就绪且FIFO中有数据要传给Link层时，传输层应过渡到DTDATAI1：DT_DATAITrans状态。
#### DTDATAI1：DT_DATAITrans状态。该状态是当数据在 
FIFO要传递给Link层。
当处于该状态时，传输层应从FIFO中向Link层传递一个Dword的数据。
过渡DTDATAI1:1：当传输未完成时，传输层应过渡到DTDATAI1：DT_DATAITrans状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
过渡DTDATAI1:2：当传输完成后，传输层应过渡到DTDATAI2：DT_DATAIEnd状态。
过渡DTDATAI1:3：当应用层请求中止DMA操作时，传输层应过渡到DTDATAI2:DT_DATAIEnd状态。
过渡DTDATAI1:4。当传输层收到链路层的非法状态转换通知时，传输层应过渡到DTI0：DT_DeviceIdle状态。
#### DTDATAI2：DT_DATAIEnd状态。当数据传输完成或应用层请求中止时，进入该状态。
处于该状态时，传输层应等待FIS的Link层和Phy层结束状态，必要时采取相应的错误处理动作。
过渡DTDATAI2:1：当FIS状态已经处理完毕，且没有检测到错误时，则
传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTDATAI2：2。当FIS状态已被处理并检测到错误时，应向链路层报告状态，传输层应过渡到DTI0：DT_DeviceIdle状态。传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTDATAI2：3。当应用层请求终止交易中的DMA数据时，向链路层报告中止状态，等待EOFP，若未检测到错误，则过渡到DTI0：DT_DeviceIdle状态。
过渡DTDATAI2:4。当应用层请求终止交易中的DMA数据时，向链路层报告中止条件，等待EOFP，如果检测到错误，向链路层报告错误，并应过渡到DTI0:DT_DeviceIdle状态。
过渡DTDATAI2:5。当传输层收到链路层的非法状态转换通知时，传输层应过渡到DTI0：DT_DeviceIdle状态。
#### 10.5.8 设备传输传输BIST 激活FIS示意图 
该协议建立了一个BIST激活FIS，告诉主机准备进入相应的?
内置自检模式。传输成功后，设备传输层进入空闲状态。应用层在检测到向主机传输成功后，应使设备的传输层、链路层和物理层进入相应的模式，进行FIS定义的内置测试数据的传输。
 传输层、链路层和物理层进入自测试模式的方式，本规范没有定义。
DTXBIST1．DT_XmitBIST 根据本规范提供的内容构建 BIST 激活 FIS。
应用层，并通知Link进行转移。
1. FIS传输完成 DT_TransBISTStatus 2. 收到Link层的非法过渡错误通知 DT_DeviceIdle 3. 
##### DTXBIST2: 
DT_TransBISTStatus
检查Link和Phy的传输结果，如果发生错误，请采取适当的措施。
1. 状态检查完成 DT_DeviceIdle 2. 状态检查并至少检测到一个错误 DT_XmitBIST^1 1.
注：1.由于错误而重新发送BIST激活FIS不是必须的，但允许。
 
##### 高速 SERIALIZED ATTACHMENT(高速)。
#### ATA国际组织 
#### DTXBIST1: DTXBIST1: DT_XmitBIST 状态，进入该状态可向主机发送 BIST FIS。进入此状态，向主机发送BIST FIS。

过渡DTXBIST1:1：当整个FIS已经传递给链路层时，传输层应向链路层表示FIS传输完成，并向DTXBIST2:DT_TransBISTSTatus状态进行过渡。
过渡 DTXBIST1:2：当传输层收到链路层发出的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。
#### DTXBIST2：DT_TransBISTStatus状态。当整个FIS已经传递给链路层时，进入该状态。
过渡DTXBIST2:1：当FIS传输完成后，传输层应过渡到DTI0：DT_DeviceIdle状态。
过渡DTXBIST2:2：当FIS传输完成后，传输层应过渡到DTI0：DT_DeviceIdle状态。当FIS传输完成且至少检测到一个错误时，传输层可过渡到DTXBIST1: DTXBIST1:DT_XmitBIST状态。
#### 10.5.9 设备传输分解寄存器--主机到设备状态图 
该协议接收一个寄存器--主机到设备的FIS，将接收到的寄存器内容放入设备寄存器中，并通知应用层收到FIS。
DTCMD0: DT_RegHDFIS 接收一个寄存器 - 主机到设备 FIS 1.FIS 传输完成，没有发现错误。 DTCMD0: DT_DeviceIdle 2. FIS 传输完成，并检测到错误 DT_DeviceIdle 3. 从链路层收到非法转换错误通知 DT_DeviceIdle 5.
#### DTCMD0：DT_RegHDFIS状态。该状态是在收到以下信息时进入的 
DT_RegHDFISFIS被识别。
当处于此状态时，传输层应接收FIS，并在确定无误接收到FIS时，将FIS的内容放入设备寄存器中。
过渡DTCMD0:1：当从链路层无误地接收到整个FIS时，传输层应向应用层表明收到了一个命令FIS，并向DTI0：DT_DeviceIdle状态进行过渡。
过渡DTCMD0:2：当从链路层接收到整个FIS并检测到错误时，应向链路层发送状态。传输层应向DTI0:DT_DeviceIdle状态进行过渡。
过渡DTCMD0:3。当传输层收到链路层的非法状态转换通知时，传输层应过渡到DTI0：DT_DeviceIdle状态。

#### 10.5.10 设备传输分解数据（主机到设备）FIS状态图...........。

本协议接收数据-主机到设备FIS。
DTDATAO0:
DT_DATAOFIS
准备接收数据
无条件DT_DATAOREC
##### DTDATAO1: 
##### DT_DATAOREC 
将接收到的数据Dword放入数据FIFO，并发出Link信号继续传输。
1. 传输未完成 DT_DATAOREC 2. 传输完成 DT_DeviceIdle 3. 从应用层中止传输 DT_DeviceAbort 4. 收到来自Link层的非法传输错误通知 DT_DeviceIdle 5.
##### DTDATAO2: 
DTDATAO2: DT_DeviceAbort
信号链路，中止传输。
1. 传输未完成 DT_DATAOREC 2. 傳輸完成 DT_DeviceIdle 
#### DTDATAO0：DT_DATAOFIS状态。当链路层表示正在接收FIS，且传输层已确定该FIS属于
数据--主机到设备类型。
当处于此状态时，传输层应准备接收数据。
过渡DTDATAO0:1：当准备接收数据时，传输层应向DTDATAO1：DT_DATAOREC状态进行过渡。
#### DTDATAO1：DT_DATAOREC状态。当传输层准备接收数据时，进入该状态。
处于该状态时，传输层应等待链路层指示传输完成。
过渡DTDATAO1:1：当Link层还没有指示FIS结束时，传输层应过渡到DTDATAO1：DT_DATAOREC状态。
过渡DTDATAO1:2：当Link层表示已经到达FIS的终点时，传输层应过渡到DTI0：DT_DeviceIdle状态。

过渡DTDATAO1:3：当应用层表示要中止FIS时，会在
传输层应过渡到DTDATAO2: DT_DeviceAbort状态。
过渡DTDATAO1：4。当传输层收到链路层发出的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。
#### DTDATAO2：DT_DeviceIdle状态。DT_DeviceAbort状态。当应用层表示要中止当前传输时，进入该状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
当处于这种状态时，传输层应根据FIFO的当前状态，向链路层发出中止传入传输的信号，并返回到DT_DATAOREC或DT_DeviceIdle。如果中止发生的时间与链路层发出的传输结束指示同时发生，那么也要适应DTI0：DT_DeviceIdle的过渡。在发出 Abort 后，该
传输回到正常的数据传输，并等待Link层发出传输结束指示。
过渡DTDATAO2：1：通知Link层发出中止。当传输未完成时，传输层应过渡到DTDATAO1：DT_DATAOREC状态。
过渡DTDATAO2:2。通知链路层发出中止。当链路层指示FIS结束时，传输层应过渡到DTI0:
DT_DeviceIdle状态。
#### 10.5.11 Device Transport分解DMA Setup - Host to Device状态图......。

该协议接收DMA Setup - Host to Device FIS，将接收到的DMA Setup内容以及FIS接收通知传递给应用层。
DTSTP0．
DT_DMASTUPHDFIS
接收 DMA 设置 - 主机到设备的 FIS 1. FIS 传输完成，且未检测到错误。 DT_DeviceIdle 2.FIS 传输完成，检测到错误。FIS 传输完成，并检测到错误 DT_DeviceIdle 3. 从链路层收到非法转换错误通知 DT_DeviceIdle 3.
DTSTP0：DT_DMASTUPHDFIS状态。当收到DT_DMASTUPHDFIS状态时进入该状态。
FIS已被识别。
过渡DTSTP0:1：当从链路层接收到整个FIS而没有错误时，传输层应向应用层指示收到了DMA设置--主机到设备FIS，并向DTI0：DT_DeviceIdle状态进行过渡。
过渡DTSTP0:2：当从链路层接收到整个FIS并检测到错误时，应向链路层发送状态。传输层应向DTI0：DT_DeviceIdle状态进行过渡。
过渡DTSTP0：3。当传输层收到链路层发出的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行转换。

#### 10.5.12 设备传输分解BIST激活FIS状态图。
该协议接收一个FIS，指示设备进入几个内置自检模式中的一个，使设备重新传输它接收的数据。如果支持该模式，则
设备的应用层将传输层、链路层和/或物理层的发送和接收部分都置于适当的状态，以执行环回操作。
DTRBIST1: DTRBIST1: DT_RcvBIST 确定所请求的环回模式的有效性。
1. 状态已检查，未检测到错误，环回模式有效 DT_BISTTrans1 2. 状态已检查，未检测到错误，环回模式无效或不支持。
  DT_DeviceIdle 3.状态检查，未检测到错误，环回模式有效。状态检查，检测到错误 DT_DeviceIdle 4. 收到链路层的非法转换错误通知 DT_DeviceIdle 5.
##### DTRBIST2: 
DT_BISTTrans1
通知应用层所需的 BIST 模式 1. 无条件 DT_DeviceIdle 
#### DTRBIST1: DT_RcvBIST状态 。当链路层表示正在接收FIS，传输层确定正在接收BIST激活FIS时，进入该状态。
当处于该状态时，传输层应确定环回请求的有效性。
过渡DTRBIST1:1：如果没有检测到接收错误，且FIS内容指示了设备支持的环回请求形式，则传输层应过渡至
DTRBIST2：DT_BISTTrans1状态。
过渡DTRBIST1:2：如果没有检测到接收错误，并且FIS内容指示了设备不支持的环回请求形式，则传输层应过渡到DTI0:DT_DeviceIdle状态。
过渡 DTRBIST1:3：如果显示接收错误，传输层应过渡到 DTI0:DT_DeviceIdle 状态。
过渡DTRBIST1:4。当传输层接收到链路层发出的非法状态转换通知时，传输层应向DTI0：DT_DeviceIdle状态进行过渡。
#### DTRBIST2：DT_BISTTrans1状态。当传输层确定已经收到有效的BIST激活FIS时，进入该状态。
收到有效的FIS后。
 传输层通知应用层，它应该将传输层、链路层和物理层置于适当的模式中，以便将接收到的数据循环回发射机。本规范没有定义执行此操作的方法。
过渡DTRBIST2:1：当应用层得到通知后，传输层应过渡到DTI0:DT_DeviceIdle状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
## 11 设备命令层协议 .......................................................................................

在以下Device命令层协议中，如果主机在设备完成执行命令层协议之前发送COMRESET，那么设备应开始执行?
COMRESET协议从头开始执行。如果设备在完成执行命令层协议之前，收到一个寄存器--主机到设备的FIS，C位清零，SRST位设为1，那么设备应从头开始执行其软件复位协议。
SYNC Escape被主机或设备用来使链路恢复到已知状态，可用于厂商特定的错误或挂起状态的恢复。在执行SYNC Escape后，在向设备发出下一条命令之前，可能需要进行软件复位。
### 11.1 开机和COMRESET协议 
如果主机发出硬件复位（上电复位或COMRESET），无论电源管理模式或当前设备命令层状态如何，设备应执行硬件复位协议。硬件复位的断言与进入状态相关联。
DP1:DR_Reset在Phy状态机内。
DHR0.Hardware_reset_asserted
Hardware_reset_asserted
等一下
1. 硬件复位被否定。 DHR1: Execute_diagnostics(执行诊断程序) 
##### DHR1: 
Execute_diagnostics
初始化硬件并执行诊断程序。
1. 初始化和诊断程序成功完成。 DHR2:     Send_good_status 2. 初始化完成，诊断程序失败。 DHR3: Send_bad_status     Send_bad_status 
DHR2.Send_good_status 要求传送状态良好的寄存器FIS。Send_good_status 要求传输状态良好的寄存器FIS。
1. 傳送 Register FIS 的狀態。 DI0: Device_idle 
DHR3.Send_bad_status 要求传送状态不好的寄存器FIS。Send_bad_status 要求传送状态不良的寄存器 FIS。
1. 傳送 Register FIS。 DI0: Device_idle 
#### DHR0：Hardware_reset_asserted。当传输层表示硬件复位（开机复位或COMRESET）被断言时，进入该状态。
当处于该状态时，设备等待硬件复位的否定，这与退出Phy状态机内的状态DP1:DR_Reset有关。
过渡DHR0:1：当传输层表示硬件复位已被否定时，设备应过渡到DHR1：Execute_diagnostics状态。
#### DHR1：Execute_diagnostics。当传输层指示COMRESET信号已被否定时，进入该状态。

当处于该状态时，设备初始化设备硬件并执行其上电诊断。
过渡DHR1:1：当设备硬件已经初始化并成功完成上电诊断时，设备应过渡到DHR2: Send_good_status状态。
DHR1:2: 当设备硬件已被初始化且开机诊断失败时，设备应转换到DHR3.Send_bad_status状态。Send_bad_status状态。
#### DHR2: Send_good_status。当设备硬件已被初始化且上电诊断成功完成时，进入该状态。
当处于该状态时，设备请求传输层向主机传输寄存器FIS。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 00h
LBA(23:16) 00h
设备名称
错误01h
状态 00h-70h(见注)
注意 a状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误01h
状态 00h
过渡DHR2:1：当传输层表示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
#### DHR3: Send_bad_status。当设备硬件已经初始化，上电诊断失败时，进入该状态。
当处于该状态时，设备要求传输层向主机发送寄存器FIS。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 00h
LBA(23:16 00h)
设备名称
错误00h，02h-7Fh
状态 00h-70h(见注)
注意 a状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称

错误00h，02h-7Fh
状态00h **过渡DHR3:1:**当传输层表示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。
 
### 11.2 设备空闲协议 
下面的状态图描述了设备的空闲协议。当执行Native Command Queuing或ATA Tagged Command Queuing命令时，会使用前面带*的状态和转换。
DI0：Device_idle等待。
1. FIS接收 DI1: Check_FIS 2. * 准备完成发布的命令。 DI4: Set_service 3. * 准备好接收WRITE FPDMA QUEUED命令的数据，FIS接收没有表示，也没有遇到错误。
##### DFPDMAQ4: 
DataPhase_
PreWriteSetup 4. * 准备好READ FPDMA QUEUED命令的数据传输，FIS接收到的数据没有显示，没有遇到错误。
##### DFPDMAQ3: 
DataPhase_
ReadSetup 5. * 一个或多个FPDMA QUEUED或NCQ QUE管理命令成功完成，且未显示FIS接收，未遇到错误。
##### DFPDMAQ10。
SendStatus 1 6. * FPDMA QUEUED 或 NCQ QUE MANAGEMENT 命令终止，失败，未显示 FIS 接收。
##### DFPDMAQ11。
##### ERROR 7.异步通知已启用，发生了需要通知的事件，且NotifyPending=0，未显示FIS接收。
  AN0: Notify_host
##### 注：1.该条件可以与条件3或4同时为真。实施状态聚合的设备如果其条件评价为真，可选择过渡3、4或5中的任何一个。不实施状态聚合的设备应优先选择过渡5，而不是过渡3和4。

DI1：Check_FIS Check_FIS类型和C位。
1. 寄存器类型，C位清零，SRST设为1。

##### DSR0。
2.寄存器类型，C位清零，SRST清零。
  DI0：Device_idle^1 3、寄存器类型，C位清零，SRST清零。寄存器类型和C位清零，SRST清零。 DI2: Check_command 4. 接收到DMA设置FIS DI0 : Device_idle 5. 意料之外的 FIS 类型，DI0: Device_idle^1 3.  DI0: Device_idle
注意：1.设备到主机的寄存器FIS不应作为接收到的寄存器FIS的响应发送。
 
##### 高速序列化在附件中的应用 
#### ATA国际组织 
DI2: Check_command^1 检查命令以确定所需的命令协议。如果支持异步通知，那么NotifyPending被清零。
1. 非数据命令协议，且无本机排队命令待处理。
  DND0：非数据 2. PIO数据输入命令协议，且无本机排队命令未执行_._ DPIOI0: PIO_in 3. PIO数据输出命令协议，且无本机队列命令待处理。
  DPIOO0: PIO_out 4.READ DMA 命令协议，无本机队列待命。
  DDMAI0: DMA_in 5. WRITE DMA 命令协议，且无本机队列命令待处理。
  DDMAO0: DMA_out 6.PACKET 命令协议，无本机队列待命。

##### DPKT0: PACKET 7. * READ DMA QUEUED 命令协议，且无本机队列命令未执行。

##### DDMAQI0.DMA_queued_in 8: 
DDMAQI0: DMA_queued_in 8. * WRITE DMA QUEUED 命令协议，并且没有任何本机队列的命令。

##### DDMAQO0：DMA_queued_out 9: 
DMA_queued_out 9.执行DEVICE DIAGNOSTIC命令协议，且无本机队列命令未执行。

##### DEDD0。
Execute_device_diag 10. DEVICE RESET 命令协议。 DDR0：Device_reset 11. 命令未执行，无本机队列命令未执行。
  DI3: No_command 12. * 服务命令协议，且没有未执行的本地队列命令。
  DI5: Service_test 13. * READ FPDMA QUEUED 命令协议。 DFPDMAQ1: AddCommand_ ToQueue 14. * DFPDMAQ1: AddCommand_ ToQueue 14.  DFPDMAQ1: AddCommand_ ToQueue 15. * NCQUE管理命令协议。 DFPDMAQ1: AddCommand_ ToQueue 16. * DFPDMAQ1: AddCommand_ ToQueue 16. 
##### DFPDMAQ12。
BrokenHost_
ClearBusy
注意：1.该状态显示所有命令的过渡。如果一个设备没有实现任何特定的命令，那么不应该处理该转换。

DI3：No_command 请求传输寄存器FIS，ABRT位设为1。
1. FIS传输完成。 DI0: Device_idle * DI4: Set_service 请求传输设置设备位的FIS，SERV位设置为1。
1. 1. FIS 传输完成。 DI0: Device_idle * DI5: Service_test 测试命令，看是否需要寄存器FIS来设置DRQ位和设置Tag。
1. 1. PACKET PIO 数据输入或 PACKET PIO 数据输出。 DI7: Service_decode 2. 其他 DI6: Service_send_tag * DI6: Service_send_tag 要求在 BSYbit 清零的情况下传输 Register FIS。
DRQ 位设置为 1，相应的 Tag 1。FIS 传输完成 DI7: Service_decode * DI7: Service_decode 检查要服务的命令类型。
1. PACKET PIO 数据输入。
  DPKT4.PACKET_PIO_in 2.PACKET PIO数据输出。    PACKET_PIO_in 2.PACKET PIO data-out.DPKT6: PACKET_PIO_out 3.PACKET DMA data-in.  DPKT6: PACKET_PIO_out 3.PACKET DMA data-in.DPKT9: PACKET_DMA_in 4.PACKET DMA data-out.  DPKT9: PACKET_DMA_in 4.PACKET DMA data-out.  DPKT11: PACKET_DMA_out 5.READ DMA QUEUED.  DDMAQI1: Send_data 6. 写入 DMA QUEUED。 DDMAQO1: Send_DMA_activate 6. 
#### DI0：Device_Idle。当设备完成命令协议、COMRESET协议、软件复位协议的执行，或队列命令被释放时，进入该状态。
处于该状态时，设备正在等待命令。如果支持排队，则设备可能正在等待获取数据或建立缓冲空间，以完成排队的命令
过渡DI0:1：当设备收到来自传输层的FIS时，设备应过渡到DI1：Check_FIS状态。
* 过渡DI0:2：当设备准备好完成排队命令的数据传输时，设备应过渡到DI4：Set_service状态。
* 过渡DI0:3。当设备准备好接收WRITE FPDMA QUEUED命令的数据时，设备应过渡到DFPDMAQ4：DataPhasePreWriteSetup状态。此条件也适用于使用非零缓冲区偏移来完成之前部分数据传输的情况。
* 过渡DI0:4：当设备准备好为READ FPDMA QUEUED命令传输数据时，设备应过渡到DFPDMAQ3：DataPhaseReadSetup状态。此条件也适用于使用非零缓冲区偏移量来完成之前部分数据传输的情况。
* 过渡DI0:5.DFPDMAQ3：DataPhaseReadSetup状态。当设备成功完成FPDMA QUEUED或NCQ时。
QUE MANAGEMENT 命令，设备应过渡到 DFPDMAQ10: SendStatus状态。

##### 在附件处进行高速 SERIALIZED ATTACHMENT。
#### 串行ATA国际组织 *转换DI0:6。当设备在FPDMA QUEUED或NCQ中遇到错误时。
QUE MANAGEMENT 命令，设备应过渡到 DFPDMAQ11: ERROR 状态。
过渡DI0:7。如果启用了异步通知，并且发生了需要通知主机的事件，且NotifyPending变量被清零，且未指示FIS接收，则设备应过渡到AN0：Notify_host状态。
#### DI1：Check_FIS状态。當設備收到來自主機的FIS時，即進入此狀態。
传输层。
当处于此状态时，设备应检查FIS类型。
过渡DI1:1：如果FIS类型是寄存器FIS，则FIS中的C位被清零，并将FIS中的
FIS中的SRST位被设置为1，器件应过渡到DSR0。
软件复位状态。
过渡DI1:2：如果FIS类型是寄存器FIS，则FIS中的C位清零，并将FIS中的
FIS中的SRST位被清零，器件应过渡到DI0：Device_idle状态。
过渡DI1:3：如果FIS类型是寄存器FIS，且FIS中的C位被置1，则器件应过渡到DI2：Check_command状态。
过渡DI1:4。如果FIS类型为第一方DMA设置FIS，则设备应通知第一方DMA设置FIS。
传输层接收第一方DMA设置FIS，并过渡到DI0:
Device_idle状态。
过渡DI1：5。对于其他任何FIS，设备应过渡到DI0：Device_idle状态。
#### DI2：Check_command状态。当设备识别到接收到的寄存器FIS包含一个新的命令时，进入该状态。注意：该状态显示所有命令的过渡。如果器件没有实现任何特定的命令，则应从DI2:11过渡到状态DI3:No_command。
当处于该状态时，设备应检查接收到的命令所需的命令协议，如果支持异步通知，则将NotifyPending清零。清空
NotifyPending为0，允许将来向主机发送异步通知信息。
过渡DI2:1：当接收到的命令为非数据传输命令时，设备应过渡到DND0：非数据状态。
过渡DI2:2：当接收到的命令为PIO时，设备应过渡到DND0：非数据状态。当接收到的命令是PIO数据输入命令时，设备应过渡到DPIOI0：PIO_in状态。
过渡DI2:3：当接收到的命令是PIO数据输入命令时，器件应过渡到DPIOI0：PIO_in状态。当接收到的命令是PIO数据输出命令时，器件应过渡到DPIOO0: PIO_out状态。
过渡DI2:4：当接收到的命令是DIO数据输出命令时，器件应过渡到DPIOO0：PIO_out状态。当接收到的命令是READ DMA命令时，器件应过渡到DDMAI0: DMA_in状态。
过渡DI2:5。当接收到的命令是WRITE DMA命令时，设备应过渡到DDMAO0: DMA_out状态。
过渡DI2:6。当接收到的命令是PACKET命令时，设备应转换到DPKT0: PACKET状态。
 * 过渡DI2:7：当接收到的命令是PACKET命令时，设备应过渡到DPKT0：PACKET状态。当接收到的命令是 READ DMA QUEUED 命令时，设备应转换到 DDMAQI0: DMA_queued_in 状态。
* 过渡DI2:8。当接收到的命令是WRITE DMA QUEUED命令时，设备应转换到DDMAQO0: DMA_queued_out状态。
过渡DI2:9。当接收到的命令是EXECUTE DEVICE DIAGNOSTICS命令时，设备应过渡到DDMAQO0: DMA_queued_out状态。
 器件应过渡到DEDD0: Execute_device_diag状态。
过渡DI2:10：当接收到的命令是RESET DEVICE命令时，设备应过渡到DDR0：Device_reset状态。
过渡DI2:11：当接收到的命令没有被设备执行时，设备应过渡到DI3：No_command状态。
* 过渡DI2:12：当接收到的命令是SERVICE命令时，设备应过渡到DI5：Service_test状态。
* 过渡 DI2:13：当接收到的命令是 READ FPDMA QUEUED 命令协议时，设备应过渡到 DFPDMAQ1: AddCommandToQueue 状态。
* 过渡DI2:14：当接收到的命令是WRITE FPDMA QUEUED命令协议时，设备应过渡到DFPDMAQ1: AddCommandToQueue状态。
* 过渡DI2:15：当接收到的命令是NCQ QUE管理命令协议时，设备应过渡到DFPDMAQ1：AddCommandToQueue状态。
* 过渡DI2:16：当接收到的命令不是READ FPDMA QUEUED；也不是READ FPDMA QUEUED；也不是READ FPDMA QUEUED。
WRITE FPDMA QUEUED；且不是NCQ QUE MANAGEMENT；也不是DEVICE RESET；且有本机队列命令未完成，则发生错误，设备应转入DFPDMAQ12：BrokenHost_ClearBusy状态。
#### DI3：No_command状态。当设备识别到接收到的命令没有被设备执行时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令描述和
中断位设置为1。
过渡 DI2:1：当传输层传输了寄存器 FIS 后，设备应过渡到 DI0：Device_idle 状态。
#### * DI4：Set_service状态。當準備好完成排隊指令的資料傳輸時，才會進入此狀態。
当处于该状态时，设备应请求传输层传送一个Set Device Bits FIS，状态寄存器中的SERV位被设置，Error和Status字段中的其他位均与各寄存器的当前内容相同，中断位设置为1。
过渡DI4:1：当传输层传输完Set Device Bits FIS后，设备应过渡到DI0：Device_idle状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
#### * DI5：Service_test状态。当收到SERVICE命令时进入该状态。
处于该状态时，设备应确定设备请求服务完成的命令类型。使用PIO协议的PACKET命令自带寄存器更新，可以设置DRQ和发送命令标签，但其他排队的命令需要通过寄存器
FIS。
过渡DI5：1。当被服务的命令是PIO数据输入或PIO数据输出命令时，设备应转入DI7：Service_decode状态。
DI5:2：当待服务的命令既不是PIO数据输入也不是PIO数据输出命令时，设备应转换到DI6：Service_send_tag状态。
#### * DI6：Service_send_tag状态。當收到SERVICE指令，並且需要將Register Device傳送至Host FIS以提供服務的指令時，才會進入此狀態。
当处于该状态时，设备应要求传输层按照ATA8-ACS标准中对被服务命令的命令描述，发送一个包含寄存器内容的寄存器FIS，其中包括所需的命令标签。
过渡DI6:1：当传输层传送了寄存器FIS后，设备应过渡到DI7：Service_decode状态。
#### *DI7：Service_decode状态。该状态是在传输了寄存器FIS后进入的，如果需要发送寄存器内容，包括所需的命令标签，以响应SERVICE命令。
当处于该状态时，设备应再次确定设备请求服务完成的命令类型，并分支到该命令的数据传输和完成。
过渡DI7:1：当要服务的命令是PIO数据输入命令时，设备应过渡到DPKT4。PACKET_PIO_in状态。
过渡 DI7:2: 当待服务的命令是 PIO 数据输出命令时，设备应过渡到 DPKT6: PACKET_PIO_out 状态。
过渡DI7:3。当待服务的命令是DMA数据输入命令时，设备应转换到DPKT9：PACKET_DMA_in状态。
过渡 DI7:4：当待服务的命令是 DMA 数据输出命令时，设备应过渡到 DPKT11: PACKET_DMA_out 状态。
过渡DI7:5。当待服务的命令是READ DMA QUEUED命令时，设备应过渡到DDMAQI1: Send_data状态。
过渡DI7:6。当需要服务的命令是WRITE DMA QUEUED命令时，设备应转换到DDMAQO1: Send_DMA_activate状态。
### 11.3 软件复位协议。
...............................................................................................

当主机在设备控制寄存器字节的SRST位位置发送一个带 "1 "的寄存器FIS时，无论设备的电源管理模式如何（如SLEEP、STANDBY），设备都应执行软件复位协议。

##### DSR0: 
软件复位协议（Software_reset_asserted
开始初始化和诊断执行。
1. 软件复位被否定。 DSR1: Execute_diagnostics 2.软件复位被否定。 DSR0: Software_reset_ asserted（软件复位）。
DSR1: Execute_diagnostics 完成初始化和诊断执行。
1. 初始化和诊断程序成功完成。 DSR2: Send_good_status 2:     Send_good_status 2. 初始化完成，诊断程序失败。 DSR3: Send_bad_status 2:     Send_bad_status 
DSR2.Send_good_status 要求传输状态良好的寄存器 FIS。Send_good_status 要求传输状态良好的寄存器FIS。
1. 傳送 Register FIS 的狀態。 DI0: Device_idle 
DSR3.Send_bad_status 请求传输状态不好的寄存器FIS。Send_bad_status 要求传输状态不好的寄存器FIS。
1. 传送寄存器 FIS。 DI0: Device_idle 
#### DSR0：Software_reset_asserted。当接收到寄存器FIS时，FIS中的C位清零，设备控制寄存器中的SRST位设为1时，进入该状态。
当处于该状态时，设备开始初始化和诊断执行，并等待SRST位的清除。
过渡DSR0:1：当接收到寄存器FIS时，FIS中的C位清零，设备控制寄存器中的SRST位清零时，设备应过渡至
DSR1：执行_诊断状态。
过渡DSR0:2：如果接收到寄存器FIS，且FIS中的C位设为1，或设备控制寄存器中的SRST位设为1，则设备应过渡到DSR0:
Software_reset_asserted状态。
#### DSR1：Execute_diagnostics。当接收到寄存器FIS时，FIS中的C位清零，设备控制寄存器中的SRST位清零，则进入该状态。
当处于该状态时，设备完成初始化并执行其诊断程序。
过渡DSR1:1：当设备完成初始化并成功完成诊断程序时，设备应过渡到DSR2: Send_good_status状态。
Transition DSR1:2: 当设备已被初始化且诊断失败时，设备应过渡到DSR3: Send_bad_status状态。
#### DSR2: Send_good_status。当设备已被初始化且诊断程序成功完成时，进入该状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
当处于这种状态时，设备请求传输层向主机传输一个寄存器FIS。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 00h
LBA(23:16 00h)
设备名称
错误01h
状态 00h-70h(见注)
状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误01h
状态00h **过渡DSR2:1:**当传输层表示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。

#### DSR3: Send_bad_status。当设备已经初始化且诊断失败时进入该状态。
当处于该状态时，设备请求传输层向主机传输一个寄存器FIS。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 00h
LBA(23:16 00h)
设备名称
错误00h，02h-7Fh
状态 00h-70h(见注)
状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误00h，02h-7Fh
状态 00h  
过渡DSR3:1：当传输层指示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。
### 11.4 EXECUTE DEVICE DIAGNOSTIC 命令协议书 
如果主机在设备完成执行EXECUTE之前发送COMRESET(COMRESET)。
DEVICE DIAGNOSTIC协议，那么设备应立即开始执行该协议。
COMRESET协议从头开始执行。如果主机在设备完成执行EXECUTE DEVICE DIAGNOSTIC协议之前，在设备控制寄存器中断言SRST，那么设备应立即从头开始执行其软件复位协议。
DEDD0．
DEDD0: Execute_device_diag
执行诊断程序。
1. 诊断程序成功完成。 DEDD1:     Send_good_status 2. 诊断程序失败。 DEDD2: Send_bad_status（发送坏状态）。
DEDD1.Send_good_status 要求传送状态良好的寄存器 FIS。Send_good_status 要求传输状态良好的寄存器FIS。
1. 傳送 Register FIS。 DI0: Device_idle 
DEDD2: Send_bad_status 要求传送状态不良的寄存器 FIS。
1. 传送寄存器 FIS。 DI0: Device_idle 
#### DEDD0: Execute_device_diag。当有EXECUTE DEVICE的时候，进入该状态。
收到DIAGNOSTIC命令。
当处于此状态时，设备执行其诊断程序。
过渡DEDD0:1：当设备成功完成诊断时，设备应过渡到DEDD1: Send_good_status状态。
过渡DEDD1:2：当设备诊断失败时，设备应过渡到DEDD2：Send_bad_status状态。
#### DEDD1: Send_good_status。当设备成功完成诊断程序时，进入该状态。
当处于该状态时，设备应请求传输层向主机发送寄存器FIS，中断位设为1。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
Count(7:0) 01h
LBA(7:0) (^0) 1h
LBA(15:8) 00h
LBA(23:16 00h)
设备名称
错误01h
状态 00h-70h(见注)
状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) (^)01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误01h
状态00h **过渡DEDD1:1:**当传输层表示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。

#### DEDD2：Send_bad_status。当设备已经初始化且诊断失败时进入该状态。
当处于该状态时，设备应请求传输层向主机发送寄存器FIS，中断位设为1。如果设备没有实现PACKET命令功能集，则寄存器内容应为。
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 00h
LBA(23:16 00h)
设备名称
错误00h，02h-7Fh
状态 00h-70h(见注)
状态寄存器中的位[6:4]的设置与设备有关。
如果设备实现了PACKET命令功能集，则寄存器的内容应是。
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误00h，02h-7Fh
状态 00h
过渡DEDD2:1：当传输层指示寄存器FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。

### 11.5 DEVICE RESET命令 protocol............................................................................

如果主机在设备完成执行DEVICE RESET协议之前发送COMRESET，则设备应立即从头开始执行COMRESET协议。如果主机在设备完成执行DEVICE RESET协议之前，在设备控制寄存器中断言SRST，那么设备应立即从头开始执行其软件复位协议。
DDR0：Device_reset 停止执行和后台活动。
1. 活动停止。 DDR1: Send_good_status 
DDR1：Send_good_status 要求将寄存器-设备以良好的状态传输给主机FIS。
1. 传送寄存器 FIS。 DI0: Device_idle 
#### DDR0：Device_reset，当收到DEVICE RESET命令时进入该状态。当收到DEVICE RESET命令时，就会进入该状态。

当处于该状态时，器件停止任何正在进行的执行或活动。
过渡DDR0:1：当器件停止任何执行或活动，并完成其内部诊断时，器件应过渡到DDR1：Send_good_status状态。
#### DDR1：Send_good_status。当设备已被初始化并成功完成诊断时，就会进入该状态。
当处于该状态时，设备请求传输层将寄存器--设备传送到 "DDR1：Send_good_status "状态。
主机FIS对主机。
寄存器的内容为
Count(7:0) 01h
LBA(7:0) 01h
LBA(15:8) 14h
LBA(23:16 EBh)
设备名称
错误01h
状态 00h
过渡DDR1:1：当传输层表示寄存器-设备到主机FIS已经传输完毕时，设备应过渡到DI0：Device_Idle状态。
### 11.6 非数据命令协议 
执行该类命令不涉及数据传输。请参阅NOP命令说明和SLEEP命令说明，了解更多的协议要求。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
DND0：非数据 执行非数据命令。
1. 命令执行完毕。 DND1.Send_status DND1: Send_status 
DND1.Send_status 请求传输寄存器FIS。Send_status 请求传输寄存器FIS。
1. FIS 传输完成。 DI0: Device_idle 
#### DND0：非数据状态。当接收到的命令为非数据命令时，进入该状态。
处于该状态时，如果支持，设备应执行所请求的命令。
过渡DND0：1：当命令执行完成后，设备应过渡到该状态。
DND1: Send_status状态。
#### DND1: Send_status状态。该状态是在非数据命令执行完毕后进入的。
当处于此状态时。
 设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DND1:1：当FIS已经传输完毕，则设备应过渡到了DND1:1。
DI0: Device_idle 状态。
### 11.7 PIO数据输入命令协议 
该类命令的执行包括PIO将一个或多个数据块从设备传输到主机。
DPIOI0：PIO_in 准备一个DRQ数据块传输到主机。
1. DRQ数据块准备好传输，且没有遇到错误。

##### DPIOI1.发送_PIO_setup 2: 
Send_PIO_setup 2.命令执行过程中遇到错误。 DPIOI3: Error_status 
DPIOI1: Send_PIO_setup 请求向主机传输PIO设置FIS。
1. 传送 PIO 设置 FIS。 DPIOI2: 传送数据 
DPIOI2: Transmit_data 请求向主机传输数据FIS。
1. 传输数据FIS，此命令不需要再传输数据。
  DI0: Device_idle 2. 传送数据 FIS，该命令需要更多的数据传输，或传输 2048 个 D 字。
  DPIOI0: PIO_in
DPIOI3: Error_status 请求传输寄存器 - 设备到主机 FIS。
1. FIS 传输完成。 DI0: Device_idle  
#### DPIOI0：PIO_in状态。当设备接收到PIO数据输入命令或需要传输一个或多个额外的DRQ数据块来完成命令时，就会进入该状态。
当处于该状态时，设备应准备一个DRQ数据块传送给主机。
过渡DPIOI0:1：当设备有一个DRQ数据块准备传输且没有遇到错误时，设备应过渡到DPIOI1：Send_PIO_setup状态。
过渡DPIOI0:2：当器件在命令执行过程中遇到错误时，器件应过渡到DPIOI3：Error_status状态。
#### DPIOI1：发送_PIO_setup状态。当设备准备好发送一个 "PIO "时，进入该状态。
DRQ数据块给主机。
当处于此状态时，设备应请求传输层发送一个PIO设置FIS。
初始状态应将BSY位清零，DRQ位设为1，寄存器内容按ATA8-ACS标准中的命令描述。中断位应被设置。如果这是命令请求的最后一个DRQ数据块，则结束状态应将BSY位清零，DRQ位清零。如果这不是命令要求的最后一个数据块，则结束状态应将BSY位设置为1，DRQ位清零。
过渡DPIOI1:1：当PIO设置FIS已经传输完毕，器件应过渡到DPIOI2：Transmit_data状态。
#### DPIOI2：Transmit_data。当设备传输了一个PIO设置FIS后，进入该状态。
FIS到主机。
当处于这种状态时，设备应请求传输层传输一个包含DRQ数据块的Data FIS。
过渡DPIOI2:1：当数据FIS已经传输完毕，且该命令所要求的所有数据都已传输完毕时，设备应过渡到DI0：Device_idle状态。
过渡DPIOI2:2。当数据FIS已经传输完毕，但该命令所要求的所有数据尚未传输，或者已经达到2048个Dword的传输限制时，设备将过渡到DPIOI0：PIO_in状态。
#### DPIOI3：Error_status。当器件遇到错误，导致命令在完成请求数据的传输前中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。除了ATA8-ACS的要求外，如果在传输该命令的前一个FIS时遇到CRC错误，设备可以将FIS中错误字段的第7位设置为1。
过渡DPIOI3:1：当FIS传输完毕后，设备应过渡到DI0:
Device_idle状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速序列化）。
#### ATA国际组织 
### 11.8 PIO数据输出命令协议..................................................................................。

执行该类命令包括从主机到设备的一个或多个数据块的PIO传输。
DPIOO0：PIO_out 准备接收主机的DRQ数据块传输。
1. 准备接收DRQ数据块传输。 DPIOO1：Send_PIO_setup 2.准备接收来自主机的DRQ数据块传输。接收到所有DRQ数据块或因错误而导致命令中止。

##### DPIOO3: Send_status: 
Send_status
DPIOO1: Send_PIO_setup 请求向主机传输PIO设置FIS。
1. 传送 PIO 设置 FIS。 DPIOO2: 接收数据     接收数据 
DPIOO2: Receive_data 从传输层接收数据FIS。
1. 收到数据FIS。 DPIOO0: PIO_out 
DPIOO3.Send_status 请求传输一个寄存器--设备到主机FIS。Send_status 请求传输一个寄存器 - 设备到主机FIS。
1. FIS 传输完成。 DI0: Device_idle 

#### DPIOO0：PIO_out状态。当设备接收到PIO数据输出命令或需要接收一个或多个DRQ数据块才能完成该命令时，进入该状态。
处于该状态时，器件应准备接收主机的DRQ数据块传输。
过渡DPIOO0:1：当设备准备接收DRQ数据块时，设备应过渡到DPIOO1：Send_PIO_setup状态。
过渡DPIOO0:2：当设备已经接收到该命令所请求的所有DRQ数据块，或者设备在完成请求数据的传输前遇到错误导致命令中止，则设备应过渡到DPIOO3:
Send_status状态。
#### DPIOO1：Send_PIO_setup。该状态是在设备准备好接收一个指令时进入的。
来自主机的DRQ数据块。
当处于此状态时，设备应请求传输层发送PIO设置FIS。
初始状态应将BSY位清零，DRQ位设为1。如果这是该命令的第一个DRQ数据块，应将中断位清零。如果这不是该命令的第一个 DRQ 数据块，则中断位应设置为 1。结束状态应具有
BSY位设为1，DRQ位清零。DRQ数据块的字节数应予指示。
过渡DPIOO1:1：当PIO设置FIS已传输完毕，器件应过渡到DPIOO2: Receive_data状态。
#### DPIOO2:Receive_data。当设备传输了一个PIO设置FIS后，进入该状态。
FIS给主机。

当处于此状态时，设备应接收来自传输层的请求数据FIS。
过渡DPIOO2:1：当收到数据FIS后，设备应过渡到数据FIS状态。
DPIOO0: PIO_out状态。
#### DPIOO3: Send_status：发送状态。当设备已经接收到该命令所请求的所有DRQ数据块，或者设备在完成请求数据的传输前遇到错误，导致命令中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。除了ATA8-ACS的要求外，如果在传输该命令的前一个FIS时遇到CRC错误，设备可以将FIS中错误字段的第7位设置为1。
过渡DPIOO3:1：当FIS传输完毕后，设备应过渡到DI0:
Device_idle状态。
### 11.9 命令协议中的DMA数据 
执行该类命令包括使用DMA传输将一个或多个数据块从设备传输到主机。
DDMAI0：DMA_in 为数据FIS的传输准备数据。
1. 准备传输数据FIS的数据。 DDMAI1: Send_data 2. 命令完成或因错误而中止。 DDMAI2: Send_status 
DDMAI1：Send_data 请求向主机传输数据FIS。
1. 传输数据FIS。此命令不需要再传输数据，或传输2048个Dword。
  DDMAI0: DMA_in
DDMAI2：Send_status 请求向主机传输寄存器FIS。
1. 发送寄存器 FIS。 DI0: Device_idle 
#### DDMAI0：DMA_in状态。当设备收到DMA数据输入指令或需要传输一个或多个数据FIS来完成指令时，进入该状态。
当处于该状态时，器件应准备向主机传输数据FIS的数据。
过渡DDMAI0:1：当设备已准备好传输数据FIS的数据时，设备应过渡到DDMAI1：Send_data状态。
过渡DDMAI0:2：当设备已经传输了该命令所要求的所有数据，或者在完成所要求数据的传输之前遇到了错误，导致命令中止，那么设备应过渡到DDMAI2：Send_status状态。
#### DDMAI1：Send_data状态。当设备有数据准备向主机传输数据FIS时，进入该状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
当处于这种状态时，设备应请求传输层传输一个包含数据的数据FIS。设备命令层应要求数据FIS大小不超过2048个Dword。
过渡DDMAI1:1：当数据FIS传输完毕后，设备应过渡到第2个数据FIS。
DDMAI0: DMA_in状态。
#### DDMAI2：Send_status。当设备已经传输了命令所要求的所有数据，或者遇到错误，导致命令在完成所要求的数据传输前中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DDMAI2:1：当FIS传送完毕后，设备应过渡到DI0:
Device_idle状态。

### 11.10 DMA数据输出指令协议。
该类命令的执行包括使用DMA传输将一个或多个数据块从主机传输到设备。在命令所需的所有数据成功传输完成后，会发出一次中断。
DDMAO0：DMA_out 准备接收来自主机的数据FIS。
1. 准备接收数据FIS。 DDMAO1: Send_DMA_activate 2. 收到该命令所要求的所有数据，或因错误而导致命令中止。

##### DDMAO3：发送_status。
DDMAO3: Send_status
##### DDMAO1: 
Send_DMA_activate
要求向主机传输DMA激活FIS。
1. 传送DMA激活FIS。 DDMAO2:     Receive_data 
DDMAO2: Receive_data 从传输层接收数据FIS。
1. 收到数据FIS。 DDMAO0：DMA_out 
DDMAO3: Send_status 请求向主机传送寄存器FIS。
1. 发送寄存器 FIS。 DI0: Device_idle 
#### DDMAO0：DMA_out状态。当设备收到DMA数据输出命令或需要收到一个或多个Data FIS才能完成该命令时，进入该状态。
处于该状态时，设备应准备接收主机的数据FIS。
过渡DDMAO0:1：当设备准备接收数据FIS时，设备应过渡到DDMAO1：Send_DMA_activate状态。

过渡DDMAO0:2：当设备已经接收到该命令所要求的全部数据，或者设备在完成所要求数据的传输之前遇到了错误，导致该命令中止，那么设备应过渡到DDMAO3: Send_status状态。
#### DDMAO1：Send_DMA_activate。当设备准备接收来自主机的数据FIS时，就会进入该状态。
当处于该状态时，设备应请求传输层发送一个DMA激活FIS。
过渡DDMAO1:1：当DMA Activate FIS传输完毕后，设备应过渡到DDMAO2: Receive_data状态。
#### DDMAO2: Receive_data。该状态是在设备传输DMA Activate FIS时进入的。
FIS给主机。
当处于该状态时，设备应接收来自传输层的请求数据FIS。
过渡DDMAO2:1：当接收到数据FIS后，设备应过渡到数据FIS状态。
DDMAO0：DMA_out状态。
#### DDMAO3: Send_status：发送状态。当设备已经接收到该命令所请求的全部数据，或者设备在完成请求数据的传输之前遇到错误，导致命令中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DDMAO3:1：当FIS传送完毕后，设备应过渡到?
DI0: Device_idle状态。
### 11.11 PACKET协议.....................................................................................................

标有*的状态只有在执行队列时才会被使用。
DPKT0：PACKET 请求传输 PIO 设置 FIS。
1. FIS 传输完成。 DPKT1.PACKET     Receive_command（接收命令）。
DPKT1: Receive_command 接收包含命令包的数据 FIS。
1. FIS接收完毕。 DPKT2: Check_command  
##### 在附件处进行高速小型化。
#### ATA国际组织 
DPKT2: Check_command 确定接收到的命令所需的协议。
1. 非数据命令。 DPKT3: PACKET_non-data 2:     PACKET_non-data 2. PIO数据接收命令。 DPKT4：PACKET_PIO_in 3:     PACKET_PIO_in 3. PIO数据输出命令。 DPKT6: PACKET_PIO_out 4.DMA 数据输入命令 DPKT9: PACKET_DMA_in 5. DMA 数据输出命令 DPKT11：PACKET_DMA_out 5. 
DPKT3.PACKET_non-data 执行非数据命令。PACKET_non-data 执行非数据命令。
1. 命令执行完毕。 DPKT14: Send_status 
DPKT4.PACKET_PIO_in 准备一个DRQ数据块传送给主机。PACKET_PIO_in 准备一个 DRQ 数据块传送给主机。
1. DRQ 数据块准备传输。 DPKT4a.PIO_in_setup     PIO_in_setup 2.传输完成或命令因错误而中止。 DPKT14: Send_status 3. * DRQ 数据块还没有准备好立即传输。
DPKT4a.PIO_in_setup PIO_in_setup 请求向主机发送 PIO Setup FIS。
1. 传送 PIO 设置 FIS。 DPKT5: Send_PIO_data (发送PIO数据) 
DPKT5: Send_PIO_data 请求向主机传输数据FIS。
1. 传送数据 FIS。 DPKT4: PACKET_PIO_in     PACKET_PIO_in 
DPKT6: PACKET_PIO_out 准备接收主机的DRQ数据块。
1. 准备接收DRQ数据块传输。 DPKT7: PIO_out_setup 2. 接收到所有 DRQ 数据块或因错误而导致命令中止。

##### DPKT14.PIO_out_setup 2: 
DPKT14: Send_status 3. * DPKT14: Send_status 3.  DPKT14: Send_status 3. 
DPKT7: PIO_out_setup 请求向主机传输 PIO Setup FIS。
1. 1. 傳送 PIO Setup FIS。 DPKT8: Receive_PIO_data（接收 PIO 数据） 1. 
DPKT8：Receive_PIO_data 从传输层接收数据FIS。
1. 收到数据FIS。 DPKT6：PACKET_PIO_out，接收传输层的数据FIS。 
DPKT9: PACKET_DMA_in 为传输数据FIS做好数据准备。
1. 1. 准备传输数据 FIS 的数据。
  DPKT10: Send_DMA_data 2. 命令完成或因错误而中止。 DPKT14: Send_status 3. * 数据尚未准备好立即传输。 数据还没有准备好立即传输，DPKT15：释放 
DPKT10：Send_DMA_data 请求向主机传输数据FIS。
1. 传送数据FIS。此命令不需要再传输数据，或传输2048个Dword。

##### DPKT9。
##### PACKET_DMA_IN 
##### DPKT11.PACKET_DMA_OUT 
PACKET_DMA_out
准备接收来自主机的数据FIS。
1. 准备接收数据FIS。 DPKT12: Send_DMA_activate 2. 收到该命令所要求的所有数据，或由于错误而导致命令中止。

##### DPKT14.Send_status 3: 
DPKT14: Send_status 3. * 尚未准备好立即传输。 DPKT14: Send_status 3. 
##### DPKT12: 
Send_DMA_activate
要求向主机传输DMA激活FIS。
1. 传送 DMA Activate FIS。 DPKT13: Receive_DMA_data（接收DMA数据）。
##### DPKT13: 
Receive_DMA_data
从传输层接收数据FIS。
1. 收到数据FIS。 DPKT11: PACKET_DMA_out 
DPKT14: Send_status 请求传输寄存器 FIS。
1. 1. FIS 传输完成。 DI0: Device_idle * DPKT15: Release 请求传送寄存器 FIS。
1. 1. FIS 传输完成.  DI0: Device_idle * DPKT15: Release 要求传输寄存器 FIS。
#### DPKT0：PACKET：当设备接收到PACKET命令时，进入该状态。

当处于该状态时，设备应请求传输层发送一个PIO设置FIS，以获取与该命令相关的命令包。初始状态应将BSY位清零，DRQ位设为1。中断位应清零。结束状态的BSY位被设置为1，DRQ位被清零。DRQ 数据块的字节数应予指示。
过渡DPKT0:1：当PIO设置FIS已经传输完毕，设备应过渡到DPKT1: Receive_command状态。
#### DPKT1: Receive_command.该状态是在设备传输PIO设置FIS时进入的。当设备传输了一个PIO设置FIS后，进入该状态：DPKT1: Receive_command。
设置FIS到主机获取命令包。
当处于此状态时，设备应收到传输层发出的请求数据FIS。

##### 高速 SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
过渡DPKT1:1：当接收到数据FIS后，设备应过渡到数据FIS。
DPKT2：检查命令状态。
#### DPKT2：Check_command状态。当收到包含命令包的数据FIS时，进入该状态。
当处于该状态时，设备应确定命令包中包含的命令的协议。
过渡DPKT2:1：当命令为非数据传输命令时，设备应过渡到DPKT3。PACKET_non-data状态。
过渡DPKT2:2。当命令为PIO数据输入传输命令时，设备应过渡到DPKT4：PACKET_PIO_in状态。PACKET_PIO_in状态。
过渡DPKT2:3。当指令为PIO数据输出传输指令时，设备应转入DPKT6: PACKET_PIO_out状态。
过渡DPKT2:4。当指令为DMA数据输入传输指令时，设备应转入DP9: PACKET_DMA_in状态。
过渡DPKT2:5。当指令为DMA数据输出传输指令时，设备应过渡到DPKT11: PACKET_DMA_out状态。
#### DPKT3：PACKET_non-data状态。PACKET_non-data状态。当接收到的命令为非数据命令时，进入该状态。
当处于该状态时，设备应执行所请求的命令。
过渡 DPKT3:1：当命令执行完毕后，设备应过渡到该状态。
DPKT14: Send_status状态。
#### DPKT4.PACKET_PIO_in状态：发送状态。PACKET_PIO_in状态。当设备接收到PIO数据输入指令或需要传输一个或多个DRQ数据块才能完成指令时，进入该状态。
当处于该状态时，设备应准备一个DRQ数据块传送给主机。
过渡DPKT4:1：当设备有一个DRQ数据块准备传输时，设备应过渡到DPKT4a。PIO_in_setup。
过渡DPKT4:2：当该命令所要求的数据全部传输完毕，或者设备在完成所要求的数据传输前遇到错误导致命令中止时，设备应过渡到DPKT14：Send_status状态。
*过渡DPKT4:3。当设备支持重叠和队列，并且没有一个 "发送 "状态时
DRQ数据块准备立即传输，设备应过渡到DPKT15：释放状态。
#### DPKT4a: PIO_in_setup: 当设备准备向主机传输一个DRQ数据块时，进入该状态。
当处于该状态时，设备应请求传输层传输一个PIO设置FIS。
初始状态应将BSY位清零，DRQ位设为1。中断位应设置为1。结束状态应将BSY位设置为1，DRQ位清零。DRQ 数据块的字节数应显示出来。
转变 DPKT4a:1：当 PIO 设置 FIS 被传送后，设备应过渡到 DPKT5:Send_PIO_data 状态。

#### DPKT5:Send_PIO_data.当设备准备向主机传输DRQ数据块时，进入该状态。当设备准备向主机传输DRQ数据块时，进入该状态。
当处于该状态时，设备应请求传输层传输一个包含DRQ数据块的数据FIS。
过渡DPKT5:1。当数据FIS被传输后，设备应过渡到以下状态
DPKT4.PACKET_PIO_in状态。PACKET_PIO_in状态。
#### DPKT6：PACKET_PIO_out状态。当设备接收到PIO数据输出指令或需要接收一个或多个DRQ数据块才能完成指令时，进入该状态。
处于该状态时，设备应准备接收主机的DRQ数据块传输。
过渡DPKT6:1：当设备准备接收DRQ数据块传输时，设备应过渡到DPKT7：PIO_out_setup状态。
过渡DPKT6:2：当设备已经接收到该命令所要求的所有DRQ数据块，或者设备在完成所要求的数据传输前遇到错误导致命令中止，则设备应过渡到DPKT14:
Send_status状态。
*过渡DPKT6:3。当设备支持重叠和排队，且不在可以立即接受DRQ数据块的状态时，设备应过渡到DPKT15:
释放状态。
#### DPKT7：PIO_out_setup。当设备准备好接收来自主机的DRQ数据块时，进入该状态。
当处于该状态时，设备应请求传输层发送一个PIO Setup FIS。
初始状态应将BSY位清零，DRQ位设为1。中断位应设置为1。结束状态应将BSY位设置为1，DRQ位清零。DRQ 数据块的字节数应显示出来。
过渡 DPKT7:1：当PIO设置FIS被传输后，器件应过渡到DPKT8：Receive_PIO_data状态。
#### DPKT8：Receive_PIO_data。该状态是在设备传送PIO设置FIS时进入的。
设置FIS给主机。
当处于此状态时，设备应从传输层接收所请求的数据FIS。
过渡DPKT8:1：当收到数据FIS后，设备应过渡到数据FIS的状态。
DPKT6: PACKET_PIO_out状态。
#### DPKT9：PACKET_DMA_in状态。当设备接收到DMA数据输入命令或需要传输一个或多个Data FIS来完成命令时，进入该状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
当处于该状态时，设备应准备好向主机传输数据FIS的数据。
过渡 DPKT9:1：当设备已准备好数据，可以传输数据 FIS 时，设备应过渡到 DPKT10: Send_DMA_data 状态。
过渡DPKT9:2：当设备已经传输了该命令所要求的所有数据，或者在完成所要求的数据传输之前遇到了错误，导致命令中止，那么设备应过渡到DPKT14：Send_status状态。
*过渡DPKT9:3。当设备支持重叠和排队，且没有数据可以立即传输时，设备应过渡到DPKT15：释放状态。
#### DPKT10：Send_DMA_data。当设备有数据准备传送数据FIS给主机时，进入该状态。
当处于该状态时，设备应请求传输层传输一个包含数据的Data FIS。
过渡DPKT10:1：当数据FIS传输完毕后，设备应过渡到该状态。
DPKT9：PACKET_DMA_in状态。设备命令层应请求数据FIS大小不超过2048 Dwords。
#### DPKT11：PACKET_DMA_out状态。当设备接收到PACKET_DMA_out状态时，进入该状态。
DMA数据输出命令或收到一个或多个Data FIS才能完成该命令。
当处于该状态时，设备应准备接收主机的数据FIS。
过渡 DPKT11:1：当设备准备好接收数据FIS时，设备应过渡到DPKT12：Send_DMA_activate状态。
过渡DPKT11:2：当设备已经接收到该命令所要求的全部数据，或者设备在完成所要求的数据传输前遇到错误导致命令中止，则设备应过渡到DPKT14：Send_status状态。
* 过渡 DPKT11:3：当设备支持重叠和排队，且不在可以立即接受数据FIS的状态时，设备应过渡到DPKT15：释放状态。
#### DPKT12：Send_DMA_activate。当设备准备好接受来自主机的Data FIS时，进入该状态。
当处于该状态时，设备应请求传输层发送一个DMA激活FIS。
过渡DPKT12:1：当DMA Activate FIS被传输后，设备应过渡到DPKT13：Receive_DMA_data状态。
#### DPKT13：Receive_DMA_data。当设备传送了一个DMA激活FIS后，进入该状态。
激活主机的FIS。
当处于这种状态时。
 设备应从传输层接收所请求的数据FIS。
过渡DPKT13:1：当收到数据FIS后，设备应过渡到数据FIS。
DPKT11: PACKET_DMA_out状态。

#### DPKT14：Send_status状态。当设备已经接收到该命令所要求的全部数据，或者设备在完成所要求数据的传输之前遇到了错误，导致命令中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡 DPKT14:1：当 FIS 传输完毕后，设备应过渡到 FIS 传输。
DI0: Device_idle 状态。
#### * DPKT15：释放状态，当设备不能立即进行数据传输时进入该状态。当设备不能立即进行数据传输时进入此状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令描述，其内容为： *DPKT15：释放：当设备不能立即进行数据传输时，进入该状态。
REL位被设置为1，如果之前的设置功能启用了总线释放中断，则REL位被设置为1。
命令，中断位设为1。
过渡DPKT15：1。当FIS传输完毕后，设备将过渡到以下状态
DI0: Device_idle状态。
### 11.12 READ DMA QUEUED命令协议...............................................................。

该类命令的执行包括利用DMA传输将一个或多个数据块从设备传输到主机。该命令的所有数据可以在命令接收到和数据传输之间没有总线释放。该命令可以在传输数据之前进行总线释放。主机应在传输数据前初始化DMA控制器。
数据传输开始时，请求的所有数据应在没有总线释放的情况下传输。
DDMAQI0:
DDMAQI0: DMA_queued_in
确定是转移还是释放。
1. 数据的数据FIS准备传输。 DDMAQI1：Send_data 2. 命令因错误而中止。 DDMAQI3：Send_status 3. 总线释放 DDMAQI4：释放 
DDMAQI1：Send_data 请求向主机传输数据FIS。
1. 传输数据FIS。此命令不需要再传输数据，或传输2048个Dword。

##### DDMAQI2: 
Prepare_data
DDMAQI2: Prepare_data 为下一个数据FIS准备数据。
1. 数据准备就绪。 DDMAQI1: Send _data 2. 命令完成或因错误而中止。 DDMAQI3: Send_status（发送状态）。
DDMAQI3：Send_status 请求向主机传输寄存器FIS。
1. 发送寄存器 FIS。 DI0: Device_idle  
##### 在附件处进行高速小型化。
#### ATA国际组织 
DDMAQI4：发布请求向主机传输寄存器FIS。
1. 传送寄存器 FIS。 DI0: Device_idle 
#### DDMAQI0：DMA_queued_in状态。该状态是在设备收到一个 
READ DMA QUEUED命令。
当处于此状态时，设备应确定所请求的数据是否已准备好传送给主机。
过渡DDMAQI0:1：当设备有请求的数据准备立即传输数据FIS时，设备应过渡到DDMAQI1：Send_data状态。
过渡DDMAQI0:2：当设备在完成请求数据的传输之前，遇到了错误，导致命令中止时，设备应过渡至
DDMAQI3：Send_status状态。
过渡DDMAQI0:3。当设备还没有准备好传输所请求的数据时。
数据FIS立即，设备应过渡到DDMAQI4：释放状态。
#### DDMAQI1：Send_data。当设备有数据准备向主机传输数据FIS时，进入该状态。
当处于该状态时，设备应请求传输层传输包含数据的Data FIS。
过渡DDMAQI1:1：当Data FIS被传输后，设备应过渡到DDMAQI2：Prepare_data状态。设备命令层应要求Data FIS大小不超过2048 Dwords。
#### DDMAQI2：Prepare_data。当设备完成向主机传输一个Data FIS时，进入该状态。
处于该状态时，设备将为下一个数据FIS准备数据。
轉換 DDMAQI2:1: 當資料已準備好，可進行資料 FIS 時，裝置應轉換到下一個資料 FIS 的狀態。
DDMAQI1：Send_data状态。
过渡DDMAQI2：2。当命令所要求的所有数据都已传输完毕或遇到错误，导致命令在完成所要求的数据传输前中止时，设备应过渡到DDMAQI3：Send_status状态。
#### DDMAQI3：Send_status。当设备已经传输了命令所要求的所有数据，或者遇到错误，导致命令在完成所要求数据的传输前中止时，就会进入该状态。
当处于该状态时。
 设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DDMAQI3:1：当FIS传送完毕后，设备应过渡到?
DI0: Device_idle状态。

#### DDMAQI4：释放状态。当设备没有请求的数据可供立即传输时，进入该状态。
当处于该状态时，设备应请求传输层传输一个寄存器FIS，REL位设为1，寄存器内容如命令描述中的
ATA8-ACS标准，并且，如果之前的设置已经启用了总线释放中断，那么就可以使用该标准。
功能命令，中断位设为1。
过渡 DDMAQI4:1：当 FIS 传输完毕后，则设备应过渡到 DI0：Device_idle 状态。
### 11.13 WRITE DMA QUEUED 命令协议 
该类命令的执行包括使用DMA传输将一个或多个数据块从设备传输到主机。该命令的所有数据在命令接收和数据传输之间可以不进行总线释放。该命令可以在传输数据之前进行总线释放。主机应在传输数据前初始化DMA控制器。
当数据传输开始时，请求的所有数据应在没有总线释放的情况下进行传输。
DDMAQO0：DMA-队列_出局
确定是转移还是释放。
1. 准备接受数据 FIS DDMAQO1：Send_DMA_activate 2. 由于错误的命令。 DDMAQO4：Send_status 3. 总线释放 DDMAQO5：释放 
##### DDMAQO1: 
Send_DMA_activate
要求向主机传输DMA激活FIS。
1. 传送DMA Activate FIS。 DDMAQO2:     Receive_data 
DDMAQO2: Receive_data 从传输层接收数据FIS。
1. 收到数据FIS。 DDMAQO3: Prepare_data_buffer     Prepare_data_buffer 
##### DDMAQO3: 
Prepare_data_buffer
准备接收下一个数据FIS。
1. 准备接收。 DDMAQO1：发送DMA_activate 2. 命令完成或因错误而中止。 DDMAQO4：发送DMA_status 
DDMAQO4：Send_status 请求向主机传输寄存器FIS。
1. 发送寄存器 FIS。 DI0: Device_idle 
DDMAQO5：发布请求向主机传输寄存器FIS。
1. 传送寄存器 FIS。 DI0: Device_idle  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### DDMAQO0：DMA_queued_out状态。该状态是在设备收到一个 
WRITE DMA QUEUED命令。
当处于此状态时，设备应确定是否准备好接受主机的请求数据。
过渡DDMAQO0：1：当设备准备好立即接收数据FIS时，设备应过渡到DDMAQO1：Send_DMA_activate状态。
过渡DDMAQO0：2：当设备在完成请求数据的传输之前，遇到了错误，导致命令中止时，设备应过渡至
DDMAQO4：Send_status状态。
过渡DDMAQO0：3。当设备没有准备好立即接收数据FIS时，设备应过渡到DDMAQO5：释放状态。
#### DDMAQO1:Send_DMA_activate。当设备准备好接收来自主机的数据FIS时，就会进入该状态。
当处于该状态时，设备应请求传输层发送一个DMA激活FIS。
过渡DDMAQO1:1：当DMA Activate FIS传输完毕后，设备应过渡到DDMAQO2: Receive_data状态。
#### DDMAQO2:Receive_data。该状态是在设备传送DMA激活FIS时进入的。
激活对主机的FIS。
当处于此状态时，设备应接收来自传输层的请求数据FIS。
过渡DDMAQO2:1：当收到Data FIS后，设备应过渡到DDMAQO3: Prepare_data_buffer状态。
#### DDMAQO3: Prepare_data_buffer。当设备完成接收来自主机的数据FIS时，就会进入该状态。
处于该状态时，设备应准备接收下一个数据FIS。
过渡 DDMAQO3:1：当准备好接收数据 FIS 时，设备应过渡到该状态。
DDMAQO1：发送_DMA_激活状态。
过渡 DDMAQO3:2：当命令所请求的所有数据都已传输完毕，或在完成请求数据的传输前遇到错误导致命令中止时，设备应过渡到DDMAQO4：Send_status状态。
#### DDMAQO4: Send_status。当设备已经传输了命令所要求的所有数据，或者遇到错误，导致命令在完成所要求数据的传输前中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DDMAQO4:1：当FIS已经传输完毕。
 那么设备将过渡到DI0: Device_idle状态。

#### DDMAQO5：释放。当设备不能立即接收到所请求的数据时，就会进入该状态。
当处于该状态时，设备应请求传输层传输一个带以下信息的寄存器FIS。
REL设置为1，寄存器内容与ATA8-ACS标准中的命令说明相同，如果之前的设置功能已经使总线释放中断生效，则
命令，中断位设为1。
过渡DDMAQO5：1。当FIS传输完毕后，设备将转入DI0设备空闲状态。
### 11.14 FPDMA QUEUED命令协议 
本课程包括： a READ FPDMA QUEUED a WRITE FPDMA QUEUED a NCQ QUE MANAGEMENT。
##### DFPDMAQ1: 
AddCommandToQueue
将命令添加到内部设备命令队列中，并进行存储
TAG值。
1. 设备成功入库命令DFPDMAQ2：ClearInterfaceBsy 2.命令畸形DFPDMAQ12：BrokenHost_ ClearBusy。
DFPDMAQ2.ClearInterfaceBsy
ClearInterfaceBsy
传输寄存器FIS，BSY位清零，DRQ位清零，中断位清零，标志着接口准备好接受下一条命令。
1. 寄存器 FIS 传输完成 DI0: Device_idle(设备空闲) 
##### DFPDMAQ3.DataPhaseReadSetup: 
DataPhaseReadSetup
用DMA缓冲器向主机传送DMA设置FIS。
标识符=TAG，D位设为1（方向为设备到主机），中断位清零1。第一方DMA设置 FIS传输完成 DFPDMAQ8：DataXmitRead。
DFPDMAQ4.DataPhasePreWriteSetup 1:
支持并启用DMA设置FIS自动激活选项。
##### DFPDMAQ5: 
DataPhase_
WriteSetup 2. DMA设置 FIS自动激活选项不支持或未启用。
##### DFPDMAQ6: 
DataPhase_
OldWriteSetup 
##### 在附件处进行高速小型化。
#### ATA国际组织 
##### DFPDMAQ5.DataPhase_WriteSetup: 
DataPhase_WriteSetup
用DMA缓冲器向主机传送DMA设置FIS。
Identifier=TAG，D位清零（方向为主机到设备），自动激活位设为1，中断位清零1。DMA设置 FIS传输完成 DFPDMAQ9：DataXmitWrite(数据发送写入) 
##### DFPDMAQ6: 
DataPhase_OldWriteSetup(数据阶段)。
用DMA缓冲器向主机传送DMA设置FIS。
Identifier=TAG，D位清零（方向为主机到设备），自动激活位清零，中断位I清零1。DMA设置 FIS传输完成 DFPDMAQ7：DataPhase_ XmitActivate。
##### DFPDMAQ7: 
DataPhase_XmitActivate
向主机传输DMA激活FIS 1.DMA激活FIS传输完成 DFPDMAQ9：DataXmitWrite。
##### DFPDMAQ8: 
DataXmitRead
向主机传输数据FIS 1.上一个DMA设置FIS的传输次数没有用完，没有遇到错误。
##### DFPDMAQ8．
DFPDMAQ8: DataXmitRead 2. 前一个DMA设置FIS的传输次数已用完，该命令的数据传输没有完成，没有遇到错误^1 DI0: Device_idle 3. 该命令的数据传输完成，没有遇到错误 DI0: Device_idle 4. 发生不可恢复的错误 DI0: Device_idle 5.
注：1.该条件要求支持并启用非零缓冲区偏移量。如果设备在多个活动命令之间切换，并且正在为多个未完成的命令执行部分数据传输，则该过渡也适用。

##### DFPDMAQ9: 
DataXmitWrite
从主机接收数据FIS 1.上一个DMA设置FIS的传输次数没有用完，没有遇到错误。
##### DFPDMAQ7: 
DataPhase_
XmitActivate 2. 上一次DMA设置FIS的传输次数已用完，该命令的数据传输未完成，未遇到错误^1 DI0: Device_idle 3. 该命令的数据传输完成，没有遇到错误 DI0: Device_idle 4. 发生不可恢复的错误 DI0: Device_idle 5.
注：1.该条件要求支持并启用非零缓冲区偏移量。如果设备在多个活动命令之间切换，并且正在为多个未完成的命令执行部分数据传输，则该过渡也适用。
 
DFPDMAQ10: SendStatus发送设置设备位FIS，ERR位清零。
中断位设置为1，ACT字段中的位n设置为1，其中n=?
TAG为自上次状态返回1后完成的每个命令TAG值。设置设备位 FIS传输完成 DI0: Device_idle(设备位) 
DFPDMAQ11：ERROR 停止命令处理和传输 设置设备位 FIS到主机，状态字段中的ERR位设为1，中断位设为1，错误字段中的ATA错误代码设为1，ACT字段中的位清零，任何未完成的排队命令的位清零，任何成功完成的排队命令的位清零，完成通知尚未送达。
1. 设置设备位 FIS传输完成 DFPDMAQ13：WaitforClear。
DFPDMAQ12:
BrokenHost_ClearBusy.
停止命令处理，并将寄存器FIS传送给主机，并使用

 则设备应过渡到DI0：状态字段中的Device_idle staERR位设为1，中断位设为1，BSY位清零，DRQ位清零，错误字段=04h。如果错误条件是由于接收到Unload请求，并且当NCQ命令尚未执行时，设备支持Unload，则设备应卸载/停放磁头。
1. 寄存器FIS传输完成 DFPDMAQ13：WaitforClear（等待清除）。
DFPDMAQ13：WaitforClear 等待主机或者发出命令读取排队错误。
日志或发出SRST 1.READ LOG EXT命令，收到排队错误日志。
##### DFPDMAQ14: 
SendQueue_
CleanACK 2. READ LOG DMA EXT命令，收到排队错误日志^1。

##### DFPDMAQ15．
SendQueue_
CleanACKDMA 3.收到SRST DSR0: Software_reset_ asserted 4.收到任何其他命令 DFPDMAQ12: BrokenHost_ ClearBusy.
注：1.见13.7 
##### DFPDMAQ14: 
发送队列_CleanACK
丢弃待处理设备队列中的所有命令。传送设置
设备位FIS，状态字段ERR清零，错误字段设置为00h，ACT字段=FFFFFFFh，中断位清零。
1. 设置设备位 FIS 传输完成 DPIOI0：PIO_in 
##### DFPDMAQ15。
SendQueue_
CleanACKDMA
丢弃待处理设备队列中的所有命令。传送设置
设备位FIS，状态字段ERR清零，错误字段设置为00h，ACT字段=FFFFFFFh，中断位清零。
1. 设置设备位 FIS 传输完成 DDMAI0：DMA_in  
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### DFPDMAQ1：AddCommandToQueue。当设备检查到该命令并确定为本机队列类型的命令时，进入该状态，而Native
支持并启用命令队列。
在此状态下，设备应检查TAG的有效性，并验证它是否已经分配给一个未完成的命令。如果有效，设备应将该命令追加到其内部命令队列中，并存储新的TAG值。
过渡DFPDMAQ1:1：当设备确定TAG有效，并已将命令添加到其内部命令队列中时，设备应过渡到DFPDMAQ2.ClearInterfaceBusy状态。
ClearInterfaceBusy状态。
过渡DFPDMAQ1:2：当设备确定接收到的命令是畸形的，说明发生了错误，设备应过渡到DFPDMAQ12。
BrokenHost_ClearBusy状态。如果命令的任何参数无效，包括使用与待处理命令的现有TAG值相对应的TAG值，则可认为该命令是畸形的。
#### DFPDMAQ2：ClearInterfaceBusy。当设备将命令添加到内部队列，并准备发送一个寄存器FIS，BSY位清零，DRQ位清零，表示接口已准备好接收下一条命令时，进入该状态。
过渡 DFPDMAQ2:1：当寄存器FIS被传送后，设备应过渡到DI0：Device_idle状态。
#### DFPDMAQ3：DataPhaseReadSetup。当器件确定已经准备好为之前排队的READ FPDMA QUEUED命令传输数据时，就会进入该状态。
当处于该状态时，设备应向主机传输一个DMA Setup FIS，DMA缓冲区标识符设置为排队的TAG值，方向位设置为1（主机内存写入）。
过渡DFPDMAQ3:1：当设备完成DMA设置FIS的传输后，设备应过渡到DFPDMAQ8：DataXmitRead状态。
#### DFPDMAQ4：DataPhasePreWriteSetup。当设备确定已经准备好接收之前排队的WRITE FPDMA QUEUED命令的数据时，就会进入该状态。
处于该状态时，设备应确定是否支持并启用DMA Setup Auto-Activate选项，然后进行适当的状态转换。
过渡DFPDMAQ4:1：如果启用了DMA Setup FIS Auto-Activate选项，设备应过渡到DFPDMAQ5：DataPhase_WriteSetup状态。
过渡 DFPDMAQ4:2：如果不支持或不启用 DMA Setup FIS Auto-Activate 选项，设备应过渡到 DFPDMAQ6: DataPhase_OldWriteSetup 状态。
#### DFPDMAQ5: DataPhase_WriteSetup。该状态是在设备准备就绪时进入的。
自动激活并接收之前排队的WRITE FPDMA QUEUED命令的数据。
当处于此状态时，设备向主机发送DMA设置FIS，DMA缓冲区标识符设置为排队的TAG值，方向位清零（主机内存读取），Auto-Activate位设置为1。

过渡DFPDMAQ5:1。当设备完成DMA设置FIS的传输后，设备应过渡到DFPDMAQ9：DataXmitWrite状态。
#### DFPDMAQ6：DataPhase_OldWriteSetup。当设备准备接收之前排队的WRITE FPDMA QUEUED命令的数据，且设备不支持Auto-Activate，或未启用时，进入该状态。
当处于此状态时。
 器件向主机传输DMA设置FIS，DMA缓冲区标识符设置为排队的TAG值，方向位清零（主机内存读取），自动激活位清零。
过渡DFPDMAQ6:1：当设备完成DMA设置FIS的传输后，设备应过渡到DFPDMAQ7：DataPhase_XmitActivate状态。
#### DFPDMAQ7：DataPhaseXmit_Activate。该状态是在设备完成WRITE FPDMA QUEUED命令的DMA Setup FIS传输后，或设备完成接收WRITE FPDMA QUEUED命令的Data FIS后，且传输次数未用尽时进入。
当处于此状态时，设备向主机发送DMA激活FIS，表示准备好接收主机的数据FIS。
过渡DFPDMAQ7:1：当设备完成DMA激活FIS的传输后，设备向主机发送DMA激活FIS，表示准备好从主机接收数据FIS。
FIS，设备应过渡到DFPDMAQ9：DataXmitWrite状态。
#### DFPDMAQ8：DataXmitRead。该状态是在器件完成READ FPDMA QUEUED命令的DMA Setup FIS传输后进入的。
处于该状态时，设备向主机传输数据FIS。
过渡DFPDMAQ8:1：如果前一个DMA Setup FIS的传输次数没有用完，也没有遇到错误，则设备保持在DFPDMAQ8：DataXmitRead状态。
过渡DFPDMAQ8:2：如果前一个DMA Setup FIS的传输计数用尽，且该命令的数据传输没有完成，也没有遇到错误，则设备应过渡到DI0：Device_idle状态。
此条件要求支持并启用非零缓冲区偏移量。如果设备在多条活动命令之间切换，并且正在为多条未完成的命令进行部分数据传输，则该过渡也适用于此情况
过渡DFPDMAQ8:3：如果设备已经完成了该命令的数据传输，并且没有遇到错误，设备应过渡到DI0：Device_idle状态。
过渡DFPDMAQ8:4：如果设备确定发生了不可恢复的错误，设备应过渡到DI0：Device_idle状态。
#### DFPDMAQ9：DataXmitWrite。该状态是在器件完成WRITE FPDMA QUEUED命令的DMA Setup FIS传输后进入的。
当处于该状态时，设备收到来自主机的数据FIS。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
过渡DFPDMAQ9:1：数据FIS接收完成后，如果前一个DMA Setup FIS的传输次数没有用完，也没有遇到错误，设备应过渡到DFPDMAQ7：DataPhase_XmitActivate状态。
过渡DFPDMAQ9:2：如果前一个DMA Setup FIS的传输次数已用完，且该命令的数据传输没有完成，也没有遇到错误，设备应过渡到DI0：Device_idle状态。
此条件要求支持并启用非零缓冲区偏移量。如果设备在多条活动命令之间切换，并且正在为多条未完成的命令进行部分数据传输，则该过渡也适用于此情况
过渡DFPDMAQ9:3：如果设备已经完成了该命令的数据传输，并且没有遇到错误，设备应过渡到DI0：Device_idle状态。
过渡DFPDMAQ9:4：如果设备确定发生了不可恢复的错误，设备应过渡到DI0：Device_idle状态。
#### DFPDMAQ10: SendStatus。当该命令或聚合命令的数据传输完成，设备准备发送状态时，进入该状态。
当处于该状态时，设备向主机发送设置设备位FIS，ERR位清零，中断位设为1，ACT字段中的位n设为1，其中n=每个命令的TAG值。
自上次状态返回后完成的TAG值。
过渡DFPDMAQ10:1：当设备完成设置设备位的传输时
FIS，设备应过渡到DI0：Device_idle状态。
#### DFPDMAQ11：ERROR：当设备遇到不可恢复的错误时，进入该状态。
当处于该状态时，设备停止命令处理，并向主机传送一个设置设备位的FIS，其中ERR位设置为1，中断位设置为1，错误字段中设置ATA错误代码，ACT字段中的位清零，对于任何未完成的排队命令(包括错误命令)，位设置为1，对于任何成功完成的排队命令，尚未向主机提供完成通知。
过渡DFPDMAQ11:1：当设备完成了设置设备位的传输时。
FIS，设备应过渡到DFPDMAQ13: WaitforClear状态。
#### DFPDMAQ12：BrokenHost_ClearBusy。当设备收到 READ FPDMA QUEUED 或 WRITE FPDMA QUEUED 命令时，或当收到的命令不是 READ FPDMA 命令时，进入该状态。

QUEUED；而不是WRITE FPDMA QUEUED；也不是DEVICE RESET；并且有本机排队的命令尚未执行。
当处于这种状态时，设备停止命令处理，并向主机传送寄存器FIS，状态字段中ERR设为1，中断位设为1，BSY位清零，DRQ位清零，错误字段中设置ATA错误代码。如果错误条件是由于接收到Unload请求，并且当NCQ命令未完成时，设备支持Unload，则设备应卸载/停放磁头。
过渡DFPDMAQ12:1：当设备完成寄存器FIS的传输时，设备应过渡到DFPDMAQ13：WaitforClear状态。

#### DFPDMAQ13：WaitforClear：当设备向主机传输了错误FIS，并在等待读取队列错误日志的命令（见13.7）或软复位时，进入该状态。任何其他命令都会返回寄存器-设备到主机FIS，状态字段中的ERR位设为1。
过渡DFPDMAQ13:1：如果设备接收到READ LOG EXT命令，以读取
队列错误日志，设备应过渡到DFPDMAQ14：SendQueue_CleanACK状态。
过渡DFPDMAQ13:2：如果设备接收到READ LOG DMA EXT命令，要读取
队列错误日志，IDENTIFY DEVICE字76位15设置为1，设备应过渡到DFPDMAQ15：SendQueue_CleanACKDMA状态。
过渡DFPDMAQ13:3。如果设备接收到SRST，设备应过渡到DFPDMAQ13:3状态。
DSR0：软件复位状态。
过渡DFPDMAQ13：4。如果设备收到任何其他命令，设备应过渡到DFPDMAQ12: BrokenHost_ClearBusy状态。
#### DFPDMAQ14：SendQueue_CleanACK：当主机对读取队列错误日志的命令作出错误FIS响应后，进入该状态。
设备应丢弃待处理队列中的所有命令，并传送一个设置设备位的FIS，状态字段中的ERR位清零，错误字段设置为00h，ACT字段=FFFFFFFh，中断位清零。
过渡DFPDMAQ14:1：当Set Device Bits FIS传输完成后，器件应过渡到DPIOI0：PIO_in状态。
#### DFPDMAQ15：SendQueue_CleanACKDMA：当主机响应错误FIS到读取队列错误日志的命令时，进入该状态。
设备应丢弃待处理队列中的所有命令，并传送一个设置设备位的FIS，状态字段中的ERR位清零，错误字段设置为00h，ACT字段=FFFFFFFh，中断位清零。
过渡DFPDMAQ14:1：当设置设备位FIS传输完成后，设备应过渡到DDMAI0：DMA_in状态。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
## 12 主机命令层协议 ...........................................................................................

### 12.1 FPDMA QUEUED 命令协议 
这个高级状态机描述了主机对Native Command的行为。
排队命令协议。状态机所描述的主机行为可以由主机软件和/或主机硬件提供，状态机的意图不是表明任何特定的实现。
该类包括  READ FPDMA QUEUED WRITE FPDMA QUEUED NCQ QUE MANAGEMENT（读取FPDMA QUEUED）。
HFPI0：空闲1。释放TAG位置和命令，等待分配TAG。
##### HFPDMAQ2．
预置ACTBit 2. 命令中指定的TAG等待发出，BSY位清零，而不是第一方DMA数据阶段。
##### HFPDMAQ3．
IssueCommand3. 从设备接收到的中断。 HFPDMAQ4: DeviceINT 4.默认值 HFPI0: Idle(空闲)
注意：1.如果有一个以上的条件为真，主机可以应用供应商特定的优先级。
##### HFPDMAQ1: 
AddCommandToQueue
将命令添加到内部主机命令队列1。无条件HFPI0：空闲。
##### HFPDMAQ2: 
预设ACTBit
将空闲的TAG值分配给命令。写入SActive寄存器，其值的位被设置在与分配的TAG值1相对应的位位置。分配给命令的TAG值和SActive寄存器写入新的TAG位掩码HFPI0：空闲。
##### HFPDMAQ3: 
IssueCommand
如果不是第一方DMA数据阶段，用新的命令和分配的TAG值向设备传输寄存器FIS 1. 寄存器 FIS 传输完成（命令已发出） HFPI0：Idle 2. 寄存器 FIS 传输延迟（命令未发出） HFPI0：空闲 2.
##### HFPDMAQ4: 
DeviceINT
读取状态寄存器，清除挂起的中断标志，并将值保存为SavedStatus1。无条件HFPDMAQ5：CompleteRequests1。 
##### HFPDMAQ5: 
CompleteRequests1
将SActive寄存器与上次中断时存储的SActive寄存器进行比较，以识别已完成的命令 1.SActive比较表明一个或多个命令已完成。
##### HFPDMAQ6．
CompleteRequests2 2. SActive比较表明没有命令被完成 
##### HFPDMAQ7: 
CompleteRequests3
##### HFPDMAQ6: 
CompleteRequests2
撤销与SActive寄存器中新清除的位对应的TAG值相关的主机请求，并更新存储的
新值为1的SActive。无条件 HFPDMAQ7: CompleteRequests3 
##### HFPDMAQ7: 
CompleteRequests3
测试SavedStatus值中的ERR位 1. ERR位清零 HFPI0：Idle 2. ERR设置为1 HFPDMAQ8：复位队列。
##### HFPDMAQ8: 
ResetQueue
发出命令读取排队错误日志到设备1。READ LOG EXT 命令被接受 HFPDMAQ9: CleanupACK 2. READ LOG DMA EXT 命令被接受 HFPDMAQ12: RetrieveRequest_ SenseDMA 3.命令未被接受 HFPDMAQ8: ResetQueue 3. 
##### HFPDMAQ9。
CleanupACK
等待DRQ位设置为1，BSY位清零^1 1. DRQ位设置为1，BSY位清零HFPDMAQ10。    HFPDMAQ10: RetrieveRequest_ Sense 2. DRQ位清零或BSY位清1 HFPDMAQ9: CleanupACK_Sense 3.
注：1.主机可以使用任何方式等待此条件，包括等待中断和检查DRQ位和BSY位状态、旋转或周期性定时器。

##### HFPDMAQ10: 
RetrieveRequest_Sense
接收PIO数据FIS与排队错误日志内容 1. PIO数据FIS接收完成 HFPDMAQ11：ErrorFlush(错误刷新)。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
##### HFPDMAQ11: 
ErrorFlush
撤销失败的排队命令，状态设置为设备报告的错误条件。清空所有已分配的本地排队命令标签。从主机命令队列中刷新具有系统特定错误条件的待处理本地队列命令，或重新发布待处理队列命令。
 无条件的HFPI0：空闲。
##### HFPDMAQ12: 
RetrieveRequest_
SenseDMA
接收数据FIS与排队错误日志内容 1. 数据FIS接收完成 HFPDMAQ13：SendStatus(发送状态) 
HFPDMAQ11:
ErrorFlush
请求向主机传输寄存器FIS 1. 传送寄存器FIS HFPDMAQ11：ErrorFlush(错误刷新) 
#### HFPI0：空闲状态。当处于该状态时，如果支持并启用了队列，则命令层正在等待来自上层协议的READ FPDMA QUEUED、WRITE FPDMA QUEUED或NCQ QUEUE MANAGEMENT命令，或等待来自设备的中断，表明先前排队的命令已经完成，或等待一个TAG位置对命令队列中等待的命令可用。
过渡 HFPI0:1：如果 READ FPDMA QUEUED、WRITE FPDMA QUEUED 或 NCQ QUE
MANAGEMENT命令待定，尚未分配到TAG值，而有一个空闲的TAG位置可供分配，则应过渡到HFPDMAQ2。
PresetACTBit状态。
过渡HFPI0:2：如果一个已分配TAG值的命令正在等待向设备发出，并且有一个空闲的TAG位置可供分配，则应过渡到HFPDMAQ2：预置ACTBit状态。
BSY位清零，且接口不在第一方DMA数据阶段，则应过渡到HFPDMAQ3：IssueCommand状态。
过渡HFPI0:3：如果从设备上接收到一个中断，表示之前排队的命令有状态，则应过渡到HFPDMAQ4：DeviceINT状态。
过渡 HFPI0:4：如果支持并启用了队列，而命令层正在等待一个空闲的TAG、一个新的命令或一个先前排队的命令的中断，则应过渡到HFPI0：Idle状态。
#### HFPDMAQ1：AddCommandToQueue。当命令层收到READ FPDMA QUEUED、WRITE FPDMA QUEUED或NCQ QUE时，就会进入该状态
上层协议的management命令，并将其添加到内部主机命令队列中。
过渡HFPDMAQ1:1：命令层将命令添加到内部主机命令队列后，应过渡到HFPI0：Idle状态。
#### HFPDMAQ2：PresetACTBit：当处于该状态时，命令层为之前排队的命令分配一个空闲的TAG值，并在SActive寄存器中写入与分配的TAG值对应的位位置。
过渡 HFPDMAQ2:1：命令层分配TAG值并将相应的位写入SActive寄存器后，应过渡到HFPI0：Idle状态。

#### HFPDMAQ3：IssueCommand。当处于该状态时，如果接口状态允许，命令层试图向设备发出一个带有预分配TAG的命令，向设备传送一个带有新命令和分配TAG值的寄存器FIS。
过渡HFPDMAQ3:1：命令层传送寄存器FIS后，应将相应的命令标记为已发出，并过渡到HFPI0：Idle状态。
过渡HFPDMAQ3:2：命令层推迟传输寄存器FIS后，应将相应的命令标记为发出，并过渡到HFPI0：空闲状态。
FIS由于接口状态不允许发送，应过渡到HFPI0：Idle状态。相应的命令仍视为未发出。
#### HFPDMAQ4：DeviceINT：当处于该状态时，命令层读取设备状态。
寄存器，以重置待定中断标志，并将该值保存为SavedStatus。
过渡HFPDMAQ4:1：命令层读取设备状态寄存器后。
 它将过渡到HFPDMAQ5: CompleteRequests1状态。
#### HFPDMAQ5：CompleteRequests1。当处于该状态时，命令层将SActive寄存器与上次中断产生的SavedStatus SActive寄存器值进行比较，以识别已完成的命令。
过渡HFPDMAQ5:1：如果SActive比较表明一个或多个命令已经完成，则应过渡到HFPDMAQ6：CompleteRequests2状态。
过渡 HFPDMAQ5:2：如果 SActive 比较表明没有命令完成，则应过渡到 HFPDMAQ7: CompleteRequests3 状态。
#### HFPDMAQ6：CompleteRequests2。当处于该状态时，命令层将其内部主机命令队列中与SActive寄存器中新清除的位对应的TAG值相关联的命令清退，并以新值更新存储的SActive寄存器。
过渡HFPDMAQ6:1：更新存储的SActive值后，应过渡到?
HFPDMAQ7：CompleteRequests3状态。
#### HFPDMAQ7: CompleteRequests3。当处于该状态时，应用层会测试 
SavedStatus值中的ERR位来决定队列是应该被维持还是被复位。
过渡HFPDMAQ7:1：如果SavedStatus值ERR位清零，则队列被维持，它应过渡到HFPI0：空闲状态。
过渡 HFPDMAQ7:2：如果SavedStatus值ERR位设置为1，则设备已报错，命令层应过渡到HFPDMAQ8：ResetQueue状态。
#### HFPDMAQ8：ResetQueue。当处于该状态时，应用层发出命令，向设备读取队列错误日志（见13.7）。
过渡HFPDMAQ8:1：READ LOG EXT命令被接受后，应过渡到HFPDMAQ9：CleanupACK状态。
过渡 HFPDMAQ8:2：在READ LOG DMA EXT命令被接受后，应过渡到HFPDMAQ12：RetrieveRequest_SenseDMA状态。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### ATA国际组织 
过渡 HFPDMAQ8:3：如果命令未被接受，主机应过渡到该命令。
HPFDMAQ8：ResetQueue状态。
#### HFPDMAQ9：CleanupACK：当处于该状态时，命令层会测试设备是否处于 
DRQ位设置为1，BSY位清零，为PIO数据FIS传输做准备。
过渡HFPDMAQ9:1：如果DRQ位设为1，BSY位清零，应过渡到HFPDMAQ10。ReceiveRequestSense状态。
过渡 HFPDMAQ9:2：如果DRQ位被清零或BSY位被置1，则应过渡到HFPDMAQ9：CleanupACK状态。
#### HFPDMAQ10: RetrieveRequest_Sense。当处于该状态时，命令层完成检索队列错误日志内容的PIO数据FIS。
过渡HFPDMAQ10:1：在完成PIO数据FIS后，应过渡到?
HFPDMAQ11：ErrorFlush状态。
#### HFPDMAQ11：ErrorFlush状态。当处于该状态时，命令层将失败的排队命令清退，错误状态设置为设备报告的错误条件。它刷新所有已分配的本机排队命令标签，并从主机命令队列中刷新带有系统特定错误条件的待处理本机命令，或重新发布待处理的排队命令。
过渡HFPDMAQ11：1：错误刷新动作完成后，应过渡到HFPI0：Idle状态。
#### HFPDMAQ12：RetrieveRequest_SenseDMA：当设备已准备好向主机传输包含队列错误日志内容的数据FIS时，进入该状态。
当处于该状态时，设备应请求传输层传输一个包含数据的数据FIS。设备命令层应要求数据FIS大小不超过2048 Dwords 。
过渡 HFPDMAQ13:1：当 FIS 传输完毕后，设备应过渡到?
HFPDMAQ13：SendStatus状态。
#### HFPDMAQ13：SendStatus状态。当设备已经传输了命令所要求的所有数据，或者遇到错误，导致命令在完成所要求的数据传输前中止时，就会进入该状态。
当处于该状态时，设备应要求传输层传输一个寄存器FIS，其寄存器内容如ATA8-ACS标准中的命令说明和
中断位设置为1。
过渡DDMAI2:1：当FIS传输完毕后，设备应过渡到?
HFPDMAQ11: ErrorFlush状态。
 
##### HFPDMAQ11：ErrorFlush状态。
序号 ATA国际组织
串行ATA修订版3.0 - 黄金版
## 13 应用层 ................................................................................................................

### 13.1 并行ATA仿真................................................................................................。

模拟主机BIOS或软件驱动程序所感知的并行ATA设备行为，是设备和串行ATA主机适配器硬件之间的合作努力。裝置的行為

命令和控制块寄存器、PIO和DMA数据传输、复位和中断都是仿真的。
主适配器包含一组寄存器，这些寄存器对传统设备寄存器的内容进行影子处理，称为影子寄存器块。所有串行ATA设备的行为都与设备0设备一样。设备应忽略接收到的寄存器-主机到设备的设备字段中的DEV位。
FIS，主机适配卡有责任将寄存器--主机--FIS的传输进行门控。
根据DEV位的值，适当地对设备进行设备FIS。
复位或开机后，主机总线适配器在设备发现期间模拟传统ATA系统的行为。复位后，主机适配器应立即将7Fh的值放在它的
影子状态寄存器，并应将值FFh置于所有其他影子命令块寄存器中（数据寄存器中的FFFh）。在此状态下，主机总线适配器不得接受对影子命令块寄存器的写入。当Phy检测到有附加设备存在时，主机总线适配器应将值FFh或80h置于Shadow状态寄存器中，主机总线适配器现在应允许对Shadow命令块寄存器进行写入。如果有设备存在，Phy应以不超过10毫秒的时间来表示它已检测到设备的存在，并在Shadow状态寄存器中把BSY位设置为1。将值80h置于
推荐使用Shadow Status寄存器，因为它提供了最高级别的BIOS兼容性。
请注意，当影子状态寄存器中的BSY位被设置为1时，该寄存器中的所有其他位都具有不确定的值。当连接的设备与主机总线适配器建立通信时，应向主机发送一个寄存器--设备到主机的FIS，结果为
影子命令块寄存器被更新为适合附加设备的值。
BIOS和系统软件编写人员应该意识到接口在确定设备存在时可能产生的10毫秒延迟，并确保在初始化后不早于10毫秒读取影子状态寄存器，或者确保在读取7Fh值后10毫秒重新读取影子状态寄存器，以确定设备的存在。
主控适配器可以向主机软件呈现一个仅有Master的仿真，即每个设备都是一个
设备0，并且每个设备0以不同的一组主机总线地址被访问。主机适配卡可选择向主机软件呈现主/从仿真，即两个独立的串行ATA端口上的两个设备在主机软件中表示为设备0和设备1，以同一组主机总线地址访问。
#### 13.1.1 软件复位 
根据ATA/ATAPI-6标准，发出软件复位是通过拨动ATA/ATAPI-6标准中的 "S "键来实现的。
设备控制寄存器中的SRST位。规定切换周期不短于5us。由于设备控制寄存器中的SRST位发生变化，串行ATA主机适配器应至少向设备发出两个寄存器--主机到设备FIS(一个是SRST位设置为1，另一个是SRST位清零的后续FIS)。参见10.3.4节，了解寄存器-主机到设备FIS的详细定义。虽然要求主机软件切换SRST位的速度不超过5us，但设备不能依靠接收到的Register - Host to Device FIS的互达时间也满足这个定时。由于流控制、帧握手和其他协议互锁，设备可能会有效地背靠背地接收所产生的Register - Host to Device FISes。

由于流控制、协议互锁、电源管理状态或其他传输延迟，在软件复位期间将SRST位清零的后续Register - Host to Device FIS传输可能会在前一个Register - Host to Device FIS传输完成之前被触发。主机适配器需要允许主机软件以ATA/ATAPI-6标准中规定的最小5us时间来切换SRST位，即使帧传输延迟导致第一次寄存器FIS传输时间超过5us。要求主机适配器确保将产生的两个寄存器--主机到设备FIS传输到设备，而不考虑每个单独FIS的传输延迟。
#### 13.1.2 纯主站模拟 
注意：与本规范的其余部分不同，本节基于ATA/ATAPI-5标准。
本机串行ATA主机适配器的行为与连接传统模式下只有主设备而没有从设备的情况相同。主机适配器有责任与主机软件正确交互，并为这种类型的配置提供正确的行为。因此，所有Serial ATA设备都不需要意识到主/从设备的问题，并忽略处理辅助设备的传统模式任务文件信息。
 当设备寄存器中的DEV位被设置为1，选择了不存在的设备1时，主机适配器应按照ATA/ATAPI-5标准中的定义，对没有设备1存在的设备0的寄存器读写作出响应。这包括当设备1被选中时，如ATA/ATAPI-5标准中所述，不将影子状态寄存器中的BSY位设置为1。当选择设备0时，主机适配器应执行后面章节中定义的用于管理影子状态寄存器内容的串行ATA协议。
当设备0被选中，并且命令寄存器被写入影子寄存器块中时，主机适配器在其影子状态寄存器中把BSY位设置为1。然后，主机适配卡向设备传送一个包含新寄存器内容的寄存器--主机到设备FIS。
当在影子寄存器块中写入设备控制寄存器，并改变SRST位的状态时，主机适配卡在其影子状态寄存器中设置BSY位为1，并向包含新寄存器内容的设备传输一个寄存器--主机到设备FIS。
当设备控制寄存器被写入任何不是SRST位状态变化的值时，传输寄存器内容时，不得将影子状态寄存器中的BSY位设置为1，向包含新寄存器内容的设备传输一帧是可选的。
同样，主机适配器将其影子状态寄存器中的BSY位设置为1，当一个
要求COMRESET或设备控制寄存器中的SRST位被置1。从而保留了将BSY位设置为1的预期时机。
设备通过发送一个 "影子寄存器 "来更新主机适配器影子寄存器块的内容。
寄存器--设备到主机FIS。这允许设备在完成命令或控制请求时，在主机适配器影子寄存器块中设置适当的结束状态。增加了特定的支持，以确保状态寄存器中DRQ和BSY位在PIO传输中的正确时序。
最后，主机适配器通过在主机适配器中提供一个中断待定标志与设备合作。当设备向主机适配器发送寄存器--设备到寄存器时，该标志由主机适配器设置。
主机FIS，中断位设为1。主机适配器在中断待定标志被设置的任何时候都会向主机处理器断言中断，影子中的DEV位被清零。
设备寄存器，影子设备控制寄存器中的nIEN位被清零。主机适配器在任何时候请求COMRESET时都会清除中断待定标志，影子设备控制寄存器中的SRST位被设置为1，影子命令寄存器中的
DEV位清零，或者读取影子状态寄存器时DEV位清零。这样可以模拟主机中断及其正确的时间。

##### 高速串行化 ATTACHMENT(高速串行化) 
#### ATA国际组织 
#### 13.1.3 主/从仿真（可选）。
注意：与本规范的其余部分不同，本节基于ATA/ATAPI-5标准。
所有设备的行为都与设备0一样。然而，主机适配器可以通过将两个串行ATA端口配对，并相应地管理其相关的影子寄存器，来选择性地实现对主/从配置行为的模拟，就像它们是设备0一样。
设备0和设备1在同一组主机总线地址上。
仿真主/从行为的主机适配器应根据影子寄存器中DEV位的值来管理两套影子寄存器（两个设备各一套）。
设备寄存器。根据DEV位的值，主机适配卡应引导对设备寄存器的访问。
影子寄存器块寄存器，以及对控制块寄存器的访问，到正确设备中的适当影子寄存器集。主适配器有责任确保正确处理与一个或两个附加设备的通信，并确保信息被正确地路由到设备。每个设备应处理与主机适配器的任何通信，就像它是针对该设备的一样，无论DEV位的值是多少。
如果一个主机适配器正在模拟主/从行为，并且没有设备连接到指定为设备1的电缆上，主机适配器应模拟设备0的行为，没有
按照ATA/ATAPI-5标准所述，设备1存在。
**13.1.3.1 软件复位**。
仿真主/从行为的主机适配器应仿真软件复位的正确行为。基于Phy初始化状态，主机适配器知道主/从仿真配置中使用的两个端口中的每个端口是否连接了一个设备。设备控制寄存器的写入，如果SRST位被设置为1，则会导致相关的影子设备控制寄存器被写入每个连接设备的端口。
 执行每个关联端口的帧传输协议，结果是向每个连接设备发送一个寄存器--主机到设备FIS。同样，随后对影子设备控制寄存器的写，将SRST位清零，应导致一个寄存器--主机到设备FIS被发送到每个连接设备。然后，主机适配器应等待每个附加设备的响应(或超时)，并根据ATA/ATAPI-5标准合并附加设备的Error和Status寄存器的内容，以产生主机软件可见的Error和Status寄存器值。
**13.1.3.2 执行设备诊断**。
仿真主/从行为的主机适配器应仿真EXECUTE的正确行为
DEVICE DIAGNOSTICS。主机适配卡应检测写入命令寄存器的EXECUTE DEVICE DIAGNOSTIC命令。检测EXECUTE DEVICE
DIAGNOSTICS命令应导致为每个连接设备的端口写入相关的影子寄存器。执行每个关联端口的帧传输协议，结果是将一个寄存器--主机到设备的FIS传送给每个连接设备。
然后，主机适配器应等待每个连接设备的响应（或超时），并根据ATA/ATAPI-5标准，合并连接设备的Error和Status寄存器的内容，以产生主机软件可见的Error和Status寄存器值。
**13.1.3.3 限制和约束**。
在主/从仿真模式下，可能不支持串行ATA特有的、并行ATA不支持的超集功能。这些功能包括但不限于支持第一方DMA、热插拔、接口电源管理以及超集状态和控制寄存器。只有在使用为并行 ATA 编写的软件，且连接的设备数量超过软件支持的 Shadow Command Block 寄存器接口数量的配置中，才建议使用主/从仿真模式。
**13.1.3.4 影子命令块寄存器访问限制**。
主机软件应采取措施，确保对Command的访问限制。
块寄存器（见ATA/ATAPI-5）在访问影子命令块寄存器时要注意，以避免不确定行为。其中一些措施包括：a)在写入影子命令块寄存器以发出新命令之前，主机软件应检查影子状态寄存器，以验证BSY和DRQ位是否都被清零。
b) 如果DRQ位在软件期望清零时被设置为1（例如当ERR位被设置为1时），主机软件应在写入影子命令寄存器以发出新命令之前执行错误恢复操作（例如向设备发出软件复位）。
注意：在BSY位和/或DRQ位设置为1时，通过将设备控制寄存器中的SRST位设置为1来发出软件复位，是串行ATA状态机中描述的合法行为，完成软件复位可以确保设备和接口处于已知状态。
ATA/ATAPI-5标准定义了对命令块寄存器的写入限制。
除DEVICE RESET命令外，当BSY位或DRQ位设为1时，禁止写入影子命令寄存器。串行ATA的访问限制与并行ATA的访问限制不同。
ATA，其中对命令寄存器的类似访问是不确定的。然而，在某些串行ATA实现中，由此产生的不确定行为可能不像某些并行ATA实现中那样良性。这是因为在串行ATA中，影子命令块寄存器是在主机和设备之间合作管理的，而定义的协调是基于BSY和DRQ位的值。
并行ATA和串行ATA行为可能不同的一个例子是，当设备在PIO读操作中把（影子）状态寄存器中的DRQ和ERR位都设置为1。在并行ATA中，许多设备实现允许软件在不从设备传输数据的情况下发出新命令。在串行ATA中，在不传输数据的情况下发出新命令可能会导致挂起的情况。在串行ATA中，当DRQ位被设置为1时，有一个相关的数据FIS正在串行ATA接口上传输。在主机从影子数据寄存器中读取相关数据完成数据FIS传输之前，数据FIS的传输是由主机完成的。
数据FIS保持在接口上，处于HOLDP/ HOLDAP流控制状态。当数据FIS在接口上保持在HOLDP/ HOLDAP流控制状态时，数据
FIS仍在接口上，不能向设备发出新的命令。
**13.1.3.5 并行ATA互操作性状态图**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
该状态图定义了主机适配器的协议，以模拟主机BIOS或软件驱动程序中仅有的并行ATA设备。
 中断挂起标志(IPF)是主机适配器中的一个内部状态位，它反映了设备是否对主机有中断挂起。
HA0：HA_SEL/NOINTRQ 中断信号未对主机进行断言。
1. 主机请求COMRESET。 HA_SEL/NOINTRQ 2. 主机写入设备控制寄存器，SRST位清零，（nIEN位设为1或IPF位设为1）。

##### HA_SEL/NOINTRQ 3.主机写入的设备控制寄存器，SRST位清零，(nIEN位清零，IPF位设为1)。

##### HA_SEL/INTRQ 4.主机写入的设备控制寄存器，SRST位被设为1。

##### HA_SEL/NOINTRQ 5.主机写入的命令寄存器。 HA_SEL/NOINTRQ 6.主机写入的设备控制寄存器，其中DEST位设为1。由主机写入的设备寄存器，DEV 位设置为 1。

##### HA_NOTSEL 7. 主机读写的任何其他寄存器 HA_SEL/NOINTRQ 8. 传输层表示设备新的寄存器内容，IPF位清零。

##### HA_SEL/NOINTRQ 9.传输层表示来自设备的新寄存器内容，IPF位清零。传输层表示来自设备的新的寄存器内容，IPF位设置为1，nIEN位设置为1。

##### HA_SEL/NOINTRQ 10.传输层表示来自设备的新寄存器内容，IPF位设为1，nIEN位设为1。传输层表示来自设备的新的寄存器内容，IPF位设置为1，nIEN位清零。

##### HA_SEL/INTRQ 
HA1：HA_SEL/INTRQ 中断信号被断定给主机。
1. 主机请求COMRESET。 HA_SEL/NOINTRQ 2. 主机写入设备控制寄存器，SRST位清零，（nIEN位设为1或IPF位清零）。

##### HA_SEL/NOINTRQ 3.主机写入的设备控制寄存器，SRST位清零，（nIEN位清零，IPF位设为1）。

##### HA_SEL/INTRQ 4.主机写入的设备控制寄存器，SRST位被设为1。

##### HA_SEL/NOINTRQ 5.主机写入的命令寄存器。 HA_SEL/NOINTRQ 6.主机写入的设备控制寄存器，其中DEST位设为1。由主机写入的设备寄存器，DEV 位设置为 1。

##### HA_NOTSEL 7. 由主机读取的状态寄存器 HA_SEL/NOINTRQ 8. 任何其他由主机写入的寄存器 HA_SEL/INTRQ 9. 主机读取的任何其他寄存器 HA_SEL/INTRQ 10. 传输层表示设备的新寄存器内容。

##### HA_SEL/INTRQ  
HA2：HA_NOTSEL 中断信号未对主机进行断言。
1. 主机请求COMRESET。 HA_SEL/NOINTRQ 2.主机写入设备控制寄存器，SRST位清零。主机写入设备控制寄存器，SRST位清零。

##### HA_NOTSEL 3.主机写入的设备控制寄存器，SRST位清零。由主机写入的设备控制寄存器，SRST 位被设置为 1。

##### HA_SEL/NOINTRQ 4.主机写入的命令寄存器，命令不是EXECUTE DEVICE DIAGNOSTIC。

##### HA_NOTSEL 5.主机用EXECUTE DEVICE DIAGNOSTIC命令写入的命令寄存器。

##### HA_SEL/NOINTRQ 6.主机用命令EXECUTE DEVICE DIAGNOSTIC写入的设备寄存器。主机写入的设备寄存器，DEV位清零，（nIEN位设为1或IPF位清零）。

##### HA_SEL/NOINTRQ 7. 由主机写入的设备寄存器，DEV位清零，（nIEN位清零，IPF位设为1）。

##### HA_SEL/INTRQ 8. 任何其他由主机写入的寄存器 HA_NOTSEL 9.由主机读取状态或备用状态寄存器。

##### HA_NOTSEL 10. 主机读取任何其他寄存器。 HA_NOTSEL 11. 传输层表示从设备中读取新的寄存器内容。

##### HA_NOTSEL 
#### HA0：HA_SEL/NOINTRQ状态。当选择了设备0，并且选择了以下两种情况时，就会进入该状态。
IPF位被清零或nIEN位被置1。
当处于此状态时，对主机的中断信号不得被断言。
过渡HA0：1：当主机请求COMRESET时，主机适配器应将影子状态寄存器中的BSY位置1，将IPF位清零，通知链路层有总线
COMRESET被断言，并使之过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA0:2：当主机写入设备控制寄存器时，SRST位清零，且nIEN位设为1或IPF位清零时，主机适配器应告知
传输层发送一个寄存器--主机到设备的FIS，C位清零，并带有当前影子寄存器的内容，并向HA0：HA_SEL/NOINTRQ状态进行过渡。
过渡HA0：3。当主机写入设备控制寄存器，SRST位清零，nIEN位清零，IPF位设为1时，主机适配卡应通知主机：HA_SEL/NOINTRQ状态。
传输层发送一个寄存器--主机到设备的FIS，C位清零，并将影子寄存器的当前内容清零，并做一个过渡到HA1：HA_SEL/INTRQ状态。
过渡HA0：4：当主机写入设备控制寄存器，SRST位设为1时，主机适配器应将影子状态寄存器中的BSY位设为1，将IPF位清为0。
 通知传输层发送一个寄存器--主机到设备的FIS，C位清零，并将影子寄存器的当前内容清零，并向HA0.HA_SEL/NOINTRQ状态过渡。
HA_SEL/NOINTRQ状态。
过渡HA0：5。当主机写入命令寄存器时，主机适配器应设置
影子状态寄存器中的BSY位为1，清除IPF位为0，通知传输层发送带有影子寄存器当前内容的C位为1的寄存器--主机到设备FIS，并使其过渡到HA0：HA_SEL/NOINTRQ状态。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### ATA国际组织 
过渡HA0：6。当主机在DEV位为1的情况下写入设备寄存器时，主机适配卡应过渡到HA2：HA_NOTSEL状态。
过渡HA0:7。当主机对任何寄存器进行读写时，主机适配卡应过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA0:8。当传输层从设备上指示新的寄存器内容时，用
IPF位清零，主机适配器应将新的寄存器内容放入影子寄存器中，并过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA0：9。当传输层指示来自设备的新的寄存器内容时，用
IPF位设为1，nIEN位设为1，主机适配器应将IPF位设为1，将新的寄存器内容放入影子寄存器中，并过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA0:10：当传输层指示设备的新寄存器内容与
IPF位置1，nIEN位清零，主机适配器应将IPF位置1，将新的寄存器内容放入影子寄存器中，并向HA1过渡。
HA1: HA_SEL/INTRQ状态。
#### HA1：HA_SEL/INTRQ状态。该状态是当设备0被选中，nIEN位被清零，IPF位被置1。
当处于该状态时，对主机的中断信号应被断言。
过渡HA1:1：当主机请求COMRESET时，主机适配器应将影子状态寄存器中的BSY位置1，清除IPF位为0，通知链路层有总线
COMRESET asserted，并使之过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA1:2：当主机写入设备控制寄存器，SRST位清零，nIEN位设为1或IPF位清零时，主机适配卡应通知到
传输层发送一个寄存器--主机到设备FIS，C位清零，并将当前影子寄存器的内容清零，并做一个过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA1:3：当主机写入设备控制寄存器，SRST位清零，nIEN位清零，IPF位设为1时，主机适配器应告知
传输层发送一个寄存器--主机到设备的FIS，C位清零，并带有当前影子寄存器的内容，并向HA1：HA_SEL/INTRQ状态进行过渡。
过渡HA1：4。当主机在SRST位为1的情况下写入设备控制寄存器时，主机适配器应将影子状态寄存器中的BSY位设为1，将IPF位清零，通知传输层发送一个寄存器--主机到设备的FIS，C位清零，内容为当前影子寄存器的内容，并过渡到HA0:
HA_SEL/NOINTRQ状态。
过渡HA1：5。当主机写入命令寄存器时，主机适配器应设置
影子状态寄存器中的BSY位为1，清除IPF位为0，通知传输层发送带有影子寄存器当前内容的C位为1的寄存器--主机到设备FIS，并过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA1：6。当主机在DEV位为1的情况下写入设备寄存器时，主机适配器应过渡到HA2：HA_NOTSEL状态。
过渡HA1:7。当主机读取状态寄存器时，主机适配卡应将IPF位清零并过渡到HA0：HA_SEL/NOINTRQ状态。

过渡HA1：8。当主机写入上述以外的任何寄存器时，主机适配卡应过渡到HA1：HA_SEL/INTRQ状态。
过渡HA1:9。当主机读取上述以外的任何寄存器时，主机适配卡应过渡到HA1: HA_SEL/INTRQ状态。
过渡HA1:10：当传输层指示来自设备的新寄存器内容时，主机适配器应将新的寄存器内容放入影子寄存器中，并向HA1：HA_SEL/INTRQ状态过渡。
#### HA2：HA_NOTSEL状态。当选择设备1时进入该状态。

当处于该状态时，不得对主机的中断信号进行断言。
过渡HA2：1：当主机请求COMRESET时，主机适配器应将影子状态寄存器中的BSY位置1。
 通知传输层发送一个寄存器--主机到设备的FIS，C位清零与影子设备寄存器中的curr清DEV位清零，将IPF位清零，通知链路层有总线COMRESET被断言，并过渡到HA0：SEL/NOINTRQ状态。
过渡HA2：2。当主机写入设备控制寄存器，SRST位清零时，主机适配器应通知传输层发送一个寄存器--主机到设备FIS，C位清零，内容为当前影子寄存器的内容，并过渡到HA2：HA_NOTSEL状态。
过渡HA2：3。当主机在SRST位为1的情况下写入设备控制寄存器时，主机适配卡应将影子状态寄存器中的BSY位设为1，将影子设备寄存器中的DEV位清为0，将IPF位清为0，通知传输层发送一个寄存器--主机到设备FIS，C位清为0，并与当前影子寄存器的内容一起过渡到HA2：HA_NOTSEL状态。
- 主机到设备的FIS，C位清零，影子寄存器的当前内容，并向HA0：HA_ SEL/NOINTRQ状态做过渡。

过渡HA2：4。当主机用除EXECUTE DEVICE DIAGNOSTIC以外的任何命令代码写入命令寄存器时，主机适配卡不应设置BSY位。
影子状态寄存器，并应过渡到HA2：HA_NOTSEL状态。
过渡HA2：5。当主机用EXECUTE命令写入命令寄存器时，应将其转换为HA2: HA_NOTSEL状态。
DEVICE DIAGNOSTIC命令代码，主机适配器应将Shadow中的BSY位设为1。
状态寄存器，将设备寄存器中DEV位清零，将IPF位清零，通知
传输层发送一个寄存器--主机到设备的FIS，C位设为1，并带有当前影子寄存器的内容，并做一个过渡到HA0：HA_SEL/INTRQ状态。
过渡HA2：6。当主机写入Device寄存器，DEV位清零，nIEN位设为1或IPF位清零时，主机适配卡应过渡到HA0：HA_SEL/NOINTRQ状态。
过渡HA2：7。当主机在DEV位清零、nIEN位清零、IPF位设为1的情况下写入设备寄存器时，主机适配卡应过渡到HA0：HA_SEL/NOINTRQ状态。
HA1：HA_SEL/INTRQ状态。
过渡HA2：8。当主机写入上述以外的任何寄存器时，主机适配器应过渡到HA2: HA_NOTSEL状态。
过渡HA2:9。当主机读取状态或备用状态寄存器时，主机应将寄存器内容00h返回给主机，并过渡到HA2：HA_NOTSEL状态。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
过渡HA2:10：当主机读取除上述以外的任何寄存器时，主机适配器应将当前的影子寄存器内容返回给主机，并过渡到HA2：HA_NOTSEL状态。
过渡HA2:11：当传输层指示来自设备的新的寄存器内容时，主机适配器应将新的寄存器内容放入影子寄存器中，并过渡到HA2：HA_NOTSEL状态。
### 13.2 IDENTIFY(PACKET)DEVICE(设备识别) 
在IDENTIFY DEVICE命令中，各种参数都是由设备传达给主机的。下面的章节定义了那些不同于和添加到
ATA8-ACS数据内容的标准定义。串行ATA特性和功能包括可以确定其存在和支持的手段，以及在可选支持的情况下启用它们的手段。
IDENTIFY(PACKET)DEVICE设置要求应通过原生Serial?
ATA设备。IDENTIFY (PACKET) DEVICE 设置要求对于并行设备来说是可选的。
连接外部串行ATA桥的ATA设备。
#### 13.2.1 IDENTIFY DEVICE(识别设备) 
## 表75 -- -- 识别设备信息。
字O/M F/V 0-46 按ATA8-ACS中的指示设置 47 M 多重计数
F
R
##### 15-8 
##### 7-0 80h 00h = 保留 01h-10h = READ/RITE MULTIPLE 命令时每次中断应传输的最大扇区数 11h-FFh = 保留 48 按 ATA8-ACS 中的指示设置 49 M 能力。
F
F
##### 15-12 
##### 11 
##### 10 
##### 9-0 
按ATA8-ACS中所示设置
应设置为1
应设置为1
按ATA8-ACS 50-52中的说明设置 按ATA8-ACS 53中的说明设置 M 现场有效性
R
F
F
F
##### 15-3 
##### 2 
##### 1 
##### 0 
保留 1=字88中报告的字段有效 0=字88中报告的字段无效 1=字(70:64)中报告的字段有效 0=字(70:64)中报告的字段无效。
过时 54-62 按ATA8-ACS中的说明设置 63 M 多字DMA传输
F
F
F
##### 15-3 
##### 2 
##### 1 
##### 0 
按ATA8-ACS中的指示进行设置 1=支持多字DMA模式2及以下 1=支持多字DMA模式1及以下 1=支持多字DMA模式0。
字O/M F/V 64 M支持的PIO传输模式
F
##### 15-2 
##### 1-0 
按ATA8-ACS中所示设置

支持PIO模式3和4 65 M 每个字的最小多字DMA传输周期时间
F 15-0 周期时间（纳秒） 66 M 制造商推荐的多字DMA传输周期时间
F 15-0 周期时间（纳秒） 67 M 在没有流量控制的情况下，最小的PIO传输周期时间。
F 15-0 循环时间（纳秒） 68 M 在 IORDY 流量控制下的最小 PIO 传输循环时间。
F 15-0 周期时间（纳秒） 69-74 按ATA8-ACS中的指示设置 75 O 队列深度
R 15-5 保留
F 4-0 最大队列深度 - 1 76 O 串行 ATA 功能。
F 15 支持READ LOG DMA EXT与READ等同。
LOG EXT
F 14 支持设备自动部分转换为休眠状态
F 13 支持主机自动部分进入休眠状态的转换。
F 12 支持本地命令队列优先级信息
F 11 在NCQ命令未完成时，支持卸载。
F 10 支持Phy事件计数器
F 9 支持接收主机发起的接口电源管理请求。
F 8 支持本地命令队列
R 7-4 保留给未来的串行 ATA 信令速度等级。
F 3 1 = 支持串行ATA Gen3信号传输速度（6.0 Gbps）。
F 2 1 = 支持串行ATA Gen2信号传输速度（3.0 Gbps）。
F 1 1 = 支持串行ATA Gen1信号传输速度（1.5 Gbps）。
F 0 应清零 77 O 串行 ATA 附加功能
R 15-6 保留
F 5 支持 NCQ 队列管理命令
F 4支持NCQ流
V 3-1 表示当前协商的串行ATA信号速度的编码值。
F 0 应被清零 78 O 支持的串行 ATA 特性
R 15-7 保留
F 6 1 = 支持软件设置保存
R 5 保留
F 4 1 = 支持订单内数据传输
F 3 1 = 设备支持启动接口电源管理。
F 2 1 = 支持 DMA 设置 自动激活优化。
F 1 1 = 在DMA设置FIS中支持非零缓冲区偏移。
F 0 将被清零 79 O 启用串行 ATA 功能。
R 15-8 保留
V 7 1 = 启用设备自动部分休眠转换。
V 6 1 = 启用软件设置保存。
R 5 保留
V 4 1 = 启用订单内数据传送。
##### 在附件处进行高速小型化。
#### ATA国际组织 
Word O/M F/V
V 3 1 = 启用设备启动接口电源管理。
V 2 1 = 启用 DMA 设置自动激活优化。
V 1 1 = 启用DMA设置FIS中的非零缓冲区偏移量。
F 0 应清零 8 0-87 按 ATA8-ACS 88 中的指示设置。
F F F F F F F
##### 15-6 
##### 5 4 3 2 1 0 
按ATA8-ACS中所示设置 1=Ultra DMA模式5及以下支持 1=Ultra DMA模式4及以下支持 1=Ultra DMA模式3及以下支持 1=Ultra DMA模式2及以下支持 1=Ultra DMA模式1及以下支持 1=Ultra DMA模式0支持 89-92 按ATA8-ACS中所示设置 93 V COMRESET结果。该字的内容应清零。
94-221 按ATA8-ACS 222中的指示设置。
##### F F F F F F F F 
传输主要修订版0000h或FFFh=设备不报告版本。
位 描述 15:12 传输类型 0h = 平行 1h = 串行 2h - Fh = 保留 11:6 保留 5 SATA Rev 3.0 4 SATA Rev 2.6 3 SATA Rev 2.5 2 SATA II: 扩展 1 SATA 1.0a 0 ATA8-AST 223 F 传输小版本 224-255 按 ATA8-ACS 中的指示设置
关键。
M = 支持这个词是强制性的。
O = 对该词的支持是可选的。
F = 字词的内容是固定的，不会改变。对于可移动介质设备，当介质被移除或改变时，这些值可能会改变。
V = 字的内容是可变的，可能根据设备的状态或设备执行的命令而改变。
X = 字的内容是特定于厂商的，可能是固定的，也可能是可变的。
R = 字的内容是保留的，应为零。
**13.2.1.1 字0 - 46：按ATA8-ACS**中的指示设置 **13.2.1.2 字47：多字PIO传输**。
字47的第15至8位应按ATA8-ACS中的指示设置。

字段7至0用于指示READ/WRITE MULTIPLE命令中每次中断应传输的最大扇区数。该字段应设置为16或更少。参见 10.3.10.1 节。
**13.2.1.3 字48：按ATA8-ACS中的指示设置** **13.2.1.4 字49：能力** **13.2.1.3 字48：按ATA8-ACS中的指示设置。
字49的第15至12位应按ATA8-ACS中的指示设置。
字49的第11位用于确定设备是否支持IORDY。该位应设置为1，表示设备支持IORDY操作。
字49的第10位用于指示设备启用或禁用IORDY的使用。该位应设置为1，表示设备支持禁用IORDY。禁用和启用IORDY是通过SET FEATURES命令来完成的。
字49的第9-0位应按ATA8-ACS中的指示设置。
**13.2.1.5 字50 - 52：按ATA8-ACS中的指示设置** **13.2.1.6 字53：字段有效性**。
字0应设置为1。字53的位1应设置为1，字64至70中报告的值有效。任何支持PIO模式3以上的设备，或支持多字DMA模式1以上的设备。
 应将字53的位1设置为1，并支持字64至70中包含的字段。字53的第2位应设置为1，表示设备支持Ultra DMA，字88中报告的值有效。字15-3为保留位。
**13.2.1.7 字54-62：按ATA8-ACS中的指示设置** **13.2.1.8 字63：多字DMA传输**。
字63的第2-0位应设置为1，表示设备支持多字DMA模式0、1和2。字15-3应按ATA8-ACS中的指示设置。
**13.2.1.9 字64：支持的PIO传输模式**。
字64的第1-0位应设置为1，表示设备支持PIO模式3和4。
第15-2位应按ATA8-ACS中的指示设置。
**13.2.1.10 字 65：每个字的最小多字 DMA 传输周期时间**。
应设置为表示120 ns。
**13.2.1.11 字66：设备推荐的多字DMA周期时间**。
应设置为表示 120 ns。
**13.2.1.12 字67: 无流量控制的最小PIO传输周期时间**。
应设置为表示120 ns。

##### 在附件处的高速小型化。
#### 串行ATA国际组织 **13.2.1.13 字68：IORDY最小PIO传输周期时间**。
应设置为表示120 ns。
**13.2.1.14 字69-74。按ATA8-ACS** **13.2.1.15字75: 队列深度** 
这个词在ATA8-ACS标准中是这样定义的。本机命令排队协议最多支持32条排队命令。在使用本地命令队列时，主机应只对排队命令发出唯一的标签值，其值小于或等于该字段所反映的值（例如，对于设备在该字段中报告的值为15，对应最多16条未执行的命令，主机在发出本地命令队列命令时，绝不使用大于15的标签值）。
**13.2.1.16 字76：串行ATA能力**。
如果不是 0000h 或 FFFFh，则设备声称符合串行 ATA 规范，并支持位 1-3 中指示的信号传输速度。由于串行ATA支持代际兼容性，因此可以设置多个位。比特0是保留位，应清零（因此，Serial ATA是一个Serial ATA规范）。
ATA设备在此字段中至少有一个位被清除，至少有一个位被设置，提供清晰的区分）。) 如果该字段不是0000h或FFFFh，则字段77至79应有效。如果该字段为0000h或FFFFh，则设备不声称符合串行ATA规范，并且...。
字词76至79无效，应予以忽略。
位0应清零。
当位1设置为1时，表示设备是串行ATA设备，支持1.5 Gbps的Gen1信令速度。
当位2设置为1时，表示该设备是串行ATA设备，并支持3.0 Gbps的Gen2信令速度。
當位 3 設定為 1 時，表示裝置為 Serial ATA 裝置，並支援 6.0 Gbps 的 Gen3 信令速度。
位4-7为未来的Serial ATA信令速度等级保留，应清零。
位8当设置为1时，表示Serial ATA设备支持Native Command（本地命令）。
13.6节中定义的排队方案。
当位9设置为1时，表示当主机启动时，串行ATA设备支持Partial和Slumber接口电源管理状态。
当位10设置为1时，表示Serial ATA设备支持Phy事件计数器。如果设备支持Phy事件计数器，则应支持Phy事件计数器日志（见13.9.3）。
当位11被设置为1时，表示设备支持在NCQ命令尚未执行时，在接收到IDLE IMMEDIATE命令并指定卸载功能后，执行磁头的卸载/停放。只有当设备支持字76的第8位所示的NCQ时，该位才会被设置为1。
当位12设置为1时，表示设备支持READ FPDMA中的优先级字段。
QUEUED和WRITE FPDMA QUEUED命令，并根据这些信息进行优化。
只有当设备支持NCQ时，该位才应置1，如字76的第8位所示。

位13表示设备支持主机自动部分到沉睡的转换。设备应容忍Partial退出延迟，最高可达最大Slumber退出延迟。这允许主机异步地从Partial过渡到Slumber。
如果字76，位9（支持接收主机发起的接口电源管理请求）被清零，那么位13应被清零。
位14表示设备支持自动部分到休眠过渡，启用后可异步从部分到休眠过渡。
如果字78，位3（支持启动接口电源管理）被清零，那么字76位14应被清零。
当位15设为1时，表示在所有情况下都可以使用READ LOG DMA EXT和READ LOG EXT命令，结果相同（见13.7）。如果IDENTIFY DEVICE字119位3被清零，则该位应被清零。
 如果位15被清零，并且主机发出READ LOG DMA EXT命令来读取队列错误日志或Phy事件
计数器日志，设备应返回命令中止。
**13.2.1.17 Word 77: 串行ATA附加功能** 
字77报告设备支持的其他可选功能。对该字的支持是可选的，如果不支持，该字应为零，表示设备不支持额外的串行ATA功能。
位0应被清零
1-3位是一个编码值，表示设备当前正在进行通信的串行ATA Phy速度。表76定义了这些值。
编码值
位 3 位 2 位 1 说明 0 0 0 未报告信令速度 0 0 1 Gen1 信令速度为 1.5 Gbps 0 1 0 Gen2 信令速度为 3.0 Gbps 0 1 1 Gen3 信令速度为 6.0 Gbps。
所有非定义值保留给未来的串行ATA信号传输速度。
## 表76 - 经协商的串行ATA信令速度的编码值。
注意：如果系统配置在数据路径中拥有多个 Phy 链接（例如，端口乘法器），则指示的速度仅与设备 Phy 和其直接主机 Phy 之间的链接相关。数据路径中的每个链路都有可能协商不同的串行ATA信令速度。
位4，当设置为1时，表示设备支持NCQ流。请参阅 READ FPDMA QUEUED 和 WRITE FPDMA QUEUED 命令对 ICC 字段的使用。只有当设备支持NCQ时，该位才应设置为1，如字76的第8位所示。
位5，当设置为1时，表示设备支持主机使用NCQ QUE管理命令。只有当设备支持字76的第8位所示的NCQ时，该位才应置1。
位6-15为保留位，应清零 **13.2.1.18 字78：支持的串行ATA功能**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
字78报告设备支持的可选功能。对该字的支持是可选的，如果不支持，该字应为0，表示设备不支持新的串行通信功能。
ATA能力。
位0应清零。
位1表示设备是否支持在DMA设置中使用非零缓冲区偏移量。
FIS。当设置为1时，设备支持传输和接收FIS的缓冲区偏移字段中的非零值的DMA设置FIS。当清零时，设备仅支持在缓冲区偏移字段清零的情况下传输和接收DMA设置FIS。
位2表示设备是否支持使用10.3.8.3.1节所述的DMA Setup FIS自动激活优化。当设置为1时，设备支持使用DMA设置FIS自动激活优化。
自动激活优化，当清零时，设备不支持自动激活。
激活优化。
位3表示设备是否支持向主机发起电源管理请求。
当设置为1时，设备支持发起接口电源管理请求，当清零时，设备不支持发起电源管理请求。如字76的第9位的定义所述，设备可以支持接收主机发起的电源管理请求，而不支持发起该位所指示的这种电源管理请求。
位4表示当在DMA设置FIS中使用非零缓冲区偏移量时，设备是否支持有保证的顺序数据传送。当设置为1时，当多个DMA Setup FIS使用非零缓冲区偏移时，设备保证READ FPDMA QUEUED或WRITE FPDMA QUEUED命令的顺序数据交付。目标数据按顺序传送，从第一个LBA开始到命令完成。当位4被清零时，当启用非零缓冲区偏移时，器件不保证按顺序传送数据。在这种情况下，数据可能会在一个命令内和多个命令之间交错。默认情况下，该字段为零。
位5是保留的，应清零。
位 6 表示设备是否支持第 13.5 节中定义的软件设置保存。当设置为1时，设备支持跨COMRESET的软件设置保存。
当清零时，当发生COMRESET时，设备将清除所有软件设置。
位7-15为保留位，应清零 **13.2.1.19 字79: 启用串行ATA功能**。
字79报告设备支持的哪些可选功能被启用。如果支持可选字78，则应支持该字，如果不支持可选字78，则不支持该字。
位0应清零。
位1表示是否启用了设备对DMA设置FIS中使用非零缓冲区偏移量的支持。当设置为1时，设备传输DMA设置FIS中的非零缓冲区偏移值。
启用FIS的缓冲区偏移字段。当清除为零时，允许设备发送

DMA设置FIS仅在Buffer Offset字段清零的情况下进行。默认情况下，该字段为零。
位2表示设备是否支持使用10.3.8.3.1节所述的DMA Setup FIS自动激活优化。当设置为 "1 "时，设备可以利用 "自动激活 "优化功能，如10.3.8.3.1所述。
激活优化。当清除为零时，设备将不使用自动激活优化。默认情况下，该字段为零。
位3表示设备是否支持向主机发起电源管理请求。当设置为1时，设备可启动电源管理过渡请求。当清零时，设备不得向主机发起接口电源管理请求。
该字段默认为零。
位4表示当DMA设置FIS中使用非零缓冲区偏移量时，设备是否支持有保证的顺序内数据传输被启用。当设置为1且启用了非零缓冲偏移时，设备可以通过传输多个具有非零缓冲偏移值的DMA Setup FIS来满足READ FPDMA QUEUED或WRITE FPDMA QUEUED命令的要求，但前提是目标数据从第一个LBA开始一直到命令完成，按顺序传送。当位4被清零时，如果启用了非零缓冲区偏移，设备可以使用非零缓冲区偏移在一条命令和多条命令中交错传输数据。默认情况下，该字段为零。
位5为保留，应清零。
位6表示设备是否支持软件设置保存。当设置为1时，设备将在COMRESET期间保存软件设置。当清零时，设备将在COMRESET发生时清除软件设置。如果设备支持软件设置保存，则该字段默认为1。如果设备不支持软件设置保存，则该字段默认为0。
位7表示是否启用了设备自动部分到休眠的转换。当启用时，设备可以异步地从Partial过渡到Slumber。如果字76，位14（支持设备自动部分到休眠过渡）被清零，那么位7应被清零。如果字79，位3（设备启动接口电源管理启用）被清零，那么位7应被清零。
8-15位为保留位，应清零。
**13.2.1.20字80-87。按ATA8-ACS中的指示设置** **13.2.1.21 字88：超DMA模式**。
字88的第5-0位应设置为1，表示设备支持Ultra DMA模式0、1、2、3、4和5。字15-5应按ATA8-ACS中的指示设置。
**13.2.1.22 字89 - 92：按ATA8-ACS中的指示设置** **13.2.1.23 字93：硬件配置测试结果**。
字93应设置为0000h，表示不支持该字。
**字94-221：按ATA8-ACS中的指示设置**13.2.1.25字222：运输主要修订**。
(15:12)位应设置为 1h。
**13.2.1.26 字223: 运输小修** 
按ATA8-ACS中的说明设置。

##### 高速 SERIALIZED ATTACHMENT(附件)。
#### 序号 ATA国际组织 **13.2.1.27字224-255: 按ATA8-ACS.**中所示设置。
#### 13.2.2 IDENTIFY PACKET DEVICE(识别包装设备) 
## 表77--识别包件设备信息。
字O/M F/V 0-48 按ATA8-ACS 49 M能力中的说明设置。
F
F
##### 15-12 
##### 11 
##### 10 
##### 9-0 
按ATA8-ACS中所示设置
应设置为1
应设置为1
按ATA8-ACS 50-52中的说明设置 按ATA8-ACS 53中的说明设置 M 现场有效性
R
F
F
F
##### 15-3 
##### 2 
##### 1 
##### 0 
保留 1=字88中报告的字段有效 0=字88中报告的字段无效 1=字(70:64)中报告的字段有效 0=字(70:64)中报告的字段无效。
过时 54-62 按ATA8-ACS中的说明设置 63 M 多字DMA传输
F
F
F
##### 15-3 
##### 2 
##### 1 
##### 0 
按ATA8-ACS中的指示设置 1= 支持多字DMA模式2及以下 1= 支持多字DMA模式1及以下 1= 支持多字DMA模式0 64 M PIO传输模式支持
F
##### 15-2 
##### 1-0 
按ATA8-ACS中所示设置
支持PIO模式3和4 65 M 每个字的最小多字DMA传输周期时间
F 15-0 周期时间（纳秒） 66 M 制造商推荐的多字DMA传输周期时间
F 15-0 周期时间（纳秒） 67 M 在没有流量控制的情况下，最小的PIO传输周期时间。
F 15-0 循环时间（纳秒） 68 M 在 IORDY 流量控制下的最小 PIO 传输循环时间。
F 15-0 循环时间（纳秒） 69-75 按 ATA8-ACS 中的指示进行设置 76 O 串行 ATA 功能。
F 15 保留
F 14 支持设备自动部分转换为休眠状态
F 13 支持主机自动部分进入休眠状态的转换。
R 12-11 保留
F 10 支持Phy事件计数器
F 9 支持接收主机发起的接口电源管理请求。
F 8 保留

R 7-4 保留给未来的串行 ATA 信令速度等级。
F 3 1 = 支持串行ATA Gen3信号传输速度（6.0 Gbps）。
F 2 1 = 支持串行ATA Gen2信号传输速度（3.0 Gbps）。
F 1 1 = 支持串行ATA Gen1信号传输速度（1.5 Gbps）。
Word O/M F/V
F 0 应清零 77 O 串行 ATA 附加功能
R 15-4 保留
V 3-1 表示当前协商的串行ATA信号速度的编码值。
F 0 应被清零 78 O 支持的串行 ATA 特性
R 15-7 保留
F 6 1 = 支持软件设置保存
F 5 1 = 支持异步通知。
R 4 保留
F 3 1 = 设备支持启动接口电源管理。
F 2-1 保留
F 0 将被清零 79 O 启用串行 ATA 功能。
R 15-7 保留
V 6 1 = 启用软件设置保存。
V 5 1 = 启用异步通知。
R 4 保留
V 3 1 = 启用设备启动接口电源管理。
R 2-1 保留
F 0 应清零 80-87 按 ATA8-ACS 88 中的指示设置。
F F F F F F F
##### 15-6 
##### 5 4 3 2 1 0 
按ATA8-ACS中所示设置 1=Ultra DMA模式5及以下支持 1=Ultra DMA模式4及以下支持 1=Ultra DMA模式3及以下支持 1=Ultra DMA模式2及以下支持 1=Ultra DMA模式1及以下支持 1=Ultra DMA模式0支持 89-92 按ATA8-ACS中所示设置 93 V COMRESET结果。该字的内容应清零。
94-221 按ATA8-ACS 222中的指示设置。
##### F F F F F F F F 
传输主要修订版0000h或FFFh=设备不报告版本。
位 描述 15:12 传输类型 0h = 平行 1h = 串行 2h - Fh = 保留 11:6 保留 5 SATA Rev 3.0 4 SATA Rev 2.6 3 SATA Rev 2.5 2 SATA II: 扩展 1 SATA 1.0a 0 ATA8-AST 223 F 传输小版本 224-255 按 ATA8-ACS 中的指示设置 
##### 在附件处进行高速小型化。
#### ATA国际组织 
关键。
M = 支持这个词是强制性的。
O = 对该词的支持是可选的。
F = 字词的内容是固定的，不会改变。对于可移动介质设备，当介质被移除或改变时，这些值可能会改变。
V = 字的内容是可变的，可能根据设备的状态或设备执行的命令而改变。
X = 字的内容是特定于厂商的，可能是固定的，也可能是可变的。
R = 字的内容是保留的，应为零。
**13.2.2.1 字0 - 48：按ATA8-ACS**所示设置 **13.2.2.2 字49：能力**。
字49的第15至12位应按ATA8-ACS中的指示设置。
字49的第11位用于确定设备是否支持IORDY。该位应设置为1，表示设备支持IORDY操作。
字49的第10位用于指示设备启用或禁用IORDY的使用。该位应设置为1，表示设备支持禁用IORDY。禁用和启用IORDY是通过SET FEATURES命令来完成的。
字49的第9-0位应按ATA8-ACS中的指示设置。
**13.2.2.3 字50 - 52：按ATA8-ACS中的指示设置** **13.2.2.4 字53：字段有效性**。
字0应设置为1。字53的位1应设置为1，字64至70中报告的值有效。任何支持PIO模式3或以上，或支持多字DMA模式1或以上的设备，应将字53的位1设为1，并支持字64至70中包含的字段。字53的第2位应设置为1，表示设备支持Ultra DMA，字88中报告的值有效。字15-3为保留位。
**13.2.2.5 字54-62：按ATA8-ACS中的指示设置** **13.2.2.6 字63：多字DMA传输**。
字63的第2-0位应设置为1，表示设备支持多字DMA模式0、1和2。字15-3应按ATA8-ACS中的指示设置。
**13.2.2.7 字64：支持的PIO传输模式**。
字64的第1-0位应设置为1，表示设备支持PIO模式3和4。
字15-2应按ATA8-ACS中的指示设置。
**13.2.2.8 字65：每个字的最小多字DMA传输周期时间**。
应设置为表示120 ns。
**13.2.2.9 字66：设备推荐的多字DMA周期时间**。
应设置为表示 120 ns。
 **13.2.2.10 字67: 无流量控制的最小PIO传输周期时间**。
应设置为表示 120 ns。
**13.2.2.11 字68：IORDY的最小PIO传输周期时间**。
应设置为表示120 ns。
**13.2.2.12 字69-75：按ATA8-ACS中的指示设置** **13.2.2.13 字76：串行ATA能力**。
字76应具有IDENTIFY DEVICE数据字76所述的内容**13.2.2.14字77: 串行ATA附加功能** 
对该字的支持是可选的，如果不支持，该字应为零，表示设备不支持额外的串行ATA功能。
位0应被清零
位1-3是一个编码值，用来表示当前设备正在进行通信的串行ATA phy速度。
 表76定义了这些值。
注意：如果系统配置在数据路径中拥有多个 Phy 链路（例如，端口乘法器），则指示的速度仅与设备 Phy 和其直接主机 Phy 之间的链路有关。数据路径中的每个链路都有可能协商不同的串行ATA信令速度。
位4-15为保留位，应清零 **13.2.2.15 字78：支持的串行ATA功能**。
字78报告设备支持的可选功能。对该字的支持是可选的，如果不支持，该字应为0，表示设备不支持新的串行通信功能。
ATA能力。
位0应清零。
位1-2为保留位，应清零。
位3表示设备是否支持向主机发起电源管理请求。
当设置为1时，设备支持发起接口电源管理请求，当清零时，设备不支持发起电源管理请求。如字76的第9位定义所述，设备可以支持接收主机发起的电源管理请求，而不支持发起该位所指示的这种电源管理请求。
位4为保留位，应清零。
位5表示设备是否支持异步通知，以指示主机需要注意。当设置为1时，设备支持启动通知事件，当清零时，设备不支持启动通知事件。一个事件的例子 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织，设备可能需要关注的包括介质变化。异步设备通知在第13.8节中描述。
位6表示设备是否支持第13.5节中定义的软件设置保存。当设置为1时，设备支持跨COMRESET的软件设置保存。
当清零时，设备在发生COMRESET时清除所有软件设置。
位7-15为保留位，应清零。
**13.2.2.16 字79: 启用串行ATA功能**。
字79应具有IDENTIFY DEVICE数据字79所述内容。
**13.2.2.17 字80-87。按ATA8-ACS*** **13.2.2.18 字88：超DMA模式**。
字88的第5-0位应设置为1，表示设备支持Ultra DMA模式0、1、2、3、4和5。字15-5应按照ATA8-ACS中的指示进行设置。
**13.2.2.19 字89 - 92：按ATA8-ACS中的指示设置** **13.2.2.20 字93：硬件配置测试结果**。
字93应设置为0000h，表示不支持该字。
**13.2.2.21 字 94-221：按 ATA8-ACS 中的说明设置** **13.2.2.22 字 222：运输主要修订**。
(15:12)位应设置为 1h。
**13.2.2.23 字223: 运输小修** 
按ATA8-ACS中所示设置。
**13.2.2.24字224-255。按ATA8-ACS中的指示进行设置**。
#### 13.2.3 确定对串行ATA功能的支持。
软件应通过读取IDENTIFY (PACKET) DEVICE数据字76-79中的相关位来验证设备的Serial ATA功能。器件通过适当设置IDENTIFY (PACKET) DEVICE字76来宣称符合Serial ATA规范。
虽然Serial ATA最初是在ATA/ATAPI规范材料中引入的，但在《Serial ATA规范》中，它是一个很好的选择。
ATA/ATAPI-7改版时，不能认为Word 80(主要版本号)时的版本号是什么。
IDENTIFY (PACKET) DEVICE数据是在支持ATA/ATAPI-7或更高版本的情况下读取的，该设备支持Serial ATA或任何特定的Serial ATA功能。

### 13.3 SET FEATURES..........................................................................................................

设备被告知主机的功能，并有可选的功能通过以下方式启用/禁用
SET FEATURES命令在ATA8-ACS标准中定义。串行ATA特性使用表78中定义的特性值来控制。
## 表78 - 特性启用/禁用值 
功能(7:0) 值说明 10h 启用串行 ATA 功能 90h 禁用串行 ATA 功能。
Count(7:0)包含要启用或禁用的特定串行ATA功能。表79中定义了适用SET FEATURES的具体串行ATA特性。
## 表79--特性识别值 
计数(7:0) 值说明 00h 保留 01h DMA 设置 FIS 中的非零缓冲区偏移量 02h DMA 设置 FIS 自动激活优化 03h 设备发起的接口电源状态转换 04h 保证有序数据传输 05h 异步通知 06h 软件设置保存 07h 设备自动部分到休眠转换 08h - FFh 为未来串行 ATA 定义保留。
#### 13.3.1 在DMA设置中启用/禁用非零偏移。
01h的Count(7:0)值被主机用来启用或禁用非零缓冲区偏移量的功能。

当设备使用第一方DMA机制时，DMA设置FIS将被禁用（参见13.6.1.2节）。
默认情况下，DMA Setup FIS中的非零缓冲区偏移被禁用。启用 DMA Setup FIS 中的非零缓冲区偏移对于在命令中执行不按顺序的数据传输（例如在数据的前半部分之前传输数据的后半部分），或者支持将大型第一方 DMA 操作分割成多个数据阶段非常有用，即在数据 I/O 期间有效地允许共享 SATA 链接，例如为主机提供传输额外数据的机制。
READ FPDMA QUEUED或WRITE FPDMA QUEUED命令到器件，以便重新排序考虑。DMA Setup FIS中非零偏移量的启用/禁用状态应在软件复位时予以保留。DMA 设置 FIS 中的非零偏移量的启用/禁用状态应在软件复位时予以保留。
当 COMRESET 时，FIS 将被重置为默认状态。
#### 13.3.2 启用/禁用DMA设置FIS自动激活优化...............................。

ACount(7:0)值为02h，主机用于启用或禁用DMA设置FIS优化，以自动激活传输第一个主机到设备的数据FIS后的数据。
DMA设置FIS的主机到设备传输方向。用于从主机到设备的传输。
第一方DMA传输需要一连串的DMA设置FIS和DMA激活FIS来启动传输。自动激活优化允许DMA设置FIS操作意味着立即激活，从而消除了额外的单独DMA激活的需要。
FIS 来启动传输。启用优化会通知设备，主机总线适配器实现允许 DMA Setup FIS 包含自动激活位，以便在收到并处理 DMA Setup FIS 后立即触发传输。默认情况下，该优化被禁用。更多细节请参见10.3.8.3.1节。自动激活位的启用/禁用状态。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织激活优化应在软件复位时予以保留。自动激活优化的启用/禁用状态应在COMRESET时重置为默认状态。
#### 13.3.3 启用/禁用设备启动接口电源状态转换。
数值为03h的Count(7:0)被主机用来启用或禁用设备启动接口电源状态转换。默认情况下，设备不允许通过向主机发出PMREQ_PP或PMREQ_SP来尝试接口电源状态转换。对于设备可能希望尝试启动这种接口电源状态转换的情况，主机可以启用设备启动这种接口电源状态转换。设备启动电源管理的启用/禁用状态应在软件复位后持续存在。在COMRESET时，启用/禁用状态应被重置为默认的禁用状态。
如果启用了设备启动的接口电源管理，则设备不得在复位和交付副复位签名之间尝试启动接口电源状态转换。
#### 13.3.4 启用/禁用有保证的顺序内数据传输。
ACount(7:0)值04h被主机用来在设备利用第一方DMA机制和DMA设置FIS中的非零缓冲区偏移量时，启用或禁用有保证的顺序内数据传输。默认情况下，有保证的顺序内数据传输已被禁用。启用有保证的顺序内数据传输，对于使用 DMA Setup FIS 中的非零缓冲区偏移将大型 I/O 进程分割成多个原子数据阶段非常有用，同时最大限度地降低了无序数据传输可能给主机带来的复杂性。在软件复位时，应保留保证无序数据传输的启用/禁用状态。保证有序数据传输的启用/禁用状态应在以下情况下重置为默认状态： 1.
COMRESET.
#### 13.3.5 启用/禁用异步通知..........................................................。

主机使用05h的Count(7:0)值来启用或禁用异步通知。默认情况下，异步通知被禁用。主机可以启用异步通知，以便允许设备在没有主机轮询的情况下请求关注。例如，这可能有助于避免对ATAPI设备中的媒体更改事件进行轮询。异步通知的启用/禁用状态应在软件复位时予以保留。异步通知的启用/禁用状态应在 COMRESET 时重置为默认状态。
#### 13.3.6 启用/禁用软件设置的保存。
计数(7:0)值06h被主机用来启用或禁用软件设置保存，如第13.5节所定义。默认情况下，如果设备支持软件设置保存，则该功能在开机时启用。软件设置保存的启用/禁用状态应在软件复位后持续存在。
 软件设置保存的启用/禁用状态应在COMRESET时重置为默认状态。主机可以禁用软件设置保存，以便在 COMRESET 时不保存软件设置（并使 COMRESET 相当于并行 ATA 的硬件复位）。
#### 13.3.7 启用/禁用设备自动部分到休眠的转换 
计数器(7:0)的值07h被主机用来启用或禁用设备自动部分到。
休眠转换。默认情况下，如果设备支持设备自动部分到休眠转换，则该功能在开机时被禁用。设备自动进入休眠状态的启用/禁用状态。
在软件复位后，部分进入休眠状态将持续存在。启用/禁用状态为
自动部分休眠转换应在COMRESET时重置为默认状态。
如果设备启动了接口，则不应启用设备自动部分休眠转换。
电源状态转换被禁用。当设备启动接口电源状态转换被禁用时，试图启用自动部分到休眠转换，将导致设备放弃设置功能命令。试图禁用设备自动偏移到休眠状态转换，会导致设备放弃设置功能命令。
当已经被禁用时，沉睡转换不会有任何影响，设备应返回成功完成设置功能命令。
### 13.4 设备配置覆盖......................................................................................

#### 13.4.1 Device Configuration Overlay Identify(设备配置叠加) 
图202定义了使用ATA8-ACS标准中的DEVICE CONFIGURATION IDENTIFY命令可以控制支持的其他特性和功能。只有在设备报告支持设备的情况下，设备才需要支持设置这些功能。
分别在IDENTIFY DEVICE或IDENTIFY PACKET DEVICE中配置覆盖。
字描述 0-7 如ATA8-ACS标准中所定义的 8 串行ATA命令/支持的功能集 15-7 保留 (0) 6 1 =报告支持NCQ QUE MANAGEMENT^1是允许的是可以改变的 5 1 =报告支持自动部分到沉睡的转换是可以改变的 4 1 =报告支持软件设置保存是可以改变的 3 1 =报告支持异步通知是可以改变的 2 1 =报告支持接口电源管理是可以改变的 1 1 =报告支持DMA中的非零缓冲区偏移量
设置 FIS 1 可更改 0 1 = 报告对本地命令队列的支持^1 可更改 9 串行 ATA 10-255 保留 如 ATA8-ACS 标准中所定义的那样
注：1.仅适用于非PACKET设备--即IDENTIFY DEVICE。

## 图202 -设备配置IDENTIFY数据结构。
WORD 8：支持的串行ATA命令/功能集
这个词描述了哪些功能的支持是可以改变的。一个功能可以被支持，但不能改变。如果字8的第0位被设置为1，那么对Native的支持就为1。
命令队列是可以改变的。该位的设置仅适用于非PACKET设备。
如果字8的第1位被设置为1，那么在DMA设置中支持非零缓冲区偏移。
FIS是可以改变的。该位的设置仅适用于非PACKET设备。
如果字8的第2位被设置为1，那么支持接收主机发起的电源管理请求和/或发送设备发起的电源管理请求是可以改变的。
如果字8的第3位被设置为1，那么对异步通知的支持是可以改变的。

##### 高速序列化的附件。
#### ATA国际组织 
如果字8的第4位设置为1，则可更改对软件设置保存的支持。
如果字8的第5位设置为1，则可更改对自动部分到休眠转换的支持。
如果字8的第6位被设置为1，那么对NCQ QUE管理命令的支持是可以改变的。
字7-15位为保留位，应清零。
字9：保留给串行ATA
该字为串行ATA保留，所有位应清零。
#### 13.4.2 设备配置叠加设置 
图203定义了使用ATA8-ACS标准中的DEVICE CONFIGURATION SET命令可以控制支持的其他特性和功能。只有当设备报告支持 "设备配置 "时，设备才需要支持设置这些功能。
分别覆盖在IDENTIFY DEVICE或IDENTIFY PACKET DEVICE中。
字描述 0-7 按照ATA8-ACS标准中的定义 8 支持的串行ATA命令/功能集 15-7 保留 6 1 = 报告对NCQ QUE的支持。
允许使用MANAGEMENT命令^1 5 1 =允许报告支持自动部分到休眠过渡 4 1 =允许报告支持软件设置保存 3 1 =允许报告支持异步通知 2 1 =允许报告支持接口电源管理 1 1 =允许报告支持DMA中的非零缓冲区偏移值

允许设置FIS^1 0 1 = 报告对本地命令队列的支持^1 允许 9 串行ATA 10-255保留 如ATA8-ACS标准中所定义。
注：1.仅适用于非PACKET设备--即IDENTIFY DEVICE。

## 图203 - 设备配置集数据结构 
WORD 8：支持的串行ATA命令/功能集
该字可以实现命令集和功能集的配置。
如果字8的第0位被清零，那么设备应。a) 禁用对本地命令队列的支持； b) 将IDENTIFY DEVICE数据中字76的8、11、12位清零； c) 将IDENTIFY DEVICE数据中字78的1、2、4位清零； d) 将IDENTIFY DEVICE数据中字79的1、2、4位清零。e)如果NCQ被禁用，并向设备发出READ FPDMA QUEUED或WRITE FPDMA QUEUED，则设备应中止该命令，状态字段中的ERR位设为1，错误字段中的ABRT位设为1。
该位的设置仅适用于非PACKET设备。
如果字8的第1位被清零，则设备应a)禁用DMA设置FIS中对非零缓冲区偏移的支持；b)将IDENTIFY DEVICE数据中的字78位1和4清零；c)将IDENTIFY DEVICE数据中的字79位1和4清零；d)如果禁用DMA设置FIS中的非零缓冲区偏移，则设备只能发出DMA缓冲区偏移字段被清零的DMA设置FIS。
该位的设置仅适用于非PACKET设备。
如果字8的第2位被清零，那么设备应。a) 禁用对接收主机发起的电源管理请求的支持，不得支持设备发起的电源管理请求； b) 将IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据的字76位9清零； c) 将IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据的字78位3清零。d)清除字79 IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据的第3位为零；e)如果禁用接口电源管理请求，设备应以PMNAKP响应任何接口电源管理请求，设备不向主机发出PMREQ_PP或PMREQ_SP。
如果字8的第3位被清零，则设备应：a)禁用对异步通知的支持；b)将IDENTIFY PACKET DEVICE数据的字78第5位清零；c)将IDENTIFY PACKET DEVICE数据的字79第5位清零；d)当禁用异步通知时，设备不得发起Set
设备位FIS，通知位设为1。
如果字8的第4位被清零，那么设备应：a)禁用对软件设置保存的支持；b)将字78的IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据的第6位清零；c)将字79的IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据的第6位清零；d)当禁用软件设置保存时，设备不得保存任何通常在COMRESET后清零的软件设置。
如果字8的第5位被清零，则设备应：a)禁用对自动部分到休眠转换的支持；b)清除字76的IDENTIFY DEVICE或IDENTIFY PACKET的第13和14位。
DEVICE数据清零；c)将字79位7的IDENTIFY DEVICE或IDENTIFY PACKET DEVICE数据清零；d)当自动Partial到Slumber过渡被禁用时，设备和主机都不能从Partial过渡到Slumber而不首先进入Active。
如果字8的第5位被设为1，第2位或字8被清零，则设备应返回命令中止。
如果字8的第6位被清零，那么设备应：a)禁用对NCQ QUE管理命令的支持。
##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### 串行ATA国际组织 b)将IDENTIFY DEVICE数据的字77位5清零；c)如果向设备发出NCQ QUE MANAGEMENT命令，设备应返回命令中止。
字8的位(15:7)为保留位，应清零。
字9：保留给串行ATA
此字为串行ATA保留，所有位应清零。
### 13.5 软件设置保存（可选 
当设备被列举时，软件使用SET FEATURES和其他命令对设备进行配置。这些软件设置通常在软件复位时保存，但不一定在COMRESET时保存。在并行ATA中，只有命令式的硬件复位才可能发生，因此传统模式软件只重新编程它所发出的特定类型的复位所清除的设置。在串行ATA中，COMRESET相当于硬件复位，如果出现异步信号丢失，则可能发生非指令性的COMRESET。由于
COMRESET相当于硬件复位，在信号异步丢失的情况下，在没有遗留模式软件知识的情况下，一些软件设置可能会丢失。为了避免在没有遗留模式驱动知识的情况下丢失重要的软件设置。
 软件设置的保存确保了重要软件设置的价值在不同的时间段内保持不变。
COMRESET。可以使用 SET FEATURES 启用或禁用软件设置保存功能，子命令代码为 06h（参见 13.3.6 节）。如果设备支持软件设置保存，则默认启用该功能。
跨 COMRESET 时应保留的软件设置如下。只有当设备支持该设置所关联的特定功能/命令时，才需要保存指定的软件设置。
INITIALIZE DEVICE PARAMETERS：用INITIALIZE建立的设备设置。
DEVICE PARAMETERS命令。该命令在ATA8-ACS标准中已经过时，最后一次定义是在ATA/ATAPI-5标准中。
电源管理功能设置待机定时器：在电源管理功能设置中使用的待机定时器。
管理功能集。
读/写流错误日志。读取流错误日志和写入流错误日志（使用GPL特性集命令访问）。
安全模式状态。由安全模式功能集命令建立的安全模式状态（参考ATA8-ACS标准）。器件不得根据COMRESET过渡到不同的安全模式状态。例如，当有一个COMRESET命令时，设备不得从SEC5：解锁/不冻结状态过渡到SEC4：安全启用/锁定状态。
COMRESET发生时，设备应保持在SEC5：解锁/不冻结状态。
SECURITY FREEZE LOCK（安全冻结锁定）：由 SECURITY FREEZE LOCK（安全冻结锁定）建立的冻结模式设置。
FREEZE LOCK 命令。
SECURITY UNLOCK（安全解锁）：在失败的SECURITY UNLOCK（安全解锁）命令中，解锁计数器会被递减。
试图解锁命令。
SET MAX ADDRESS（EXT）。在 SET MAX ADDRESS 或 SET MAX ADDRESS 中指定的最大 LBA。
MAX ADDRESS EXT.
SET FEATURES（写入缓存启用/禁用）。SET FEATURES 命令建立的写缓存启用/禁用设置，子命令代码为 02h 或 82h。
SET FEATURES（设置传输模式）。PIO、多字和 UDMA 传输模式的设置，由 SET FEATURES 命令建立，子命令代码为 03h。

SET FEATURES（高级电源管理启用/禁用）。由SET FEATURES命令建立的高级电源管理启用/禁用设置，子命令代码为05h或85h。启用/禁用高级电源管理：由SET FEATURES命令建立的高级电源管理级别，子命令代码为05h或85h。
当高级电源管理启用时（SET FEATURES子命令代码05h），Count(7:0)寄存器也将被保留。
SET FEATURES (Read Look-Ahead)。SET FEATURES 命令中子命令代码为 55h 或 AAh 的读取先导功能启用/禁用设置。
SET FEATURES (Release Interrupt)（释放中断）：释放中断的启用/禁用设置。SET FEATURES（释放中断）：由SET FEATURES命令建立的释放中断启用/禁用设置，子命令代码为5Dh或DDh。
SET FEATURES（SERVICE中断）。SET FEATURES（SERVICE中断）：由SET FEATURES命令建立的SERVICE中断启用/禁用设置，子命令代码为5Eh或DEh。
SET FEATURES（恢复到默认值）：通过SET FEATURES命令建立的SERVICE中断启用/禁用设置，子命令代码为5Eh或DEh。SET FEATURES（恢复到默认值）：由SET FEATURES命令建立的恢复到开机默认值的启用/禁用设置，子命令代码为CCh或66h。
SET MULTIPLE MODE（设置多重模式）：用SET MULTIPLE命令建立的块大小。通过SET MULTIPLE MODE命令建立的块大小。
NCQ QUE管理（死机处理）。WDNC和RDNC的状态。
写-读-校验功能集。IDENTIFY DEVICE数据字120位1，字210-211，字220位（7：0）的内容。在处理COMRESET后，设备不得返回到其写-读-验证的出厂默认设置。
#### 13.5.1 温馨重启注意事项(告知性) 
在系统重启过程中，软件设置保存所维护的安全设置可能会引起错误状况。一些系统实现选择通过向设备发送COMRESET来重启系统。当设备启用了软件设置保存时，安全设置保持在解锁/冻结状态(SEC6)。当处于解锁/冻结状态(SEC6)时，系统软件发送带有密码的SECURITY UNLOCK命令会被设备中止。系统软件应执行本节的建议，避免用户输入的密码被中止。
建议系统软件在温态重启时不要提示用户密码。
如果系统软件在温态重启过程中检测到设备处于SEC5状态，则会在
SECURITY FREEZE命令可由系统软件发出，进入解锁/冻结状态。
状态（SEC6）。
SEC状态和SECURITY命令在ATA8-ACS中描述。请注意，这些建议不适用于外部SATA设备。
### 13.6 原生命令队列（可选）。
本节为串行ATA定义了一个简单而精简的命令排队模型。
本机排队定义利用设置设备位FIS中预留的32位字段来传达最多32条未完成命令中每条命令的待处理状态。状态寄存器中的BSY位只传达设备接收另一条命令的准备状态，而不传达排队命令的完成状态。
 收到新的命令后，设备会清空该命令。
BSY位为零，然后继续执行接收到的命令。Set Device Bits FIS中的32个协议特定位被处理成一个32元素的活动命令位数组（称为
ACT位），每条可能的待处理命令都有一个，并且数组是位显性的，这样数组中的位 "n "对应于标签为 "n "的命令的待处理状态。" 
##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
设备返回的数据（或传输给设备的数据），对于排队的命令，使用First?
方DMA机制，使主机控制器选择适当的目标/源内存缓冲区进行传输。用于缓冲区选择的内存句柄与与命令相关联的标记相同。对于传统的桌面主机控制器，该句柄可用于索引到预先构建的散布/收集列表（通常称为物理区域描述表或简单的PRD表）的指针向量中，以便在主机的DMA引擎中建立适当的上下文。第一方DMA数据阶段被定义为从接收到DMA设置FIS到相关传输计数耗尽或影子状态寄存器中的ERR位被设置的期间。在这期间，主机不得向设备发出新的命令，设备也不得向主机发出新命令完成的信号。
对于成功完成的命令，通过更新Set Device Bits FIS中的32元素位数组返回状态。对于失败的命令，设备会停止处理命令，允许主机软件或控制器固件进行干预，并通过使用通用日志功能集来解决失败的源头，然后再明确重启处理。
支持本地命令队列的设备应实现并报告对ATA8-ACS中定义的通用日志功能集的支持。此外，设备应实现排队错误日志。
#### 13.6.1 定义 **13.6.1.1 命令发布机制**。
串行ATA传输协议对为共享的影子命令块寄存器提供写保护的影子状态寄存器中BSY位的状态很敏感。由于
影子命令块寄存器只有在BSY位清零时才能安全写入，应遵守传输层定义的BSY位约定，只有在BSY位清零时才能尝试发出新命令。当影子状态寄存器中的BSY位被清零时，可以向设备发出另一条命令。
在尝试发出新的排队命令之前，应先检查影子状态寄存器中BSY位的状态，如果BSY位被设置为0，则可以向设备发出另一条命令。如果BSY位被设置为1，则下一条命令的发出应被推迟，直到BSY位被清零。最好是尽量减少这种命令发布延迟，因此设备应及时将BSY位清零。主机控制器可能有内部设计，以减轻主机软件对BSY位的状态进行阻塞的需要。
本机排队命令包括一个标识命令的标签值。标签值的范围是0到31（含），并在命令发出时在寄存器--主机到设备FIS中传达。对于在其IDENTIFY DEVICE字75中报告值小于31的设备，主机应只发出小于或等于报告值的唯一标签值。
在发出新的本机队列命令时，在命令传送到设备之前，HBA应将SActive寄存器中与所发命令的标签值对应的位设置为1。第14.1.4节描述了SActive寄存器和它的访问约定。
接受命令后，设备在准备接收另一条命令时，应将BSY位清零，向主机发送一个寄存器--设备到主机的FIS，其内容如下： 1.
FIS状态字段中的BSY位被清除，中断位被清除为零。
**13.6.1.2 数据传输机制**。
第一方DMA机制被设备用来传输（或接收）任意排队命令的数据。命令的标签值也应是DMA缓冲区标识符，用于唯一标识传输的源/目的存储器缓冲区。

DMA设置FIS由设备在每次数据传输前选择合适的传输缓冲区。每次传输开始时只需要一个 DMA 设置 FIS，如果传输跨越多个数据 FIS，则在每个数据 FIS 之前不需要新的 DMA 设置 FIS。
串行ATA主机控制器硬件应考虑到DMA设置FIS缓冲区标识符是一个介于0和31之间的值，主机控制器应根据该索引选择适当的传输缓冲区。
对于从主机到设备的数据传输。
 包括对第一方DMA机制的优化，通过允许请求的数据在这种请求后立即传输到设备，而不需要后续的DMA，从而消除一个事务。
激活FIS以启动数据流。这种对第一方DMA机制的优化在10.3.8.3.1节中定义。
如果没有启用（见13.3.1节）或不支持（见13.2.1节）DMA设置FIS中的非零缓冲区偏移，则应在DMA设置FIS后满足某条命令的数据传输完成后，才可以开始不同命令的数据传输。主机控制器在收到新的DMA Setup后，不需要保留DMA引擎上下文。
FIS中，如果未启用或不支持非零缓冲区偏移，则设备无法在其离开的位置恢复先前放弃的上下文的数据传输。
如果主机控制器硬件在DMA设置FIS中支持非零缓冲区偏移，并且启用了非零偏移的使用，如果设备不支持保证按顺序传送数据（见第13.2.1节）或禁用了按顺序传送数据（见第13.3.4节），则设备可能会不按顺序返回（或接收）给定命令的数据（即先返回命令最后一半的数据）。
在这种情况下，设备也可以为多个命令交错地传送部分数据，但前提是设备要跟踪适当的缓冲区偏移量。例如，命令 0 的前半部分数据可能会被传送，然后是命令 1 的前半部分数据，接着是命令 0 的剩余数据。 默认情况下，非零缓冲区偏移量的使用被禁用。请参阅第13.3.1节，了解有关启用DMA设置FIS的非零缓冲区偏移的信息。
如果主机控制器硬件支持DMA Setup FIS中的非零缓冲区偏移量，并且启用了非零偏移量的使用，如果设备支持保证按顺序传送数据，并且启用了保证按顺序传送数据，则设备可以使用多个DMA Setup FIS来满足特定的I/O过程，但如果使用了多个DMA Setup FIS，则数据应按顺序传送，从第一个LBA开始。在这种情况下，设备不得对单个或多个命令进行部分数据交错传送。例如，一个命令的前半部分数据可以使用一个 DMA 设置 FIS 和一个或多个后续数据 FIS 来传送，然后是该命令的剩余数据，使用第二个 DMA 设置 FIS 和一个或多个后续数据 FIS 来传送。非零缓冲区偏移量的使用与上述更一般的无序数据交付情况一样。默认情况下，保证有序数据传输的使用被禁用。
对于选择数据传输的内存缓冲区，DMA Setup FIS由设备发出。
DMA Setup FIS字段定义在图204中（另见10.3.8节）。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### 串行ATA国际组织 0 保留 (0) 保留 (0) A I D 保留 (0) FIS类型 (41h) 0h TAG 1 0h 2。
保留 (0) 3 4 DMA 缓冲区偏移值
DMA传输计数 5 6 保留 (0)
## 图204 - 用于选择内存缓冲区的DMA设置FIS定义 
领域定义
FIS类型 如10.3.8节所定义。
D 按照10.3.8节中的定义。由于DMA设置FIS仅由设备针对此处定义的队列模型发出，因此该字段中的值定义为1=设备到主机的传输（写到主机内存），0=主机到设备的传输（从主机内存读）。
A 按照10.3.8节的定义，包括10.3.8.3.1节的其他细节。
对于从设备到主机的传输方向的DMA设置，该位应为0。
TAG 该字段用于标识主机内存中选择数据传输的DMA缓冲区。DMA Buffer Identifier Low字段的低阶5位应设置为与传输数据的命令TAG对应的TAG值。DMA Buffer Identifier Low/High字段的其余位应清零。在10.3.8节的DMA设置FIS中定义的64位缓冲区标识符字段用于传递占据该字段5个最小有效位的TAG值。
DMA缓冲区偏移
如10.3.8节中所定义。只有当主机通过第13.3节中定义的SET FEATURES机制表示支持时，设备才可以在该字段中指定一个非零值。从指定的缓冲区中指定的偏移量开始，按顺序递增的逻辑地址进行数据传输。
DMA传输计数
按10.3.8节的定义。该值应准确反映后面数据传输的长度。如果传输计数是奇数字，请参考10.3.11.2节的特殊注意事项。设备不得将该字段设置为0h；该字段的值为0h是非法的，会导致不确定的行为。

I 中断原生命令队列在数据传输阶段后（传输计数用完后）不利用中断。中断位应清零。
R/Reserved 所有保留字段均应清零。
**13.6.1.3 状态返回机制**。 
为了达到最高的效率，状态返回机制是不互锁的（不包括握手），同时确保没有状态通知丢失或被覆盖（即状态通知无竞赛）。
状态通知是无竞赛的）。) 状态返回机制依赖于ACT位的数组--在32个可能的未执行命令中，每个命令都有一个ACT位来传达活动状态，从而形成一个32位的ACT状态字段。在10.3.6节定义的设置设备位FIS中的32位保留字段被定义为SActive字段，用于传达更新ACT位数组的命令完成信息。32位字段中的零位位置对应于标签值为零的命令的ACT位。主机软件应检查
SActive寄存器(包含ACT位数组)时检查状态，以确定自主机上次处理命令完成后，哪些命令已经完成。由于主机中的软件延迟，在主机检查状态时，有可能有多个命令指示完成（即在主机响应一个完成通知时，另一个命令可能已经完成）。只有成功完成的命令才使用这种机制来指示其状态--失败的命令使用13.6.3.3.3.1.1和13.6.3.7.1.2中描述的附加机制来传递错误信息以及受影响的命令标签。队列错误日志用于传递额外的队列命令错误信息，如 13.7 所述。
**13.6.1.4 优先权**。
主机对I/O优先级的了解可以作为命令的一部分传送给设备。NCQ命令有两种优先级值，即正常和高优先级。当主机将一个NCQ命令标记为高优先级时，主机要求该命令的服务质量比正常优先级发出的命令要好。
类是软优先级的形式。设备可以选择在未完成的高优先级命令之前完成一条正常优先级命令，不过应优先考虑高优先级命令。正常优先级命令可能在高优先级命令之前完成的一个例子是，当正常优先级命令是一个缓存命中，而高优先级命令需要访问设备介质。
优先级是在NCQ命令的PRIO位中指定的（READ FPDMA QUEUED和?
WRITE FPDMA QUEUED）。) 该位可以指定正常优先级或高优先级值。
如果一个命令被主机标记为高优先级，设备应尝试为该命令提供更好的服务质量。不要求设备在满足正常优先级请求之前处理所有高优先级请求。
设备应比正常和等时请求更及时地完成高优先级请求。设备应在其相关的截止日期之前完成等时请求。
**13.6.1.5 卸载**。
当在笔记本电脑环境中使用本地命令队列时，主机需要能够因过度移动（如笔记本电脑掉落）而停放磁头。本节定义了一种机制，当设备中NCQ命令未完成时，主机可以使用这种机制来停放磁头。ATA/ATAPI-7条款6.20.10中定义了完成卸载操作的典型时间。
当NCQ命令未完成时，设备能够接受ATA/ATAPI-7条款6.20中定义的带有卸载功能的IDLE IMMEDIATE命令。当接收到该命令并指定了Unload Feature时，设备应。1. 立即卸载/停放磁头。
2. 用寄存器-设备到主机的FIS响应主机，并在状态寄存器中把ERR位设置为1，因为这是一个非排队命令。
 
##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
当主机收到错误指示时，应继续读取 "排队错误日志"（见13.7）。在 "排队错误日志 "中，设备应说明该错误是否是由于接收到UNLOAD，以及UNLOAD是否被执行。读取 "排队错误日志 "时，设备不得将磁头加载到介质上。
排队错误日志指示设备是否已接受Unload，是否正在执行命令。为了得到Unload完成（和成功）的明确指示，需要在读取Queued Error Log后再次发出带有Unload功能的IDLE IMMEDIATE命令。在读取了排队错误日志后。
 没有未完成的NCQ命令，且NCQ错误已被清除，因此带有卸载功能的IDLE IMMEDIATE命令将被正常处理，当卸载过程成功完成时，将返回一个成功状态。
如果设备当前正在为之前发出的NCQ命令执行数据传输，则向设备发出带有卸载功能的IDLE IMMEDIATE命令可能会有延迟。
如果设备恰好正在执行大量的数据错误恢复程序，这种延迟可能会超过可接受的时间。然而，当一个非排队数据命令尚未执行，而设备正在执行错误恢复程序时，也可能出现同样的问题。
#### 13.6.2 混合非本地队列命令和本地队列命令。
当本地队列命令尚未执行时，主机不得发出非本地队列命令。当收到非本地队列命令而本地队列命令尚未执行时，设备应向主机发送一个寄存器FIS，并在FIS的状态字段中将ERR和ABRT位设置为1，BSY位清零，以此向主机发出错误条件的信号，并按第13.6.3.4节所述停止命令处理，但下文所述除外。非本位队列命令包括除READ FPDMA以外的所有命令。
QUEUED、WRITE FPDMA QUEUED 和 NCQ QUE MANAGEMENT 命令在 13.6.3.1、13.6.3.5 和 13.6.3.8 中定义。
发生错误后，接收到读取排队错误日志的命令（见13.7），应导致任何未完成的Serial ATA本地排队命令被中止，设备应执行必要的状态清理，以返回到无命令待处理的状态。器件应向主机发送Set Device Bits FIS，将SActive字段中的所有位都设置为1（即FFFFFFFh），从而清除SActive寄存器中的所有位。在读取到排队错误
读取队列错误日志，设备应准备好执行随后发出的队列命令，而不管之前队列命令上是否有任何错误。
如果在原生排队命令尚未执行且设备之前没有报告错误的情况下发出读取排队错误日志的命令，设备应发出错误条件信号。当没有错误未完成时，收到该命令应与本地队列命令未完成时的任何其他非本地队列命令一样处理。在这种情况下，需要后续读取排队错误日志的命令才能从错误中恢复。

#### 13.6.3 命令定义 **13.6.3.1 READ FPDMA QUEUED**。
队列中的本机读取命令使用了一个新的命令，新命令只支持LBA模式，并且只使用48位寻址。新命令只支持LBA模式，并且只使用48位寻址。新命令的格式定义在图205中。
寄存器 7 6 5 4 3 2 1 0
特写(7:0) (^) 扇形计数7:0
特征(15:8) (^) 区块计数 15:8
计数(7:0) TAG保留
计数(15:8) PRIO(1:0) 保留。
LBA(7:0) LBA 7:0
LBA(31:24) LBA 31:24
LBA(15:8) LBA 15:8
LBA(39:32) (^) LBA 39:32
LBA(23:16) LBA 23:16
LBA(47:40) LBA 47:40
ICC ICC(7:0) 器件 FUA 1 Res 0 Reserved
设备 FUA 1 Res 0 保留
命令60h 
## 图205 - READ FPDMA QUEUED命令定义。
TAG 由主机软件分配的TAG值应与其他所有的TAG值不同。
对应于未完成的命令的TAG值。分配的TAG值不得超过IDENTIFY DEVICE字75中指定的值。
PRIO 优先级（PRIO）值由主机根据发出的命令的优先级来分配。设备应比普通和等时请求更及时地完成高优先级请求。设备应在其相关的截止日期之前完成等时请求。
00b 正常优先级 01b 异步 - 依赖于截止日期的优先级 10b 高优先级 11b 保留。
ICC 当PRIO设置为01b值时，异步命令完成（ICC）字段有效。它由主机根据与发出的命令相关联的预定截止时间来分配。当最后期限已过，设备应尽快继续完成命令。如果设备支持NCQ QUE MANAGEMENT命令(见13.6.3.8)并支持Deadline Handling子命令(见13.6.3.8.2)，主机可以修改该行为。该子命令允许主机设置设备是否要中止（或继续处理）已经超过了在
ICC。
ICC字段有几个参数编码。精细或粗糙的时间。
间隔和最大时间。间隔表示时间限制参数的时间单位。
如果ICC位7被清零，则说明 
##### 在附件处进行高速小型化。
#### ATA国际组织 
- 时间间隔是细粒度的。
- 时间间隔=10毫秒
- 时间限制 = (ICC[6:0] + 1) * 10 msec
- 最大精细时间=128*10毫秒=1.28秒。
如果ICC位7被设置为1（粗糙的编码），那么
- 时间间隔是粗粒度的。
- 间隔=0.5秒。
- 时间限制 = (ICC[6:0] + 1) * 0.5秒
- 最大粗时间=128*0.5秒=64秒。

FUA 当设置为1时，无论存储设备是否在其缓冲区或缓存中保存了所请求的信息，都会强制从存储介质中检索数据。如果设备因缓存写入而持有所请求数据的修改副本，则作为该操作的一部分，修改后的数据将首先写入介质，然后再从存储介质中检索。当清零时，数据可以从设备的存储介质或设备可能包含的缓冲器/缓存中检索。
其他 所有其他寄存器的内容与ATA8-ACS标准中定义的READ DMA QUEUED EXT命令一致，包括扇区计数15:0的约定，其中0的值表示要传输65,536个扇区。
 **13.6.3.2 成功输出**。
在成功完成一个或多个未完成的命令后，设备应发送一个
设置设备位FIS，中断位设为1，ACT字段中与上次状态通知发送后完成的每个命令TAG的位位置相对应的一个或多个位设为1。状态寄存器中的ERR位应清零，错误寄存器中的值为零。

ACT字段占据设置设备位FIS的最后32位，如下图190所定义。
0 Error R Status Hi R Status LoN I R Reserved (0) FIS Type (A1h) 0 0 1 1 ACT 31:0
图190 - 成功完成READ FPDMA QUEUED命令的设置设备位FIS
设置设备位 FIS 的 ACT 字段为最多 32 个排队命令中的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备显式聚合成功状态返回，则可以将多个位设置为1。
错误 错误寄存器应清零。
状态 按照10.3.6节的定义。ERR位应清零，表示命令成功完成。

I 中断位。中断位应设置为1。
所有其他字段如10.3.6节中所定义。
注意：设备应注意，如果选择将状态汇总到许多未完成的命令实际上已经成功完成，而没有通知主机，则错误可能导致这些命令的最终完成状态为失败。设备在对未完成的队列命令使用状态聚合时，应该有选择地确保让主机知道未完成命令的成功完成情况，以避免错误迫使大量不必要的命令重试。
**13.6.3.3 错误输出** 13.6.3.3.1.1 收到命令后： 1.
如果设备接收到命令后，尚未将BSY位清零确认，而遇到错误，设备应向主机发送寄存器FIS（见图206），状态字段中ERR位设为1，BSY位清零，错误字段中为ATA错误代码。
寄存器7 6 5 4 3 2 1 0
错误 ERROR
计数(7:0) na
计数(15:8) na
LBA(7:0) na
LBA(31:24) na
LBA(15:8) na
LBA(39:32) (^) na
LBA(23:16 na)
LBA(47:40) na
设备名称
状态 BSY DRDY DF na DRQ na na ERR 
## 图206 - READ FPDMA QUEUED在收到命令时出错。
ERROR ATA错误代码为失败命令的失败条件
BSY 0
DRDY 1
DF 0
DRQ 0
ERR 1
寄存器 FIS 传输后，设备应停止处理任何未完成的或新的命令，直到队列错误日志（见 13.7）被读取后，才继续中止所有未完成的命令。
13.6.3.3.1.2 命令执行期间
如果通过将BSY位清零来确认所有的命令，并且检测到错误状况，设备应向主机发送设置设备位FIS（见下图191），状态字段中的ERR位设为1，错误字段中的ATA错误代码，以及
中断位设置为1。出错时所有未完成的命令应作为错误响应的一部分被中止，并可由主机酌情重新发出。对于任何命令，如果 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织未成功完成或导致错误，设备应在设置设备位FIS中把相应的ACT位清零。
0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1 1 ACT 31:0
## 图207 - 带有错误通知的设置设备位FIS，以及命令完成情况 
SActive Set Device Bits FIS 的 ACT 字段为最多 32 个排队命令中的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备明确地汇总成功状态返回，则可以将多个位设置为1。

错误 错误寄存器应包含ATA错误代码。
状态 如10.3.6节中所定义。ERR位应设置为1，表示发生了NCQ错误。
I 中断位。中断位应设置为1。
10.3.6节定义的所有其他字段。
如果设备在影子状态寄存器中的BSY位清零时发出错误条件信号，只有作为设置设备位FIS的一部分更新的寄存器才会被修改，而其他影子寄存器块寄存器保持不变。如果当影子状态寄存器中的BSY位被设置为1时，设备发出错误条件信号，则设备用寄存器FIS将BSY位清零，更新影子寄存器块中的所有寄存器，但仍可通过读取队列错误检索到命令的相应错误信息。
日志。
在传输 "设置设备位 "FIS后，设备应停止处理任何未完成的或新的命令，直到读取 "排队错误日志 "后才继续中止所有未完成的命令。详见13.6.3.4。
**13.6.3.4 队列中止**。
在响应NCQ错误条件传送寄存器FIS或设置设备位FIS之后，设备应停止处理任何未完成的或新的命令，直到队列中的FIS被删除为止。
错误日志（见13.7）使用通用日志（GPL）功能集读取。

当收到读取队列错误日志的命令时，设备应在返回最后一条失败命令的详细错误信息（包括13.7中所述的失败命令的标签值）之前，执行任何必要的清理工作。
作为对接收到的读取排队错误日志命令的响应，设备应发送一个 Set
设备位FIS（见下图208）向主机发送ACT字段中的所有位都设置为1。
这个策略可以避免主机无意中以成功状态完成一个失败的命令。
该策略的例外情况是，如果主机读取排队错误日志，以获取与设备报告的特定错误没有直接联系的信息。如果设备接收到读取排队错误日志的命令，而该命令并不是直接响应设备报告的错误，也没有未完成的排队命令，则不需要设置设备的错误日志。
由于此时没有必要中止任何命令，因此 FIS 的位数是作为响应交付的。
 0 Error R Status Hi R Status LoN I R Reserved (0) FIS Type (A1h) 0 0 1
ACT 31:0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
## 图208 - 设置设备位FIS中止所有未完成的命令..........................................。

ACT 整个ACT字段应设为1，以表示所有未完成的命令正在被中止。
错误 应将错误寄存器清零。
状态 如10.3.6所定义。ERR位应清零，表示所有之前未完成的命令已被清理。
I 中断位。中断位应设置为 1。
10.3.6中定义的所有其他字段。
当显示错误时，主机应将任何未执行的命令，如果其相应的SActive寄存器位未被清除，则视为失败。

##### 高速序列化在附件中的应用 
#### 串行ATA国际组织 **13.6.3.5 WRITE FPDMA QUEUED**。
排队的本机写命令使用了一条新命令。新命令的格式定义在图209中。
寄存器 7 6 5 4 3 2 1 0
特写(7:0) (^) 扇形计数7:0
特征(15:8) (^) 区块计数 15:8
计数(7:0) TAG保留
计数(15:8) PRIO(1:0) 保留。
LBA(7:0) LBA 7:0
LBA(31:24) LBA 31:24
LBA(15:8) LBA 15:8
LBA(39:32) (^) LBA 39:32
LBA(23:16) LBA 23:16
LBA(47:40) LBA 47:40
ICC ICC(7:0)
设备 FUA 1 0 0 保留
命令61h 
## 图209 - WRITE FPDMA QUEUED命令定义。
TAG 由主机软件分配的TAG值应与其他所有的TAG值不同。
对应于未完成的命令的TAG值。分配的TAG值不得超过IDENTIFY DEVICE字75中指定的值。
PRIO 优先级（PRIO）值由主机根据发出的命令的优先级来分配。设备应比普通和等时请求更及时地完成高优先级请求。设备应在其相关的截止日期之前完成等时请求。
00b 正常优先级 01b 异步 - 依赖于截止日期的优先级 10b 高优先级 11b 保留。
ICC 当PRIO设置为01b值时，异步命令完成（ICC）字段有效。它由主机根据与发出的命令相关联的预定截止时间来分配。当截止日期过后，设备应尽快继续完成命令。
 如果设备支持 NCQ QUE MANAGEMENT 命令（请参见 13.6.3.8）并支持 Deadline Handling 子命令（请参见 13.6.3.8.2），则主机可以修改此行为。该子命令允许主机设置设备是否要中止（或继续处理）已经超过了在
ICC。
ICC字段有几个参数编码。精细或粗糙的时间。
间隔和最大时间。间隔表示时间限制参数的时间单位。
如果ICC位7被清零，则说明
- 时间间隔是细粒度的。
- 时间间隔=10毫秒  
- 时间限制 = (ICC[6:0] + 1) * 10 msec
- 最大精细时间=128*10毫秒=1.28秒。
如果ICC位7被设置为1（粗糙的编码），那么
- 时间间隔是粗粒度的。
- 间隔=0.5秒。
- 时间限制 = (ICC[6:0] + 1) * 0.5秒
最大粗时间=128*0.5秒=64秒。
FUA 当设置为1时，强制在显示完成状态之前将数据写入存储介质。当清零时，设备可能会在数据写入介质之前指示完成状态。
其他 ATA8-ACS标准中定义的WRITE DMA QUEUED EXT命令所指定的所有其他寄存器，包括扇区计数15:0惯例，其中零值指定要传输65,536个扇区。
 **13.6.3.6 成功输出**。
在成功完成一个或多个未完成的命令后，设备应发送一个
设置设备位FIS，中断位设为1，ACT字段中与上次状态通知发送后完成的每个命令TAG的位位置相对应的一个或多个位设为1。状态寄存器中的ERR位应清零，错误寄存器中的值为零。
ACT字段占据设置设备位FIS的最后32位，如下图210所定义。
0 Error R Status Hi R Status LoN I R Reserved (0) FIS Type (A1h) 0 0 1 1 ACT 31:0
### 图210 - 成功完成WRITE FPDMA QUEUED命令的设置设备位FIS。
设置设备位 FIS 的 ACT 字段为最多 32 个排队命令中的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备显式聚合成功状态返回，则可以将多个位设置为1。
错误 错误寄存器应清零。
状态 如10.3.6所定义。ERR位应清零，表示命令成功完成。
I 中断位。中断位应设置为1。
10.3.6中定义的所有其他字段。
注意：设备应注意，如果选择将状态汇总到许多未完成的命令实际上已经成功完成，而没有通知主机，则错误可能导致这些命令的最终完成状态为失败。设备在对未完成的队列命令使用状态聚合时，应该有选择地确保主机知道未完成的命令已经成功完成，而不至于因为错误而导致大量不必要的命令重试。

##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### 串行ATA国际组织 **13.6.3.7 错误输出** 1 3.6.3.7.1.1 收到命令后。
如果设备收到了一条命令，还没有通过将BSY位清零来确认，遇到了错误，设备应向主机发送一个寄存器FIS（见下图211），状态字段中的ERR位设为1，BSY位清零，错误字段中的ATA错误代码。
寄存器7 6 5 4 3 2 1 0
错误 ERROR
计数(7:0) na
计数(15:8) na
LBA(7:0) na
LBA(31:24) na
LBA(15:8) na
LBA(39:32) na
LBA(23:16 na)
LBA(47:40) na
设备名称
状态 BSY DRDY DF na DRQ na na ERR
## 图211 - 收到命令时发生WRITE FPDMA QUEUED错误。
ERROR ATA错误代码为失败命令的失败条件
BSY 0
DRDY 1
DF 0
DRQ 0
ERR 1
在传输寄存器 FIS 后，设备应停止处理任何未完成的或新的命令，直到读取排队错误日志（见 13.7）后才继续中止所有未完成的命令。详见13.6.3.4。
13.6.3.7.1.2 命令执行期间
如果通过将BSY位清零来确认所有的命令，并且检测到错误状况，设备应向主机发送设置设备位FIS（见下图212），状态字段中的ERR位设为1，错误字段中的ATA错误代码，以及
中断位设置为1。出错时所有未完成的命令应作为错误响应的一部分被中止，主机可酌情重新发出。对于任何未成功完成或导致错误的命令，设备应在Set Device Bits FIS中将相应的ACT位清零。

 0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1。
ACT 31:0 1
## 图212--设置设备位FIS，有错误通知和命令完成。
设置设备位 FIS 的 ACT 字段为最多 32 个排队命令中的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备显式聚合成功状态返回，则可以将多个位设置为1。
错误 错误寄存器应包含ATA错误代码。
状态 按照10.3.6中的定义。ERR位应设置为1，表示发生了NCQ错误。
I 中断位。中断位应设置为1。
10.3.6中定义的所有其他字段。
如果当影子状态寄存器中的BSY位被清零时，设备发出错误条件信号，只有作为设置设备位FIS的一部分更新的寄存器才会被修改，而使其他影子寄存器块寄存器保持不变。如果当影子状态寄存器中的BSY位被设置为1时，设备发出错误条件信号，则设备用一个更新影子寄存器块中所有寄存器的寄存器FIS将BSY位清零。
在传输Set Device Bits FIS之后，设备应停止处理任何未完成的或新的命令，直到队列错误日志（见13.7）被读取后，才继续中止所有未完成的命令。更多细节请参见13.6.3.4。

##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
序号 ATA国际组织
串行ATA修订3.0-黄金版 **13.6.3.8 NCQ QUE管理**。
NCQ队列管理功能允许主机管理未完成的NCQ命令和/或影响NCQ命令的处理。
NCQ QUE MANAGEMENT命令是一个非数据的NCQ命令。只有指定的NCQ
QUE MANAGEMENT子命令作为即时NCQ命令执行。
如果NCQ被禁用，并且向设备发出了一条NCQ QUE MANAGEMENT命令，那么设备将中止该命令，状态寄存器中的ERR位被设置为1，并且在状态寄存器中的ERR位被设置为1。
错误寄存器中的ABRT位设置为1。该命令禁止用于实现PACKET功能集的设备。设备的排队行为取决于指定的子命令。
寄存器 7 6 5 4 3 2 1 0
特性(7:0) (^) 子命令专用子命令。
特写(15:8) (^) 保留。
Count(7:0) TAG保留
计数(15:8) 保留
LBA(7:0) 子命令专用(TTAG) 保留。
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 Res 1 Res 0 保留
命令63h 
## 图213 - NCQ QUE管理 - 命令定义。
表80定义了子命令值。如果指定了一个无效的子命令，那么设备将在状态寄存器中ERR位设为1，错误寄存器中ABRT位设为1的情况下中止命令，并将导致所有未执行的命令被中止。
## 表80 - 子命令字段 
子命令说明 参考 0h 终止 NCQ 队列 13.6.3.8.1 1h 截止日期处理 13.6.3.8.2 2h - Fh 保留。
TAG 由主机软件分配的TAG值应与其他所有的TAG值不同。
对应于未完成的命令的TAG值。分配的TAG值不得超过IDENTIFY DEVICE字75中指定的值。
子命令特定（TTAG）是选定的队列TAG。这允许主机选择要管理的特定未完成的队列命令。
该命令的错误和正常返回都是子命令特定的。
 **13.6.3.8.1 ABORT NCQ QUE子命令( 0h )**。
设置为0h的子命令用于指定ABORT NCQ QUE子命令。ABORT NCQ
QUEUE子命令是一条即时NCQ命令。对该子命令的支持在NCQ队列管理日志中指明（见13.7.5）。
ABORT NCQ QUE子命令只影响那些设备在接受该NCQ QUE管理命令前已表示接受命令的NCQ命令。
命令的格式定义在图181中。
寄存器 7 6 5 4 3 2 1 0
特性(7:0) 终止类型 0h
特点(15:8) 保留
Count(7:0) TAG保留
计数(15:8) 保留
LBA(7:0) TTAG 保留。
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) 保留
LBA(23:16 保留
LBA(47:40) 保留
设备 Res 1 Res 0 保留
命令63h
图181 - NCQ队列管理，中止NCQ队列 - 命令定义
终止类型描述了所请求的操作。表81显示了定义的中止类型。表81显示了定义的中止类型。
NCQ 队列管理日志（见 13.7.5）提供了设备支持的中止类型列表。
TAG 由主机软件分配的 TAG 值应与其他所有的 TAG 值不同。
TAG值对应未完成的命令。TAG值不得超过IDENTIFY DEVICE字75中指定的值。
TTAG TTAG字段包含请求中止的未完成命令的TAG值。
TTAG值只有在Abort Type字段设置为3h（Abort Selected）时才有效。TTAG值不得超过在
IDIFIY DEVICE word 75.

##### HIGH-SPEED SERIALIZED ATTACHMENT. 
#### ATA国际组织 
## 表81----中止类型 
终止
0h Abort All（全部放弃） 设备应尝试放弃所有尚未执行的 NCQ 命令。
1h Abort
流媒体
设备应尝试中止所有未完成的NCQ流命令。所有非流式NCQ命令将不受影响。
2h Abort Non
流媒体
裝置應嘗試中止所有未完成的NCQ非技術性任務。
流命令。所有NCQ流命令不受影响。
3h 终止
选定
设备应尝试中止与 TTAG 字段中代表的标签相关联的未完成的 NCQ 命令。
4h - Fh 保留 13.6.3.8.1.1 成功输出。
如果指定了支持的Abort类型参数，那么即使该命令没有导致任何命令被中止，设备也应表示成功。
当Abort NCQ Queue命令成功完成时，应向主机发送Set Device Bits FIS，通过将这些命令的ACT位设置为1，来完成Abort子命令和因Abort子命令而中止的命令。此
SDB FIS 也可以指示其他已完成的命令。
0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1。
ACT 31:0 1
## 图214 - NCQ队列管理，中止NCQ队列 - 成功完成........。

ACT Set Device Bits FIS的ACT字段为最多32条命令中的每一条传达完成通知。该字段是位显性的，设备为其指示完成通知的每个命令标记设置位位置为1。
如果设备显式聚合成功状态返回，则可以将多个位设置为1。设备应将每个已被中止的排队命令的相应位设置为1，并将与中止NCQ队列命令的TAG值相关的位设置为1。
错误 错误寄存器应包含00h。
状态 如10.3.6中定义。ERR位应清零。
I 中断位。中断位应设置为1。
所有其他字段的定义见 10.3.6。
13.6.3.8.1.2 错误输出 1 3.6.3.8.1.2.1 在收到命令时。
如果TTAG字段的值等于TAG字段的值，或者指定了一个不支持的Abort类型参数，设备应返回命令中止。
如果设备接收到一个命令，还没有通过将BSY位清零来确认，遇到错误，设备应向主机发送一个寄存器FIS（见下图215），状态字段中的ERR位设为1，BSY位清零，错误字段中的ATA错误代码。
寄存器7 6 5 4 3 2 1 0
错误 ERROR
计数(7:0) na
计数(15:8) na
LBA(7:0) na
LBA(31:24) na
LBA(15:8) na
LBA(39:32) na
LBA(23:16) na
LBA(47:40) na
设备名称
状态 BSY DRDY DF na DRQ na na ERR
## 图215--NCQQUE管理，中止NCQQUE--收到命令时出错。
ERROR ATA错误代码为失败命令的失败条件
BSY 0
DRDY 1
DF 0
DRQ 0
ERR 1
在传输寄存器 FIS 后，设备应停止处理任何未完成的或新的命令，直到读取排队错误日志（见 13.7）后才继续中止所有未完成的命令。详见13.6.3.4。
13.6.3.8.1.2.2 命令执行期间
如果通过将BSY位清零来确认所有的命令，并且检测到错误状况，设备应向主机发送设置设备位FIS（见下图212），状态字段中的ERR位设为1，错误字段中的ATA错误代码，以及
中断位设置为1。出错时所有未完成的命令作为错误响应的一部分被中止，主机可根据情况重新发出。对于任何未成功完成或导致错误的命令，设备应在Set Device Bits FIS中将相应的ACT位清零。

##### HIGH SPEED SERIALIZED ATTACHMENT? 
#### 串行 ATA 国际组织 0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1。
ACT 31:0 1
## 图216 - NCQ QUE管理，中止NCQ队列 - 执行过程中出错.........。

ACT Set Device Bits FIS的ACT字段为最多32个排队命令中的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备显式聚合成功状态返回，则可以将多个位设置为1。
错误 错误寄存器应包含ATA错误代码。
状态 按照10.3.6中的定义。ERR位应设置为1，表示发生了NCQ错误。
I 中断位。中断位应设置为1。
10.3.6中定义的所有其他字段。

如果设备在影子状态寄存器中的BSY位被清零时发出错误条件信号，只有作为Set Device Bits FIS一部分更新的寄存器被修改，而其他影子寄存器块寄存器保持不变。如果当影子状态寄存器中的BSY位被设置为1时，设备发出错误条件信号，则设备用一个更新影子寄存器块中所有寄存器的寄存器FIS将BSY位清零。
在传输Set Device Bits FIS之后，设备应停止处理任何未完成的或新的命令，直到队列错误日志（见13.7）被读取后，才继续中止所有未完成的命令。更多细节请参见13.6.3.4。
 
##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### Serial ATA International Organization **13.6.3.8.2 Deadline Handling Subcommand ( 1h )**。
设置为1h的子命令指定了死机处理子命令该子命令控制设备如何处理NCQ流命令。NCQ队列管理日志（见13.7.5）中显示了对该子命令的支持。该命令的格式定义在图184中。
寄存器 7 6 5 4 3 2 1 0
特性(7:0) 保留 RDNC WDNC 1h
特写(15:8) (^) 保留。
Count(7:0) TAG保留
计数(15:8) 保留
LBA(7:0) 保留
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 Res 1 Res 0 保留
命令 63h **图 184 - NCQ QUE 管理，截止日期处理 - 命令定义**。
WDNC 如果WDNC(Write Data Not Contiunue)位被清零，那么设备可能允许WRITE FPDMA QUEUED命令的完成时间超过ICC参数指定的时间。如果WDNC位被设置为1，那么所有WRITE FPDMA QUEUED命令的完成时间将超过ICC参数的规定。
FPDMA QUEUED 命令应在
ICC定时器值，否则设备将返回所有未完成命令的命令中止。WDNC仅适用于PRIO设置为01b的WRITE FPDMA QUEUED命令（异步--优先级取决于截止日期）。
见13.6.3.5）。
RDNC 如果RDNC(Read Data Not Continue)位被清零，那么设备可以允许READ FPDMA QUEUED命令的完成时间超过了Read FPDMA QUEUED命令的完成时间。
指定的ICC参数。如果RDNC位被设置为1，那么所有READ FPDMA?
QUEUED命令应在ICC定时器值指定的时间内完成，否则器件将对所有未完成的命令返回命令中止。RDNC仅适用于PRIO设置为01b的READ FPDMA QUEUED命令（异步--取决于截止日期的优先级）。见13.6.3.1）。
WDNC和RDNC位的状态应在软件复位和COMRESETs（通过软件设置保留）中保留，而不应在电源周期中保留。
TAG TAG值应由主机软件分配，以不同于所有其他软件。
TAG值对应未完成的命令。TAG值不得超过IDENTIFY DEVICE字75中规定的值。
**13.6.3.8.2.1 成功输出**。 
如果支持死机处理子命令，设备应无误地返回命令完成。
当Deadline Handling子命令成功完成时，设置设备位数
应向主机发送FIS，以完成死机处理子命令。该SDB FIS还可以指示其他已完成的命令。
0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1.
ACT 31:0 1
## 图217 - NCQ QUE管理，截止日期处理 - 成功完成........。

ACT Set Device Bits FIS的ACT字段为最多32个命令中的每个命令传达完成通知。该字段是位显性的，设备为其指示完成通知的每个命令标记设置位位置为1。
如果设备明确地汇总成功状态返回，则可以将多个位设置为1。设备应将与该命令标签相关的位设置为1。
死线处理命令的 TAG 值。
错误 寄存器中应包含 00h。
状态 如10.3.6所定义。ERR位应清零。
I 中断位。中断位应设置为1。
所有其他字段的定义见 10.3.6。
13.6.3.8.2.2 错误输出 13.6.3.8.2.2.1 接收到命令时。
如果设备收到了一条命令，还没有通过将BSY位清零来确认，遇到了错误，设备应向主机发送一个寄存器FIS（见下图218），状态字段中的ERR位设为1，BSY位清零，错误字段中的ATA错误代码。
寄存器7 6 5 4 3 2 1 0
错误 ERROR
计数(7:0) na
计数(15:8) na
LBA(7:0) na
LBA(31:24) na
LBA(15:8) na
LBA(39:32) na
LBA(23:16 na)
LBA(47:40) na
设备名称
状态 BSY DRDY DF na DRQ na na ERR
## 图218 - NCQ QUE管理，截止日期处理 - 收到命令时出错。
ERROR ATA错误代码为失败命令的失败条件 
##### 在附件处进行高速小型化。

#### ATA国际组织 
##### BSY 0 
##### DRDY 1 
##### DF 0 
##### DRQ 0 
##### ERR 1 
在传输寄存器 FIS 后，设备应停止处理任何未完成的或新的命令，直到读取排队错误日志（见 13.7）后才继续中止所有未完成的命令。详见13.6.3.4。
13.6.3.8.2.2.2 命令执行期间
如果通过将BSY位清零来确认所有的命令，并且检测到错误状况，设备应向主机发送设置设备位FIS（见下图212），状态字段中的ERR位设为1，错误字段中的ATA错误代码，以及
中断位设置为1。出错时所有未完成的命令作为错误响应的一部分被中止，主机可根据情况重新发出。对于任何未成功完成或导致错误的命令，设备应在Set Device Bits FIS中将相应的ACT位清零。
0 错误 R 状态 Hi R 状态 LoN I R 保留 (0) FIS 类型 (A1h) 1 1.
ACT 31:0 1
## 图219 - NCQ QUE管理，截止日期处理 - 执行期间出错.........。

ACT Set Device Bits FIS的ACT字段为最多32个排队命令的每个命令传达成功完成通知。该字段是位显性的，设备为其指示成功完成通知的每个命令标记设置位位置为1。如果设备显式聚合成功状态返回，则可以将多个位设置为1。
错误 错误寄存器应包含ATA错误代码。
状态 按照10.3.6中的定义。ERR位应设置为1，表示发生了NCQ错误。
I 中断位。中断位应设置为1。
10.3.6中定义的所有其他字段。
如果当影子状态寄存器中的BSY位被清零时，设备发出错误条件信号，只有作为设置设备位FIS的一部分更新的寄存器才会被修改，而使其他影子寄存器块寄存器保持不变。如果当影子状态寄存器中的BSY位被设置为1时，设备发出错误条件信号，则设备用一个更新影子寄存器块中所有寄存器的寄存器FIS将BSY位清零。
在传输Set Device Bits FIS之后，设备应停止处理任何未完成的或新的命令，直到队列错误日志（见13.7）被读取后，才继续中止所有未完成的命令。详见13.6.3.4。

#### 13.6.4 第一方DMA HBA支持(信息) 
串行ATA本机队列模型利用第一方DMA机制，允许设备选择适当的主机内存缓冲区来传输数据。第一方DMA机制确保了内存保护，以避免流氓或错误设备不分青红皂白地访问主机内存。这在串行ATA中是通过让设备仅通过DMA缓冲区标识符来引用内存缓冲区，而不是通过使用物理内存地址来实现的。
对于本地命令队列协议，用于选择内存缓冲区的缓冲区标识符与用于标识相应命令的唯一标签值相同。标签的值在0到31（含）的范围内，对应的是主机在向设备发出命令时分配的标签值。
对于主流桌面主机控制器，在收到DMA设置FIS后，缓冲区标识符可被主机用作指向预先构建的PRD表(物理区域描述表，也通常称为散点/集合列表)的指针向量的索引，该向量对应于各种未完成排队命令的内存缓冲区。向量表中适当索引处的指针可被转移到DMA引擎中，作为活动PRD表的基本指针，有效地使DMA引擎选择相应的内存缓冲区进行后续数据传输。这样可以对现有的主机进行最小的改变
DMA架构，并提供一个精简高效的缓冲区选择机制。
对于这样的实施例，主机软件将负责预先构建相应的PRD表，并在发出新的本机队列命令之前更新矢量表条目。图220说明了这些概念(该图旨在作为说明性的，并不排除其它可能的主机控制器实施例)。
00 11 nn
FFPPDDMMAA
#### DDMMAAEEnnggiinnee VVeeccttoorrTTaabbllee 
PPRRDDPPTTRR
PPRRDDTTaabbllee 00
PPRRDDTTaabblleenn
PPRRDDTTaabbllee 11
## 图220 - 用于第一方DMA支持的DMA引擎间接示例。
这个用于支持第一方DMA的说明性主机控制器实施例有一个已知的缺点，即处理第一方DMA访问的非零缓冲区偏移是很麻烦的，因为预构建的PRD表中的条目不一定具有统一的长度。
 对于原生命令队列模型，不需要支持非零缓冲区偏移，但是，如果需要在命令内进行不按顺序的数据传递（例如，给定命令的数据是通过先传递最后一半数据，然后再传递前一半数据来返回的），则需要支持非零缓冲区偏移。关于非零缓冲区偏移的信息，请参见第13.3节。

##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
### 13.7 SATA日志...................................................................................................................。

在SATA设备中，有几个可用的日志 "文件"。它们都是只读的。READ LOG
通用日志记录功能集（见ATA8-ACS）中的EXT命令用于读取通用日志记录功能集中的
SATA 日志。在某些情况下，也可以使用 READ LOG DMA EXT 命令。
每份日志都有一个 "地址"，可供参考。每个日志包含零个或多个数据 "页"。每个 "页 "包含512字节的数据。
#### 13.7.1 日志地址定义.......................................................................................

为串行ATA分配的日志地址定义在Error! 未找到参考源...
## ＃＃表82-串行ATA的日志地址。
#### 13.7.2 通用日志目录 (00h)..................................................................

支持队列错误日志（见 13.7）的设备在通用日志目录中反映了这种支持。
日志目录日志( 00h)，通过在该日志的偏移量20h处的值为1，在偏移量21h处的值为0来表示在地址10h处存在一个长度为1页的日志。
支持Phy事件计数器日志的设备在通用日志中反映了这种支持。
目录(00h)，在该日志的偏移量22h处有值1，在偏移量23h处有值0，以表示在地址11h处存在一个长度为1页的日志。
支持NCQ队列管理日志的设备在通用目录中反映了这种支持。
日志目录（日志00h），通过在该日志的偏移量24h处的值为1，在偏移量25h处的值为0来表示地址12h处存在长度为1页的日志。
日志地址描述 00h - 0Fh 如ATA8-ACS标准中所定义 10h NCQ队列错误日志 11h Phy事件计数器日志 12h NCQ队列管理日志 13h - 17h 保留给将来的串行ATA定义 18h - FFh 如ATA8-ACS标准中所定义。
## 表83 - 串行ATA的通用日志目录值 
#### 13.7.3 排队错误日志（10h）.......................................................................................。

本机队列命令的错误处理方案在主机接到本机队列命令出错的通知后，停止对命令的处理。这样，主机软件就可以进行干预，采取适当的行动来解决错误，并避免了由于未处理命令中的数据依赖性而导致不一致的可能性。主机通过向设备发出特定的命令，使设备中止所有剩余的未执行命令，从而明确地重新启动命令处理。由于影子状态和错误寄存器的容量不够大，无法同时包含有关错误条件的信息和识别错误排队命令的标签，因此增加了一个额外的日志，以便主机能够检索错误排队命令的额外信息。
ATA8-ACS标准中定义了通用日志（GPL）功能集。
如果IDENTIFY DEVICE字76位15设置为1，则可使用READ LOG EXT或READ LOG DMA EXT命令读取队列错误日志。
如果IDENTIFY DEVICE字76位15被清零，则应使用READ LOG EXT命令读取队列错误日志。试图使用READ LOG EXT或READ LOG DMA EXT命令读取排队错误日志。
DMA EXT命令应被中止，设备的状态不会改变。
读取排队错误日志(10h)具有第13.6.2节中定义的额外副作用，即中止任何未完成的排队命令，并将因排队命令错误而停止的设备返回到没有未完成命令的状态，并再次准备好接受命令（例如，在完成读取日志的命令后，设备将返回到以下状态
DI0:Device_idle状态，定义在11.2节）。) 排队错误日志包含扩展的命令错误信息。
队列错误日志反映的是第一次记录的NCQ命令的错误信息，直到读取队列错误日志后遇到另一个NCQ错误。
在软件复位或COMRESET后，排队错误日志的内容是不确定的。
支持本地队列功能的设备应支持队列错误日志。队列错误日志
错误日志的长度为一页，其定义见图221。
字节值 0 - 1Fh 如ATA8-ACS标准中的定义 20h 如果支持本地命令队列则为1。
 如果不支持本地命令队列，则为 0 21h 0 22h 1 如果支持 Phy 事件计数器，则为 0 如果不支持 Phy 事件计数器，则为 23h 0 24h 1 如果支持 NCQ 队列管理，则为 0 如果不支持 NCQ 队列管理，则为 25h 0 26h - 2Fh 保留给未来的串行 ATA 定义 30h - 1FFh 如 ATA8-ACS 标准中所定义的那样。
##### 在附件处进行高速小型化。
#### ATA国际组织 
字节 7 6 5 4 3 2 1 0 0 NQ UNL R TAG 1 保留 2 状态 3 错误 4 LBA(7:0) 5 LBA(15:8) 6 LBA(23:16) 7 设备 8 LBA(31:24) 9 LBA(39:24) 10 LBA(47:40) 11 保留 12 计数器(7:0) 13 计数器(15:8) 14 保留 15 保留 16 保留 17 保留 18 保留 19 保留 20 255......。
保留 256 510
供应商特定的511数据结构校验和
## 图221--排队错误日志数据结构定义 
TAG 如果NQ位被清零，则TAG字段包含与失败的排队命令相对应的TAG。
UNL 如果设置为1，表示错误条件是由于收到IDLE指令而导致的。
IMMEDIATE命令，并指定了Unload功能。如果清零，则说明出错的原因不是因为收到了指定了卸载功能的IDLE IMMEDIATE命令。如果收到的最后一条命令是一条Unload
即时，设备在读取时，不得将磁头加载到介质上。
排队错误日志。
如果设置为1，NQ位也应设置为1，以表示失败是由于接收到非排队命令所致。当设置为1时，状态位的值。
日志中的错误、LBA(7:0)字段(字节 3-5)的设置如下。
状态：BSY位应清零 BSY位应清零，ERR位应设为1。
错误。ABRT位应设为1
LBA(7:0)。如果卸载正在执行或已成功完成，应设置为C4h。LBA(7:0)：如果卸载未被接受或卸载失败，应设置为4Ch。
NQ 如果设置为1，表示错误条件是由于非排队命令已经发出，因此TAG字段无效。如果清零，则表示 TAG 字段有效，错误条件适用于排队命令。
BYTE1-19 数据结构中嵌入了设备到主机寄存器FIS的映像。这些字段对应于影子寄存器块寄存器，并以与 READ DMA QUEUED EXT 或 WRITE DMA 一致的错误信息进行编码。
ATA8-ACS标准中定义的QUEUED EXT命令。
ERROR 与失败的命令的ATA ERROR寄存器值相对应的值。无效标签值的命令特定错误条件应作为无效的命令参数处理，并按此报告（即错误寄存器中ABRT位设为1，其他位均清零）。
请注意，当初始错误条件发出信号时，数据结构的ERROR字段中返回的值与Error影子寄存器中返回的值是分开的。错误影子寄存器的值用于发出排队命令错误的信号，而数据结构ERROR字段中的值则提供了有关特定排队命令所遇到的错误条件的具体信息。
厂商专用
分配给特定供应商使用。
数据结构校验和
数据结构校验和是数据结构中前511个字节之和的2的补码。每一个字节都应以无符号算术相加，溢出的部分应被忽略。当校验和正确时，数据结构中所有512个字节之和为0。
R e s e r v e d / R
所有保留字段应清零。
#### 13.7.4 Phy Event Counters Log (11h) 
详见13.9。
#### 13.7.5 NCQ队列管理日志(12h) 
为了确定支持的NCQ QUE MANAGEMENT子命令及其各自的功能，主机软件应读取日志12h。
如果支持NCQ QUE MANAGEMENT命令，则应支持该日志（IDENTIFY DEVICE字77位5设为1）。
Dword Bits 描述 0 31-5 保留NCQ Abort功能 0 4 支持4h Abort类型（Abort Selected TTag） 0 3 支持3h Abort类型（Abort Non-Streaming） 0 2 支持2h Abort类型（Abort Streaming） 0 1 支持1h Abort类型（Abort All） 0 0 支持Abort NCQ（子命令0h） 1 31-。 3 为 NCQ 截止日期功能保留 1 2 支持读数据不继续 1 1 支持写数据不继续 1 0 支持截止日期处理（子命令 1h） 2 31-1 为子命令 2h 功能保留。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织 2 0 支持子命令2h 15 31-1 保留子命令Fh功能 15 0 支持子命令Fh 128-16 31-0 保留。
## 图222--NCQ队列管理日志(12h)数据结构定义。
### 13.8 异步通知(可选) 
异步通知是指设备向主机发送通知，说明设备需要注意的一种机制。
 该机制的几个例子包括：指示媒体已插入 ATAPI 设备，或指示端口多路复用器端口上发生了热插拔事件。
这个定义并没有列出所有导致设备产生异步通知的事件。主机用于确定事件和所需操作的机制不在本规范的范围内，更多信息请参考具体设备的命令集规范。
#### 13.8.1 设置设备位 FIS 通知位 
设置设备位FIS通知'N'位由设备用来通知主机需要注意。当设备需要关注时，N位被设备设置为1，否则清零。
默认情况下，设备在设置设备位FIS中不得将N位设为1。设备应在主机启用异步通知功能后，设备才可以将Set Device Bits FIS中的N位设为1。在收到设置设备位的N位的Set Device Bits后，主机有责任对设备进行询问，并确定需要采取何种操作。
#### 13.8.2 通知机制........................................................................................。

为了表示设备需要关注，设备应向主机发出Set Devices Bits FIS，中断'I'位设为1，通知'N'位设为1。Error、Status Hi和Status Lo字段应准确反映设备中相应寄存器字段的当前值。
接收设置设备位FIS的通知位设置为1时，可使用14.1.5节中定义的SNotification寄存器向主机反映。主机可以支持异步
通知而不支持SNotification寄存器。要求主机支持
异步通知是当接收到Set Device Bits FIS时，它可能会产生一个中断；SNotification寄存器使软件能够确定该中断是由于通知事件引起的。
#### 13.8.3 异步通知的状态图......................................................。

下面的状态图定义了如果设备支持异步通知所需的行为。
通知。设备只有在处于命令层状态机所描述的可明确向主机发送设置设备位FIS的状态时，才应发送设置了Notification位的Set Device Bits FIS。该状态机是从11.2节定义的Device_idle状态进入的。支持异步通知的设备还需要支持11.2节中Device_idle和Check_command状态中对异步通知支持的增强功能。

该状态图利用了一个名为NotifyPending的内部变量。NotifyPending变量表示已经向主机发送了异步通知。当NotifyPending被清零，并且发生需要关注的事件时，可能会向主机发送异步通知。当NotifyPending设置为1，且发生需要关注的事件时，由于主机尚未确认收到最后一个异步通知，所以不得向主机发送异步通知。主机通过向设备发送一个寄存器FIS来确认接收异步通知。
AN0：Notify_host 向主机发送设置设备位FIS，该主机的'I'位设置为1，'N'位设置为1，当前状态和错误值，所有保留字段清零。设置NotifyPending为1。
1. 无条件的 DI0: Device_idle. 
#### AN0：Notify_host：当启用异步通知功能，需要向主机发送异步通知时，进入该状态。
当处于该状态时，设备应向主机发出设置设备位FIS，该主机的中断'I'位设置为1，通知'N'位设置为1，当前状态和错误字段值以及所有的
保留字段清零。内部变量NotifyPending应设为1，表示已经向主机发送了通知，但主机尚未通过接收主机的寄存器FIS进行确认。
过渡AN0:1：设备应无条件地过渡到状态DI0：Device_idle状态。
#### 13.8.4 ATAPI通知................................................................................................

ATAPI设备应在Word 78的
IDENTIFY PACKET DEVICE，请参考13.2.2节。该功能可通过使用 SET
特性，如13.3.5节所定义。
**13.8.4.1 事件实例(资料性)**。
可能导致设备向主机生成异步通知以请求关注的事件的一个例子是媒体变更事件。
 当ATAPI设备检测到设备状态发生变化时，介质变化事件就会发生 - 介质被插入或移除。
### 13.9 Phy事件计数器(可选) 
Phy事件计数器是一个可选的功能，可以获得更多关于界面上发生的Phy级事件的信息。这些信息可以帮助设计者和集成商测试和评估接口的质量。设备在IDENTIFY(PACKET)DEVICE字76，位10中表示是否支持Phy事件计数器功能。主机通过读取Phy事件计数器日志（见13.9.3）确定Phy事件计数器的当前值。计数器值不应在电源周期内保留。计数器值应在 COMRESET 和软件复位时保留。
定义的计数器分为三个基本类别：计数数据 FIS 传输期间发生的事件、计数非数据 FIS 传输期间发生的事件以及与 FIS 传输无关的事件。与FIS传输过程中发生的事件相关的计数器可以统计与主机到设备FIS传输、设备到主机FIS传输或双向FIS传输相关的事件。记录双向事件的计数器不需要是记录设备到主机FIS传输和主机到设备FIS传输中发生的相同事件的计数器的总和。

##### 高速服务器化的附件。
#### ATA国际组织 
支持Phy事件计数器的实现应实现所有强制计数器，并可支持图223所示的任何可选计数器。请注意，根据主机和设备执行非数据FIS重试的速度，一些计数器可能会以不同的方式递增。实现可能会以不同的方式记录CRC和非CRC错误事件。例如，差异性错误极有可能导致CRC错误。因此，差异性错误可能会导致记录非CRC事件的事件计数器和记录CRC事件的事件计数器对同一事件同时递增。另一个实施例差异是如何记录缺失的EOFP事件；缺失的EOFPmay意味着坏的CRC，即使FIS上的CRC可能是正确的。这些例子说明了一些
Phy事件计数器对计数器本身的实现很敏感，因此这些对实现敏感的计数器不能作为不同实现之间接口质量的绝对衡量标准。
支持Phy事件计数器的设备应实现并报告支持ATA8-ACS标准中定义的通用日志功能集。此外，设备应实现Phy事件计数器日志。
#### 13.9.1 计数器复位机制 
有两种机制可以让主机明确地使Phy计数器被重置。
第一个机制是向设备发出BIST激活FIS。当收到BIST
激活FIS后，设备应将所有Phy事件计数器复位至其复位值。此外，当主机读取Phy事件计数器日志，且Features(7:0)中的位0被设置为1时，设备应返回该命令的当前计数器值，然后重置所有Phy事件计数器值。
#### 13.9.2 计数器标识符 
每个计数器以一个16位标识符开始。图223定义了每个标识符的计数器值。日志中任何未使用的计数器槽的计数器标识符值应为0h。
未实现的可选计数器不得在Phy事件计数器日志中返回。
计数器返回的值为'0'表示没有该特定事件的实例。日志中的事件计数器没有必要的顺序，顺序是任意的，由设备供应商选择。
计数器标识符的14:12位传达计数器使用的重要位数。所有的计数器值都会消耗16位的倍数。位14:12的有效值和相应的计数器大小为。1h16位计数器 2h32位计数器 3h48位计数器 4h64位计数器
任何计数器的标识符位15设置为1的，都是特定于厂商的。这就创建了一个厂商特定的计数器标识符范围，从8000h到FFFFh。供应商特定的计数器应遵守上述定义的重要位14:12的数量。

识别符（位 11:0
强制/
可选

说明 000h Mandatory 无计数器值，标志着日志中计数器的结束。001h 强制执行命令失败，错误寄存器中的 ICRC 错误位被设置为 1。 数据 FIS 006h 设备到主机非数据 FIS 的可选 R_ERRP 应答 007h 主机到设备非数据 FIS 的可选 R_ERRP 应答 008h 设备到主机非数据 FIS 的可选重试 009h 从驱动器 PHYRDY 到驱动器 PHYRDYn 的可选转换 00Ah 强制签名设备。 由于COMRESET而发送的to-Host寄存器FIS 00Bh 可选的主机到设备FIS中的CRC错误 00Dh 可选的主机到设备FIS中的非CRC错误 00Fh 可选的由于CRC错误而发送的主机到设备数据FIS的R_ERRP响应 010h 可选的主机到设备数据FIS的R_ERRP响应。 012h 由于非CRC错误，主机到设备的非数据FIS的可选R_ERRP响应 013h 由于非CRC错误，主机到设备的非数据FIS的可选R_ERRerrors响应。
C00h
可选(端口倍增器) 主机到设备的非数据FIS R_ERRPending状态，由于碰撞。
C01h 可选（端口乘法器）签名寄存器--设备到主机FIS。
C02h 可选（端口乘法器） 设备到主机FIS的CRC传播发生错误。
## 图223 - Phy事件计数器识别器 
由于在 FIS 结束前接收到 SYNCPprimitives 而终止的 FIS（a）。
SYNC Escape）不计入R_ERRPending状态计数器。
**13.9.2.1 计数器定义**。
本节中的计数器定义规定了特定计数器标识符所代表的事件。
**1 3. 9. 2. 1. 1 I d e n t i f i e r 0 0 h**。
没有与标识符000h相关的计数器。计数器标识符 000h 表示日志中没有其他计数器。
**1 3. 9. 2.1.2 I d e n t i f i e r 0 0 1 h**。
标识符为 001h 的计数器返回返回结束状态的命令数，状态寄存器中 ERR 位设置为 1，错误寄存器中 ICRC 位设置为 1。
**1 3. 9. 2. 1. 3 I d e n t i f i e r 0 0 2 h** 
标识符为 002h 的计数器返回（传输的设备到主机的数量）的总和。
主机用R_ERRP响应的数据FIS)和(收到的主机到的数据FIS数量)。
设备用R_ERRP响应的设备数据FIS）。) 标识符 002h 返回的计数不需要等于标识符 003h 和 004h 的计数器之和。
**1 3. 9. 2. 1. 4 I d e n t i f i e r 0 0 3 h**。
标识符为 003h 的计数器返回主机以 R_ERRP 响应的传输的设备到主机数据 FIS 的数量。
**1 3. 9. 2. 1. 5 I d e n t i f i e r 0 0 4 h**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
标识符004h的计数器返回收到的主机到设备数据FIS的数量，设备用R_ERRP作出响应。标识符004h返回的计数不需要等于标识符00Fh和010h的计数器之和。
**1 3. 9. 2. 1. 6 I d e n t i f i e r 0 0 5 h**。
带标识符005h的计数器返回（传输的设备到主机的非数据FIS的数量，主机用R_ERRP响应）和（接收到的主机到的非数据FIS的数量）之和。
设备用 R_ERRP 响应的非数据 FIS。) 非数据FIS的重试也包括在这个计数中。
**1 3. 9. 2. 1. 7 I d e n t i f i e r 0 0 6 h**。
标识符为 006h 的计数器返回主机以 R_ERRP 响应的设备到主机非数据 FIS 的传输次数。非数据FIS的重试也包括在这个计数中。
**1 3. 9. 2. 1. 8 I d e n t i f i e r 0 0 7 h**。
标识符为007h的计数器返回收到的主机到设备的非数据FIS的数量，设备用R_ERRP作出响应。非数据FIS的重试次数也包括在这个计数中。
**1 3. 9. 2. 1. 9 I d e n t i f i e r 0 0 8 h**. 
标识符008h的计数器返回传输的设备到主机的非数据FIS的数量，这些FIS在重试后，主机用R_ERRP作出响应。
**13.9.2.1.10 标识符009h**。
标识符为009h的计数器返回设备转换到 "设备 "的次数。
从PHYRDYn状态，包括但不限于异步信号事件、电源管理事件和COMRESET事件。如果启用了接口电源管理，那么该计数器可能会因为接口电源管理转换而递增。
**13.9.2.1.11 标识符 00Ah*** 
标识符00Ah的计数器返回响应COMRESET时传送的带有设备复位签名的设备到主机寄存器FIS的数量，这些FIS成功地被主机发出R_OKPf。
**13.9.2.1.12标识符00Bh*** 

标识符为00Bh的计数器返回收到的所有类型（数据和非数据）的Host-to-Device FIS的数量，由于CRC错误，设备用R_ERRP作出响应。标识符00Bh返回的计数不需要等于标识符00Fh和012h的计数器之和。
**13.9.2.1.13 标识符 00Dh*** 
标识符00Dh的计数器返回收到的所有类型（数据和非数据）的Host-to-Device FIS的数量，设备因CRC错误以外的原因用R_ERRP作出响应。标识符00Dh返回的计数不需要等于标识符010h和013h的计数器之和。
**13.9.2.1.14标识符00Fh**。
标识符为00Fh的计数器返回收到的主机到设备数据FIS的数量，由于CRC错误，设备以R_ERRP回应。
**13.9.2.1.15 标识符010h**。
标识符010h的计数器返回接收到的主机到设备数据FIS的数量，除CRC错误外，设备以R_ERRP作出响应。
**13.9.2.1.16标识符012h**。
标识符 012h 的计数器返回收到的 Host-to-Device 非数据 FIS 的数量，由于 CRC 错误，设备以 R_ERRPdue 响应。
**13.9.2.1.17 标识符013h**。 
标识符为013h的计数器返回收到的主机到设备的非数据FIS的数量，设备对这些FIS的响应是R_ERRP，原因不是CRC错误。
#### 13.9.3 Phy事件计数器日志(11h) 
Phy 事件计数器日志的长度为一页（512 字节）。日志的第一个Dword包含适用于其余日志的信息。软件应继续处理计数器，直到发现值为0h的计数器标识符或整个日志已被读取。值为0h的计数器标识符表示过了该点，日志就不再包含计数器值了。图224中定义了日志11h。
如果IDENTIFY DEVICE字76位15设置为1，则可以使用READ LOG EXT或READ LOG DMA EXT命令之一读取Phy事件计数器。
如果IDENTIFY DEVICE字76位15被清零，则应使用READ LOG EXT命令读取队列错误日志。试图使用READ LOG EXT或READ LOG DMA EXT命令读取Phy事件计数器日志。
LOG DMA EXT 命令应被中止，设备的状态不会改变。
字节 7 6 5 4 3 2 1 0 0 预留 1 预留 2 预留 3 预留 n n+1
计数器 n Identifier n+2 n+ 计数器 n 长度
计数器n值
##### 508 
##### 509 
##### 510 
保留 511 数据结构校验和
## 图224 - Phy事件计数器日志数据结构定义..................................................。

计数器n标识符
对应于Counter n Value的Phy事件计数器标识符。指定正在报告的特定事件计数器。标识符的长度为16位。
有效的标识符列在图223中。
计数器 n 值
对应于Counter n Identifier的Phy事件计数器的值。有意义的位数由Counter n Identifier位14:12决定（如13.9.2节中所定义）。Counter n Value的长度应始终是16位的倍数。所有的计数器都是一扩展的。例如，如果一个计数器在物理上只实现了8位，当它的最大值为
FFh，应一延长至FFFh。计数器在达到最大值后应停止（而不是归零）。
计数器 n 长度
Phy事件计数器的大小，由Counter n Identifier的14:12位定义。
Phy事件计数器的大小应是16位的倍数。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
数据结构校验和
数据结构校验和是数据结构中前511个字节之和的2的补码。每一个字节都应以无符号算术相加，溢出的部分应被忽略。当校验和正确时，数据结构中所有512个字节之和为0。
保留 所有保留的字段应清零。
### 13.10 交错旋转（可选）。
包括许多串行ATA硬盘驱动器的存储子系统存在与系统上电期间的电流负载有关的电源系统设计问题。最好提供一个简单的机制，让存储子系统控制器可以对磁盘设备初始化和旋转进行排序。请注意，串行ATA磁盘驱动器供应商可能并不总是提供解析或执行ATA命令的能力，在设备旋转和完成设备初始化之前，因此该机制可能不依赖于ATA协议。
为了适应机柜中磁盘驱动器阵列的交错旋转，磁盘驱动器应在 Phy 初始化成功后，也就是 Phy 进入 Phy 状态后，才能旋转起来。
DP7:DR_Ready状态。磁盘驱动器可以使用任何一种方法来推迟Phy初始化前的旋转，并在设备初始化期间保持正确的接口状态。

存储子系统控制器可采用多种方法在其多个串行ATA端口上对Phy初始化进行排序，包括但不限于分阶段释放主机侧串行ATA收发器的芯片级复位，或嵌入式高级电源管理逻辑。
系统实现应理解可能需要电源管理的各种场景，以及相应的Phy初始化序列。例如，在填充存储子系统上电后，Phy通信是通过主机侧收发器产生的COMRESET信号启动的。这里使用的术语 "主机端收发器 "指的是位于存储子系统控制器上的串行ATA接口。这与将Serial ATA磁盘驱动器热插拔到运行中的存储子系统的相关序列形成对比，其中由磁盘侧收发器产生的COMINIT信号启动Phy通信。在这两种情况下，COMRESET或COMINIT信号之后都会交换COMWAKE信号。成功进入DP7:DR_Ready状态才是磁盘驱动器旋转的门槛。
在使用ATA命令使设备旋转下来的情况下，设备不得使用交错旋转机制使设备旋转起来。更多信息请参见ATA8-ACS。
### 13.11 非512字节扇区大小(信息) 
串行ATA接口没有固有的扇区大小的依赖性，而且没有任何东西在
串行ATA接口规范，排除了512字节以外的扇区大小。
无论存储设备的物理扇区大小如何，最大的数据FIS有效载荷长度是2048个Dword，如10.3.11节所定义。这可能意味着，对于扇区大小较大的设备来说，单个数据FIS所包含的物理扇区数量会减少，或者数据FIS传递的数据扇区数量不是整数。

### 13.12 缺陷管理(信息) 
#### 13.12.1 概述（信息）.........................................................................................。

基于SCSI磁盘驱动器的存储子系统已经发展出处理磁盘驱动器故障和减轻磁盘缺陷影响的流程。例如，READ DEFECT DATA (37h)和REASSIGN BLOCKS (07h)等SCSI命令已被用于允许存储管理员或应用程序主动处理磁盘表面的问题扇区。
串行ATA设备利用了桌面设备市场的经济性，因此继承了桌面设备的设计理念和实现方式。从设计理念的角度来看，桌面设备从来没有产生过低级别的控制，例如企业级设备中常见的逻辑块的重新分配。相反，桌面设备一直被定位为 "黑盒 "数据仓库。这种方法有很多好处，例如消除了缺陷管理作为计算机（O/S、文件系统、I/O、设备驱动程序）设计者的设计任务，但在某些情况下牺牲了设备的确定性性能和对缺陷管理活动的一般认识。
作为 "黑匣子 "供应商，Serial ATA设备供应商承担了缺陷管理和数据可用性的大部分责任。本节高层次地概述了Serial ATA设备供应商在这些领域采用的方法，以及系统设计者、存储管理应用设计者和系统管理员可用来最大限度地提高存储和数据可靠性的工具。
总而言之，Serial ATA设备通过SMART（自我监测、分析和报告技术）命令提供的信息与SCSI READ DEFECT返回的信息类似。
DATA命令。子系统设计者没有规定块的重新分配；而是在桌面级设备显示时，自动执行缺陷块的重新分配。此外，磁盘设备制造商提供了一系列工具和嵌入式功能，帮助防止发生不可恢复的读取错误，帮助检测可能导致灾难性数据丢失的磁盘设备退化，并帮助管理员诊断和隔离错误事件的原因。
#### 13.12.2 典型的串行 ATA 可靠性指标（信息性）.............................................。

磁盘制造商采用各种方法来恢复数据块中的坏位。首先，广泛的纠错代码（ECC）被用于 "即时 "检测和纠正错误而不影响设备性能。其次，当ECC不能在飞行中纠正错误时，可以使用各种读重试方案。只有在重试过程耗尽后，才会将错误发布到主机上。
设计建议。通过适合目标市场可靠性需求的RAID方案来适应固有的不可恢复的读取错误率。

#### 13.12.3 串行ATA缺陷管理概述(信息) 
导致不可恢复的读取错误的缺陷有两种不同的形式，即暂时性和永久性。器件制造商采用各种方案来确定缺陷的性质。如果缺陷被确定为永久性的，设备固件会将LBA重新映射到预定义的备用扇区，并将缺陷扇区标记为备用扇区。随后对重新映射的LBA的访问将以对主机透明的方式指向备用扇区。作为重新映射过程的一部分，设备会保留重映射块的错误状态，直到用新数据写入为止。
磁盘驱动器中配置的备用扇区数量通常在不同的设备供应商和设备型号中是独一无二的，并反映了设备容量和预期缺陷率之间的权衡。一般来说，备用扇区与磁盘驱动器中定义的分配组相关联。如果 
##### 在附件处进行高速小型化。
#### Serial ATA国际组织备用扇区的数量随着时间的推移而耗尽，随后的永久性缺陷导致扇区无法重新映射。受影响的逻辑块地址(LBA)会被主机操作系统或磁盘实用程序（如 "scandisk"）识别为不良，并随后无法使用。
设计建议。如果主机或串行ATA存储子系统遇到不可恢复的读取错误，该错误由磁盘驱动器管理。磁盘驱动器负责在传达错误状况之前执行广泛的读取重试过程，行使内部设备诊断以确定错误的性质，并在必要时重新映射物理扇区。随后对该逻辑地址的访问被引导到磁盘上的已知良好区域。
如果启用了写入缓存，则应注意确保备件不会耗尽。如果没有采取这种谨慎措施，就有可能出现写操作实际上不能成功完成，并及时向主机返回适当的错误条件。请参考13.12.5节中关于SMART的信息，监控备件状态。
在特别关键的数据应用中，可以对磁盘驱动器日志进行特定的查询，以确定错误事件是否是随机事件，或者是否存在一些需要系统或管理员采取额外行动的降级条件。
在存储子系统中，已知的良好数据可以从冗余源中恢复（例如在RAID子系统中），建议将已知的良好数据写回任何报告有读取错误的LBA。这种行为确保磁盘驱动器有机会补救错误条件，并将已知的好数据写入磁盘上的已知好块，无论这些块是永久错误条件导致的重映射块，还是可能受到临时性错误影响的相同块。保证后续的读访问满足无误。
#### 13.12.4 连续后台缺陷扫描（信息性的 
串行ATA设备供应商可能采用称为连续背景缺陷扫描(CBDS)的方案，在闲置期间，使用固件例程扫描磁盘上的扇区，以查找和纠正缺陷。因此，CBDS是作为后台任务执行的。CBDS 的效果是通过主动 "清理 "良好扇区的缺陷或将数据从磁盘上的可疑区域复制到备用扇区，减少不可恢复的读取错误的发生。在SMART规范中对CBDS进行了更详细的描述，该规范还提供了启用/禁用该功能的方法。
设计建议。在评估系统省电方案时，考虑CBDS的要求，因为这些方案可能会在明显的闲置期间关闭磁盘驱动器的电源。
#### 13.12.5 自我监控、分析和报告技术(信息) 
有些磁盘故障是可以预测的。这种故障机制的特点是随着时间的推移而退化，在某些情况下，可以由磁盘驱动器进行有效监控，并记录下来，定期向存储经理或管理实用程序报告。
ATA8-ACS标准详细描述了SMART命令支持。各个设备供应商在其设备上提供了独特的SMART功能，并提供了关于这些功能的文档，以便主机或控制器开发人员可以有效地使用预测性故障信息。
设计建议。在可能的情况下，利用ATA SMART命令提供的功能来预测磁盘故障。预测知识可用于交换备用磁盘驱动器。
RAID配置，触发数据备份或保护程序，或安排存储子系统维护。

### 13.13 机柜服务/管理(可选) 
#### 13.13.1 概述 
提供支持行业标准SAF-TE（SCSI访问容错）的方法。

为了提高Serial ATA存储子系统的功能，提供了SES（SCSI机箱服务）机箱服务。无需对机柜内的Serial ATA设备进行修改。
存储外壳处理器(SEP)是一种与存储外壳子系统内各种传感器和指示器接口的设备。串行ATA机柜管理桥(SEMB)是一种允许串行ATA主机控制器或端口多路复用器与SEP通信的设备，在主机和机柜处理器之间起桥梁作用。本节为软件定义了一个标准接口，用于通过ATA命令块与SEMB设备通信
寄存器。它还定义了SEMB设备如何使用I^2 C IPMI协议与SEP设备通信。为了让软件与SEMB有效通信，SEMB被视为连接到存储子系统的另一个串行ATA设备。SEMB可以在Serial ATA主机控制器内实现，在端口倍增器内实现，或者作为主机和SEP之间的硬件桥梁。
在本规范中，主机(Serial ATA RAID控制器或HBA)可以使用SAF-TE或SES命令协议与SEP进行控制/状态通信。这些协议提供了必要的功能，并且具有众所周知和广泛实施的优势，因此应该尽量减少对RAID控制器固件和主机管理软件的影响。实现上要求支持机柜管理的Serial ATA主机控制器或Port Multipliers有一个I^2 C接口与SEP设备通信。
本规范还解决了支持通用和标准化接口的需求，允许不同厂商的应用软件与管理设备进行通信。
这是通过使用ATA发送/接收适当的命令来实现的。
命令块寄存器集（或串行ATA寄存器FIS）使用与该接口相关的READ SEP/WRITE SEP命令。ATA命令块寄存器接口可以与子系统中的其他设备保持一致，而且使用简单，好理解。
#### 13.13.2 拓扑结构 
机柜服务支持机制应支持需要此类机柜服务的存储子系统（如外部存储机柜）的预期配置和拓扑。图225展示了一个通用配置。
集中器是将主机接口连接到一个或多个串行ATA设备的控制器逻辑。通常，集中器是一个RAID控制器或端口多路复用器，但它也可以是一个简单的HBA或集成多功能芯片组的一部分。由于集中器可能会因实施情况不同而有不同的体现，因此使用通用术语以避免暗示任何特定的实施。
主机接口是主机与集中器进行通信的接口。
对于插入PCI插槽的RAID控制器来说，主机接口是PCI，而对于外部的RAID控制器来说，主机接口是PCI。
存储子系统中的RAID控制器，主机接口可能是光纤通道、InfiniBand。
架构、以太网(iSCSI)或任何不同的外部子系统互连。
SEMB(Serial ATA 机柜管理桥)是将主机接口的机柜管理数据连接到机柜管理总线(图中以I^2 C表示)的逻辑。对于智能PCI RAID控制器来说，SEMB可能是运行在RAID处理器上的固件和相关的设计特定的I^2 C控制器接口逻辑，而对于端口多路复用器来说，SEMB是通过逻辑ATA命令块寄存器接口将I^2 C接口（和事务）连接到串行ATA的控制器逻辑。

##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
SEP（存储机柜处理器）与机柜中的各种传感器和指示器（如温度传感器、风扇转速计和指示灯）连接。
SEP（存储机柜处理器）与机柜中的各种传感器和指示器连接，如温度传感器、风扇转速和指示灯。
SSEEMMBB 
SSEEPP 
GGPPIIOO
二^22 CC
SSAATTAA
HHoossttII//FF
## 图225 - 通用外壳服务拓扑 **13.13.2.1 定义配置**。
定义配置是从图225中的通用拓扑结构中提炼出来的，其中为了使定义清晰，删除了无关的元素。对于定义配置，主机接口被选择为串行ATA，因为这导致了暴露在定义中的最大数量的接口/元素。在实践中，各种元素可能被集成到另一个子系统元素中（例如，SEMB可能被集成到RAID控制器或端口倍增器中）。为了定义的缘故，这些元素被单独显示出来，解决方案就像它是一个串行ATA目标设备一样。在这样的配置中，SEP只是作为另一个暴露的Serial ATA设备。
 这种配置最类似于现有的SCSI机箱服务方案，其中机箱服务设备是使用SCSI目标ID实现的。对于这种配置，机箱服务桥接器和相关的存储机箱处理器作为单一用途的ATA设备暴露出来。
HHBBAA SSEEMMBB SSEEPP 
二^22 CC GGPPIIOO
SSeerriiaallAATTAA
HHoosstt
CCoonnttrroolllleerr
IIntteerrffaaccee
## 图226----通用拓扑的简化图。
由于上图中的HBA（主机总线适配器）是一个标准的串行ATA HBA，因此是固定的，因此本节所定义的元素可以进一步简化为图227中的定义配置，将外壳服务设施呈现为一个ATA设备，具有
命令块寄存器接口。

SSEEMMBB 
#### SSEEPP 
GGPPIIOO
二^22 CC
LLooggiiccaall
IIntteerrffaaccee ATATAT
##### AA 
##### RR eeg gi iss tete rr.
In In tete rfrf aac cee
HHBBAA 
SSAATTAA
II/FF
LLooggiicc 
SSAATTAA
II/FF
LLooggiicc 
#### BBrriiddggee 
#### LLooggiicc 
SSAATTAA
## 图227 - 机柜服务定义配置 
对于SEP不与它的前端SEMB或等价物打包提供的实施例(即SEP和SEMB由不同的供应商提供)，建议这两个元素之间的互连是I^2 C，并且该互连的命令协议在第13.13.4.2节中定义。对于SEP与SEMB由同一供应商提供的实施例，这些元件之间的互连可能是特定于厂商的(对于这两个元件被集成的情况，可能是嵌入式的)。
同样，对于SEMB与前端HBA或同等设备打包的实施，这些元素之间的互连可能是厂商特定的，并且不需要是串行的。
ATA（在某些配置中，SEMB可能被集成到HBA中，在这种情况下，这两个逻辑元素之间的互连是嵌入式的）。
#### 13.13.3 限制............................................................................................................

为了适应一系列可能的实现，本节定义的接口和元素比任何一个设计/实现通常会使用的更多。只有那些暴露的接口和来自不同厂商的互连成分才有望利用本节中描述的相应定义和规范。例如，一个智能RAID控制器可能有SEMB功能实现作为固件运行在嵌入式RAID处理器上，这样的解决方案不会暴露SEMB前端接口，这将是厂商特定的(即内部的RAID卡和由厂商提供的固件管理)。然而，这样的解决方案可能会暴露I^2 C接口，如果它与另一个厂商的SEP互连，因此需要遵守I^2 C接口之间的通信规范。
教育統籌局局長和教育局局長。
#### 13.13.4 定义 
本规范支持与SAF-TE协议相同的外壳管理命令/状态（加上附录）。由于SAF-TE在当前的SCSI应用中被广泛使用，所以尽量重用数据格式是一个很自然的途径。本规范还支持SCSI-3附件中定义的SES外壳管理命令/状态。
服务命令集规范。具体参考资料请参见第3节。
对于串行ATA寄存器集的情况，现有ATA任务文件的一个子集用于创建从SEP设备发送/接收数据的命令。在可能的情况下，使用了与现有ATA协议相同的命令结构。所有的SEP命令都是用命令寄存器中的SEP_ATTN操作码向SEMB发出的，实际的SEP命令作为参数在Features(7:0)中传递。第13.13.4.3节和13.13.4.4节定义了主机到?
SEP和SEP到主机的命令协议。

##### 高速串行化在附件中的应用 
#### ATA国际组织系列**13.13.4.1发现**。
在COMRESET或软件复位后，如果SEMB检测到有附加的SEP存在，则SEMB应将图228中确定的唯一SEMB专用签名放入逻辑命令块寄存器中。该签名应可在逻辑
命令块寄存器不迟于复位操作（无论是开机复位、COMRESET或软复位）后3秒。对于实现SEMB独立于SEMB的情况下，必须在复位操作（无论是开机复位、COMRESET或软复位）后3秒内完成。
HBA，命令块寄存器签名应通过使用寄存器-设备到主机FIS的串行ATA互连进行传输。
寄存器 7 6 5 4 3 2 1 0
错误 00h
Count(7:0) 01h
计数(15:8) 00h
LBA(7:0) 01h
LBA(31:24) 00h
LBA(15:8) 3Ch
LBA(39:32) (^) 00h
LBA(23:16 C3h
LBA(47:40) 00h
设备名称
状态 BSY DRDY DF DSC DRQ 0 0 ERR
状态=50h 
## 图228--表明存在外壳服务设备的注册签名。
................

如果SEMB没有检测到附加的SEP的存在，那么SEMB应将图229中确定的签名放入逻辑命令块寄存器中，以便向主机传达在逻辑接口处没有设备存在，并且SEMB不应对任何后续命令块寄存器的访问或发出的命令作出响应，直到下一次COMRESET或软件复位。对于SEMB与主机分离的实施例
HBA，命令块寄存器签名使用寄存器-设备到主机FIS在串行ATA互连上传输。
寄存器 7 6 5 4 3 2 1 0
错误 FFh
计数(7:0) FFh
计数(15:8) FFh
LBA(7:0) FFh
LBA(31:24) FFh
LBA(15:8) FFh
LBA(39:32) (^) FFh
LBA(23:16 FFh)
LBA(47:40) FFh
设备FFh
状态^01111111
状态=7Fh 
## 图229 - 缺席外壳处理器的注册签名..............................................。
 
除设备复位签名外，SEP应支持13.13.5.1节所述的IDENTIFY SEP命令，以便主机软件确定其能力，并识别其是否支持SAF-TE或SES命令集。
**13.13.4.2逻辑命令块寄存器到I**^2 **C映射**。
SEMB提供了SEP和SEMB之间的交易映射和转换，以及通过逻辑命令块寄存器接口呈现给主机的交易。
**13.13.4.2.1 命令交付**。
命令由SEMB通过命令块寄存器接口传递给SEP，作为命令或设备控制寄存器被写入的结果（如果SEMB逻辑寄存器接口与主机/HBA紧密耦合）或响应寄存器FIS的接收（如果SEMB逻辑寄存器接口与主机/HBA紧密耦合）。
SEMB逻辑寄存器接口在串行ATA物理互连的远端）。)
命令由SEMB通过I^2 C传递给SEP，SEMB从命令块寄存器（或接收寄存器FIS）中提取SEP命令和命令类型字段，并将字段转发给SEP。如果SEP是离散的，并通过I^2 C互连，那么SEP的命令就会在I^2 C上传递给SEP。
SEP命令字段被打包成I 2的形式。
帧，并通过I 2转发到SEP。
C互连。SEMB逻辑命令块寄存器遵守相同的约定，如
串行ATA，用于处理BSY位。BSY位由接口/SEMB在响应命令寄存器被写入时设置，SEP随后清除该位以指示命令完成/状态。
对于发出命令，SEMB应产生并传送一个I 2
根据命令块寄存器或寄存器FIS的内容，C包。命令块寄存器或寄存器FIS的映射。
对传输的I^2 C数据包进行注册，只能对使用
SEP_ATTN操作码，SEMB不需要响应命令寄存器中的任何其他操作码。命令块寄存器对I^2 Cpacket的映射应如图230所示。
寄存器7 6 5 4 3 2 1 0
特点(7:0) (^)SEP_CMD
特写(15:8) (^) 保留。
计数(7:0) LEN
计数(15:8) 保留
LBA(7:0) CMD_TYPE...。
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 保留 0 保留
命令 SEP_ATTN（67h）。
## 图230 - 机柜处理器通信中使用的命令块寄存器字段。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
SEP_CMD 要与 CMD_TYPE 中指定的命令类型一起发出的 SAF-TE 或 SES 命令代码。
SAF-TE READ BUFFER的用法。SEP_CMD相当于SCSI READ BUFFER命令的BUFFER ID字段。命令代码及其功能请参见SAF-TE规范参考中的3.1节。
SAF-TE WRITE BUFFER的用法。SEP_CMD相当于SCSI WRITE BUFFER命令参数数据中传输的OPERATION CODE字段。
命令代码及其功能参见SAF-TE规范参考中的3.2节。
SES RECEIVE DIAGNOSTIC RESULTS用法。SEP_CMD相当于
SCSI RECEIVE DIAGNOSTIC RESULTS 命令的 PAGE CODE 字段。
有关命令代码及其功能，请参见SES规范参考文献的6.1节。
SES SEND DIAGNOSTIC的用法。SEP_CMD相当于SCSI SEND DIAGNOSTIC命令参数数据中传输的PAGE CODE字段。命令代码及其功能请参见SES规范参考文献的6.1节。
IDENTIFY SEP用法。SEP_CMD等于ECh。
LEN 命令的数据传输阶段的传输长度，单位为Dword。
有效值为1-255（得出最大传输长度为1020字节）。不是 4 字节的倍数的数据传输将由发送器用 0 填充到下一个 4 字节 (Dword) 粒度。
CMD_TYPE
标志表示发出的SEP命令是SAF-TE命令码还是SES命令码，数据传输方向是SEP到主机还是主机到SEP。

该字段的编码如下。00h SAF-TE命令代码，带有SEP到主机的数据传输，包括以下内容。
IDENTIFY SEP 80h SAF-TE命令码，主机到SEP的数据传输 02h SES命令码，SEP到主机的数据传输，包括IDENTIFY。
SEP 82h SES指令代码，主机到SEP的数据传输。
保留所有其他价值
由此产生的传递命令的I^2 C帧如图231所示。
SEP
地址
R/W (0)
A CMD_TYPE A CHK
SUM
A SEMB
地址
A SEQ (0)
A SEP_CMD A ...剩下的交易... ...
从主站到从站 从从站到主站
## 图231 - I^2 C框架，用于传送机柜服务命令。
SEMB不需要支持任何命令寄存器写入的值比SEP_ATTN更多。在响应命令寄存器写入SEP_ATTN以外的值时，SEMB应将SEP_ATTN的值设置为SEP_ATTN。
ERR位，并清除状态寄存器中的BSY位。对于这种非法的主机行为，
SEMB不得为该非法命令产生任何I^2 C流量。SEMB应支持设备 
控制寄存器写入时，SRST位的状态发生变化，但对SRST不改变状态的设备控制寄存器写入时，不应采取任何行动。
SEP不必同时支持SAF-TE和SES命令协议。响应SEP命令问题，SEP不支持的协议，SEP应以13.13.4.2.2节中定义的错误状态返回。
**13.13.4.2.2 状态机制**。
SEMB通过将BSY位清零，向主机指示命令完成。
状态寄存器，并通过触发中断。SEP状态返回给SEMB的内容仅包括
状态字节，没有其他命令块寄存器用来传递状态。如果SEP遇到了一些错误条件或不支持发出的SEP命令，那么状态寄存器中的ERR位被设置为1。
如果SEP是通过I^2 C互连与SEMB通信，那么状态字节就包括在SEP读写定义中所示的交易结束时。在将状态值转入状态寄存器后，SEMB应将BSY位清零并发出中断信号。如果SEMB通过串行ATA互连连接到主机，则应将结束状态收集在寄存器FIS中并传送给主机。为了响应读写SEP命令，返回SEP_CMD和CMD_TYPE字节值。
当一个命令成功完成后，状态寄存器中的状态值应为50h。
当出现错误时，状态寄存器中的状态值为51h。
**13.13.4.3 主机到SEP的数据命令**。
所有主机到SEP的数据传输都会传输一个数据有效载荷，其长度如命令的LEN字段所示。SAF-TE和SES参考定义了支持的命令和功能，以及传输数据结构的格式。
所有的SEP命令都是通过Command寄存器中的SEP_ATTN命令（操作码67h）和Features(7:0)中的SEP命令代码来发布的，如命令块中所示。
图232的寄存器图像。CMD_TYPE字段标识发出的SEP命令是读还是写，以及命令协议是SAF-TE还是SES。
寄存器 7 6 5 4 3 2 1 0
特点(7:0) (^)SEP_CMD
特写(15:8) (^) 保留。
计数(7:0) LEN
计数(15:8) 保留
LBA(7:0) CMD_TYPE (80h 或 82h)
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 保留 0 保留
命令 SEP_ATTN（67h）。
## 图232 - WRITE SEP命令块寄存器................................................................。
 
##### 在附件处进行高速序列化。
#### ATA国际组织 
主机到SEP的数据传输命令后，应由主机进行数据传输，完成SEP命令的传递。如果命令是通过I^2 C接口传送给SEP，则传送的I^2 C数据包应采用图233所示形式。
SEMB(主站)到SEP(从站)传输--同时传输命令和数据。
SEP
地址
R/W (0)
A CMD_TYPE A CHK
SUM
A SEMB
地址
A SEQ (0)
A SEP_CMD A ... ...
... Data[0] A Data[1] A .... 数据[LEN*4- 1] ....
A CHKSUM A P
SEP(主站)到SEMB(从站)的转移--转移状态。
S SEMB
地址
R/W (0)
A CMD_
类型
A CHK
SUM
A SEP
地址
A SEQ (0)
A SEP_
CMD
A SEP
状态
A CHK
SUM
A P
从主人到奴隶 从奴隶到主人
## 图233 - I^2 C对应WRITE SEP命令的事务。
用于串行ATA外壳服务流量的I^2 C传输应符合主站到从站（IPMB）。参见IPMB和I^2 C参考资料，以了解IPMB的主从传输惯例的细节。
主机应使用DMA协议将数据从主机传输到SEMB，如果SEMB与主机之间的接口是Serial ATA接口，则SEMB应触发
通过向主机发送DMA激活FIS来传输DMA数据。
**13.13.4.4 SEP到主机的数据命令**。

所有SEP到主机的数据传输都会传输一个数据有效载荷。命令的LEN字段表示传输的数据有效载荷的长度。SAF-TE和SES参考定义了支持的命令和功能，以及传输数据结构的格式。这两个
SAF-TE和SES SEP应支持IDENTIFY SEP命令，这两个命令集的格式相同。
所有的SEP命令都是使用命令寄存器中的SEP_ATTN命令(操作码67h)和特征(7:0)中的SEP命令代码来发布的，如命令块所示
图234的寄存器图像。CMD_TYPE字段标识发出的SEP命令是读还是写，以及命令协议是SAF-TE还是SES。

寄存器 7 6 5 4 3 2 1 0
特点(7:0) (^)SEP_CMD
特写(15:8) (^) 保留。
计数(7:0) LEN
计数(15:8) 保留
LBA(7:0) CMD_TYPE (00h 或 02h)
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 保留 0 保留
命令 SEP_ATTN（67h）。
## 图234 - READ SEP命令块寄存器 
SEP到主机的数据传输命令之后，应从设备到主机进行后续的数据传输，以完成SEP命令。如果命令是通过I^2 C接口传递给SEP，则传输的I^2 C数据包应采用图235所示的形式。
SEMB(主站)到SEP(从站)传输--传输命令。
SEP
地址
R/W (0)
A CMD_
类型
A CHK
SUM
A SEMB
地址
A SEQ (0)
A SEP_C
MD
A CHK
SUM
A P
SEP(主站)到SEMB(从站)的传输--同时传输数据和状态。
S SEMB
地址
R/W (0)
A CMD_TYPE A CHK
SUM
A SEP
地址
A SEQ (0)
A SEP_CMD A ... ...
... SEP_CMD
状态
A 数据[0] A 数据[1] A ... 数据[LEN*4- 1]
A CHKSUM A P
从主人到奴隶 从奴隶到主人
## 图235 - I^2 C与READ SEP命令相对应的事务。
主机应使用 DMA 协议将数据从 SEMB 传输到主机。
#### 13.13.5 SES和SAF-TE扩展 **13.13.5.1 IDENTIFY SEP命令（ECh）**。
SAF-TE和SES SEP都应支持这里定义的IDENTIFY SEP命令。识别SEP命令。
IDENTIFY SEP命令是一个SEP到主机的命令代码，用作SEP_ATTN命令的SEP命令参数，CMD_TYPE值根据使用的命令协议设置为00h或02h（见13.13.4.2.1节）。该命令返回一个数据结构，描述所连接的SEP的能力和属性。IDENTIFY SEP命令要求SEP返回外壳的具体信息（不是设备或环境信息）。该命令大致类似于SCSI INQUIRY命令。

##### 高速串行化在连接处 
#### ATA国际组织 
对于定义为ASCII字符字符串的参数，ASCII数据字段应只包含图形代码（即代码值20h至7Eh），所有字符串应以空格字符填充到字段的整个宽度。对于字符串 "Copyright"，字符 "C "是第一个字节，字符 "o "是第二个字节，等等。
**13.13.5.1.1 IDENTIFY SEP数据结构**。
图236描述了由SEP响应于
IDENTIFY_SEP命令。所有保留字段应清零。通过设置发出的Read SEP命令的LEN字段，可以控制返回的数据量（即通过不传输数据结构末尾的保留字节和厂商特定字节来缩短传输时间）。
IDENTIFY SEP数据结构通常为64字节长，可以扩展以支持更大的厂商特定的ENCLOSURE信息。
该数据结构不包括外壳中元素的列表。
该数据块提供外壳描述符信息和参数。
字节 字段名称 0 封箱描述符长度 1 子封箱标识符 2-9 封箱逻辑标识符 10-17 封箱供应商标识符 18-33 产品标识符 34-。 37 产品修订级别 38 渠道标识符 39-42 软件修订级别 43-48 接口标识字符串 49-52 接口规格修订级别 53-63 供应商规格内含信息
## 图236 - IDENTIFY SEP数据结构定义 
##### 封面描述器长度。
ENCLOSURE DESCRIPTOR LENGTH字段指定IDENTIFY SEP数据结构中包含的有效字节数。
SUB-ENCLOSURE IDENTIFIER(子目录)
如SES参考文献中所定义。除非定义了子封套，否则该字段应清零。
ENCLOSURE LOGICAL IDENTIFIER（封套逻辑标识符）。
ENCLOSURE LOGICAL IDENTIFIER 字段包含子机箱的唯一逻辑标识符。它应使用一个 8 字节的 NAA 标识符，其格式在 SCSI Primary Commands 参考资料中定义。ENCLOSURE
LOGICAL IDENTIFIER对外壳来说是唯一的，可能与提供外壳服务的设备的全球名称不同。此字段的组合，以及围护设备供应商标识和

PRODUCT IDENTIFICATION字段，唯一标识任何制造商的任何SEP单元。世界范围内的名称应该有一个5h的NAA字段，表示IEEE是命名机构。

##### 容器供应商识别信息 
ENCLOSURE VENDOR IDENTIFICATION 字段应包含机柜供应商的标识字符串，格式与标准 SCSI INQUIRY 数据中供应商标识字段的指定格式相同（参见 SCSI Primary Commands 参考资料）。ENCLOSURE VENDOR
IDENTIFICATION可能与提供外壳服务的设备的供应商标识不同。
产品标识
PRODUCT IDENTIFICATION 字段应包含机柜的产品标识字符串，其格式与标准 SCSI INQUIRY 数据中的产品标识字段所指定的格式相同（请参见 SCSI Primary...）。
命令参考）。) PRODUCT IDENTIFICATION 字段可能与提供外壳服务的设备的产品标识不同。
产品修订级别（PRODUCT REVISION LEVEL
PRODUCT REVISION LEVEL 字段应包含机柜的产品修订级别字符串，其格式与标准 SCSI INQUIRY 数据的产品修订级别字段的指定格式相同（请参阅 SCSI Primary Commands 参考资料）。PRODUCT REVISION LEVEL 可能与提供外壳服务的设备的产品修订级别不同。
CHANNEL IDENTIFIER
CHANNEL IDENTIFIER字段用于区分单个机柜支持的不同HBA通道（例如通过多个/冗余主机连接）。此字段中的值对每个通道都是唯一的。此字段是可选的，如果不使用，应清零。
FIRMWARE REVISION LEVEL（软件修订级别
FIRMWARE REVISION LEVEL 字段是一个 4 字节的 ASCII 字符串，用于标识 SEP 设备当前的固件版本。
接口标识字符串
INTERFACE IDENTIFICATION STRING 字段是一个 6 字节的字段，其中包含常量 ASCII 字符串 "SAF-TE"（如果命令是在 CMD_TYPE 字段中设置了 SAF-TE 协议位且 SEP 支持该协议的情况下发出的）或 "S-"。
E-S"（如果命令是在 CMD_TYPE 字段中设置了 SES 协议位且 SEP 支持该协议的情况下发出的）。其作用是标识外壳符合在发出 IDENTIFY SEP 命令时使用的 CMD_TYPE 字段所指示的命令协议。
接口规格修订级别
INTERFACE SPECIFICATION REVISION LEVEL 字段是一个 4 字节的字段，其中包含一个格式为 "x.xx "的 ASCII 字符串，它标识了 INTERFACE SPECIFICATION REVISION LEVEL 的修订。
该SEP设备声称符合的接口规范。ASCII 字符串数据以最重要（最左）的字符存储在字段的最低字节偏移处。
厂商指定的封装信息
VENDOR-SPECIFIC ENCLOSURE INFORMATION字段可供厂商特定定义和使用。
**13.13.5.2 活动LED控制**。
SES和SAF-TE协议提供的命令用于告知SEP设备其每个相关槽位的状态和可能插入的设备。这些信息用于驱动外壳状态信号（LED、LCD、声音报警等）到某种有意义的状态。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织或强制SEP按要求以预编程响应；取决于供应商的实现。
由于串行ATA设备不一定会提供活动指示，因此SAF-SEP的扩展也是如此。
13.13.5.2.1和13.13.5.2.2节中定义了TE和SES设施，以适应外壳处理器用于提供操作员活动指示的方式。
**13.13.5.2.1 SAF-TE - 写设备插槽状态修改**。
SAF-TE写入设备槽状态的有效数据长度取决于该通道上设备槽的数量( d )。通道上每个设备槽有三个字节的数据，相关的数据结构定义在图237中。
Bit/Byte 7 6 5 4 3 2 1 0 0 Slot 0 Byte 0 1 Slot 0 Byte 1 2 Slot 0 Byte 2 d*3-3 Slot d-1 Byte 0 d*3-2 Slot d-1 Byte 1 d*3-1 Slot d-1 Byte 2 d*3 ...63
厂商专用
## 图237 - SAF-TE写设备插槽状态数据结构。
串行ATA对字段定义的修改如下。
槽d 字节0 如SAF-TE中定义的那样
槽 d 字节 1 根据 SAF-TE 中的定义修改。
位 0-1 按照 SAF-TE 中的定义。
位2 DR_ACT：由主机设置为1，在向与该插槽相关联的设备发出命令时，指示设备活动。(在SAF-TE参考中定义为保留)
位 3-7 如 SAF-TE 中所定义。
槽d 字节2 SAF-TE中定义的
如果一个设备槽的任何字节中没有设置标志，这就是一个NO CHANGE FROM CURRENT STATE指示。这允许主机改变一个特定设备插槽的状态，而不必知道所有设备插槽的当前状态。
 设置一个或多个标志需要将所有标志写入正确的二进制值。因此，更改之前应先读取相应的设备槽状态，并以 "读-修改-写 "的操作方式实现写入设备槽状态。
**13.13.5.2.2 SES-设备元素定义修改**。
图238中定义了外壳控制页中设备元件类型的控制信息字段的格式。通过在字节2的第7位增加设备活动控制位(DR_ACT)来修改数据结构(该位在SES参考中定义为保留)。

位
字节数
##### 7 6 5 4 3 2 1 0 
##### 0 COMMON CONTROL 1 保留 2 DR_ACT DO NOT
删除
保留 RQST
插入
RQST
删除
RQST
IDENT
Rsrvd 3 保留 RQST
错
设备
关
ENABLE
BYP A
ENABLE
BYP B
保留
## 图238 - SES设备元素数据结构 **13.13.5.2.3 活动指示行为和操作**。
主机将DR_ACT位设置为1，将外部DRIVE ACTIVITY LED设置为 "on"。作为回应，SEP应以厂商特定的速率闪烁相关的LED。LED应闪烁约0.5秒，之后该位将被SEP自动清零（LED停止闪烁）。
**13.13.5.3 插槽到端口的对应关系**。
对于主机连接和设备插槽之间没有直接一一对应关系的存储子系统，需要一个对应惯例，以确保主机有办法准确控制特定存储设备的正确外壳插槽。
没有直接对应关系的配置包括那些在主机和设备之间有影响直接对应关系的干扰元素的配置，如使用串行ATA端口乘法器时的情况。
图239说明了主机连接和外壳设备插槽之间没有直接对应关系的配置。

##### 高速串行化接口 
#### ATA国际组织 
## 图239 - 示例子系统...............................................................................................。
 **13.13.5.3.1 SAF-TE对应定义（可选）**。
图240定义了SAF-TE SCSI ID字段约定，用于建立主机连接和外壳插槽之间的对应关系。支持SAF-TE的SEP可以选择采用这个约定。如果一个机箱符合这个对应定义，它将把读取机箱配置命令返回的数据中字节7的第0位设置为 "1"。如果机箱不符合这一对应定义，则应清除 "读取机箱配置 "命令返回的数据中字节7的位0，将其置为 "0"。
如果执行了这个对应惯例，那么SCSI ID将用于读取附件配置命令中的SCSI ID。
机箱状态命令，每个设备插槽的SCSI ID将返回给主机。该对应关系也应被主机用于Set SCSI ID命令中指定的SCSI ID。一个空的或未使用的插槽应具有一个FFh的SCSI ID；一个FFh的SCSI ID不应被用来标识一个活动的设备插槽。
位
外地
##### 7 6 5 4 3 2 1 0 
SCSI ID 端口通道
## 图240 - SAF-TE设备ID字段约定。
通道 通道字段对应于一个主机连接。对于给定的机柜槽，它表示该槽与哪个主机连接相关联。在有端口多路复用器介入的情况下，通道字段表示相关端口多路复用器的上游端口连接到哪个主机通道。槽位中的
通道值从零开始串行分配，并相应地在主机连接包装上显示。

端口 端口字段对应于一个设备连接。对于给定的机柜插槽，它表示该插槽与介入的多端口控制器的哪个端口相关联。在介入的控制器是端口多路复用器的情况下，端口字段表示该插槽连接到端口多路复用器的哪个端口，并对应于FIS中用于寻址设备的PM端口字段。在没有介入的多端口控制器的情况下，该字段为零。
对于图239中的配置，外壳中插槽0对应的SCSI ID值为33h，而外壳中插槽3对应的SCSI ID值为03h。
13.13.5.3.2 SES 对应定义（可选）**13.13.5.3.2 SES 对应定义（可选）** 
图241定义了SES插槽地址字段约定，用于建立主机连接和外壳插槽之间的对应关系。支持SES的SEP可以选择采用这个约定。确定外壳是否符合这种对应定义的方法是由厂商特定的，或由SES-2规范定义的。
SEP应在外壳状态页中设备元素类型（元素类型01h）的状态信息字段中使用此约定（如果已实施）。
 该字段中设备类型元素的第一个字节是插槽地址，应按图241的规定设置。机柜状态页用接收诊断结果命令读取。
位
外地
##### 7 6 5 4 3 2 1 0 
槽位地址 端口通道
## 图241 - SES插槽地址字段约定.........................................................................。

Channel Channel字段对应于一个主机连接。对于一个给定的机柜槽，它表示该槽与哪个主机连接相关联。在有端口多路复用器介入的情况下，Channel字段表示相关端口多路复用器的上游端口连接到哪个主机通道。槽位中的
通道值从零开始串行分配，并相应地在主机连接包装上显示。
端口 端口字段对应于一个设备连接。对于给定的机柜插槽，它表示该插槽与介入的多端口控制器的哪个端口相关联。在介入的控制器是端口多路复用器的情况下，端口字段表示该插槽连接到端口多路复用器的哪个端口，并对应于FIS中用于寻址设备的PM端口字段。在没有介入的多端口控制器的情况下，该字段为零。
对于图239中的配置，机柜中槽位0对应的槽位地址值为33h，而机柜中槽位3对应的槽位地址值为03h。
#### 13.13.6 机柜服务硬件界面 
对于机柜/背板不与存储子系统控制器捆绑的实现，建议机柜和控制器使用的带外机柜服务接口为I^2 C，第13.13.6.1节定义了机柜/背板与存储子系统控制器之间的连接器和电缆互连。
**13.13.6.1 I**^2 **C电缆/连接器定义**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
存储子系统控制器不直接连接到机柜/背板的实施方案，需要在背板和控制器之间为I^2 C机柜服务总线建立互连。例如，使用基于PCI的Serial ATA的独立系统，需要在背板和控制器之间进行I^2 C机箱服务总线的互连。
RAID控制器和带有前面板可访问设备的背板，需要将源自PCI控制器的I^2 C接口连接到与各种存储设备和操作指示灯(LED)接口的背板上。
利用I^2 C提供外壳服务并希望与其他产品进行互操作/互换的产品，应使用Molex莫仕产品号22-43-6030或同等产品作为总线连接器。该连接器与IPMB连接器具有相同的足迹/尺寸，但其颜色为白色，而不是实际IPMB连接器使用的黄色。
**13.13.6.2 SEP的发现和枚举**。
对于SEP是I^2 C设备且不作为完整存储解决方案的一部分提供的实施方案（即打算与另一厂商提供的SEMB进行通信），SEP是一个I^2 C设备。
SEP应与SEMB有一个专用的I^2 C接口，不应与外壳传感器和指示器共享I^2 C接口。
为了使SEMB能够有效地发现和枚举一个附加的SEP，在存储子系统中连接到SEMB的I^2 C总线上的第一个SEP应被分配I^2 Caddress C0h（注意，I^2 C地址字段的LSB是R/W位，有效地导致I^2 C地址字段的长度为7位）。一个SEMB直接只支持一个SEP，所以使用一个以上的
连接到存储子系统中同一SEMB的SEP是厂商特定的。任何额外的
存储子系统中同一I^2 C接口上的SEP应连续分配给更高的接口。
I^2 C地址。
### 13.14 硬盘活动指示 (可选) 
存储设备状态和活动的操作员通知/指示可以由主机通过第13.13节中定义的外壳服务设施或通过其他主机驱动的方式来驱动。
操作员对存储设备状态和活动的通知/指示也可以通过智能处理器（如IO处理器）来驱动。参考SAF-TE写入设备插槽。
SAF-TE参考文献中的状态命令和13.13.5.2.1节中支持SEP控制HDD活动指示的方法。正如本参考文献所建议的，这些实现可能是特定于厂商的。
#### 13.14.1 桌面行为的HDD活动模拟 
如果主机控制器可选择实现桌面活动LED功能，所需行为与当前的并行ATA解决方案兼容，则主机控制器应以图242中定义的行为生成这样的信号。

## 图242 - 桌面行为模拟的活动LED定义 
在LED行为逻辑中。
 实现可以通过什么方式来确定所连接的设备类型是ATAPI（参见逻辑行为定义中的逻辑表达式DEVICE_TYPE != ATAPI）是特定于实现的，可以包括基于复位签名的设备类型检测、向设备发出的命令操作码检测（即ATAPI设备有使用ATAPI命令代码A0h和A1h发出的命令），或通过其他方式。
所要求的行为是，对ATAPI设备的活动不产生LED活动指示。
对于有多个串行ATA通道的实现，控制器应提供一个汇总活动信号，该信号是每个通道的单个活动信号的有线OR。
**13.14.1.1 桌面硬盘活动信号的电气要求**。
对于根据第13.14.1节提供活动信号的实施方案，该信号应是低电平有效信号，并应是集电极/漏极开路设计。该信号的电压和电流要求/能力由厂商决定。
#### 13.14.2 活动/状态指示参考（参考）...............................................。

串行ATA控制器设备可能包括分立的物理引脚，用于连接设备活动LED。此类控制器可为每个端口提供一个设备活动引脚和/或一个总活动信号。它们可以被包括在内，以便主机（或IO处理器）软件不需要提供设备活动状态，或者当发生对设备的写入/读出时，SEP不需要承担闪烁LED的负担。这些信号允许设备活动LED，而不需要改变串行ATA规范。随着Serial ATA的外壳管理设施的成熟和普及，本节中概述的方法很可能会过时。
// POR - 开机复位 // HRESET - 硬件复位。
RESET = POR || HRESET; if ((BSY || SActive) && DEVICE_TYPE != ATAPI) // 如何确定 !ATAPI 是具体实施的。
ACTIVITY_LED = ON; 否则
ACTIVITY_LED = OFF; if (MASTER_SLAVE_EMULATION_ENABLED && SLAVE_PRESENT) { if (RESET)
SLAVE_LED = ON。
} 否则
SLAVE_LED = OFF。
If (REGISTER_FIS_TRANSMITTED_ON_SLAVE_CHANNEL)
SLAVE_LED = OFF.LED = ACTIVITY_LED || SLAVE_LED;。
LED = ACTIVITY_LED || SLAVE_LED; 
##### 在附件处进行高速 SERIALIZED。
#### ATA国际组织 
图243显示了在外壳内实现设备活动LED的配置示例。在这个例子中，解决方案很可能会使用常见且广泛存在的标准0.1英寸针头。根据设备的数量，标准头的尺寸会有所不同，但一般来说，配置中每个设备活动LED需要两个引脚。因此，具有4个设备状态LED的4端口解决方案将需要一个2x4引脚的标准头。
图244在配置上与图243所示的相同，只是它显示了使用带状电缆以方便组装。
## ＃＃分开的电线 
#### 
#### 活动LED 
## 图243 - 带独立导线的设备活动LED灯.............................................................。
 
∮∮带状电缆 
#### 
#### 活动LED 
## 图244 - 带有带状电缆的设备活动LED灯................................................................。

还请注意，活动输出的设计是为了支持有线OR配置。然后，它们可以支持所有输出连接在一起的配置，以便生成一个总的活动指示。
利用有线OR功能，图245显示了一个更复杂的配置，它可以支持一个集成系统可能需要的额外需求。在这个例子中，设备直接插入背板。设备活动LED被放置在一个单独的小型夹层卡上，该夹层卡可以将LED活动信号同时从串口的
ATA控制器在I/O控制器和SEP上，在本例中SEP位于背板上。然后，这将允许如前文所述指示正常的设备活动，但也将支持SEP为其他目的对LED产生可区分的视觉模式的概念。例如，SEP可以将LED灯置于稳定的ON状态，以指示故障的卡或被热插拔的卡。

##### 高速 SERIALIZED ATTACHMENT (SEP) 
#### ATA国际组织 
#### 外壳背板 
#### 主板或 
#### IO控制器 
##### SEP 
LED信号线在电路板上的OR。
I2C
## 图 245 - 存储子系统中的设备活动 LED.......................................................。

设计人员应该了解本节所述解决方案的一些局限性。例如，如果一个解决方案使用端口乘法器，那么LED可能只对一般的前端端口活动有用。
 而且可能无法识别特定端口乘法器端口上的特定设备，而操作员可能需要对其采取行动（例如设备故障）。另一个考虑因素是，由串行ATA控制器产生的信号可能会根据某些状态改变状态，而这些状态转换可能过于迅速，不容易被操作者发现。例如，如果BSY位被设置为1或如果传输状态机处于活动状态，则LED引脚可能被否定。因此，在某些配置中，当许多短数据包被传输/接收时，如果没有额外的方法来防止这种情况的发生，那么当LED出现关闭时，设备可能会被激活。
### 13.15 端口乘法器的发现和枚举 
#### 13.15.1 开机 
上电时，端口乘法器应进入 16.3.3.5.1 节规定的主机端口热插拔状态机中的 HPHP1:NoComm 状态。进入该状态后，端口乘法器应： 1: 1. 清除任何内部状态，并重置端口倍增器硬件的所有部分。
2. 2. 在所有端口倍增器寄存器中放置复位值，包括端口专用寄存器。复位值应禁用所有设备端口。

在执行这个序列后，端口倍增器应继续执行主机端口的热插拔状态机中所述的操作。

如果端口多路复用器在向主机发出初始COMINIT信号之前收到主机的COMRESET，端口多路复用器应立即执行第13.15.2.1节中详述的动作，并停止执行上述上电序列。
#### 13.15.2 重置..................................................................................................................。

有三种机制可以重置设备。COMRESET、软件复位和 DEVICE
对PACKET设备发出RESET命令。
要重置端口乘法器，主机应发出 COMRESET 命令。端口乘法器不会响应软件复位或DEVICE RESET命令而复位。端口乘法器的具体操作
以下是对每种复位类型的乘法器响应详情。
**13.15.2.1 COMRESET**。
当端口多路复用器收到主机端口的 COMRESET 时，端口多路复用器应进入 16.3.3.5.1 节规定的主机端口热插拔状态机中的状态 HPHP1:NoComm。进入该状态后，端口乘法器应： 1: 1. 清除任何内部状态，并重置端口倍增器硬件的所有部分。
2. 2. 在所有端口倍增器寄存器中放置复位值，包括端口专用寄存器。复位值应禁用所有设备端口。

在执行完这一序列后，端口倍增器应继续执行主机端口的热插拔状态机中所述的操作。
**13.15.2.2 软件复位**。
当主机对控制端口进行软件复位时，会向控制端口发送两个寄存器FIS。在第一个寄存器FIS中，设备控制寄存器中的SRST位被设置为1。在第二个Register FIS中，设备控制寄存器中的SRST位被清零。
在接收到SRST位被置位的Register FIS后，端口乘法器应等待SRST位被置位。
在用端口发出寄存器 FIS 之前，将 SRST 位清零的寄存器 FIS。
乘法器的签名给主机。端口乘法器的行为应符合以下要求： 1.
软件复位协议在11.3节中描述。要放在寄存器FIS中的值如图246所示。
寄存器 7 6 5 4 3 2 1 0
错误 00h
Count(7:0) 01h
计数(15:8) 00h
LBA(7:0) 01h
LBA(31:24) 00h
LBA(15:8) 69h
LBA(39:32) (^) 00h
LBA(23:16 96h)
LBA(47:40) 00h
设备名称
状态 BSY DRDY DF na DRQ 0 0 ERR 
## 图246 - 软件复位控制端口结果值............................................................。

##### BSY = 0 
##### DRDY = 1 
##### DF = 0 
##### DRQ = 0 
##### ERR = 0  
##### 在附件处进行高速小型化。
#### ATA国际组织 
端口乘法器在接收到软件复位后，不应采取任何复位动作。端口倍增器应采取的唯一行动是用一个包含端口倍增器的寄存器FIS来响应。
倍增器签名。引起一般端口乘法器复位，使用COMRESET机制。
**13.15.2.3 器件复位**。
向控制端口发出的设备复位命令应被端口乘法器视为不支持的命令。请参阅第 16.3.3.8.6 节。
#### 13.15.3 软件初始化序列(信息) 
本节详细介绍了主机软件初始化端口倍增器设备时应采取的顺序。
**13.15.3.1 端口倍增器意识软件**。
端口倍增器感知软件检查主机的SStatus寄存器，以确定是否有设备连接到端口。如果有设备连接到端口，主机就会对控制端口进行软件复位。如果返回端口倍增器签名。
 然后将端口乘法器连接到端口上。然后，主机将按照第13.15.4.2节的详细规定，对端口倍增器端口上的设备进行枚举。
识别端口倍增器的软件不应要求设备端口0h上有设备，以确定是否存在端口倍增器。
**13.15.3.2 非端口乘法器感知软件**。
非端口乘法器感知软件等待连接设备的签名返回给主机。如果设备端口0h上有设备，则连接到设备端口0h的设备向主机返回一个包含其签名的寄存器FIS。如果设备端口0h上没有设备，非端口倍增器感知软件会超时等待签名返回，并认为发生了设备故障。如果需要快速启动，系统应该有一个端口?
倍增器识别BIOS和端口倍增器识别OS驱动程序。
当加载了非端口倍增软件时，除设备端口0h以外的所有设备端口都被禁用。主机将只接收来自连接到设备端口0h的设备的FIS。
**13.15.3.3 连接到端口倍增器的启动设备**。
系统设计人员只有在BIOS为以下情况下，才能将多个启动设备连接到端口多路复用器。
端口乘法器意识。例如，在一个包含三个可启动设备的系统中（硬盘驱动器。
CD-ROM和DVD）这些设备只有在BIOS为以下情况下才能连接到端口倍增器上
端口多路复用器的发现，否则用户无法从没有连接到设备端口0h的设备上启动。
#### 13.15.4 Port Multiplier Discovery and Device Enumeration (Informative) **13.15.4.1 Port Multiplier Discovery**。
要确定是否存在端口乘法器，主机将执行以下程序。主机通过检查主机的Serial ATA端口上是否建立了通信。
SStatus寄存器。如果有设备存在，主机发出软件复位，PM端口字段设置为控制端口。主机检查返回的签名值，如果它与 Port
Multiplier Signature，主机知道存在端口乘法器。如果签名值与端口倍增器不对应，主机可以继续执行该设备类型的正常初始化序列。主机不应依靠设备被连接到设备端口0h来确定端口倍增器的存在。
当端口多路复用器收到控制端口的软件复位时，端口多路复用器应根据第13.15.2.2节中详述的程序向主机发出一个寄存器FIS。寄存器FIS中包含的签名值如图247所示。

寄存器 7 6 5 4 3 2 1 0
错误 na
Count(7:0) 01h
计数(15:8) na
LBA(7:0) 01h
LBA(31:24) na
LBA(15:8) 69h
LBA(39:32) (^) na
LBA(23:16 96h)
LBA(47:40) na
设备名称
状态 na 
## 图247 -- -- 端口乘数签名 **13.15.4.1.1 端口乘数不存在时的考虑因素**。
直接连接的设备可能没有准备好在传输签名FIS之前从主机接收软件复位。
建议主机软件在成功接收到签名FIS之前不要发出软件复位。
签名FIS由主机发送，除非主机知道端口倍增器。
如果主机是端口倍增器，设备可能会在传输签名FIS之前收到软件重置。
乘法器意识。在设备没有发送签名FIS而收到主机发送的X_RDYP的情况下，设备可以暂缓响应R_RDYP，直到其应用层处于能够处理来自HBA的新命令/控制FIS的状态，包括软件复位。
在某些情况下，设备可能会推迟R_RDYP的传输，直到它准备好传输R_RDYP。
签字 FIS。
**13.15.4.2 设备列举**。
发现端口多路复用器后，主机会枚举所有连接到端口的设备。
倍增器。主机读取16.4.1.1节中定义的GSCR[2]，以确定端口倍增器上设备端口的数量。
对于端口倍增器上的每个设备端口，主机执行以下程序来枚举连接到该端口的设备。1. 主机启用设备端口。主机按照第14.1.3节的规定，通过在设备端口的PSCR[2](SControl)寄存器中适当设置DET字段来启用设备端口。
    主机使用WRITE PORT MULTIPLIER命令为要启用的设备端口写入PSCR[2] (SControl)。
2. 主机在启用设备端口后，应允许建立通信并检测设备存在。参考8.4.1节描述主机PHY初始化序列。
3. 主机使用 READ PORT MULTIPLIER 命令读取设备端口的 PSCR[0] (SStatus)。如果PSCR[0] (SStatus)表示有设备存在，则主机查询设备端口的PSCR[1] (SError)，并清除X位，表示设备存在的情况已经改变。

4. 4. 如果主机不支持上下文切换，设备对设备端口的初始COMRESET所产生的签名可能会被丢弃，因为BSY----------。 
##### 在附件处进行高速小型化。
#### 当主机收到寄存器FIS时，串行ATA国际组织位可能会被清除。因此，为了确定所连接设备的签名，主机应向设备端口发出软件复位。如果返回的是一个已识别设备的有效签名，主机就可以进行该设备类型的正常初始化。
不支持级联端口乘法器。
### 13.16 自动部分到休眠转换 
主机和设备可能会独立地意识到一些条件，在这些条件下，它们可以过渡到休眠状态，以节省电力，而不影响性能（例如，空闲、寻找）。
为了提高节电效果，"自动部分状态到沉睡状态转换 "定义了一种能力，它允许Phy从部分状态过渡到沉睡状态，而无需首先进入活动状态。
以下是对自动部分到休眠过渡功能的要求： 1) 只有当设备报告主机自动部分到休眠时，才能使用主机自动
支持部分进入休眠状态（Word 76，Identify Device的Bit 13）。
2) 设备自动部分进入休眠只有在主机支持增加的设备自动部分进入休眠时才会使用。
部分退出延迟(最高可达最大沉睡延迟)，并已启用设备的自动
在声称支持设备的设备上进行部分到休眠的转换（通过设置功能）（识别设备的字76，位14）。
从Partial过渡到Slumber不需要COMWAKE，然后是Active状态的转换，而且各附属的Phy将不会意识到这一转换。由于各Phy处于Partial状态，它应容忍增加的Partial退出延迟，因为其他Phy可能处于Slumber状态。

## 14 主机适配卡寄存器接口 ...........................................................................................

串行ATA主机适配器包括一个额外的寄存器块，它与ATA命令块寄存器分开独立映射，用于报告额外的状态和错误信息，并允许控制串行ATA特有的功能。这些附加寄存器被称为串行ATA状态和控制寄存器（SCR），被组织为16个连续的32位寄存器。这些寄存器的基本地址和映射方案由特定的主机适配器实现定义--例如，PCI控制器实现可以使用PCI映射功能映射SCR。表84说明了串行ATA寄存器接口的整体组织，包括ATA命令块寄存器和SCR。
状态和控制寄存器。传统模式软件不使用串行ATA状态和控制寄存器。串行ATA状态和控制寄存器与串行接口相关联，独立于主机适配器可能实现的任何主/从仿真。
## 表84 - SCR定义............................................................................................................

ATA命令块和控制块寄存器
A2 A1 A0 **读** (^) **写** 0 0 0 数据数据 0 0 1 错误特征 (^010) Count(7:0) Count(7:0) [15:8] [7:0] [15:8] [7:0] 0 1 1 LBA Low LBA Low [31: 24] [7:0] [31:24] [7:0] 1 0 0 LBA Mid LBA Mid [39:32] [15:8] [39:32] [15:8] 1 0 1 LBA High LBA High [47:40] [23:16] [47:40] [23:16] 1 1 0 器件 器件。
CS 0 1 1 1 状态命令
CS 1 1 1 0 备用状态设备控制
串行ATA状态和控制寄存器
SATA 寄存器 0 SATA 状态/控制
SATA 寄存器 1 SATA 状态/控制......。SATA状态/控制
SATA 寄存器 14 SATA 状态/控制
SATA寄存器15 SATA状态/控制 
### 14.1 状态和控制寄存器.......................................................................................。

串行ATA提供了一个额外的寄存器块，用于控制接口和检索接口状态信息。有16个连续的寄存器分配，其中前5个已定义，其余11个保留给将来定义。表85定义了串行ATA
状态和控制寄存器。
## 表85-SCR定义 
SCR[0] S状态寄存器
SCR[1] SError 寄存器
SCR[2] SC控制寄存器
SCR[3] SActive register
SCR[4] SNotification 寄存器
SCR[5] 保留 .... ...
SCR[15] 保留 
##### 在附件处进行高速小型化。
#### ATA国际组织 
#### 14.1.1 SStatus 寄存器 
串行ATA接口状态寄存器--SStatus--是一个32位的只读寄存器，传递接口和主机适配器的当前状态。该寄存器在读取时传达接口状态，并由主机适配器持续异步更新。对该寄存器的写入没有影响。
SCR0 保留 (0) IPM SPD DET

DET DET值表示接口设备检测和Phy状态。
0000b 未检测到设备，且 Phy 通信未建立 0001b 检测到设备存在，但 Phy 通信未建立 0011b 检测到设备存在，且 Phy 通信已建立 0100b Phy 处于离线模式，因为接口被禁用或运行在
BIST环回模式
保留所有其他价值
SPD SPD值表示协商建立的接口通信速度 0000b 未协商速度（设备不在或通信未建立） 0001b 协商Gen1通信速度 0010b 协商Gen2通信速度 0011b 协商Gen3通信速度。
保留所有其他价值
IPM IPM值表示当前接口电源管理状态 0000b 设备不存在或通信未建立 0001b 接口处于活动状态 0010b 接口处于部分电源管理状态 0110b 接口处于休眠电源管理状态。
保留所有其他价值
保留 所有保留字段应清零。
注意 a接口需要处于激活状态，接口设备检测值（DET字段）才能准确。当接口处于Partial或Slumber状态时，主机和目标之间没有建立通信，导致DET值对应于没有设备存在或没有建立通信。因此，在所有条件下，例如当接口因处于Partial或Slumber状态而处于静止状态时，可能无法准确检测到设备的插入或移除。因此，在所有可能的接口状态下，仅靠这个字段可能不足以满足设备插入或取出检测的所有要求。
注意 a当主机、设备或两者都启用了自动支持时，SStatus 寄存器的 IPM 值可能无法正确表示当前的接口低功率状态（部分或休眠）。
部分到沉睡的转换。IPM值保证表示接口已进入低功耗状态，但它可能不代表主机或设备当前的接口低功耗状态。关于自动部分到休眠的更多信息，请参考13.16。
沉睡过渡。
#### 14.1.2 SError寄存器 
串行ATA接口错误寄存器--SError--是一个32位的寄存器，它传达了补充性的错误信息。
接口错误信息，以补充影子寄存器中的错误信息。
块错误寄存器。该寄存器表示自上次清除SError寄存器后积累的所有检测到的错误（无论是否被接口恢复）。错误寄存器中的设置位通过对SError寄存器的写入操作或复位操作明确清除。

写入清除设置错误位的值应在要清除的位对应的位位置上编码为1。主机软件应在适当的检查点清除接口SError寄存器，以便最好地隔离错误条件及其影响的命令。
SCR1 DIAG ERR
ERR ERR 字段包含错误信息，供主机软件确定对错误条件的适当响应时使用。该字段的位显著性如下图所示。
ERR R R R R E P C T R R R R R M I
C 未恢复的持续性通信或数据完整性错误。发生了一个未恢复的通信错误，并且预计是持久性的。由于预计错误条件将是持久的，因此主机软件无需重新尝试操作。
持久性通信错误可能来自与设备的互连故障，也可能来自已被移除或已失效的设备，或其他一些原因。
E 内部错误。主机总线适配器发生内部错误，导致操作失败，可能使主机总线适配器进入错误状态。主机软件应在重新尝试操作前重置接口。如果该状况持续存在，则主机总线适配器可能受到设计问题的影响，使其与所连接的设备不兼容。
I 恢复的数据完整性错误。发生了数据完整性错误，接口通过重试操作或其他恢复操作进行了恢复。这可能是由于传输中的噪声突发、电压供应变化或其他原因造成的。由于操作最终成功，主机软件不需要采取任何行动，但是，主机软件可能会选择跟踪此类恢复的错误，以衡量整体通信完整性，并有可能降低协商的通信速度。
M 恢复的通信错误。设备和主机之间的通信暂时中断，但又重新建立。这可能是由于设备暂时被移除、Phy 同步暂时丢失或其他原因造成的，可能来自 Phy 层和 Link 层之间的 PHYRDYn 信号。
 由于操作最终成功，主机软件不需要采取任何行动，但是，主机软件可能会选择跟踪这种恢复的错误，以衡量整体通信的完整性，并有可能降低协商的通信速度。
P 协议错误。检测到违反串行ATA协议的情况。这可能是由于接收到无效或形成不良的 FIS、无效的状态转换或其他原因造成的。主机软件应重置接口，并重试相应的操作。如果这样的错误持续存在，则说明连接的设备可能存在设计问题，导致其与主机总线适配器不兼容。
R 保留位，供将来使用。应清零。
T 未恢复的瞬态数据完整性错误。发生了一个数据完整性错误，但接口没有恢复。由于该错误条件不会持续存在，主机软件应重试操作。
DIAG DIAG字段包含诊断错误信息，供诊断软件在验证正确操作或隔离故障模式时使用。该字段是位显著的，定义如下图所示。
DIAG R A X F T S H C D B W I N 
##### 在附件处进行高速小型化。
#### ATA国际组织 
检测到端口选择器存在。当主机处于HP2：HR_AwaitCOMINIT状态时，收到COMWAKE时，该位被设置为1。上电复位时，该位被清零。当主机向该位位置写入1时，该位被清零。
B 10b～8b 解码错误。当设置为1时，该位表示自该位上次清零后发生了一个或多个10b至8b解码错误。
C CRC错误。当设置为1时，该位表示自该位上次清零后，Link层发生了一个或多个CRC错误。
D Disparity Error（差异性错误）。当设置为1时，该位表示自上次将该位清零后，检测到一次或多次不正确的差异性。
F 未识别的FIS类型。当设置为1时，该位表示自上次清除该位后，传输层收到一个或多个CRC良好的FIS，但其类型字段未被识别。
I Phy内部错误。当设置为1时，该位表示自上次清除该位为0后，Phy检测到一些内部错误。
N PHYRDY变化。当设置为1时，该位表示PHYRDY信号自上次该位清零后状态发生变化。
H 握手错误。当设置为1时，该位表示在帧传输时收到一个或多个R_ERRP握手响应。这类错误可能是接收方检测到的CRC错误、差分或10b/8b解码错误，或其他导致传输帧负握手的错误条件。
R 保留位，供将来使用。应清除为零。
S 链接序列错误。当设置为1时，该位表示自该位上次清零后遇到了一个或多个链路状态机错误条件。
链路层状态机定义了链路层检测到错误过渡的条件。
T 传输状态转换错误。当设置为1时，该位表示自上次将该位清零后，传输层内从一个状态过渡到另一个状态的过程中发生了错误。
W COMWAKE检测。当设置为1时，该位表示自上次该位被清零后，Phy检测到了一个COMWAKE信号。
X Exchanged：当设置为1时，该位表示自上次将该位清零后，设备存在发生了变化。实现确定设备存在已改变的方式是由厂商决定的。该位可以在任何时候被设置为1，不管是为了响应新设备的插入，还是为了响应COMINIT信号而发生的Phy复位初始化序列。
COMRESET已被发出，或响应上电。
#### 14.1.3 SControl寄存器 
串行ATA接口控制寄存器--SControl是一个32位的读写寄存器，它提供了软件控制串行ATA接口功能的接口。对SControl寄存器的写入会导致主机适配器或接口采取一个动作。从寄存器读出的值返回最后写入的值。
SCR2 保留 (0) PMP SPM IPM SPD DET
DET DET字段控制主机适配器的设备检测和接口初始化。
0000b 没有设备检测或初始化操作要求 0001b 执行接口通信初始化序列以建立通信。这在功能上等同于硬复位，结果是接口被复位，通信重新初始化。当写入
SC控制寄存器，将DET字段设置为0001b。
 主机接口应过渡到HP1: HR_Reset状态，并应保持在该状态，直到后续对SControl寄存器的写入将DET字段设置为0001b以外的值。
 0100b禁用串行ATA接口，并使Phy处于离线模式。
保留所有其他值
SPD 该SPD字段表示接口通信速度建立时，接口允许协商的最高通信速度 0000b 无速度协商限制 0001b 限制速度协商为不大于Gen1通信速度 0010b 限制速度协商为不大于Gen2通信速度 0011b 限制速度协商为不大于Gen3通信速度。
保留所有其他价值
IPM IPM 字段表示可通过串行 ATA 接口电源管理功能调用的已启用的接口电源管理状态 0000b 无接口电源管理状态限制 0001b 过渡到禁用的部分电源管理状态 0010b 过渡到禁用的休眠电源管理状态 0011b 过渡到禁用的部分和休眠电源管理状态。
保留所有其他价值
选择电源管理（SPM）字段用于选择电源管理状态。
写入该字段的非零值将导致指定的电源管理状态被启动。写入该字段的值将被视为单次启动。此字段应读作0000b。
0000b 无电源管理状态转换请求 0001b 转换到部分电源管理状态启动 0010b 转换到沉睡电源管理状态启动 0100b 转换到活动电源管理状态启动。
保留所有其他价值
端口乘法器端口(PMP)字段表示所有传输的FIS的PM端口字段中要放置的4位值。开机时该字段为'0000'。该字段是可选的，并且是一个
如果要传输的 FIS 是通过其他方法构建的，HBA 实施可以选择忽略该字段。
保留 所有保留的字段应清零。
#### 14.1.4 SActive register....................................................................................................

SActive 寄存器是一个 32 位的寄存器，传递设置设备位 FIS 的 SActive 字段中返回的信息。如果不支持NCQ，则不需要实现SActive寄存器。
主机可以通过对SActive寄存器的写操作来设置SActive寄存器中的位。写入设置位的值应在与要设置的位相对应的位位置上编码为1。SActive寄存器中的位不会因为主机的写寄存器操作而被清除，主机软件不能直接清除SActive寄存器中的位。
SActive寄存器中的被设置位是由于设备返回的数据在
设置设备位 FIS 的 SActive 字段。设置设备位的SActive字段中返回的值。
在SActive寄存器中要清除的位对应的位位置上，位FIS应编码为1。设备不能设置SActive寄存器中的位。
主控制器在发出COMRESET信号时，或在发出软件复位后，通过发送控制寄存器FIS时，应将SActive寄存器中的所有位清除为零。
SRST位设置为1。

##### 在附件处进行高速 SERIALIZED。
#### ATA国际组织 
SCR3 SActive
## 图248-SActive寄存器定义.......................................................................................。

SActive 对于本地命令队列协议，SActive值表示尚未成功完成的一组未完成队列命令。参见13.6节。
#### 14.1.5 SNotification寄存器（可选）...........................................................................。

串行ATA接口的通知寄存器--SNotification是一个32位的寄存器，它传达给主机一个设置了通知位的Set Device Bits FIS的设备，具体见10.3.6节。当主机收到Set Device Bits FIS且Notification位设置为1时，主机应设置SNotification寄存器中与接收到的FIS中PM Port字段值对应的位。例如，如果PM端口字段设置为7，那么主机应将SNotification寄存器中的7位设置为1。设置SNotification寄存器中的位后，如果FIS中的中断位被设置为1，且中断被启用，则主机应产生中断。
对SNotification寄存器进行写操作，或上电复位操作，可明确清除SNotification寄存器中的设置位。寄存器不因COMRESET而被清除，软件负责根据情况清除寄存器。
 写入清除集位的值应在与要清除的位对应的位位置上编码为1。
SCR4 保留 通知
## 图249 - SNotification寄存器定义...............................................................................。

Notify 该字段表示具有相应PM端口号的特定设备是否向主机发送了设置设备位FIS，并将Notification位设置为1。
保留 该保留字段应清零。
 
##### HIGH SPEED SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
## 15 错误处理 .....................................................................................................................

### 15.1 架构..................................................................................................................

串行ATA的分层架构也延伸到了错误处理。如图250所示，串行ATA堆栈中的每一层都有来自下一个低层的错误指示（Phy层除外，因为Phy层没有与之相关的低层）、堆栈中下一个低层的数据和堆栈中下一个高层的数据作为输入。每一层都有其本地错误检测能力，根据从下层和上层接收到的数据识别该层特有的错误。每层执行本地恢复和控制动作，并可将错误信息转发给堆栈中的下一个上层。
传输错误信息
应用层
恢复和控制行动
错误检测
传输层
恢复和控制行动
错误检测
链接层
恢复和控制行动
错误检测
植物层
恢复和控制行动
错误检测
链接错误信息
Phy错误信息
命令/
状况
帧10b流
原始信号
## 图250--错误处理架构 
错误反应一般分为四类
冻结
终止
重试
跟踪/忽略
本节中描述的错误处理响应并不全面，包括了具体的已知错误场景，以及说明典型的错误控制和恢复动作。因此，本节是描述性的，是对第14.1.2节中定义的错误报告接口的补充，并且各实现可能会在其内部错误恢复和控制动作中有所不同。
对于最严重的错误条件，在这种情况下，状态已经被严重扰乱，无法恢复，适当的错误响应是冻结并依靠复位或类似的操作来恢复所有必要的状态，以恢复到正常运行。
对于预计会持续存在的错误条件，适当的错误响应是中止并使尝试的操作失败。这样的失败通常意味着在堆栈上发出通知，以告知主机软件该条件。
对于短暂的、不会持续存在的错误条件，适当的响应是重试失败的操作。只有没有扰乱系统状态的失败操作才可以重试。这种重试可以由相关层中的恢复和错误控制动作直接处理，也可以由主机软件响应传递给它的错误信息来处理。
非关键的可恢复条件可以被跟踪或忽略。这类条件包括那些在堆栈中较低层通过重试或其他恢复操作恢复的条件。跟踪此类错误通常可能有利于识别边缘运行的组件或其他即将发生的故障。
### 15.2 Phy错误处理概述 
#### 15.2.1 错误检测 
Phy层内部检测到的错误主要有三类。
- 没有设备存在
- OOB信号序列失败
- Phy内部错误(通信链路失去同步) 
无设备存在的情况是由于主机控制器和设备之间的介质物理断开造成的，无论是间歇性的还是持续性的。主控制器应检测设备存在，作为7.5节中定义的接口复位序列的一部分。
在PHYRDY信号被断言之前，当OOB信号事件序列无法完成时，就会出现OOB信号失败的情况。当从电源管理部分状态或休眠状态、从环回BIST测试状态或从初始上电状态出现时，需要OOB信号序列。OOB 信令序列用于实现 COMRESET、COMINIT、COMWAKE 和 ALIGNPpatterns 的特定有序交换，以使主机控制器和设备之间的通信链路恢复。具体序列详见7.5节。
APhy内部错误可能产生于多种情况，不管是输入信号的特性引起的，还是实现中特有的内部错误，总是会导致通信链路同步的丢失。

固定的本地接收PLL频率架构（过采样、跟踪/非跟踪）对输入数据速度频率与标称预期速度的变化很敏感，因此它们通常有弹性缓冲器。弹性缓冲器用于适应输入数据速度频率和本地接收PLL频率之间的差异--如果Tx频率相对于Rx本地PLL频率的差异过高/过低，可能会出现超跑/欠跑情况，通常被称为Phy内部误差。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
#### ATA国际组织 
基于VCO(PLL)的时钟恢复架构对输入数据速度频率变化、高频抖动也很敏感，可能难以实现锁定--这可能被声明为Phy内部错误。
一些状态机、阻抗补偿和串行器/解串器(SerDes)电路构成了典型的串行ATA接口Phy，各种类型的错误条件可能会被归纳在一起，构成声明的 "Phy内部错误"。这些错误通常是每个实现所特有的。
#### 15.2.2 错误控制动作.............................................................................................。
 **15.2.2.1 无设备存在**。
由于物理接口的性质，Phy有可能在不同的时间确定一个设备连接到电缆上。直接的结果是，Phy负责检测是否有连接的设备，并在SStatus寄存器中报告该设备的存在，以便主机软件做出适当的反应。
在接口初始化序列中，当COMRESET信号发出时，主机控制器中的一个内部状态位 "设备检测 "应被清除。当主机控制器检测到来自连接设备的COMINIT信号时，应在主机控制器中设置 "设备检测 "状态位。当主机控制器在从Partial或Slumber状态恢复时检测到COMWAKE信号时，可在主机控制器中设置 "Device Detect "状态位。设备检测 "状态位可以在主机控制器中设置。
检测 "状态位对应于14.1.1节中定义的SStatus寄存器中的设备存在检测信息。
请注意，设备的存在和建立的通信是分别报告在SStatus寄存器中。
SStatus 寄存器，以涵盖附加设备被检测到的情况。
Phy，但Phy无法与其建立通信。
**15.2.2.2 OOB信号序列失败**。
Phy对第8.1节定义的接口OOB复位信令序列没有任何超时条件。如果设备存在，Phy应在开机复位后10毫秒内检测到设备存在（即COMINIT应在发出COMRESET后10毫秒内返回）。如果设备不存在，Phy不需要超时，可以无限期地保持在复位状态，直到主机软件介入。在成功完成接口初始化序列后，Phy应处于准备、活动和同步状态，SStatus寄存器位应反映出这一点，如14.1.1节所定义。
**15.2.2.3 Phy内部错误**。
如15.2.1节所述，有几个潜在的错误来源被归类为 "植物"。
内部错误"。为了适应一系列的实施，而不使软件错误处理方法依赖于实施，所有不同的内部Phy错误的潜在来源被合并起来，以便在第14.1.2节定义的SError寄存器中报告条件。这一要求并不排除每个厂商实现自己级别的错误诊断位，但这些位应驻留在厂商特定的寄存器位置。
Phy内部错误应导致Phy成为未准备好的状态(PHYRDY信号被否定)，相应的SStatus寄存器和SError寄存器位应按照14.1节的定义进行更新。

SError寄存器中定义的 "PHYRDY变化 "位应按照14.1.2节中的定义进行更新。
#### 15.2.3 错误报告......................................................................................................。

Phy错误除了按照14.1节的定义反映在SStatus寄存器和SError寄存器中外，一般还要向链路层报告。
### 15.3 链路层错误处理概述...............................................................................

#### 15.3.1 错误检测 
Link层内部检测的错误主要有两类。
无效的状态转换
数据完整性错误
无效状态转换错误可能来自多个来源，第1节中定义了链路层对许多此类错误条件的响应。数据完整性错误一般来自于物理互连中的噪声。
#### 15.3.2 错误控制动作。
............................................................................................

链路层在传输过程中检测到的错误，一般是通过累积错误的方式进行处理，直到传输结束，并将接收错误情况反映在最终的
R_ERRP/R_OK握手。具体的情况在下面的章节中列出。
**15.3.2.1 无效状态转换**。
无效状态转换一般通过返回到已知状态来处理，例如在9.6节的Link状态图中定义了无效状态转换尝试的响应。根据系统的状态，返回到已知状态一般通过两种恢复路径来实现。
如果无效状态转换尝试是在帧的传输过程中(收到SOFP后)，链路层应向发送代理发出负确认(R_ERRP)信号。
如果无效状态转换不是在帧传输过程中，Link应直接进入空闲状态，等待下一次操作。
以下段落概述了在特定状态转换场景下的要求，以及它们各自的Link错误控制动作。
接收接口接收到一个或多个连续的X_RDYPat后，如果接收到的下一个控制字符不是SOFP，则链路层应将此情况通知传输层，并过渡到空闲状态。
在传输X_RDYP之后，如果没有收到返回的R_RDYP，则不应试图进行链路层恢复动作。上层应最终超时，并复位接口。
在收到一个意外的SOFP时，当接收接口还没有用R_RDYP发出准备接收数据的信号时，该接收接口应保持在空闲状态，发出SYNCP基元，直到发送接口终止传输，也回到空闲状态。

##### 高速序列化在附件上的应用 
#### ATA国际组织 
如果发射机用 EOFP 和 WTRMP 关闭一个帧，并且既没有收到 R_OKPnor 一个 R_OKPnor一个
R_ERRP在预定的超时时间内，不得尝试链路层恢复动作。高层最终应超时，并复位接口。
如果发送器发出EOFP信号，并且接收到除SYNCP、R_OKP或R_ERRP以外的基元，链路层应坚持不懈地继续等待接收一个合适的终止基元。
数据完整性错误。
数据完整性错误通常通过向传输层发出信号来处理，以便有可能触发传输重试操作，或向主机软件传递失败的状态信息。
为了回到已知状态，数据完整性错误通常通过帧确认握手的方式，在帧传输结束后，在回到空闲状态之前，发出信号。
以下段落概述了具体数据完整性错误情况下的要求，以及相应的Link错误控制动作。
在接收帧结束时(在EOFP处)检测到CRC错误时，链路层应通知传输层所接收的帧包含CRC错误。此外，链路层应发出负确认，即R_ERRP，作为帧状态握手，并应返回空闲状态。
在接收帧的过程中，当检测到差异性错误或其他8b/10b编码违规时，则
链路层应保留这些错误信息，在接收到的帧结束时，链路层应提供负确认，即R_ERRP，作为帧握手，并将错误通知传输层。
对编码违规的控制动作与CRC错误的控制动作基本相同。
#### 15.3.3 错误报告......................................................................................................。

链路层的错误情况通过私有接口向传输层报告，传输层与链路层之间的
链路层和传输层。此外，链路层错误会按照14.1.2节的定义在SError寄存器中报告。
### 15.4 传输层错误处理概述 
传输层是串行ATA接口的最高层。传输层将错误传达给软件和/或执行本地错误恢复，并启动控制动作，如重试一类FIS传输。
传输层将检测到的错误通知链路层，使链路层反映出
每个帧结束时R_ERRP/R_OKPhandshake中的传输错误。设备应将任何R_ERRP帧握手反映在传输的命令结束状态中反映出来。
寄存器FIS，传达操作结束状态。传输层还将任何遇到的错误信息反映在SError寄存器中。
传输层可以重试任何FIS传输，但前提是系统状态没有因为相应的失败而改变。
 并可进行任意次数的重试。对于反复重试操作持续失败的场景，主机软件最终应超时退出相应的命令，并进行恢复操作。

#### 15.4.1 错误检测 
除了链路层传递给它的错误信息外，传输层内部还检测到以下几类错误。
内部错误
帧错误
协议错误和状态错误
传输层的内部错误有几种，包括各种速度匹配FIFO的溢出/不足。内部错误的处理方法一般是相应的事务失败，返回到相当于事务失败的状态（如CRC不好会导致的状态）。
传输层检测的帧错误有几种，包括接收CRC不正确的帧、接收TYPE字段无效的帧、接收错误的帧（如长度不正确的寄存器帧）。帧错误的处理方法一般是失败相应的事务，并返回到相当于失败的事务的状态（如CRC不好导致的状态）。
协议和状态转换错误往往源于行为不端的设备没有遵循正确的
串行ATA协议，包括PIO计数值与随后传输的数据字符数不匹配和事件序列错误等错误。
协议和状态转换错误的处理方法一般是使相应的事务失败，并返回到与失败的事务相当的状态（如接收到CRC不好的帧时的状态）。
#### 15.4.2 错误控制动作.............................................................................................。
 **15.4.2.1 内部错误**。
内部错误的处理方法通常是：相应的事务失败后，重新尝试事务或将失败情况通知主机软件，以最终产生主机软件重试响应。以下是具体的内部错误情况及其对应的传输层错误控制动作。
如果接收FIFO溢出，传输层应发出帧接收负确认信号，在帧确认握手过程中向链路层发出信号返回R_ERRP。随后的操作相当于帧接收错误的CRC。
如果发送FIFO不足，传输层应关闭发送帧，并以一个
EOFP和CRC值被迫不正确，以确保损坏帧的接收器也执行适当的错误控制动作。
**15.4.2.2 帧错误**。
帧错误的处理方式一般有两种，取决于错误预期是短暂的还是持久的，以及系统状态是否被扰动。对于预计是瞬时的错误条件（如CRC错误），且系统状态没有被扰动，传输层可以任意多次重试相应的事务，直到最终主机超时和软件复位，或进行其他错误恢复尝试。对于不是瞬时错误条件造成的错误条件（如接收到的FIS中的无效Type字段），错误响应一般是失败交易并报告失败。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
以下是具体的帧错误情况及其相应的传输层错误控制动作。
在系统状态未被扰动的前提下，被否定确认的帧的发送方可以重试FIS传输。可以重传的帧类型有： 1:
寄存器--主机到设备
注册 - 设备到主机
DMA激活 - 设备到主机
DMA设置 - 设备到主机
PIO设置 - 设备到主机
设置设备位 - 设备到主机
BIST激活--主机到设备或设备到主机。
由于数据传输FIS会导致主机总线适配器内部状态的改变，无论是通过DMA控制器改变其状态还是通过改变剩余的PIO重复次数，数据传输FIS永远不应该重试。
传输层不需要重试那些不改变系统状态的失败FIS传输，但传输层可以尝试重试任何次数。对于通过重试不能解决的条件，如持续错误，主机软件最终应超时处理，并重置接口。
如果传输层检测到接收到一个未识别TYPE值的FIS，传输层应向链路层发出信号，通过断言来否定确认帧的接收。
R_ERRPduring the frame acknowledgement handshake.
如果传输层检测到接收到畸形帧，如帧的长度不正确。
 传输层应在帧确认握手时发送R_ERRPduring帧确认信号给链路层，以否定帧接收。
**15.4.2.3 协议和状态转换错误**。
协议和状态错误源于不遵守串行ATA协议的不良设备。
这类错误一般通过失败相应的事务并返回到已知状态来处理。由于这类错误不是由环境瞬态引起的，所以不应试图重试此类失败的操作。以下是具体的帧错误情况及其相应的传输层错误控制动作。
如果PIO传输计数过期，两个Dword后不是EOFP(CRC落在最后一个数据Dword和EOFP之间)，则PIO设置FIS中规定的传输计数与后续数据有效载荷的大小不匹配。对于这种数据有效载荷/传输次数不匹配的情况，PIO设置FIS中规定的传输次数与后续数据有效载荷的大小不匹配。
传输层应在帧确认握手过程中，通过传输R_ERRPduring帧确认信号，向链路层发出否定帧接收的信号。
#### 15.4.3 错误报告......................................................................................................。

传输层通过串行ATA状态和控制寄存器向主机软件报告错误。设备通过传输寄存器FIS向主机软件传递传输层错误信息，更新ATA影子寄存器块状态和错误寄存器值。
所有传输层未处理/恢复的传输层错误条件应设置影子寄存器块状态寄存器中的错误位，并通过传输适当的寄存器FIS更新错误寄存器中的值。

主机传输层错误条件应导致状态和错误值在SStatus和
SError寄存器被更新为与错误条件相对应的值，并应导致在帧确认握手过程中通知链路层对违规FIS进行否定确认。
### 15.5 应用层错误处理概述....................................................................。

应用层的错误处理部分由为Parallel（并行）编写的软件的行为定义。
ATA。传输层支持超集错误报告功能，通过以下方式实现
状态和控制寄存器，软件应利用这些错误报告功能来改进串行ATA的错误处理。
#### 15.5.1 错误检测 
总的来说有三种错误检测机制，软件通过这些机制来识别和响应。
串行ATA错误
- 命令块状态寄存器中的不良状态
- SError 寄存器中的坏状态
- 命令未能完成（超时 
在命令块状态寄存器中返回坏状态的条件，但没有序列号。
ATA接口的错误信息，对应于《中国电子报》中规定的错误条件。
ATA标准。这类错误条件和响应在ATA标准中定义，在串行ATA中没有独特的处理方式。这类错误包括命令错误，例如试图从LBA读取超过磁盘末端的数据，以及设备特定的故障，例如无法从给定扇区号读取数据。这些故障与Serial ATA无关。
ATA接口，因此对于这些错误条件，没有串行ATA特定接口状态信息。只有设备返回的状态信息可用于识别问题源，加上任何可能适用的可用SMART数据。
传输层错误条件，无论是否恢复，都反映在SStatus和
SError寄存器的定义见14.1.2节。主机传输层负责在SStatus和SError寄存器中反映错误信息，设备传输层负责通过传输相应的寄存器FIS在影子寄存器块状态和错误寄存器中反映未恢复的错误。
未能完成的命令会被主机驱动软件通过超时机制检测到。一般来说，这种超时会导致没有命令的状态或错误信息传递给主机软件，软件可能无法确定这种错误的来源或原因。
#### 15.5.2错误控制动作.............................................................................................。

在影子寄存器块状态寄存器中返回不良状态，但在SError寄存器中没有接口错误信息的条件，应按照
ATA标准。
在SError寄存器中返回接口错误信息的条件，通过四种基本响应来处理。
冻结
终止/失败
重试(复位后可能)
跟踪/忽略 
##### 在附件处进行高速小型化。
#### ATA国际组织 

导致灾难性系统扰动而无法恢复的错误条件应导致系统停止。串行ATA没有定义任何明确的停止条件，然而，软件可能能够推断出这样的条件。
预计不会是短暂的错误条件，并且预计在随后的尝试中不会成功的错误条件应导致受影响的命令被中止和失败。此类命令的失败应报告给上级软件层进行处理。适合这种响应的情况包括尝试与未连接的设备进行通信，以及接口未能成功与连接的设备进行通信协商。
预计是短暂性的错误条件应导致受影响的命令被重试。这类命令可以直接重试，也可以在接口和/或设备复位后重试，这取决于SError寄存器中报告的特定错误值。适合这种响应的情况包括导致CRC错误、8b/10b代码违反或不对等错误的噪声事件。
可恢复且不需要显式错误处理的条件可以被跟踪或忽略。跟踪此类错误允许后续对边缘组件进行故障隔离，并容纳可能的恢复操作。这种响应适合的情况包括跟踪Phy同步损耗的数量，以确定潜在的电缆故障或适应明确降低协商的通信速度。
 
##### 高速串行化在附件中的应用 
#### ATA国际组织 
## 16 端口乘法器 ......................................................................................................................

### 16.1 简介 
端口多路器是一个活动主机连接与多个设备通信的机制。端口多路复用器可以看作是一个简单的多路复用器，一个活动的主机连接被多路复用到多个设备连接，如图251所示。
主机
端口设备
港口
#### 主机总线适配器 **HDD** **HDD** **HDD** **HDD** **HDD**。
##### P o rt
##### M u lt ip li er
## 图251 - 端口乘法器概述 
只支持一个活动的主机连接到Port Multiplier。端口多路复用器是一种可扩展的设计，最多支持15个端点设备连接，并可利用主机连接的全部带宽。端口多路复用器不得连接到另一个端口。
乘法器（即无级联）。
### 16.2 概述 
端口乘法器在所有FIS类型中使用四个位（称为PM端口字段）在主机和相应设备之间路由FIS。使用PM端口字段，端口乘法器会路由以下信息
从一台活动主机到最多 15 台串行 ATA 设备的 FIS。PM端口字段由主机在主机到设备的FIS上用要将FIS路由到的设备的端口地址填写。对于设备到主机的FIS，PM端口字段由端口乘法器用传输FIS的设备端口地址填写。设备端口地址从零开始，依次递增，直到最后一个设备端口地址被定义。控制端口，端口地址Fh，用于与端口倍增器本身进行控制和状态通信。
为了利用所有连接到端口多路复用器的设备，主机需要有一个机制来设置所有传输的FIS中的PM端口字段。
端口倍增器维护了一组通用寄存器，同时也维护了每个设备端口的串行ATA超集状态和控制寄存器。控制端口支持两个命令，READ PORT MULTIPLIER和WRITE PORT MULTIPLIER，用于读取和写入这些寄存器。

一些额外的端口复用器功能包括
- 支持在设备端口0h上使用传统模式软件启动。
- 支持交错旋转启动。
- 支持热插拔。

### 16.3 定义 
#### 16.3.1 地址机制 
端口乘法器在所有FIS类型中使用四个位（称为PM端口字段）在主机和相应设备之间路由FIS。使用PM端口字段，端口乘法器会路由以下信息
从一台活动主机到最多 15 台串行 ATA 设备的 FIS。PM端口字段由主机在主机到设备的FIS上用要将FIS路由到的设备的端口地址填写。对于设备到主机的FIS，PM端口字段由端口乘法器用传输FIS的设备的端口地址填写。
在所有FIS中，PM端口字段直接跟在FIS类型字段后面，请参考10.3节。
#### 16.3.2 设备端口要求...................................................................................。

设备端口是指可以用来连接设备和端口倍增器的端口。设备端口是指可以用来连接设备和端口倍增器的端口。
乘法器可支持多达15个设备端口。
 设备端口地址应从零开始，按顺序编号，直到所有设备端口都有端口地址。有效设备端口的端口地址值应小于端口乘法器支持的设备端口总数。
**16.3.2.1 主机到设备的传输**。
要将 FIS 传输到连接到端口倍增器的设备上，主机应将 FIS 中的 PM 端口字段设置为设备的端口地址。然后，主机应开始将 FIS 传送至端口乘法器。
当端口多路复用器通过主机端口接收到FIS时，端口多路复用器应根据传输、链路和Phy状态机检查PM。
当端口乘法器通过主机端口接收到一个FIS时，端口乘法器应检查PM?
FIS中的端口字段，以确定FIS应通过的端口地址。如果
如果 FIS 的目的地是控制端口，则端口乘法器应接收 FIS 并执行所要求的命令或操作。如果 FIS 的目的地是设备端口，则端口乘法器应执行以下步骤。1. 端口乘法器应确定设备端口是否有效。如果设备端口无效，端口乘法器应向主机发出SYNC转义，终止接收FIS。参考16.3.3.8.3节。
2. 端口乘法器应确定设备端口的PSCR[1](SError)寄存器DIAG字段中的X位是否设置为1。如果设置为1，端口乘法器应向主机发出SYNC转义，并终止FIS的接收。参考16.3.3.8.2节。
3. 端口乘法器应判断是否发生了碰撞。碰撞是指主机要传输到的设备已经在进行接收。如果发生了碰撞，端口倍增器应完成接收主机的FIS，并向主机发出R_ERRP作为结束状态。端口乘法器应按照16.3.3.2节所述的程序来清除碰撞条件。
4. 4. 端口乘法器应向设备发出 X_RDYP，启动与设备的传输。如果设备刚刚决定开始向主机传输，在端口乘法器向设备发出X_RDYP时，可能会发生碰撞。如果设备开始  
##### 在附件处进行高速小型化。
#### 串行ATA国际组织向端口乘法器传输X_RDYP时，发生了碰撞。如果发生了碰撞，端口乘法器应完成从主机接收FIS，并应发出以下命令： 1.
R_ERRP 给主机作为结束状态。端口乘法器应按照16.3.3.2节所述程序清除碰撞条件。
5. 5. 设备向端口乘法器发出 R_RDYP 后，端口乘法器应将主机的 FIS 传送给设备。端口乘法器在设备发出R_OKP进行FIS接收之前，不得向主机发送R_OKPstatus。R_OKPstatus的握手应是设备到主机的互锁。参考16.3.3.1节。

如果在FIS传输的任何部分检测到错误，端口乘法器应确保错误条件被传播到主机和设备。
主机与端口乘法器之间的传输与端口乘法器与设备之间的传输是分开处理的，只有帧R_OKPhandshake的末端是互锁的。端口
倍增器应确保每条链路的所有FIS传输都能满足第9.4.7节规定的流控信令延迟要求。具体来说，端口乘法器应确保满足以下几项之间的流控信令时延。1. 主机端口和它所连接的主机 2.每个设备端口和它所连接的设备： 1. 
如果在FIS传输过程中没有检测到错误，端口乘法器不应改变传输到设备的FIS。端口乘法器无需检查或重新计算CRC。
**16.3.2.2 从设备到主机的传输**。
要向主机传输FIS，设备应根据传输、链路和Phy状态机进行传输。无论是直接连接到主机还是通过端口倍增器连接到主机，设备的行为都是一样的。
当设备要向主机传输FIS时，端口多路器应执行以下程序。1. 在接收到设备发出的X_RDYPf后，端口倍增器应确定设备端口的PSCR[1]（SError）寄存器的DIAG字段中是否设置了X位。在DIAG字段中的X位被清零之前，端口乘法器不会向设备发出R_RDYP。
2. 2. 端口乘法器应接收来自设备的 FIS。端口乘法器应在PM端口字段中填写发送设备的端口地址。端口乘法器应将修改后的FIS传送给主机，并重新计算CRC。端口乘法器应检查从设备收到的 CRC。
 如果来自设备的CRC无效，端口乘法器将破坏发送给主机的CRC，以确保错误条件得到传播。具体细节请参考16.3.3.8.4节，了解端口乘法器如何在这种错误情况下破坏CRC。
3. 3. 端口乘法器应向主机发出X_RDYP，开始向主机传输FIS。当主机向端口乘法器发出R_RDYP后，端口乘法器应将FIS从设备传送到主机。在主机发出R_OKP进行FIS接收之前，端口倍增器不得向设备发送R_OKP状态。从设备到主机的R_OKP状态握手应是互锁的。参考16.3.3.1节。

如果在 FIS 传输的任何部分检测到错误，端口乘法器应确保错误情况被传播到主机和设备。
端口乘法器可以等待与主机的X_RDYP/R_RDYPhandshake，然后再发出X_RDYP/R_RDYPhandshake。
R_RDYP到设备，以减少缓冲。设备与端口倍增器之间的传输与端口倍增器与主机之间的传输是分开处理的，只有帧的末端R_OKPhandshake是互锁的。端口倍增器应确保每条链路上的所有FIS传输都能满足第9.4.7节规定的流控信令延迟要求。具体来说，端口乘法器应确保满足以下几个环节之间的流控信令延迟。1. 主机端口与其所连接的主机之间。
2. 每个设备端口和它所连接的设备之间。

#### 16.3.3 政策.................................................................................................................
 **16.3.3.1 FIS交付**。
帧结束握手应在主机和设备之间进行互锁。具体来说，端口乘法器在FIS的目标设备发出R_OKP之前，不得向FIS的发起者发出R_OKP。端口乘法器应将R_OKP和R_ERRP从FIS的目标端传播出去。
FIS的发起者。
如果在R_OKPhandshake传递给发起者之前，传输失败，端口乘法器负责传播错误条件。具体来说，端口乘法器应传播以下信息
在 FIS 传输过程中接收到的 SYNCP 基元，以确保在 FIS 传输过程中遇到的任何错误情况都能得到传播。当FIS传输中发生CRC计算错误或可能的数据损坏时，应采取的适当行动请参考16.3.3.8.4和16.3.3.8.5节。
如果 FIS 传输正在进行，并且端口乘法器与活动设备之间的链路无法操作，则端口乘法器应向主机发出 SYNCPprimitives，直到主机以 SYNCP 响应，以使传输失败。检测到链路无法操作时，失败传输允许主机立即进行恢复操作，从而消除与超时相关的延迟。
**1 P o r t P r i o r i t y**。
端口乘法器应确保已启用的活动设备端口不被饿死。具体使用的优先级算法是具体实施的。
控制端口应优先于所有设备传输。当控制端口的命令未完成时，端口倍增器不得启动任何设备传输，直到控制端口的命令完成。
**16.3.3.1.2 FIS 传送机制(信息性)**。
本节为端口多路复用器可以用来满足FIS传输策略的一种方法提供了参考。
开始FIS传输：如果端口倍增器上的一个设备发出X_RDYP的信号，而端口倍增器上的一个设备又发出X_RDYP的信号，那么该端口倍增器就会开始FIS传输。
倍增器已经选择了该设备进行下一步的传输，并且主机端口不忙，则端口
乘法者应。1. 向主机发出X_RDYP。
2. 等待主机响应R_RDYP。
3. 在主机发出R_RDYP后，端口倍增器向设备发出R_RDYP。

然后可以继续向主机传输。
如果主机向端口乘法器断言X_RDYP，而端口乘法器没有向主机断言X_RDYP，端口乘法器就向主机响应R_RDYP。端口乘法器从主机接收FIS有效载荷的第一个D字。如果指定的端口乘法器端口是一个X_RDYP，则该端口乘法器将响应主机的R_RDYP。
##### 在附件处进行高速小型化。
#### 串行ATA国际组织在端口倍增器上启用的设备端口，端口倍增器在指定的设备端口上发出X_RDYP，并继续向设备传输整个FIS。如果在此过程中发生碰撞，端口倍增器应遵循第 16.3.3.2 节中概述的程序。
状态传播 : 如果主机和设备之间正在进行 FIS 传输，端口倍增器应按照 16.3.3.2 节中概述的程序进行。
端口多路复用器只有在首先从主机或设备接收到该基元的情况下才会发出R_OKP、R_ERRP和SYNCP。
 除非发生了碰撞或指定了无效端口，否则端口乘法器不得向FIS的发起者传递R_OKPor R_ERRP。
端口乘法器不应将R_OKPor R_ERRP传递给FIS的发起者，直到FIS的目标发送R_OKPor R_ERRP后才开始端到端传输。
如果FIS传输的发起方或目标方在FIS传输过程中发出SYNCP，则应传播此基元，以确保错误条件被传播到任何一端。
**16.3.3.2 碰撞**。
碰撞是指端口乘法器已经开始接收主机要传输的设备的信号。当设备在端口乘法器向该设备发出X_RDYP的同时发出X_RDYPat时，也会发生碰撞。所有的碰撞都被视为一个
X_RDYP/X_RDYPcollision；根据Link层状态机，主机失去了所有的这种碰撞，应该在稍后的时间重新传输其FIS。
只有当主机试图向有原生排队命令未完成的设备发出另一条原生排队命令时，才会发生碰撞。本机命令队列协议保证主机在发生碰撞时永远不会传输数据FIS。这意味着端口多路复用器可以安全地向主机发出一个错误，主机应该在稍后的时间点重试失败的FIS传输。
当端口乘法器检测到碰撞时，端口乘法器应完成接收主机的FIS，并向主机发出R_ERRP进行帧握手结束。端口乘法器
乘法器应丢弃从主机收到的FIS。主机应尝试重试失败的FIS传输。
## 表86--状态图碰撞。
PMC1: PmColl_Idle 执行正常操作。等待主机接收 FIS。
1. 主机开始接收设备端口X的FIS信号 PmColl_ChkRecv 2. 设备端口 X 的主机未开始接收。
PMC2.PmColl_ChkRecv 确定设备端口X上是否正在进行FIS接收。PmColl_ChkRecv 确定设备端口X是否正在进行FIS接收。
1. 设备端口 X 的接收正在进行中。 PmColl_Collision 2. 设备端口X的接收没有进行中。 PmColl_XmitToDP 
PMC3: PmColl_Collision(碰撞)
检测到碰撞。完成从主机接收FIS，并丢弃FIS内容。
1. WTRMP或SYNCP未从主机接收。 PmColl_Collision 2. WTRMP从主机接收到。 PmColl_FailHostFIS 3.从主机接收到的 SYNCP.  PmColl_Idle  
PMC4: PmColl_FailHostFIS 向主机发送R_ERRP。
1. 无条件的 PmColl_Idle. 
PMC5: PmColl_XmitToDP 传送 X_RDYP 到设备端口 X。
1. PmColl_XmitToDP 2. X_RDY从设备端口X接收到。从设备端口 X 接收到的 R_RDY。
在主机端口发生的X_RDYP/X_RDYPcollision应按照X_RDYP/X_RDYPcollision来处理。
链接层状态图见第9.6节。
**16.3.3.3 使用不知道端口倍增器的软件启动**。
启动是通过Port Multiplier的第一个端口，即设备端口0h来实现的，无需任何特殊的软件或硬件支持。不支持附加端口的HBA，可以通过端口倍增器的第一个端口（设备端口0h）启动。
Multiplier应与设备端口0h上的设备一起工作。
如果系统需要快速启动功能，应确保BIOS和操作系统驱动软件都能识别Port Multiplier。如果在端口倍增器存在的情况下使用了不知道端口倍增器的软件，而设备端口0h上没有设备存在，那么该软件会检测到设备存在，但不会收到带有设备签名的寄存器FIS。等待设备签名可能会导致不知道端口倍增器的 BIOS 无法满足快速启动时间要求。
**16.3.3.4 错位启动支持**。
端口倍增器应在上电时或收到主机端口的COMRESET信号时禁用所有设备端口。此功能允许主机控制每个设备何时旋转起来。
请参阅第13.15.4.2节，了解如何列举设备，包括由于端口被禁用而可能被旋转下来的设备。
**16.3.3.5 热插拔事件**。
端口乘法器对热插拔事件的处理由主机端口和设备端口的热插拔状态机分别在16.3.3.5.1节和16.3.3.5.2节中定义。
在收到主机的COMRESET信号后，端口乘法器应执行内部复位。作为内部复位的一部分，端口乘法器应更新每个设备端口的串行ATA超集状态和控制寄存器。有关COMRESET处理的更多详细说明请参见13.15.2.1节。
在收到设备的COMINIT信号后。
 端口乘法器应按照第13.16节的定义更新该端口的串行ATA超集状态和控制寄存器。端口乘法器应设置设备端口的PSCR[1](SError)寄存器的DIAG字段中的X位，以标记设备的存在已经改变，如第14.1.2节所定义。如果端口乘法器在最后一次COMRESET后没有收到控制端口的FIS，并且通过设备端口0h收到了一个未请求的COMINIT信号，端口乘法器应按照16.3.3.5.1节中对主机端口的热插拔状态机的规定，将COMINIT信号传播给主机。对于所有其他情况，COMINIT信号不应传播给主机。
如果设备端口的PSCR[1](SError)寄存器DIAG字段中的X位被设置，则端口的
在X位被清除之前，乘法器应禁止与该端口进行FIS传输。当
端口乘法器不允许使用设备端口进行FIS传输，端口乘法器应确保： 1.
设备正在尝试传输的FIS不会被丢弃。

##### 高速 SERIALIZED ATTACHMENT(附件)。
#### ATA国际组织 
建议主机软件经常查询16.4.1.2节中定义的GSCR[32]，以确定设备端口上是否有设备存在变化。
**16.3.3.5.1 主机端口的热插拔状态机**。
由于端口多路复用器不可能与主机共享同一电源，因此应支持端口多路复用器主机端口的有线热插拔。因此，端口型多用器应在过渡到端口型多用器后，通过定期向主机发送COMINIT信号，定期轮询主机是否存在。
HPHP1:NoComm状态。
在通过主机端口建立通信后，状态机使能设备端口0h，当使用不知道端口倍增器的软件进行操作时，状态机还将设备端口0h的PSCR[1](SError)寄存器的DIAG字段中的X位设置后清除。此外，当尚未发生控制端口寄存器访问时，状态机应将从设备端口0h接收到的非请求COMINIT信号传播给主机。这些调整允许设备端口0h与不知道端口乘法器的主机软件一起工作。
当使用端口乘法器识别软件时，状态机将设备端口 0h 与其他设备端口完全一样。
## 表 87 - 主机端口热插拔状态机的状态图。
HPHP1：NoComm^1
将端口乘法器设置为13.15.1节和13.15.2.1节规定的初始状态。
1. 无条件启动通讯
注意事项 1. 该状态在开机复位或响应收到的COMRESET时进入。

HPHP2: StartComm
将 Phy 状态机过渡到状态 DP1：DR_RESET。
通信重试时间间隔重置为初始值.^1 1. 无条件等待通信
注意事项 1. 通信重试间隔应大于或等于10 ms。

HPHP3：WaitComm 1.PHYRDY已确认。 PHYRDY未确认，且通信重试间隔未过。        WaitComm 3.PHYRDY未断言，且通信重试时间间隔已过。 NoComm 
HPHP4: EnablePort0 如果设备端口0h当前被禁用，则启用设备端口0h。
1. PHYRDY asserted。 Port0ComInit 2. PHYRDY未检测到。 NoComm  
HPHP4b：Port0ComInit 1。通信丢失，接口不在电源管理状态（即拔掉插头），控制端口未收到FIS。
  NoComm 2.控制端口收到FIS。 CommOK^1 3. 通信建立，控制端口未收到FIS，且（从设备端口0h收到COMINIT，或进入HPHP4b:Port0ComInit状态后已>=10ms）。
  Port0ComInitWait 4. 控制端口建立了通信，但没有收到FIS，也没有收到来自设备端口0h的COMINIT，且进入HPHP4b:Port0ComInit状态后经过了<10ms。
  端口0ComInit
##### 注意事项。  如果端口0的PSCR[0](SStatus)的DET字段的位0被设置为1，那么端口0的PSCR[1](SError)的DIAG字段的X位应在进行转换之前被设置。

HPHP4c:
Port0ComInitWait^ 1. 通信丢失，接口不在电源管理状态(即拔掉插头)，未收到控制端口的FIS。
  NoComm 2.控制端口收到FIS。 CommOK^1 3. 通信建立，控制端口未收到FIS，设备端口0h的COMINIT被否定。
  LegacyCommOK 2 4. 通信已建立，但控制端口未收到 FIS，且设备端口 0h 的 COMINIT 已确认。
  端口0ComInitWait
##### 注意事项。  如果端口0的PSCR[0](SStatus)中DET字段的位0被设置为1，那么端口0的PSCR[1](SError)DIAG字段中的X位应在进行转换之前被设置。
2. 在进行转换之前，设备端口0h的PSCR[1] (SError)中的X位应被清零。
 
##### 高速串行化 ATTACHMENT(附件) 
#### ATA国际组织 

HPHP5.LegacyCommOK 1: LegacyCommOK 1.通信丢失，接口不在电源管理状态（即拔掉插头），控制端口未收到FIS。
  NoComm 2.通信建立或接口处于电源管理状态，设备端口0h未收到COMINIT，控制端口未收到FIS。
  LegacyCommOK 3.通信建立或接口处于电源管理状态，设备端口0h收到COMINIT，控制端口未收到FIS。
  StartComm^1 4. 控制端口接收到FIS。 CommOK^2
注意事项 1. 端口0的PSCR[1](SError)中的X位应在进行转换前设置为1。
2. 2. 如果端口 0 的 PSCR[0](SStatus)中 DET 字段的位 0 设置为 1，则端口 0 的 PSCR[1](SError)DIAG 字段中的 X 位应在转换前设置为 1。

HPHP6：CommOK 1.通信丢失，接口不在电源管理状态（即拔掉插头）。        NoComm 2.通信建立或接口处于电源管理状态。 CommOK **16.3.3.5.2 设备端口的热插拔状态机**。
设备端口热插拔行为与直接支持设备热插拔的主机控制器的行为完全相同。设备没有变化，使用模式也没有变化。
## 表88-设备端口热插拔状态机状态图............................................。

DPHP1: NoComm 1.PHYRDY asserted.  CommOK 2.PHYRDY未断言。 NoComm 
DPHP2：CommOK 1.通信丢失，接口不在电源管理状态。        NoComm 2.通信建立或接口处于电源管理状态。 CommOK **16.3.3.6 链路电源管理**。
端口乘法器应根据链路层状态机，支持接收来自主机和附加设备的PMREQ_PP和PMREQ_SP。如果端口多路复用器不支持所请求的电源管理状态，端口多路复用器应响应于
PMREQ_PP或PMREQ_SP与PMNAKP。

在端口乘法器发送FIS之前，端口乘法器应检查链路的状态，如果链路处于Partial或Slumber状态，则发出COMWAKE信号。端口乘法器应在第16.4.2节定义的端口特定寄存器（特别是每个端口的PSCR[0](SStatus)）中准确反映每个设备端口链路的当前状态。
端口乘法器不得在设备端口上传播PMREQ_PP或PMREQ_SPreceived。
从设备接收到的PMREQ_PP或PMREQ_SP只影响该设备与端口乘法器之间的链路。如果端口乘法器在设备端口上接收到PMREQ_PP或PMREQ_SP，端口乘法器应执行以下操作。
- 端口乘法器应向设备发出PMACKPor PMNAKP的响应
- 如果端口多路复用器响应设备的PMACKP： o 端口多路复用器应将与该设备的链路过渡到指定的电源状态 o 端口多路复用器应更新该设备端口的特定寄存器，以反映该链路的当前电源管理状态。
如果端口多路复用器对PMREQ_PP或PMREQ_SP作出PMACKP响应，则端口多路复用器应将从主机接收到的PMREQ_PP或PMREQ_SP传播到所有活动的设备端口。在这种情况下，端口乘法器应将PMREQ_PP或PMREQ_SP传播到所有具有以下功能的设备端口。
PHYRDY asserted。如果设备对PMREQ_PP或PMREQ_SP作出PMNAKP响应，该事件只影响与该设备的链接。主机可以查询端口乘法器端口特定寄存器，以确定哪些设备端口处于电源管理状态。
如果端口乘法器收到主机发来的PMREQ_PP或PMREQ_SP，那么具体的操作为： 1.
端口多路复用器应采取的措施有：1．
- 端口乘法器应以PMACKPor PMNAKP来响应主机。
- 如果端口乘法器用PMACKP响应主机： o 端口乘法器应将与主机的链路过渡到指定的电源状态 o 端口乘法器应向所有PHYRDY已确定的设备端口发出PMREQ_PP或PMREQ_SP - 如果设备用PMACKP响应，端口乘法器应将与该设备的链路过渡到指定的电源状态，并应更新该端口的端口乘法器特定寄存器 - 如果设备用PMNAKP响应，端口乘法器不应对该设备端口采取任何行动。
端口乘法器应根据需要唤醒设备链路。来自主机的COMWAKE信号不会传播到设备上。当一个FIS需要被传送到设备时，端口倍增器应向该设备发出COMWAKE信号。
如果所有的设备端口都处于PMREQ_PP或PMREQ_SP状态，端口倍增器可以向主机发出PMREQ_PP或PMREQ_SP信号。
部分状态、休眠状态或被禁用。
**16.3.3.7 减少上下文切换的复杂性***。

如果在某些 FIS 序列中间收到来自另一个设备的流量，可能会使一些主机控制器设计复杂化。例如，如果主机收到来自一个设备的DMA激活FIS，那么主机在向第一个设备发出数据FIS之前收到来自另一个设备的FIS可能会很尴尬。
端口乘法器应在启动任何待定设备传输之前，为主机提供传输机会。端口倍增器在向主机发出X_RDYP之前，不应断言。
端口多路复用器已从主机接收到至少两个连续的 SYNCPprimitives（无论主机或端口多路复用器是否是前一个 FIS 的发送者）。如果是 
##### 在附件处进行高速小型化。
#### 串行ATA国际组织碰撞，端口乘法器应忽略这一要求，并执行第16.3.3.2节中详述的操作。
如果主机要在接收另一个FIS之前进行传输，主机应在上一个FIS传输结束和下一个FIS传输开始之间发出一个SYNCP。一种可能的实现方式是，不管主机是否准备好进行下一次传输，立即过渡到9.6.3节定义的主机链路层状态HL_SendChkRdy。然后，只有当主机准备好继续传输且接收到R_RDYPis时，主机才会从HL_SendChkRdy状态过渡出来。
**16.3.3.8 错误处理和恢复**。
主机负责以直接连接到设备时处理错误的方式处理错误条件。主机负责检测没有完成的命令，并根据需要执行错误恢复程序。具体的主机软件错误恢复程序要根据具体的实现情况而定。
端口乘法器不负责执行任何错误恢复程序。端口
乘法器应针对链路层状态机所描述的某些错误条件返回R_ERRP。端口乘法器应更新16.4.1.2节中定义的GSCR[32]和发生错误的设备端口的PSCR[1]（SError）。
**1 6. 3. 3. 8. 1 C o m a n d T i m e o u t**。
如果命令超时，主机可以检查16.4.2节中定义的PSCR[1](SError)，以确定发生错误的端口上是否出现了接口错误状况。如果该端口上的设备存在变化，如DIAG字段中的X位所表示的那样，那么主机可以检查PSCR[1](SError)，以确定在发生错误的端口上是否存在接口错误情况。
PSCR[1] (SError)的端口，主机应重新列举该端口上的设备。命令超时后的主机软件错误恢复机制具体实施。
**16.3.3.8.2 停用设备端口**。
如果主机向某个设备端口传输FIS，由于该端口PSCR[1]的DIAG字段（SError）中X位被设置，导致该端口被禁用或FIS传输被禁止，则端口乘法器在FIS接收结束时不应执行R_OKPor R_ERRPhandshake，而应通过向主机发出SYNC Escape终止FIS接收。主机负责检测命令没有结束，并执行错误恢复程序，包括必要时清除PSCR[1]寄存器DIAG字段的X位。
**16.3.3.8.3 设备端口地址无效**。
无效设备端口地址是指设备端口地址的值大于或等于端口倍增器支持的设备端口数。如果主机指定了一个无效的设备端口地址作为FIS传输的一部分，端口倍增器应发出SYNC转义并终止FIS的接收。主机负责检测该命令没有完成，并执行正常的错误恢复程序。
**16.3.3.8.4 设备启动传输的无效CRC**。
在设备发起的传输中，端口乘法器应重新计算CRC，因为它修改了FIS的第一个D字。端口乘法器应检查设备发送的原始CRC，如果原始CRC无效，端口乘法器应反转重新计算的CRC。如果原始 CRC 无效，端口乘法器应反转重新计算的 CRC，以确保设备发送的 CRC 无效。
CRC错误会传播到主机上。反转可以通过对重新计算的
CRC与FFFFFFFh。端口乘法器还应更新发生错误的设备端口的 PSCR[1] (SError) 中的错误信息。
**1 6. 3. 3. 8. 5 D a t a C o r r u p t i o n**。
如果端口乘法器遇到8b/10b解码错误或任何其他可能影响FIS发射器和接收器之间传递的数据完整性的错误，端口乘法器应确保将该错误传播给接收器。端口乘法器可以通过破坏FIS的CRC来传播错误。端口乘法器也应更新FIS中的错误信息。
PSCR[1](SError)为发生错误的设备端口。
 **16.3.3.8.6 控制端口上接收到的不支持的命令**。
如果在控制端口上收到不支持的命令。
 端口乘法器应以具有表 89 所示的状态和错误寄存器值的寄存器 FIS 做出响应。
## 表89 - 不支持的命令的寄存器值 
寄存器 7 6 5 4 3 2 1 0
错误 保留 ABRT 保留
状态 BSY DRDY DF na DRQ 0 0 ERR
不支持的命令的寄存器值。
ABRT = 1
BSY = 0
DRDY = 1
DF=0
DRQ=0
ERR = 1 **16.3.3.9 BIST支持**。
一个端口多路复用器可以选择支持BIST。支持BIST的端口多路复用器只能以点对点的方式支持BIST。支持BIST的端口多路复用器不得将一个端口上收到的BIST激活FIS传播到另一个端口上。主机确定一个端口
多路复用器通过检查16.4.1.3节中定义的GCSR[64]来支持BIST。
要通过主机与端口多路复用器的连接进入 BIST 模式，主机应发出 BIST
激活FIS到端口倍增器控制端口。主机不得向设备端口发出BIST激活FIS。
要通过设备连接进入BIST模式，设备应向设备端口发出BIST激活FIS。
端口乘法器。端口乘法器应拦截BIST激活FIS并进入BIST模式。
在设备进入BIST模式后，端口乘法器应更新该端口的PSCR[0](SStatus)寄存器，以反映链路已进入BIST模式，如第14.1.1节所述。
由端口乘法器启动BIST是厂商独有的。
**16.3.3.10 异步通知**。
端口多路复用器可以选择支持第13.8节定义的异步通知。如果启用了异步通知，当全局状态和控制的GSCR[32]中的一个位从0转换为1时，端口乘法器应向主机发送异步通知。
寄存器。端口乘法器可以为多个零到一位的转换发送一次通知。
只有当控制端口当前没有未完成的命令时，才应发送异步通知。如果当需要发送异步通知时，控制端口有一条命令未完成，端口乘法器应首先完成该命令，然后再发送异步通知。端口乘法器应在 "设置设备 "中设置PM端口字段。
位FIS到控制端口，以指示端口乘法器本身需要注意。
GSCR[64]中指出了对异步通知功能的支持，并通过使用
GSCR[96]。
**16.3.3.10.1 基于命令的交换(信息)**。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
主机设计应仔细考虑在基于命令的交换设计中支持异步通知（在16.7.1节中概述）。如果一个基于命令的开关
HBA 没有明确的异步通知功能，那么主机不应该在控制端口或任何连接的设备上启用异步通知。
**16.3.3.11 Phy事件计数器**。
端口多路复用器可以选择支持第13.9节中定义的Phy事件计数器功能。如果启用了Phy事件计数器，端口多路复用器应存储所有启用的端口（包括主机端口）的支持的计数器信息。它不要求相同的
在每个端口上实施 Phy 事件计数器。
GSCR[64]中显示了对Phy事件计数器功能的支持，并且使用GSCR[34]中的0位启用。计数器的值不应在电源周期内保留。在 COMRESET 和任何端口上发生的软件复位时，应保留计数器的值。
**16.3.3.11.1 计数器标识符**。
端口多路复用器可以支持13.9.2节图223中描述的任何计数器标识符。由于端口多路复用器的结构，对某些计数器的支持可能并不是对所有端口都是合理的，例如标识符为 001h 和 00Ah 的计数器。对于端口
乘法器的实现，除000h以外的所有计数器都是可选的。计数器标识符值为000h的计数器应表示在GSCR或PSCR寄存器中实现的Phy事件计数器列表的结束。标识符为000h的计数器应无计数器值。
所有计数器值都消耗16位的倍数，最大为64位。每个计数器分配一个寄存器位置。寄存器位置包含所实现的计数器的标识符和Phy事件计数器的值。
**16.3.3.11.2 读取计数器值**。
最初，主机可以通过提交从GSCR[256](或PSCR[256])开始的读数来获取已实现的计数器的映射及其大小，以获得每个端口的计数器标识符。一旦达到000h的标识符，就表示已实现的计数器列表结束。这次读取的格式是READ PORT MULTIPLIER命令，Device寄存器的RS1位清零。PortNum字段的值决定了要访问哪一组计数器。
 0h-Eh端口的设备端口计数器信息分别通过端口号0h-Eh进行检索。主机端口计数器信息是通过使用控制端口号(Fh)来检索的。RegNum[15:0]应设置为要读取的具体寄存器位置。READ PORT MULTIPLIER命令的输出包含计数器的标识符。当启用 Phy 事件计数器时，端口乘法器应返回标识符 000h，作为没有实施 Phy 事件计数器的端口的第一个计数器。
要读取计数器本身的值，需要发送READ PORT MULTIPLIER命令，并将Device寄存器的RS1位设置为1。PortNum字段中的值决定了要访问哪一组计数器。通过使用端口号0h-Eh分别检索端口0h-Eh的设备端口计数器信息。主机端口计数器信息是通过使用控制端口号(Fh)来检索的。RegNum[15:0]应设置为要读取的具体寄存器位置。
READ PORT MULTIPLIER命令的输出包含计数器的值，长度最大为64位。如果读取到的计数器值长度小于64位，则由READ PORT MULTIPLIER命令返回的值。
端口乘法器的上位应以零为填充。
一旦达到最大的计数器值，所有的计数器都是一扩到16位的倍数（即16、32、48、64位）。例如，当作为16位计数器返回时，如果一个计数器在物理上只实现了8位，当它达到最大值FFh时，它应被一扩展到FFFh。计数器在达到最大值后应停止（而不是包为零）。

当对Phy事件计数器寄存器空间的任何读数达到或超过标识符000h位置时，端口乘法器应返回错误状态，ERR位设为1，BSY和
在FIS的状态字段中，DRQ位清零。在错误字段中，ABRT位也应设为1。
**16.3.3.11.3 计数器复位机制**。
主机可以使用三种机制来显式地使Phy事件计数器被重置。第一种机制使用WRITE PORT MULTIPLIER命令来清除单个计数器。PortNum字段决定要访问哪一组计数器。分别使用端口号0h-Eh来写入端口0h-Eh的设备端口计数器信息。主机端口的计数器信息是通过使用控制端口号（Fh）来写入的。在这里，我们可以通过控制端口号(Fh)来写入主机端口的计数器信息。
RegNum字段应设置为要写入的寄存器位置（计数器）。命令中的Value字段包含了要写入寄存器的内容，在这种情况下，全部是零。
第二种机制允许在读取该计数器寄存器后重置该计数器。
如果设备寄存器中的RS2位被设置为1，在读取任何计数器时，端口乘法器应返回命令的当前计数器值，然后在成功传输寄存器FIS后重置该值。如果需要重试，在不成功传输寄存器FIS时，端口乘法器应返回当前的计数器值，然后重置该值。
FIS有可能在重新传送计数器值之前改变计数器值。
第三种机制是全局复位功能，通过在GSCR[34]中写入适当的位来复位所有的
特定端口的 Phy 事件计数器。主机可以通过向 GSCR[34] 的 31-16 位写入 FFFFh 来重置所有 Phy 事件计数器。
### 16.4 端口乘数寄存器 
使用READ PORT MULTIPLIER和WRITE PORT MULTIPLIER访问端口乘法器。
向控制端口发出的 MULTIPLIER 命令。
#### 16.4.1 一般状态和控制寄存器.................................................................。

控制端口的地址在 READ PORT MULTIPLIER 和 READ PORT MULTIPLIER 命令的 PortNum 字段中指定。
WRITE PORT MULTIPLIER命令定义于16.5.1节和16.5.2节，用于读/写通用状态和控制寄存器。
**16.4.1.1 静态配置信息**。
一般状态和控制寄存器的静态配置信息部分包含了端口乘法器整个运行过程中的静态寄存器。这些寄存器是只读的，主机不得修改。
## 表 90 - 静态信息寄存器 
寄存器 O/M F/V 说明
GSCR[0] M
F
F
产品标识符 31-16 厂商分配的设备 ID。
15-0 PCI-SIG分配的厂商ID。
GSCR[1] M
F F F F F F F F F
修订信息 31-16 保留 15-8 端口乘法器的修订级别。
7-4 保留 3 1 = 支持端口乘法器规范 1.2。
2 1 = 支持端口乘法器规范 1.1。
1 1 = 支持端口乘法器规格 1.0.
1 = 支持端口乘法器规范 1.0.0 保留
GSCR[2] M 端口信息 
##### 在附件处进行高速小型化。
#### ATA国际组织 
##### F 
##### F 31-4 Reserved 3-0 外露设备扇出端口的数量。
GSCR[3] -
GSCR[31]
O F 保留
关键词：O/M=强制性/选择性要求。
O/M = 强制性/任择性要求。
M = 对登记册的支持是强制性的。
O = 对登记册的支持是可选的。
F/V = 固定/可变内容。
 设备端口计数器
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器0：产品标识符
对该登记册的支持是强制性的。该登记册标明了生产该产品的供应商。
端口乘法器和特定设备标识符。
比特15-0应设置为生产端口乘法器的厂商的PCI-SIG分配的厂商标识符。
位31-16应设置为厂商分配的设备标识符。
寄存器1：修订信息
对该寄存器的支持是强制性的。该寄存器指定了Port Multiplier支持的规格版本，Port Multiplier可以支持多个规格版本。
该寄存器还指定了由寄存器0确定的特定Port Multiplier产品的版本级别。
位0为保留位，应清零。
当位1被设置为1时，表示Port Multiplier支持Port Multiplier规范版本1.0。
当位 2 设置为 1 时，表示端口乘法器支持端口乘法器规范版本 1.1。
当位 3 设置为 1 时，表示端口倍增器支持端口倍增器规范版本 1.2。
位7-4为保留位，应清零。
位 15-8 表示由寄存器 0 确定的端口倍增器产品的版本级别。
该标识符由厂商分配。
比特31-16为保留位，应清零。
寄存器2：端口信息
对该寄存器的支持是强制性的。该寄存器指定了端口倍增器所包含的端口信息，包括外露设备扇出端口的数量。外露设备端口数是指产品上物理连接并可使用的设备端口数。
位3-0指定外露设备扇出端口的数量。值为0时无效。
控制端口不应计算在内。

位31-4为保留位，应清零。
寄存器3-31。保留
寄存器3-31是为将来定义端口乘法器保留的，应清零。
**16.4.1.2 状态信息和控制**。
通用状态和控制寄存器的状态信息部分包含了传递状态信息和控制端口乘法器操作的寄存器。
## 表91 - 状态信息和控制寄存器。
寄存器 O/M F/V 说明
GSCR[32] M
F V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V
错误信息 31- 15 保留 14 端口中可选择位的 OR 14 PSCR[1](SError) 13 端口中可选择位的 OR 13 PSCR[1](SError) 12 端口中可选择位的 OR 12 PSCR[1](SError) 11端口中可选择位的 OR 端口 11 PSCR[1] (SError) 端口 10 的可选择位的 10 OR PSCR[1] (SError) 端口 9 的可选择位的 9 OR PSCR[1] (SError) 端口 8 的可选择位的 8 OR PSCR[1] (SError) 可选择位的 7 OR PSCR[1] (SError) 端口 7 中的可选位的 6 OR 端口 6 中的可选位的 6 OR PSCR[1] (SError) 端口 5 中的可选位的 5 OR PSCR[1] (SError) 端口 4 中的可选位的 4 OR PSCR[1] (SError) 端口 4 中的可选位的 3 OR PSCR[1] (SError) 端口 3 中的可选择位的 2 OR 端口 2 中的可选择位的 2 OR PSCR[1] (SError) 端口 1 中的可选择位的 1 OR PSCR[1] (SError) 端口 0 中的可选择位的 0 OR PSCR[1] (SError)
GSCR[33] M
V
错误信息位启用 31-0 如果设置，则启用该位，以便在 GSCR[32] 中使用。
GSCR[34] O V Phy 事件计数器控制 31 主机端口全局计数器复位 30 端口 14 全局计数器复位 29 端口 13 全局计数器复位 28 端口 12 全局计数器复位 27 端口 11 全局计数器复位 26 端口 10 全局计数器复位 25 端口 9 全局计数器复位 24 端口 8 全局计数器复位 23 端口 7 全局计数器复位 22 端口 6 全局计数器复位 21 端口 5 全局计数器复位 20 端口 4 全局计数器复位 19 端口 3 全局计数器复位 18 端口 2 全局计数器复位 17 端口 1 全局计数器复位 16 端口 0 全局计数器复位 15-1 保留 0 Phy 事件计数器已启用
GSCR[35] -
GSCR[63] O F 保留
关键词：O/M=强制性/选择性要求。
O/M=强制性/选择性要求。

##### 在附件处的高速串行化。
#### ATA国际组织 
寄存器 O/M F/V 说明
M = 对注册表的支持是强制性的。
O = 对寄存器的支持是可选的。
F/V = 固定/可变内容。
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器32: 寄存器32：错误信息
对该寄存器的支持是强制性的。该寄存器反映了设备端口的PSCR[1] (SError)寄存器中是否有特定的位被设置。设置的位可能反映了一个错误或设备存在已经改变。主机使用GSCR[33]选择设备端口的PSCR[1] (SError)位来反映。更新寄存器内容的端口乘法器算法是： for (n=0; n<NumPorts; n++) { if (Port[n].PSCR[1] & GSCR[33]) == 0)
GSCR[32].Bit[n]=0 else

GSCR[32].Bit[n]=1。
}
这个寄存器是只读的。为了清除受影响的PSCR[1](SError)寄存器中的值，并通过在该寄存器中的反射，应写入特定设备端口的PSCR[1](SError)寄存器。关于SError寄存器的定义，请参考14.1.2节。
位0应设置为端口0 PSCR[1](SError)中选定位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。
在端口1 PSCR[1](SError)中，位1应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要被OR-ed的位。如果端口1没有被
端口乘法器，该位应清零。
在端口2 PSCR[1] (SError)中，位2应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口2没有被
端口乘法器，该位应清零。
在端口 3 PSCR[1] (SError)中，位 3 应设置为所选位的逻辑 OR-ed 值。
使用GSCR[33]选择要OR-ed的位。如果端口3没有被
端口乘法器，该位应清零。
在端口4 PSCR[1] (SError)中，位4应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口4没有被
端口乘法器，该位应清零。
在端口5 PSCR[1] (SError)中，位5应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口5没有被
端口乘法器，该位应清零。
位6应设置为端口6 PSCR[1] (SError)中选择的位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口6没有被
端口乘法器，该位应清零。

在端口 7 PSCR[1] (SError)中，应将位 7 设置为所选位的逻辑 OR-ed 值。
使用GSCR[33]选择要OR-ed的位。如果端口7没有被
端口乘法器，该位应清零。
在端口8 PSCR[1] (SError)中，位8应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口8没有被
端口乘法器，该位应清零。
在端口9 PSCR[1] (SError)中，位9应设置为所选位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口9没有被
端口乘法器，该位应清零。
位 10 应设置为端口 10 PSCR[1] (SError) 中所选位的逻辑 OR-ed 值。
使用GSCR[33]选择要OR-ed的位。如果端口10没有被
端口乘法器，该位应清零。
位11应设置为端口11 PSCR[1] (SError)中选择的位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口11没有被
端口乘法器，该位应清零。
位12应设置为端口12 PSCR[1] (SError)中选择的位的逻辑OR-ed值。
使用GSCR[33]选择要OR-ed的位。如果端口12没有被
端口乘法器，该位应清零。
位 13 应设置为端口 13 PSCR[1] (SError) 中所选位的逻辑 OR-ed 值。
使用GSCR[33]选择要OR-ed的位。如果端口13没有被
端口乘法器，该位应清零。
位 14 应设置为端口 14 PSCR[1] (SError) 中所选位的逻辑 OR-ed 值。
使用GSCR[33]选择要OR-ed的位。如果端口14没有被
端口乘法器，该位应清零。
位31-15为保留位，应清零。
寄存器33：错误信息位使能
对该寄存器的支持是强制性的。该寄存器选择/启用了用于实现以下功能的位
GSCR[32]中的OR操作。如果某位被设置为1，则GSCR[32]中的每个设备端口都会反映该位。这是一个全局性的使能，不是针对设备端口的。这个寄存器的默认值应该是0400FFFFh；这对应于ERR字段中的所有位和GSCR[32]中的位。
在GSCR[32]中，每个设备端口的DIAG字段的X位一起被OR。
寄存器 34.Phy 事件计数器控制 寄存器 34：Phy 事件计数器控制
如果端口支持Phy事件计数器，则必须支持该寄存器。
GSCR[64]中第4位指示的乘法器。该寄存器用于Phy事件计数器控制机制。
如果将位0设为1，则表示端口多路复用器支持Phy事件计数器，并且当前启用了该功能。如果端口多路复用器支持Phy事件计数器，则应支持端口多路复用器上实现的所有端口的计数器，包括主机端口。它不需要在每个端口上实现相同的Phy事件计数器列表。如果该位被清零，那么计数器内的当前值将被保留，并停止计数。该位在开机时应清零。
 该位不受任何端口上发生的 COMRESET 或软件复位的影响。Phy 事件计数器的值不受该位的影响。
1-15位是保留位，应清零。

##### 高速串行化的附件 
#### ATA国际组织 
如果将位 16 设置为 1，则会立即重置与端口 0 相关的所有 Phy 事件计数器。一旦所有计数器复位完成，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 17 设置为 1，则应立即重置与端口 1 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 18 设置为 1，则应立即重置与端口 2 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 19 设置为 1，则应立即重置与端口 3 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 20 设置为 1，则应立即重置与端口 4 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 21 设置为 1，则应立即重置与端口 5 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 22 设置为 1，则应立即重置与端口 6 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 23 设置为 1，则应立即重置与端口 7 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 24 设置为 1，则应立即重置与端口 8 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 25 设置为 1，则应立即重置与端口 9 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 26 设置为 1，则应立即重置与端口 10 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 27 设置为 1，则应立即重置与端口 11 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 28 设置为 1，则应立即重置与端口 12 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位 29 设置为 1，则应立即重置与端口 13 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。

如果将位 30 设置为 1，则应立即重置与端口 14 相关的所有 Phy 事件计数器。一旦完成所有计数器的重置，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
如果将位31设置为1，则应立即重置与主机端口相关的所有Phy事件计数器。一旦所有计数器复位完成，端口乘法器将自动将该位清零。如果写为零，则不采取任何行动。
寄存器 35-63。63: 保留
寄存器34-63是为将来定义端口乘法器保留的，应清零。
**16.4.1.3 支持的功能**。
通用状态和控制寄存器的功能支持部分包含了端口乘法器支持的可选功能的寄存器。所有功能
支持的寄存器是只读的。
## 表92 - 支持的功能寄存器 
寄存器 O/M F/V 说明
GSCR[64] M
F F F F F F F

端口乘法器修订版 1.X 功能支持 31-5 保留 4 1 = 支持 Phy 事件计数器 3 1 = 支持异步通知 2 1 = 支持动态 SSC 发送使能 1 1 = 支持向主机发出 PMREQP 0 1 = 支持 BIST。
GSCR[65] -
GSCR[95] O F 保留
关键词：O/M=强制性/选择性要求。
O/M = 强制性/任择性要求。
M = 对登记册的支持是强制性的。
O = 对登记册的支持是可选的。
F/V = 固定/可变内容。
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器 64：端口乘法器 1.X 版功能支持。
对该寄存器的支持是强制性的。该寄存器指定了Port Multiplier规范1.X版本中可选的Port Multiplier支持的功能，如果设置为1，则表示Port Multiplier支持16.3.3.9节所述的BIST。
如果将该位设置为1，则表示端口多路复用器支持第16.3.3.9节所述的BIST。如果该位被清零，则端口多路复用器不支持接收BIST。
BIST 激活 FIS。
如果位1被设置为1，则表示端口乘法器支持发出PMREQ_PP和PMREQ_PP。
当所有设备端口被禁用或处于部分/休眠状态时，向主机发出PMREQ_SPrequests。如果该位被清零，则端口倍增器不支持向主机发出PMREQ_PP或PMREQ_SPrequests。
位2如果设置为1，表示端口多路复用器支持动态启用和禁用扩频时钟发送。如果该位被清零，则表示端口倍增器不支持动态启用和禁用扩频时钟传输。

##### HIGH SPEED SERIALIZED ATTACHMENT(高速附件)。
#### ATA国际组织 
如果将位3设置为1，则表示端口乘法器支持异步通知。如果设置为1，则表示端口乘法器支持异步通知。
端口多路复用器支持异步通知，它应能发送一个Set
当GSCR[32]中的某位从零过渡到1时，设备位FIS到主机，中断位设为1，通知位设为1。如果该位被清零，则该设备的
端口多路复用器不支持异步通知。
如果将位 4 设为 1，则表示端口多路复用器支持 Phy 事件计数器，并将位 4 设为 1，则表示端口多路复用器支持 Phy 事件计数器。
应执行GSCR[34]。如果该位被清零，则端口乘法器不支持Phy事件计数器。
位31-5为保留位，应清零。
寄存器65-95。寄存器65-95： 保留
寄存器 65-95 是为将来定义端口乘法器保留的，应清零。
**16.4.1.4 功能启用**。
一般状态和控制寄存器的功能启用部分包含允许启用可选功能的寄存器。功能启用寄存器与第 16.4.1.3 节中定义的功能支持寄存器具有一对一的对应关系。所有功能
启用的寄存器可读/写。
## 表93 - 功能启用寄存器 
寄存器 O/M F/V 说明
GSCR[96] M
F
V
V
V
V
端口乘法器修订版 1.X 特性 启用 31-4 保留 3 1 = 启用异步通知 2 1 = 启用动态 SSC 传输 1 1 = 启用向主机发出 PMREQP 0 1 = 启用 BIST 支持。
GSCR[97] -
GSCR[127]
O F 保留
关键词：O/M=强制性/选择性要求。
O/M = 强制性/任择性要求。
M = 对登记册的支持是强制性的。
O = 对登记册的支持是可选的。
F/V = 固定/可变内容。
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器96.端口乘法器 端口乘法器 Revision 1.X Features Enable（启用）。
对该寄存器的支持是强制性的。该寄存器控制可选的端口
启用端口多路复用器支持的多路复用器规范修订版1.X功能。
如果将位0设置为1，则表示端口多路复用器支持BIST，并且启用了BIST支持。如果该位被清零，则不启用接收BIST激活FIS。如果端口多路复用器支持BIST，则该位应在上电或复位后设置为1，否则应在上电和复位时清零。
如果设置为 1，则表示端口多路复用器支持发出 PMREQ_PP 和 PMREQ_PP。
当所有设备端口被禁用或处于部分/沉睡状态，且该功能被启用时，向主机发出PMREQ_SPrequests。如果该位被清零，端口乘法器将不会向主机发出PMREQ_PP或PMREQ_SPrequests。该位在上电和复位时应清零。
比特2如果设置为1，表示端口多路复用器支持动态启用和禁用扩频时钟传输，并且当前该功能已经启用。如果该位被清零，并且该功能在 GSCR[64]中被支持，则端口多路复用器将被激活。
乘法器不得使用扩频时钟发送。如果该功能在GSCR[64]中得到支持，则该位在上电和复位时应设置为1。
 如果不支持GSCR[64]中规定的该功能，那么该位应在上电和复位时清零。
如果位3被设置为1，则表示端口多路复用器支持异步通知，并且当前该功能已经启用。如果端口多路复用器支持异步通知，则它应能向主机发送一个设置设备位的FIS，并将其与
当GSCR[32]中的一个位从0过渡到1时，中断位设置为1，通知位设置为1。如果该位被清零，而GSCR[64]中的相应位被置1，则不启用异步通知。该位在上电和复位时应清零。
寄存器31-4为保留位，应清零。
寄存器97-127：保留
寄存器97-127是为将来定义端口乘法器保留的，应清零。
**16.4.1.5 供应商专用**。
通用状态和控制寄存器的供应商唯一部分包含了供应商唯一的寄存器。
## 表94 - 供应商专用寄存器 
寄存器 O/M F/V 说明
GSCR[128] - GSCR[255] O X 厂商唯一性
关键词：O/M=强制性/选择性要求。
O/M = 强制性/任择性要求。
M = 对登记册的支持是强制性的。
O = 对登记册的支持是可选的。
F/V = 固定/可变内容。
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器128-255。厂商唯一 **16.4.1.6 Phy事件计数器**。
一般状态和控制寄存器的 Phy 事件计数器部分包含了存储主机端口乘法器支持的每个 Phy 事件计数器的数据的寄存器。Phy 事件计数器寄存器包含标识符和计数器值。所有Phy事件计数器寄存器都是可读/可写的。
计数器的返回值为零意味着没有发生过该事件。

##### 高速 SERIALIZED ATTACHMENT(高速服务器)。
#### ATA国际组织 
## 表95 - Phy事件计数器寄存器 
寄存器 O/M F/V 说明
GSCR[256] -
GSCR[2303]
O V Phy事件计数器寄存器。
键。
O/M = 强制性/选择性要求。
M = 对寄存器的支持是强制性的。
O = 对寄存器的支持是可选的。
F/V = 固定/可变内容
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器256-2303：用于Phy事件计数器。Phy事件计数器不分配特定的寄存器。每个寄存器都包含所实现的计数器的标识符和值。
**16.4.1.7 保留**。
从地址2304开始的通用状态和控制寄存器部分为保留寄存器。
## 表96 - 保留寄存器 
寄存器 O/M F/V 说明
GSCR[2304] -
GSCR[65535]
O F 保留
关键词：O/M=强制性/选择性要求。
O/M = 强制性/任择性要求。
M = 对登记册的支持是强制性的。
O = 对登记册的支持是可选的。
F/V = 固定/可变内容。
F = 寄存器的内容是固定的，不会改变。
V = 寄存器的内容是可变的，可以改变。
X = 寄存器的内容可能是固定的，也可能是可变的。
寄存器2304-65535：保留给将来的端口乘法器定义，应清零。
#### 16.4.2 端口状态和控制寄存器： 寄存器2304-65535：为将来定义端口乘法器保留，应清零。
端口乘法器应为其支持的每个设备端口维护一组端口状态和控制寄存器（PSCR）。这些寄存器是特定于端口的，并包含串行ATA超集。
状态和控制寄存器，以及每个端口的Phy事件计数器信息。主机在READ-RAD的PortNum字段中指定要读或写寄存器的设备端口。
16.5.1 节和 16.5.2 节中定义的端口多路复用器命令或 WRITE PORT MULTIPLIER 命令。寄存器的定义如下表所示。

## 表 97 - PSCR 定义.........................................................................................................。

寄存器定义
PSCR[0] SStatus 寄存器 (见 14.1.1 节)
PSCR[1] SError 寄存器(见14.1.2节)
PSCR[2] SControl 寄存器(见14.1.3节)
PSCR[3] SActive 寄存器(未实现)
PSCR[4] SNotification 寄存器(未实施)
PSCR[5] - PSCR[255] 保留。
PSCR[256] - PSCR[2303] Phy 事件计数器寄存器。
PSCR[2304] - PSCR[65535] 保留。
PSCR[2](SControl)寄存器DET字段的复位值应为4h(Phy禁用)。
**16.4.2.1 Phy 事件计数器**。
端口多路复用器中每个设备端口的Phy事件计数器信息都包含在端口状态和控制寄存器中，从PSCR[256]开始。Phy事件计数器寄存器包含标识符和计数器值。所有Phy事件计数器寄存器都是可读/可写的。
计数器返回的值为零，表示没有发生过该特定事件。

### 16.5 端口乘法器命令定义 
#### 16.5.1 READ PORT MULTIPLIER..................................................................................。

READ PORT MULTIPLIER 命令用于读取端口乘法器上的一个寄存器。读取的是
应向控制端口发出 READ PORT MULTIPLIER 命令。
**16.5.1.1 输入**。
## 表 98 - READ PORT MULTIPLIER 命令定义 
寄存器 7 6 5 4 3 2 1 0
特性(7:0) (^) RegNum[7:0]。
特性(15:8) (^) RegNum[15:8]。
计数(7:0) 保留
计数(15:8) 保留
LBA(7:0) 保留
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备 na RS1 RS2 na 端口号
命令E4h
PortNum 设置为要读取寄存器的端口地址。
 
##### 高速 SERIALIZED ATTACHMENT(附件)。
#### ATA国际组织 
RegNum 设置为要读取的寄存器的编号。
RS1 寄存器专用 1：该位为寄存器专用。
Phy事件计数器用法。用于确定对Phy事件计数器标识符或值的访问。如果在读取Phy事件计数器寄存器时清零，端口乘法器应返回该寄存器的Phy事件计数器标识符。如果设置为1，则端口乘法器应返回该寄存器的Phy事件计数器值，最大长度为64位。
所有其他用途。该位在所有对Phy事件计数器寄存器以外的寄存器的READ PORT MULTIPLIER命令中被视为 "na"。
RS2 寄存器专用 2：该位为寄存器专用。
Phy事件计数器的用法。在读取Phy事件计数器值时使用。如果在读取Phy事件计数器寄存器时设置为1，则端口乘法器应返回计数器的值，随后复位RegNum中提供的寄存器的计数器值。
所有其他用途。该位在所有对Phy事件计数器寄存器以外的寄存器的READ PORT MULTIPLIER命令中被视为 "na"。
**16.5.1.2 成功输出**。
成功完成后，应将状态寄存器中的ERR位清零，错误寄存器中的值为零，并返回指定寄存器的值。
## 表99 - READ PORT MULTIPLIER成功状态结果值 
寄存器 7 6 5 4 3 2 1 0
错误0
计数(7:0) 值[7:0]。
计数(15:8) 值[39:32]。
LBA(7:0)值[15:8]。
LBA(31:24) 值[47:40] ...
LBA(15:8)值[23:16]。
LBA(39:32) (^) 值 [55:48] 。
LBA(23:16值[31:24])
LBA(47:40)值[63:56]。
设备保留
状态 BSY DRDY DF na DRQ 0 0 ERR
键。
值 设置为从寄存器中读取的64位值。
BSY = 0
DRDY = 1
DF=0
DRQ=0
ERR = 0 **16.5.1.3 错误输出**。
当遇到错误时，端口多路复用器应将状态寄存器中的ERR位设置为1，并在错误寄存器中识别错误代码。
 
## 表100 - READ PORT MULTIPLIER错误状态结果值..........................................。

寄存器 7 6 5 4 3 2 1 0
错误 保留 ABRT REG PORT ount(7:0) 保留。
计数(15:8) 保留
LBA(7:0) 保留
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) 保留
LBA(23:16 保留
LBA(47:40) 保留
设备保留
状态 BSY DRDY DF na DRQ 0 0 ERR
关键：
ABRT = 0
REG 如果指定的寄存器无效，则设置为 1。
PORT 如果指定的端口无效，则设置为 1。
BSY = 0
DRDY = 1
DF=0
DRQ=0
ERR = 1
#### 16.5.2 写入端口多路复用器 
WRITE PORT MULTIPLIER命令用于在端口乘法器上写入一个寄存器。寄存器的名称为 "WRITE PORT MULTIPLIER"。
应向控制端口发出 WRITE PORT MULTIPLIER 命令。
**16.5.2.1 输入**。
## 表101 - WRITE PORT MULTIPLIER命令定义。
寄存器 7 6 5 4 3 2 1 0
特性(7:0) (^) RegNum[7:0]。
特性(15:8) (^) RegNum[15:8] (7:0)
计数(7:0) 值 [7:0] (^)
数值[39:32]
LBA(7:0)值[15:8]。
LBA(31:24) 值[47:40] ...
LBA(15:8)值[23:16]。
LBA(39:32) 值 [55:48] 。
LBA(23:16值[31:24])
LBA(47:40)值[63:56]。 
##### 在附件处进行高速小型化。
#### ATA国际组织 
寄存器 7 6 5 4 3 2 1 0
设备 na RS1 na na PortNum
命令E8h
键。
值 设置为要写入寄存器的64位值。
RegNum 设置为要写入寄存器的数量。
PortNum 设置为要写入寄存器的端口地址。
RS1 寄存器专用 1：该位为寄存器专用。
Phy事件计数器的用法。WRITE PORT MULTIPLIER 命令不能用于写入 Phy 事件计数器的标识符值。如果在写入Phy事件计数器寄存器时，该位被设置为1，则由
RegNum应与Value一起写入。如果在写入Phy事件计数器寄存器的过程中被清零，端口乘法器应返回错误状态，ERR位被设置为1，并且在FIS的状态字段中BSY和DRQ位被清零。ABRT位也应在错误字段中设置为1。
所有其他用途。在所有READ PORT（读端口）上，该位应被视为 "na"。
对 Phy 事件计数器寄存器以外的其他寄存器的 MULTIPLIER 命令。
**16.5.2.2 成功输出**。
顺利完成后：
 端口乘法器应将指定的值写入指定的寄存器中，状态寄存器中的 ERR 位应被清除，错误寄存器中的值应为零。状态寄存器中的 ERR 位应被清除，错误寄存器中的值应为零。
## 表102 - 写入端口多路复用器成功状态结果值 
寄存器 7 6 5 4 3 2 1 0
错误0
Count(7:0) 保留
计数(15:8) 保留
LBA(7:0) 保留
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) (^) 保留。
LBA(23:16 保留
LBA(47:40) 保留
设备保留
状态 BSY DRDY DF na DRQ 0 0 ERR
键。
BSY = 0
DRDY = 1
DF=0
DRQ=0
ERR = 0 **16.5.2.3 错误输出**。
当遇到错误时，端口多路复用器应在状态寄存器中把ERR位设置为1，并在错误寄存器中识别错误代码。
 
## 表103 - 写入端口多路复用器错误状态结果值 
寄存器 7 6 5 4 3 2 1 0
错误保留 ABRT REG PORT
Count(7:0) 保留
计数(15:8) 保留
LBA(7:0) 保留
LBA(31:24) 保留
LBA(15:8) 保留
LBA(39:32) 保留
LBA(23:16 保留
LBA(47:40) 保留
设备保留
状态 BSY DRDY DF na DRQ 0 0 ERR
关键：
ABRT = 0
REG 如果指定的寄存器无效，则设置为 1。
PORT 如果指定的端口无效，则设置为 1。
BSY = 0
DRDY = 1
DF=0
DRQ=0
ERR = 1
#### 16.5.3 中断..............................................................................................................。

端口乘法器应在控制端口命令的状态响应中，通过在Device-to-Host Register FIS中设置中断位为1来产生一个中断。端口乘法器在响应控制端口的软件复位时，不应产生中断。
### 16.6 控制PM端口值和接口电源管理....................................。

主控制器需要提供一种方法，使软件可以设置所有传输FIS中的PM端口字段。这种能力可以通过支持FIS中的PMP字段暴露给软件。
14.1.3节中定义的SC控制寄存器。此外，还需要提供一种方法，使软件可以使特定的设备端口过渡到低功率管理状态。通过支持第14.1.3节中定义的SControl寄存器中的SPM字段，可以向软件提供这一功能。
### 16.7 开关类型 (信息) 
根据主机控制器的能力，主机可以使用两种不同的切换类型。如果主机控制器支持基于硬件上下文切换的值的
在接收到的FIS中的PM端口字段，那么主机可能会同时对多个设备有未完成的命令。这种切换类型称为基于FIS的切换，其结果是将FIS从对其有未完成命令的任何设备传送到主机。如果主机控制器不支持基于PM的值的硬件上下文切换。
端口字段，那么主机在任何时候都只能对一个设备有未完成的命令。这种交换类型被称为基于命令的交换，结果是FIS只从对其有未完成命令的一个设备传递给主机。该
无论主机使用何种交换类型，端口乘法器的操作都是一样的。

##### 高速串行化附件 
#### ATA国际组织 
#### 16.7.1 基于命令的切换。
不支持硬件上下文切换的主机控制器利用一种称为基于命令的切换类型。要使用基于命令的切换，主机控制器在任何时间点上只对一个设备发出未完成的命令。通过一次只向一个设备发出命令，结果是端口乘法器只从该设备传送FIS。
主机控制器可以通过在SControl寄存器中实现端口倍增器端口(PMP)字段来支持基于命令的切换，详见14.1.3节。为了使用这种机制，主机软件将在向连接到端口多路复用器的设备发出命令之前适当地设置PMP字段。当主机软件完成对某一设备端口的命令后，它将在向任何其他设备端口发出命令之前修改PMP字段。需要注意的是，当主机软件向端口多路复用器本身发出命令时，应将PMP字段设置为控制端口（如READ PORT MULTIPLIER或WRITE PORT
MULTIPLIER）。)
#### 16.7.2 基于FIS的切换功能 
支持硬件上下文切换的主机控制器可以利用一种称为基于FIS的切换类型。基于FIS的切换允许主机控制器在任何时间点对多个设备有未完成的命令。当多个设备的命令尚未执行时，主机控制器的
端口乘法器可以从任何设备上传送FIS，且命令尚未执行。
**16.7.2.1 主机控制器要求**。
为了支持基于FIS的切换，主控制器应具有上下文切换支持。主控制器需要提供一种方法，在一个端口上为最多16个设备提供编程接口。
 语境切换支持不仅需要理解Control?
块寄存器上下文，也包括DMA引擎上下文和SActive寄存器。主机控制器需要能够更新特定设备的上下文，即使主机软件当前没有选择该设备的编程接口。
主机控制器需要在硬件辅助的FIS传输中填写PM端口字段。例如，如果主机控制器收到来自设备的DMA Activate，它需要构造一个
数据FIS，PM端口字段设置为收到的DMA激活FIS中的值。
请参考第16.3.3.7节，以降低主机上下文切换的复杂性的机制。
 
##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
#### ATA国际组织 
## 17 端口选择器 .......................................................................................................................

端口选择器允许两个不同的主机端口连接到同一个设备，以便为该设备创建一个冗余路径。结合RAID，Port Selector允许系统供应商建立完全冗余的解决方案。端口选择器的上游端口也可以连接到端口多路复用器，以便在更复杂的拓扑结构中提供冗余。如图252所示，端口选择器可以被视为一个简单的多路复用器。
## 图252 - 端口选择器概述...........................................................................................。

一个端口选择器正好提供两个主机连接。两个主机端口中每次只有一个是活动的--规范没有定义活动/活动解决方案的机制。
不支持将端口选择器级联到一起。
### 17.1 应用实例 
如图253所示，端口选择器的一个应用实例是为设备的冗余访问提供一种手段。这种成分与RAID一起，可以建立一个没有单点故障的系统。通常情况下，端口选择器将被封装在硬盘驱动器载体中，以便在硬盘驱动器发生故障时创建一个可服务的单一单元。整个系统将由两台主机组成，每台主机连接到一个RAID阵列，系统中的每个设备都有一个连接到每个主机的Port Selector。其中一台主机可视为实时主机，另一台主机可能是备用主机。在此配置中，实时主机将保持对所有设备的访问，而备用主机只有在实时主机发生故障时才会接管对设备的访问。
主机控制器 
主机控制器 
设备0 1 
#### 主机 
#### 
#### 设备 
#### 
#### 主机 
#### 
港口 
Sel.
 
## 图253 - 两个主机的故障转移应用示例 
### 17.2 概述 
端口选择器是一种机制，它允许两个不同的主机端口连接到同一个设备，以便创建一个通往该设备的冗余路径。每次只有一个主机连接到设备是活动的。有效使用端口选择器需要两个主机端口之间协调访问设备。主机应进行协调，以确定在任何给定的时间点，哪个主机端口应控制设备。协调机制或协议的定义超出了本规范的范围。
一旦主机确定了应该控制设备的主机端口，包含要激活的主机端口的主机就会通过选择该主机端口激活来控制设备。活动主机通过使用基于协议的或边带端口选择机制来选择要活动的端口。侧带端口选择机制可以是简单的硬件选择线，拉到高位激活一个主机端口，拉到低位激活另一个端口。
边带端口选择机制不属于本规范的范围。基于协议的端口选择机制是利用Serial ATA协议来引起活动端口的切换。
本规范定义了一种基于协议的端口选择机制，它使用COMRESET信号的特定摩尔斯编码来引起活动主机端口的切换。一个端口选择器在任何时候都只能支持一种选择机制。端口选择器的外部可见行为
无论使用基于协议的端口选择机制还是边带端口选择机制，选择器都是一样的。
**载波/墨盒载波/墨盒** **HDDHDD** 
主机BHost B
主机A
设备  
##### 在附件处进行高速小型化。
#### ATA国际组织 
支持基于协议的端口选择的端口选择器，如果端口选择器支持可选的存在检测功能，并且主机具有一个增强的SError寄存器，可以锁定该事件，则会在信号路径中进行检测。支持边带端口选择的端口选择器的检测机制不在本规范的范围内。
### 17.3 活动端口选择。
...................................................................................................

端口选择器在同一时间只有一个活动的主机端口。端口选择器应支持两种机制中的一种，以确定两个主机端口中哪个是活动的。第一种机制称为 "侧带端口选择"。侧带端口选择使用的是串行端口选择器以外的机制。
ATA协议，用于确定哪个主机端口处于活动状态。第二种机制称为基于协议的端口选择。基于协议的端口选择使用串行ATA OOB Phy信号的序列来选择活动的主机端口。
无论使用基于协议的端口选择机制还是边带端口选择机制，端口选择器都应表现出本规范中定义的行为。
选择新的活动端口后，设备和处于未知状态。设备可能有前一个活动主机的活动命令未完成，需要刷新。在进行活动端口切换后，强烈建议活动主机发出一个
COMRESET到设备，以确保设备处于已知状态。
#### 17.3.1 基于协议的端口选择 
基于协议的端口选择是一种主动的端口选择机制，它使用一系列的
串行ATA OOB Phy信号来选择活动主机端口。支持基于协议的端口选择的端口选择器在开机时应没有选择任何活动的主机端口。第一个
通过主机端口接收到的COMRESET或COMWAKE应选择该主机端口为活动端口。然后，主机可以发出明确的开关信号来改变活动的主机端口。
在不活动的主机端口上接收到基于协议的端口选择信号，会导致端口
选择器来取消选择当前活动的主机端口，并选择接收选择信号的主机端口。基于协议的端口选择信号是这样定义的：它是使用状态和控制寄存器生成的，并且它的接收和解码不需要端口选择器包含一个完整的链路层或传输层（即信号的直接Phy检测）。
**17.3.1.1 端口选择信号定义**。
端口选择信号是基于从主机传送到端口选择器的COMRESET OOB信号的模式。如图254所示，端口选择器在检测端口选择信号时，应只限定从一个COMRESET信号的断言到下一个COMRESET信号的断言的时间。

TTrraannssmmiitttteedd
CCOOMMRREESSEETT
SSiiggnnaallss
DDeetteecctteeddIIntteerrvvaall
DDeetteecctteeddIIntteerrvvaall
### COMRESET 图 254 - 基于 COMRESET 的断言到以下 COMRESET 的断言的端口选择信号。
端口选择信号定义为一系列COMRESET信号，从一个COMRESET信号的断言到下一个COMRESET信号的断言的时序如表104所定义，图255所示。端口选择器应选择端口，如果不活动，则在否定
在该端口上接收到两个完整的、具有指定突发间间隔的背靠背序列后，进行COMRESET（即两个COMRESET间隔的两个序列，共包含5个）。
COMRESET突发，有四个突发间的延迟）。) 具体来说，在接收到有效的端口选择信号后，端口选择器在整个第五个COMRESET burst不再被检测到之前，不得选择该端口为活动状态。端口选择器只需在不活动端口上识别端口选择信号。即使COMRESET信号构成端口选择信号，在活动端口上接收到的COMRESET信号也会传播到设备上，而不需要端口选择器采取任何行动。这可能导致多个设备复位。
表104中详述的定时应与链路上使用的信令速度无关。
例如，对于使用Gen1或Gen2速度的链路，复位间的时间是相同的。
名称 最小值 最大值 单位 备注
T1 2.0 1.6 2.4 ms 选择序列的第一个事件的复位间断言延时
T2 8.0 7.6 8.4 ms 选择序列的第二个事件的复位间断言延迟。
## 表104 - 端口选择信号间复位时间要求  
##### 在附件处进行高速小型化。
#### ATA国际组织 
TTrraannssmmiitttteedd
CCOOMMRREESSEETT
SSiiggnnaallss
TT 11 TT 22 TT 11 TT 22
### spacings............................................................................................................................... 图255 - 完整的端口选择信号，由两个序列组成，并有必要的复位间隔。
端口选择器对COMRESET信号的解释和检测符合Phy层电气规范，即在收到符合COMRESET信号时序定义的第四个突发时检测COMRESET信号。
 这里提到的端口选择信号的复位间时序是从检测到有效的COMRESET信号到下一次检测到这样的信号为止，而与构成该信号的突发信号无关。
COMRESET信号本身。
**17.3.1.2 存在检测**。
存在检测是指主机检测端口选择器是否存在于端口上的能力。如果一个
端口选择器支持存在检测功能，主机将能够确定是否有一个
端口选择器连接到主机端口。主机可以确定这一点，无论
端口选择器所连接的端口是活动或非活动链路。
存在检测功能仅针对利用基于协议的端口选择的端口选择器进行定义。利用边带端口选择的系统应预先配置为边带端口选择，因此这些系统也可以预先配置为支持存在检测。存在检测是基于协议的端口选择器的可选功能。
**17.3.1.2.1 主机端口Phy状态机增强功能**。
如果支持存在检测，则8.4.2节中描述的Port Selector主机端口Phy状态机应如图所示进行修改。当Phy离线且存在检测被启用时，端口选择器应保持在DR_PS_Wait状态。
DP1：DR_Reset^1接口静止^1。COMRESET未检测到，开机复位被否定 **_且存在检测未启用，Phy未_** **_offline_**。
##### DR_COMINIT **_2. COMRESET未检测到，上电复位_** **_负值，存在检测启用_** **_DR_PS_Presence_** 3. COMRESET检测到或上电复位确定 DR_Reset。
注：1、该状态在响应开机复位或收到主机的COMRESET信号时随时异步进入。在上电复位或收到主机的 COMRESET 信号时，随时异步进入该状态。

DP12: DR_PS_Presence 传送 COMWAKE^ **_1.Phy online_** **_DR_COMINIT 2.Phy off. Phy online_** **_DR_COMINIT 2. Phy offline_** **_DR_PS_Wait_**。 
DP13: DR_PS_Wait 接口静态^ **_1. Phy online_** **_DR_COMINIT 2.Phy offline_** **_DR_PS_Wait_** **17.3.1.2.2 主机 Phy 初始化状态机的影响(告知性)**。
连接到执行存在检测的端口选择器的主机在处于第8.4.1节定义的Phy状态机的HP2：HR_AwaitCOMINIT状态时，会收到一个COMWAKE信号。
该状态对接收COMWAKE不敏感，只有在接收到COMINIT时才会执行过渡到新的状态。主机设计者应该确保他们的实现对接收该状态下的COMWAKE不敏感。如果主机设计能够在此状态下闩锁接收到COMWAKE的事件，主机应将该事件用
SError 寄存器增强功能详见 17.3.1.2.3 节。
**17.3.1.2.3 增强存在检测的SError寄存器**。
第14.1.2节定义的串行ATA接口错误寄存器(SError)包括接口上可能发生的各种事件的指示，如PHYRDY状态的改变、检测到不一致、错误等。为了方便通知主机软件收到端口选择器存在检测信号的手段，当主机处于HP2状态时收到COMWAKE时，SError寄存器DIAG字段中的A位被置为1。
HR_AwaitCOMINIT。
**17.3.1.3 主机传输注意事项（告知性）**。
为了确保端口选择信号可靠地传递给端口选择器，主机应考虑到任何其他可能干扰传输COMRESET端口选择序列的接口活动。例如，如果主机周期性地发出COMRESET信号，作为硬件接线设备存在检测机制的一部分，那么在端口选择信令序列期间可能会出现周期性的COMRESET信号，从而破坏端口选择序列。为了避免这种相互作用，主机可以选择在监视相关的超集状态和控制寄存器中的Phy状态的同时，持续传输端口选择序列。当端口选择信号被端口选择器识别并生效后，主机检测到相关端口被激活后PHYRDY状态的变化，并与其建立通信。建议主机在发出基于协议的选择信号中的每个COMRESET突发之前，立即检查PHYRDY信号，只有在PHYRDY未被断言的情况下，才会发出下一个COMRESET突发。
#### 17.3.2 侧带端口选择 
活动的主机端口可以通过边带机制来选择。侧带端口选择使用串行ATA协议之外的机制来选择哪个主机端口是活动的。侧带端口选择机制的一个例子是硬件选择线。使用的侧带选择机制不在本规范的范围内。支持侧带端口选择的端口选择器应表现出本规范中定义的行为。

#### 17.3.3 更改活动端口时的行为。
在更换活动端口的过程中，在与新的活动主机连接之前，前一个主机的连接被断开，活动主机端口以外的所有内部状态被初始化。
当选择新的活动主机端口时，端口选择器应执行以下程序。1. 端口选择器应停止传输，并在以前的活动主机端口Phy(现为非活动主机端口)上进入静止电源状态。
2. 端口选择器应初始化活动主机端口的选择位状态以外的所有内部状态。
3. 端口选择器应在新的活动主机端口上进入活动电源条件。
4. 端口选择器应允许OOB和正常通信在新的活动主机端口和设备之间进行。
 
##### 高速 SERIALIZED ATTACHMENT（高速服务器）。
#### 串行ATA国际组织 **17.3.3.1 活动端口改变后的设备状态(信息性)**。
端口选择器可以支持有序地切换到新的活动主机端口。支持有序切换的端口选择器可以确保在切换到新的活动主机端口期间，保持与设备Phy的基元对齐。保持基元对齐可以确保
在整个切换到新的活动主机端口的过程中，端口选择器和设备之间的PHYRDY仍然存在。
选择新的活动端口后，设备可能处于未知状态。设备可能有来自先前活动主机端口的活动命令未完成，需要刷新。
新的活动主机应该向设备发出 COMRESET 命令，以使设备返回到已知状态。
### 17.4 行为和策略 
#### 17.4.1 控制状态机 
端口选择器控制状态机是基于一个端口选择器的模型，它由三个Serial ATA Phys相互连接，并由一个整体控制逻辑块控制，如图256所示。为方便起见，Port Selector的三个端口分别简称为 "A"、"B "和 "D"，分别对应主机端口A、主机端口B和设备端口。
##图256--控制状态机............................................................................................。

图256所描述的Phys被推定为具有图257所示的基本功能和控制状态。图257是图111的变体。其不同之处在于。
- 删去了回环控制，因为这些控制与该状态机无关。
- 增加了明确的ONLINE和OFFLINE信号，包括这些信号的寄存器锁存器，这样信号就不需要在每个状态下都被断言。SControl寄存器规定了主机将Phy置于离线模式的机制。因此，我们有理由期待Phy具有可能被利用的ONLINE和OFFLINE信号。
- 增加了一个PORTSELECT信号。使用基于协议的端口选择器应将PORTSELECT信号设置为Sequence Detect块的输出。当收到基于协议的选择信号时，序列检测块被断言，否则该信号被否定。使用侧带端口选择的端口选择器，当要求改变活动端口时，应设置PORTSELECT信号。

主机端口B
主机端口A
Phy **设备端口**
Phy State
机器（第8节） **控制
国家
机器** 
Phy 
Phy
Phy State
机器（第8节） 
Phy State
机器（第8节） 
TXclock
DATAIN[0:n] [0:n]*。
固定模式源
控制块
##### + 
##### a 
##### I O 
##### O 
模拟前端
##### TX- 
##### TX+ 
##### SYSTEMCLOCK I 
##### PHYRESET I 
##### SLUMBER I 
##### PARTIAL I 
##### SPDSELI 
##### SPDMODE O 
恢复的时钟
固定模式检测
数据提取模块
##### + 
##### a 
##### COMMA O 
DATAOUT[0:n]* O
##### RXCLOCK O 
##### COMRESET/ 
##### COMINIT 
##### O 
##### COMWAKE O 
##### I 
##### I RX+ 
##### RX- 
##### ONLINE I 
##### PHYRDY O 
##### R 
##### OFFLINE I S 
##### 关 
序列
检测
##### PortsELECT O 
## 图257 - Phy框图.................................................................................................。

下面的状态图指定了端口选择器控制逻辑块的行为。埠选择控制逻辑块的行为。
端口选择器应具有该状态机所描述的外部可见行为。
从所选主机端口接收到COMRESET信号应无条件地迫使控制状态机过渡到状态PS15：ResetDevice。接收 COMINIT 信号 
##### 在附件处进行高速小型化。
#### 来自设备的串行ATA国际组织应无条件地强制控制状态机过渡到状态PS14。
如果不在ResetDevice状态，则应无条件地强制控制状态机过渡到状态PS14：ResetHost。为了简洁起见，大多数状态都省略了这个隐含的转换。
PS1: PORReset^1 将内部PS状态设置为初始条件，包括

MaxNegSpeed=Max，SelHostPort=none。断言A.OFFLINE.SelHostPort=none。
断言B.OFFLINE.SelHostPort=none。断言D.脱机。
1. 开机复位条件和显式复位请求被否定，Mode=SideBand SetHostPortSideBand 2. 上电复位条件和显式复位请求被否定，且模式=基于协议的AwaitHostSelection 3. 上电复位或显式复位请求被确认，PORReset。
注：1、该状态在响应开机复位或明确的复位请求时随时异步进入。该状态是在响应开机复位或明确的复位请求时随时异步进入的。明确的复位请求是端口选择器本身的复位线/按钮，而不是来自主机的COMRESET信号。

PS2：SetHostPortSideBand^根据边带选择信号的值来设置SelHostPort。
1. 从SelHostPort ResetDevice接收到COMRESET 2. 从D接收到COMINIT，并且没有从SelHostPort接收到COMRESET。
ResetHost 3.没有收到SelHostPort的COMRESET，没有收到D的COMINIT SetHostPortSideBand。
PS3.ONLINE: ComInitPropToBoth^断言A.ONLINE。断言A.PHYRESET。断言B.ONLINE。断言A.PHYRESET.断言B.ONLINE.断言
B.PHYRESET。
1. 无条件的AwaitHostSelection 
PS4.AwaitHostSelection^ 1: AwaitHostSelection^ 1. 从D接收到COMINIT，从(A或B)没有接收到(COMRESET或COMWAKE)ComInitPropToBoth 2. 从A选择A接收到(COMRESET或COMWAKE)3. 从A没有接收到(COMRESET或COMWAKE)，从B选择B接收到(COMRESET或COMWAKE)4. 没有检测到OOB信号。
PS5：选择A^断言B.OFFLINE。设置SelHostPort=A。断言SelHostPort.ONLINE。
断言D.ONLINE.PhyRESET.SelHostPort.PhyRESET。断言 SelHostPort.PHYRESET.SelHostPort=A。断言
D.PHYRESET.^ 1. 无条件等待通讯 
PS6：选择B^断言A.OFFLINE。设置SelHostPort=B。断言SelHostPort.ONLINE。
断言D.ONLINE.PhyRESET.SelHostPort=B。断言 SelHostPort.PHYRESET. 断言
D.PHYRESET.^ 1. 无条件等待通讯  
PS7：WaitForComm^ 1．SelHostPort.PHYRDY和D.PHYRDY，且PORTSELECT信号没有变化 CheckSpeeds 2. (!SelHostPort.PHYRDY或 !D.PHYRDY)且未超过超时^1，PORTSELECT信号WaitForComm不变 3.(!SelHostPort.PHYRDY或 !D.PHYRDY)且超过超时^1，PORTSELECT信号PowerManageCheck不变 4. 非选择的主机端口收到PORTSELECT信号 改变端口。
注：1.超时时间由厂商决定，但应大于1760微秒。

PS8：CheckSpeeds^1 1. SelHostPort.SPDMODE = D.SPDMODE Online 2. SelHostPort.SPDMODE > D.SPDMODE SetDeviceSpeed 3. SelHostPort.SPDMODE < D.SPDMODE SetHostSpeed
注：1.SPDMODE信号的值越大，表示速度越高，而SPDMODE的值越小。

PS9：Online^将D上收到的DATA传输到SelHostPort。将SelHostPort上接收到的DATA传输到D上。
1. 收到非选择主机端口的PORTSELECT信号 ChangePort 2. SelHostPort.PHYRDY 否定或 D.PHYRDY 否定 PowerManageCheck（电源管理检查）。
PS10：SetDeviceSpeed^ Set MaxNegSpeed=D.SPDMODE^ 1. 无条件再通讯 
PS11：SetHostSpeed^ Set MaxNegSpeed=SelHostPort.SPDMODE^ 1. 无条件的再通讯 
PS12：ReComm Assert D.PHYRESET^ 1. 无条件等待通信 
PS13: ChangePort Assert SelHostPort.OFFLINE. Assert !"SelHostPort.ONLINE."。设置
SelHostPort=！SelHostPort。设置MaxNegSpeed=Max.^ 1。无条件的WaitForComm 
PS14：ResetHost Assert SelHostPort.ONLINE.SelHostPort.ONLINE。断言 D.ONLINE.ONLINE。断言：SelHostPort.ONLINE.Assert
SelHostPort.PHYRESET^ 1. 无条件的WaitForComm
注意：1.如果SelHostPort != none，且端口选择器不在状态ResetDevice，则在收到D.COMINIT时无条件进入该状态。
 
##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### ATA国际组织 
PS15：ResetDevice^1断言SelHostPort.ONLINE。断言 D.ONLINE.ONLINE。断言D.ONLINE.Assert
D.PHYRESET.^ 1. 无条件的WaitForComm
如果 SelHostPort != none，则在收到 SelHostPort.COMRESET 时无条件进入该状态。

PS16：PowerManageCheck^ 1. 端口选择器确定进入的低功率状态是SLUMBER PowerManageSlumber 2. 端口选择器确定输入的低功率状态是 SLUMBER PowerManagePartial。
PS17：PowerManagePartial Assert SelHostPort.Partial. Assert D.Partial.^ 1. 检测到SelHostPort.COMWAKE或检测到D.COMWAKE WaitForComm 2.非活动主机端口收到PORTSELECT信号 ChangePort 3. 未收到COMWAKE信号，且PORTSELECT信号未发生变化 PowerManagePartial
##### PS18: 
PowerManageSlumber
Assert SelHostPort.Slumber.^ 1. Assert D.Slumber.^ 1. 检测到SelHostPort.COMWAKE或检测到D.COMWAKE WaitForComm 2.非活动主机端口收到PORTSELECT信号 ChangePort 3. 未收到COMWAKE，且PORTSELECT信号没有变化 PowerManageSlumber.^ 1.
#### 17.4.2 BIST支持 
不需要APort Selector来支持BIST Activate FIS。通过端口选择器发送BIST Activate FIS的结果行为是未定义的。
#### 17.4.3 流量控制信令延迟..............................................................................。

端口选择器应满足第9.4.7节规定的流控信令延迟。埠选择器应满足第9.4.7节中规定的流控信令延迟。

端口选择器应确保每条链路的流控信令延迟得到满足。
具体来说，端口选择器应确保满足以下几个环节之间的流控信令时延。1. 端口选择器活动主机端口与其所连接的主机 2.端口选择器设备端口与其所连接的设备 
端口选择器不得降低其所连接的活动主机或所连接设备的流控信令延迟预算。
#### 17.4.4 电源管理.............................................................................................。

端口选择器应在电源管理事件中保持活动主机端口，只有在接收到有效的端口选择信号后，才允许活动主机端口改变。
非活动主机端口上的Phy应处于静止电源状态。当检测到活动主机端口或设备端口不存在PHYRDY信号时，端口选择器应将该Phy置于静止电源状态。
如果设备和端口选择器之间不存在PHYRDY信号，连接到活动主机端口的Phy应进入静止电源状态，并压制Phy发射器。如果活动主机和端口选择器之间没有 PHYRDY 信号，则连接到设备的 Phy 应进入静止电源状态，并压制 Phy 发射器。在PHYRDY不存在的这些期间，OOB信号仍应在活动主机和设备之间传播，以确保通信的建立。
如果端口选择器能够确定活动主机和设备协商了一个Slumber电源管理转换，端口选择器可以在Slumber电源状态定义的时间内从静止电源状态恢复。如果端口选择器不能确定主机和设备进入的电源状态，端口选择器应在部分电源状态定义的时间内从静止电源状态恢复。
**17.4.4.1 唤醒预算**。
当Port Selector连接到设备时，出Partial或Slumber的唤醒预算可能会增加。当活动主机Phy走出低功率状态时，Port Selector活动主机Phy可能会在引起Port Selector设备Phy唤醒之前唤醒，进而唤醒设备。主机应允许设备至少在20微秒的时间内从唤醒
部分电源管理状态。
#### 17.4.5 OOB Phy信号 
端口选择器应按照第17.4.1节中控制状态机的规定，将从活动主机接收到的COMRESET传播给设备。端口选择器应传播
从设备接收到的 COMINIT 传送到控制状态中指定的活动主机端口。
17.4.1节中的 "机器"。如果没有选择任何活动的主机端口，端口选择器应传播以下信息
从设备接收到的 COMINIT 传送到控制状态中指定的活动主机端口。
17.4.1节中的机器。允许端口选择器延迟发送传播的OOB信号。
端口选择器不应对通过非活动主机端口接收到的COMRESET信号作出响应。
当通过非活动主机端口接收到COMRESET信号时，非活动主机端口Phy应保持在静止电源状态。
#### 17.4.6 热插拔 
端口选择器只有在收到来自设备的 COMINIT 信号时，或作为控制中指定的活动速度协商的一部分，才会在主机端口上生成 COMINIT。
17.4.1节中的状态机。如果连接到端口选择器的设备是热插拔的，设备会根据Phy层状态机发出COMINIT序列，作为其正常上电序列的一部分。端口选择器应在活动的主机端口（如果两个主机端口都不活动，则在两个主机端口上传播COMINIT）。当主机检测到COMINIT信号时，主机再对端口进行询问，以确定是否有设备连接。
如果连接到端口选择器的设备被热拔出，端口选择器应压制活动主机端口的发射器，详见17.4.4节。然后，活动主机应确定PHYRDY信号不再存在，因此设备不再存在。
#### 17.4.7 速度协商 
速度以每条链路为单位进行协商。具体来说，端口选择器应在以下几个方面进行速度协商。1. 端口选择器的活动主机端口与所连接的主机 2.端口选择器的设备端口与所连接的设备 
端口选择器以其支持的最高速度开始速度协商。端口
然后，端口选择器在每条链路上协商速度，使其达到相应的支持速度。在对活动主机链路和设备链路的速度进行协商后，端口选择器应检查两个速度是否匹配。如果速度不匹配，端口选择器就会将其支持的最大速度限制在两个协商速度中较低的速度。
 然后，端口选择器强制重新协商速度，以达到一个共同的速度。

##### 在附件处进行高速 SERIALIZED。
#### ATA国际组织 
#### 17.4.8 扩频时钟 
端口选择器应在其所有端口上支持扩频时钟接收。端口
选择器可支持扩频传输。如果可以设置，建议使用配置跳线来启用/禁用扩频时钟。扩频时钟
提供的串行ATA协议，如果可静态配置，可启用/禁用扩频时钟。
如果使用扩频时钟，则主机和端口之间的扩频域为
选择器不需要与设备和端口之间的展域相同。
选择器。通过端口选择器的信号可以被重新分配。
### 17.5 开机和复位 
#### 17.5.1 开机 
上电后，端口选择器应重置所有内部状态，包括活动的主机端口。这将导致在使用基于协议的端口选择时，不会选择任何活动的主机端口。
**17.5.1.1 端口选择器的存在检测**。
对于基于协议的端口选择，可以使用第17.3.1.2节中概述的可选机制进行存在检测。对于实现边带端口选择的端口选择器的存在检测不在本规范的范围内。
#### 17.5.2 重置..................................................................................................................
 **17.5.2.1 COMRESET*** 
当通过活动主机端口接收到COMRESET信号时，端口选择器应重置所有内部状态，活动主机端口应保持不变，最大速度应保持不变，COMRESET信号应传播给设备。端口选择器在接收到非活动主机端口的COMRESET信号后，除17.3.1节规定的上电后没有选择活动主机端口外，不应采取任何复位动作。
**17.5.2.2 软件复位和DEVICE RESET**。
端口选择器不得在收到软件复位或 DEVICE RESET 命令时复位。
### 17.6 主机的实现(信息) 
#### 17.6.1 基于协议的选择软件方法(资料性)..............................。

本节将详细介绍产生基于协议的端口选择信号的首选软件方法。实现SControl和SStatus寄存器的HBA软件可以使用这种方法来创建基于协议的端口选择信号。
如果在生成序列的过程中，Phy长期处于开启状态，那么基于硬件的端口选择信号就会出现。
COMRESET轮询算法可能会干扰和破坏序列。这种方法试图通过在创建信号期间让Phy在线非常短的序列，将基于主机的COMRESET轮询算法的任何影响降到最低。概述的程序适用于COMRESET轮询间隔大于25微秒的任何HBA设计。
1. 将SControl.DET写入4h，将Phy设置为脱机状态。
2. 将SControl.DET写入1h，将Phy设置为复位状态。
3. 3. 等待5微秒，以便为直流耦合的Phy设计提供充电时间。
4. 将 SControl.DET 写到 0h，将 Phy 设置为在线状态。
5. 等待20微秒以允许COMRESET突发传输到器件。
6. 6. 将 SControl.DET 写到 4h，将 Phy 设置为脱机状态。
  7. 等待1.975毫秒，以满足表104中规定的T1定时。
8. 8.重复步骤2-6。
9. 等待7.975毫秒，以满足表104中指定的T2定时。
10. 10.重复步骤2-6。
11. 等待1.975毫秒，以满足表104中指定的T1定时。
12. 12. 重复步骤2-6 13. 等待7.975毫秒，以满足表104中指定的T2定时。
14. 将SControl.DET写入1h，将Phy设置为复位状态。
15. 等待5微秒，为直流耦合Phy设计留出充电时间。
16. 将 SControl.DET 写到 0h，将 Phy 设置为在线状态。
17. 等待长达10毫秒的SStatus.DET = 3h 18. 如果SStatus.DET !=3h，转到步骤1重新启动进程。

这个过程在下一页的伪代码中也有概述。

##### HIGH SPEED SERIALIZED ATTACHMENT（高速服务器）。
#### 串行ATA国际组织 // / 继续执行这个程序，直到SStatus.DET == 3。
// while(SStatus.DET !=3) {
SControl.DET= 4; // Turnoff Phy // 在适当的T1/T2定时间隔下模仿出COMRESETbursts。
// for (i = 0; i < 4; i++) {
SControl.DET= 1; // 将HBA置于复位状态。
Sleep(5); // 等待Phy充电，以微秒为单位。
SControl.DET = 0; // 发出COMRESET。
Sleep(20); // 等待 COMRESET 的发送。
SControl.DET = 4; // 关闭 Phy if ((i == 0) || (i == 2)) {
Sleep(1975); // WaitT1 timeminus 已经等待的时间。
} else if ((i == 1) || (i == 3)) {
Sleep(7975); // WaitT2 timeminus 已经等待的时间。
}
} // / 发出突发事件的finalCOMRESET。
//
SControl.DET= 1; // 将HBA置于复位状态。
Sleep(5); // 等待Phy充电，以微秒为单位。
SControl.
DET= 0; // Issue COMRESET // // Wait up to 10 milliseconds for PHYRDY.
// for (i = 0; i < 10000; i++) { if (SStatus.DET== 3) { break; // Stopprocedure if SStatus.DET == 3。
}
Sleep(1); // 等待1微秒。
}  
##### 在附件处进行高速小型化。
#### ATA国际组织 
## 附录A。CRC和扰码的样本代码(信息性) ..........................................

### A.1 CRC计算 
#### A.1.1 概述 
下面一节提供了一个CRC多项式的信息实现。这个例子是为了帮助验证算法的HDL实现。
#### A.1.2 最大帧大小............................................................................................。

串行ATA使用的32位CRC可以显示出提供两个10位错误的检测，最大帧大小为16384字节。这为将来扩展FIS提供了最大64字节的固定开销，同时仍允许最大用户数据有效载荷为8192字节。
#### A.1.3 CRC算法的示例代码 
下面是用C语言编写的代码，说明了CRC算法的实现。一个寄存器
以包含PIO写命令的主机到设备FIS为例进行输入。计算出的CRC是附加在传输的串行数据流上的校验D字，紧接于
EOFP. 代码同时显示产生的命令FIS和中间的CRC多项式值。要用GNU工具链编译代码，请使用以下命令。"gcc -o crc.exe crc.c"
此代码提供的目的只是为了说明问题。
#### A.1.4 CRC算法示例代码 /****************************************************************************/* */ /* crc.c */ /* */ /* 这个示例代码读取标准的32位值序列 */ /* 以十六进制格式化，前导为 "0x"(例如0xDEADBEEF)。代码计算输入数据流的串行ATA CRC。所用的生成器多项式为 */ /* 32 26 23 22 16 12 11 10 8 7 5 4 2 */ /* G(x) = x + x + x + x + x + x + x + x + x + x + x + x + 1 */ /* */ /* 本示例代码使用了适合在硬件中实现的 CRC 计算 */ /* 电路的并行实现。下面是被模拟的电路的方框图。 */ /* | */ /* | */ /* | */ /* +--------------------------------------------+ */ /* */ /* CRC值初始化为0x52325032，如Serial ATA */ /*规范所定义。*/ /* */ /****************************************************************************/ #include <stdlib.h> #include <stdio. h> main(argc,argv) int argc; char *argv[]; { int i, data_count; unsigned int crc, data_in; unsigned char crc_bit[32], new_bit[32]; crc = 0x52325032; data_count = 0; while (scanf(" 0x%8x", &data_in) == 1) { data_count++; /* 将 data_in 的值加到 */ /* "寄存器 "中的 CRC 的当前值上。加法是以模数2(XOR)方式进行的。*/ crc ^= data_in; /* 将寄存器中的CRC值扩展到32位，以便于操作。*/ for (i = 0; i < 32; ++i) { crc_bit[i] = (crc >> i) & 0x01;
} /* 下面的32个任务执行上图中标有 "*"的方框的功能*/*。new_bit数组是一个*/**暂时存放新计算出来的CRC值的地方。*/ 请注意，下面的赋值中有很多共享项。
 */ new_bit[31] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[15] ^ crc_bit[11] ^ crc_bit[9] ^ crc_bit[8] ^ crc_bit[5]。new_bit[30] = crc_bit[30] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[22] ^ crc_bit[14] ^ crc_bit[10] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[4]; new_bit[29] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[25] ^ 。crc_bit[23] ^ crc_bit[22] ^ crc_bit[21] ^ crc_bit[13] ^ crc_bit[9] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[3]; new_bit[28] = crc_bit[30] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[24] ^ 。crc_bit[22] ^ crc_bit[21] ^ crc_bit[20] ^ crc_bit[12] ^ crc_bit[8] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[2]; new_bit[27] = crc_bit[29] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[23] ^ 。crc_bit[21] ^ crc_bit[20] ^ crc_bit[19] ^ crc_bit[11] ^ crc_bit[7] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[1]; new_bit[26] = crc_bit[31] ^ crc_bit[28] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[22] 。^ crc_bit[20] ^ crc_bit[19] ^ crc_bit[18] ^ crc_bit[10] ^ crc_bit[6] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[0]; new_bit[25] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[22] ^ crc_bit[21] ^ crc_bit[19] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[15] ^ crc_bit[11] ^ crc_bit[8] ^ crc_bit[3] ^ crc_bit[2]; new_bit[24] = crc_bit[30] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[21] ^ crc_bit[20] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[16] ^ crc_bit[14] ^ crc_bit[10] ^ crc_bit[7] ^ crc_bit[2] ^ crc_bit[1]; new_bit[23] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[20] ^ crc_bit[19] ^ 。crc_bit[17] ^ crc_bit[16] ^ crc_bit[15] ^ crc_bit[13] ^ crc_bit[9] ^ crc_bit[6] ^ crc_bit[1] ^ crc_bit[0]; new_bit[22] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[23] ^ 。crc_bit[19] ^ crc_bit[18] ^ crc_bit[16] ^ crc_bit[14] ^ crc_bit[12] ^ crc_bit[11] ^ crc_bit[9] ^ crc_bit[0]; new_bit[21] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[22] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[13] ^ crc_bit[10] ^ crc_bit[9] ^ crc_bit[5]; new_bit[20] = crc_bit[30] ^ crc_bit[28] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[23] ^ crc_bit[21] ^ crc_bit[17] ^ crc_bit[16] ^ crc_bit[12] ^ crc_bit[9] ^ crc_bit[8] ^ crc_bit[4]; new_bit[19] = crc_bit[29] ^ crc_bit[27] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[22] ^ crc_bit[20] ^ crc_bit[16] ^ crc_bit[15] ^ crc_bit[11] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[3]; new_bit[18] = crc_bit[31] ^ crc_bit[28] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[21] ^ crc_bit[19] ^ crc_bit[15] ^ crc_bit[14] ^ crc_bit[10] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[2]; new_bit[17] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[27] ^ crc_bit[25] ^ crc_bit[23] ^ crc_bit[22] ^ 。crc_bit[20] ^ crc_bit[18] ^ crc_bit[14] ^ crc_bit[13] ^ crc_bit[9] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[1]; new_bit[16] = crc_bit[30] ^ crc_bit[29] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[22] ^ crc_bit[21] ^ 。crc_bit[19] ^ crc_bit[17] ^ crc_bit[13] ^ crc_bit[12] ^ crc_bit[8] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[0]; new_bit[15] = crc_bit[30] ^ crc_bit[27] ^ crc_bit[24] ^ crc_bit[21] ^ crc_bit[20] ^ crc_bit[18] ^ crc_bit[16] 。^ crc_bit[15] ^ crc_bit[12] ^ crc_bit[9] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[3]; new_bit[14] = crc_bit[29] ^ crc_bit[26] ^ crc_bit[23] ^ crc_bit[20] ^ crc_bit[19] ^ crc_bit[17] ^ crc_bit[15] 。^ crc_bit[14] ^ crc_bit[11] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[2]; new_bit[13] = crc_bit[31] ^ crc_bit[28] ^ crc_bit[25] ^ crc_bit[22] ^ crc_bit[19] ^ crc_bit[18] ^ crc_bit[16] ^ 。crc_bit[14] ^ crc_bit[13] ^ crc_bit[10] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[3] ^ crc_bit[2] ^ crc_bit[1]; new_bit[12] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[27] ^ crc_bit[24] ^ crc_bit[21] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[15] 。^ crc_bit[13] ^ crc_bit[12] ^ crc_bit[9] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[2] ^ crc_bit[1] ^ crc_bit[0]; new_bit[11] = crc_bit[31] ^ crc_bit[28] ^ crc_bit[27] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[20] ^ crc_bit[17] 。^ crc_bit[16] ^ crc_bit[15] ^ crc_bit[14] ^ crc_bit[12] ^ crc_bit[9] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[1] ^ crc_bit[0]; new_bit[10] = crc_bit[31] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[26] ^ crc_bit[19] ^ crc_bit[16] ^ crc_bit[14] ^ crc_bit[13] ^ crc_bit[9] ^ crc_bit[5] ^ crc_bit[3] ^ crc_bit[2] ^ crc_bit[0]; 
##### 高速序列化在ATATACHMENT。

#### 串行ATA国际组织 new_bit[9] = crc_bit[29] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[18] ^ crc_bit[13] ^ crc_bit[12] ^ crc_bit[11] ^ crc_bit[9] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[2] ^ crc_bit[1]; new_bit[8] = crc_bit[31] ^ crc_bit[28] ^ crc_bit[23] ^ crc_bit[22] ^ crc_bit[17] ^ crc_bit[12] ^ crc_bit[11] ^ crc_bit[10] ^ crc_bit[8] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[1] ^ crc_bit[0]; new_bit[7] = crc_bit[29] ^ crc_bit[28] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[23] ^ crc_bit[22] ^ crc_bit[21] ^ 。crc_bit[16] ^ crc_bit[15] ^ crc_bit[10] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[5] ^ crc_bit[3] ^ crc_bit[2] ^ crc_bit[0]; new_bit[6] = crc_bit[30] ^ crc_bit[29] ^ crc_bit[25] ^ crc_bit[22] ^ crc_bit[21] ^ crc_bit[20] ^ crc_bit[14] 。^ crc_bit[11] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[2] ^ crc_bit[1]; new_bit[5] = crc_bit[29] ^ crc_bit[28] ^ crc_bit[24] ^ crc_bit[21] ^ crc_bit[20] ^ crc_bit[19] ^ crc_bit[13] 。^ crc_bit[10] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[5] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[1] ^ crc_bit[0]; new_bit[4] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[29] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[20] ^ crc_bit[19] ^ crc_bit[18] 。^ crc_bit[15] ^ crc_bit[12] ^ crc_bit[11] ^ crc_bit[8] ^ crc_bit[6] ^ crc_bit[4] ^ crc_bit[3] ^ crc_bit[2] ^ crc_bit[0]; new_bit[3] = crc_bit[31] ^ crc_bit[27] ^ crc_bit[25] ^ crc_bit[19] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[15] 。^ crc_bit[14] ^ crc_bit[10] ^ crc_bit[9] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[3] ^ crc_bit[2] ^ crc_bit[1]; new_bit[2] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[26] ^ crc_bit[24] ^ crc_bit[18] ^ crc_bit[17] ^ crc_bit[16] ^ 。crc_bit[14] ^ crc_bit[13] ^ crc_bit[9] ^ crc_bit[8] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[2] ^ crc_bit[1] ^ crc_bit[0]; new_bit[1] = crc_bit[28] ^ crc_bit[27] ^ crc_bit[24] ^ crc_bit[17] ^ crc_bit[16] ^ crc_bit[13] ^ crc_bit[12] ^ crc_bit[11] ^ crc_bit[9] ^ crc_bit[7] ^ crc_bit[6] ^ crc_bit[1] ^ crc_bit[0]; new_bit[0] = crc_bit[31] ^ crc_bit[30] ^ crc_bit[29] ^ crc_bit[28] ^ crc_bit[26] ^ crc_bit[25] ^ crc_bit[24] ^ crc_bit[16] ^ crc_bit[12] ^ crc_bit[10] ^ crc_bit[9] ^ crc_bit[6] ^ crc_bit[0]; /* 新的CRC值已被计算为*//* new_bit数组中的单个位。将其重新组合成一个32位的值，并将其 "时钟 "*//*到 "寄存器 "中。*/ crc = 0; for (i = 31; i >= 0; --i) { crc = crc << 1; crc |= new_bit[i];
}printf("运行中的CRC值为0x%08X/n", crc)。
} printf("处理的数据字总数为%d/d/n", data_count); printf("CRC值为0x%08X/n/n", crc); return 0;
}
#### A.1.5 CRC执行输出示例 
以下是存储在文件样本中的示例数据作为输入：0x00308027 0xE1234567 0x00000000 0x00000002 0x00000000
执行命令./crc < sample，得到以下输出。
运行CRC值为0x11E353FD。
运行的CRC值为0x0F656DA7。
运行CRC值为0x3D14369C
运行的CRC值为0x92D0D681。
运行的CRC值为0x319FFF6F。
处理的数据字总数为5个
CRC是0x319FFF6F。
### A.2 扰动计算.................................................................................................。

#### A.2.1 概述 
下面一节提供了一个加扰多项式的信息实现。这个例子是为了帮助验证算法的HDL实现。
#### A.2.2 加扰算法的示例代码 
下面的代码是用C语言编写的，说明了加扰算法的实现。A
含有PIO写命令的注册主机到设备FIS被用作示例输入。该代码显示了加扰数据和加扰器的原始输出。要使用GNU工具链编译代码，请使用以下命令。"gcc -o scramble.exe scramble.c"
提供的这段代码只是为了说明问题。
#### A.2.3 加扰器实现示例 /****************************************************************************/** *//* scramble.c *//* *//* 本示例代码生成由串行ATA规范中定义的加扰器产生的65535个D字的整个序列。该规范要求LFSR产生一串比特，然后将这些比特打包成32位Dword，与数据Dword进行XOR。指定的生成器多项式为 */ 16 15 13 4 */ /* G(x) = x + x + x + x + 1 */ /* */ /* 平行化版本的扰频器初始化为*/ /*从*/ /*规范中定义的初始化值0xFFFF导出的值。本实施例初始化为0xF0F6。其他*/ /*并行实现有不同的初始值。重要的一点是，任何实施例的第一个Dword输出*//*需要等于0xC2D2768D。*/ /* */ /* 这段代码并不代表C语言实现的优雅解决方案，*/ /* 但它确实展示了一种生成序列的方法，这种方法可以*/ /* 在硬件中轻松实现。
 该代码所模拟的电路框图如下。*/ /* */ /* +-----------------------------------+ */ /* | | */ /* | +--+ +--+ | */ /* +---->| e |----------+---->| M |----+----> Output(31 downto 16) */ /* | g | | | 1 */ /* +-- --+ |+--+ */* | */* |+--+ */* | */* +---->| M |---------> Output(15 downto 0) */* | 2 */* +---+ */* */* 框图中所示的寄存器是一个16位的寄存器，两个*/*框，*M1和*M2分别代表一个16乘16的二进制*/*矩阵。两个*/ /*框，*M1和*M2，分别代表一个16乘16的二进制*/ /*矩阵的乘法。一个16乘16的矩阵乘以一个16位向量，就得到一个16位向量。*/ 两个向量是32位加扰器值的两半。上半部分的值会被存储到上下文寄存器中，用于生成下一个加扰器的值*/**序列。*/ 
##### 在附件处进行高速小型化。
#### Serial ATA International Organization /* */ /****************************************************************************/ #include <stdlib.h> #include <stdio. h> main(argc,argv) int argc; char *argv[]; { int i, j; unsigned short context; /* 持有上下文或状态的16位寄存器 */ unsigned long scrambler; /* 电路的32位输出 */ unsigned char now[16]; /* 上下文的各个位 */ unsigned char next[32]; /* scrambler的计算位 */ /* 平行化版本的scrambler初始化为*/ /*从*/ /*规范中定义的初始化值0xFFFF导出的值。本实施例的初始化值为0xF0F6。其他*/ /*并行实现有不同的初始值。重要的一点是，任何实现的第一个Dword输出*//*需要等于0xC2D2768D。*/ context = 0xF0F6; for (i = 0; i < 65535; ++i) { /* 将寄存器内容(变量context)分割成*/*各个位，以便于处理。*/ for (j = 0; j < 16; ++j) { now[j] = (context >> j) & 0x01;
} /* 下面的16个赋值实现了矩阵乘法*//*由标有*M1的方框执行。*/ /* 请注意，这些赋值中有很多共享项。*/ next[31] = now[12] ^ now[10] ^ now[7] ^ now[3] ^ now[1] ^ now[0]; next[30] = now[15] ^ now[14] ^ now[12] ^ now[11] ^ now[9] ^ now[6] ^ now[3] ^ now[2] ^ now[0]; next[29] = now[15] ^ now[13] ^ now[12] ^ now[11] ^ now[10] ^ now[8] ^ now[5] ^ now[3] ^ now[2] ^ now[1]; next[28] = now[14] ^ now[12] ^ now[11] ^ now[10] ^ now[9] ^ now[7] ^ now[4] ^ now[2] ^ now[1] ^ now[0]。next[27] = now[15] ^ now[14] ^ now[13] ^ now[12] ^ now[11] ^ now[10] ^ now[9] ^ now[8] ^ now[6] ^ now[1] ^ now[0]。next[26] = now[15] ^ now[13] ^ now[11] ^ now[10] ^ now[9] ^ now[8] ^ now[7] ^ now[5] ^ now[3] ^ now[0]; next[25] = now[15] ^ now[10] ^ now[9] ^ now[8] ^ now[7] ^ now[6] ^ now[4] ^ now[3] ^ now[2]。next[24] = now[14] ^ now[9] ^ now[8] ^ now[7] ^ now[6] ^ now[5] ^ now[3] ^ now[2] ^ now[1]; next[23] = now[13] ^ now[8] ^ now[7] ^ now[6] ^ now[5] ^ now[4] ^ now[2] ^ now[1] ^ now[0]。next[22] = now[15] ^ now[14] ^ now[7] ^ now[6] ^ now[5] ^ now[4] ^ now[1] ^ now[0]; next[21] = now[15] ^ now[13] ^ now[12] ^ now[6] ^ now[5] ^ now[4] ^ now[0]。next[20] = now[15] ^ now[11] ^ now[5] ^ now[4]; next[19] = now[14] ^ now[10] ^ now[4] ^ now[3]; next[18] = now[13] ^ now[9] ^ now[3] ^ now[2]; next[17] = now[12] ^ now[8] ^ now[2] ^ now[1]。next[16] = now[11] ^ now[7] ^ now[1] ^ now[0]; /* 以下16个赋值实现了矩阵乘法 */ /* 由标有*M2的盒子执行。*/ next[15] = now[15] ^ now[14] ^ now[12] ^ now[10] ^ now[6] ^ now[3] ^ now[0]; next[14] = now[15] ^ now[13] ^ now[12] ^ now[11] ^ now[9] ^ now[5] ^ now[3] ^ now[2]; next[13] = now[14] ^ now[12] ^ now[11] ^ now[10] ^ now[8] ^ now[4] ^ now[2] ^ now[1]; next[12] = now[13] ^ now[11] ^ now[10] ^ now[9] ^ now[7] ^ now[3] ^ now[1] ^ now[0]。next[11] = now[15] ^ now[14] ^ now[10] ^ now[9] ^ now[8] ^ now[6] ^ now[3] ^ now[2] ^ now[0]; next[10] = now[15] ^ now[13] ^ now[12] ^ now[9] ^ now[8] ^ now[7] ^ now[5] ^ now[3] ^ now[2] ^ now[1]。next[9] = now[14] ^ now[12] ^ now[11] ^ now[8] ^ now[7] ^ now[6] ^ now[4] ^ now[2] ^ now[1] ^ now[0]。next[8] = now[15] ^ now[14] ^ now[13] ^ now[12] ^ now[11] ^ now[10] ^ now[7] ^ now[6] ^ now[5] ^ now[1] ^ now[0]。next[7] = now[15] ^ now[13] ^ now[11] ^ now[10] ^ now[9] ^ now[6] ^ now[5] ^ now[4] ^ now[3] ^ now[0]; next[6] = now[15] ^ now[10] ^ now[9] ^ now[8] ^ now[5] ^ now[4] ^ now[2]。next[5] = now[14] ^ now[9] ^ now[8] ^ now[7] ^ now[4] ^ now[3] ^ now[1]; next[4] = now[13] ^ now[8] ^ now[7] ^ now[6] ^ now[3] ^ now[2] ^ now[0]。next[3] = now[15] ^ now[14] ^ now[7] ^ now[6] ^ now[5] ^ now[3] ^ now[2] ^ now[1]; next[2] = now[14] ^ now[13] ^ now[6] ^ now[5] ^ now[4] ^ now[2] ^ now[1] ^ now[0]; next[1] = now[15] ^ now[14] ^ now[13] ^ now[5] ^ now[4] ^ now[1] ^ now[0]; next[0] = now[15] ^ now[13] ^ now[4] ^ now[0]; /* "next "数组中已生成32位的输出。
 */ /* 将比特重新组合成一个32位的Dword。*/ scrambler = 0; for (j = 31; j >= 0; --j) { scrambler = scrambler << 1; scrambler |= next[j];
} /* 加扰器输出的上半部分被存储到*/*寄存器中，作为下一个周期的保存上下文。*/ context = scrambler >> 16; printf("0x%08X/n", scrambler);
} return 0;
} 
##### 在附件处进行高速小型化。
序号 ATA国际组织
#### A.2.4 加扰器实施输出示例 
下面列出了加扰器生成的前32个结果和上面列出的C样本代码。
0xC2D2768D 0x1F26B368 0xA508436C 0x3452D354 0x8A559502 0xBB1ABE1B 0xFA56B73D 0x53F60B1B 0xF0809C41 0x747FC34A 0xBE865291 0x7A6FA7B6 0x3163E6D6 0xF036FE0C 0x1EF3EA29 0xEB342694 0x53853B17 0xE94ADC4D 0x5D200E88 0x6901EDD0 0xFA9E38DE 0x68DB4B07 0x450A437B 0x960DD708 0x3F35E698 0xFE7698A5 0xC80EF715 0x666090AF 0xFAF0D5CB 0x2B82009F 0x0E317491 0x76F46A1E 
### A.3 示例帧.............................................................................................................

下表显示了传输一个简单的FIS的步骤和数值。
对于LBA=1234567和Count(7:0)=2。
## 表105 - CRC和扰码器计算示例 - PIO写命令 
FIS数据（十六进制）
扰流板
值(十六进制)
炒菜
数据（十六进制）
累计
CRC值（十六进制）
评论 3737B57C na 3737B57C na SOFP，基元未加扰，加扰器复位 00308027 C2D2768D C2E2F6AA 11E353FD 寄存器--主机到设备 FIS。
命令=30，Cbitset
E1234567 1F26B368 FE05F60F 0F656DA7 LBA 1234567 00000000 A508436C A508436C 3D14369C Extended LBA = 0 00000002 3452D354 3452D356 92D0D681 Device ControlRegister = 0，2个扇区 00000000 8A559502 8A559502 319FFF6F reserved = 0 319FFF6F BB1ABE1B 8A854174 na CRC
D5D5B57C na D5D5B57C na EOF,基元未加扰。
注：所有数值均为十六进制，显示为31:0。
在8b/10b编码之前，该寄存器FIS的传输D字为 。
SOFP
C2E2F6AAh
FE05F60Fh
A508436Ch 3452D356h 8A559502h 8A854174h
EOFP 
##### 在附件处进行高速小型化。
序号 ATA国际组织
## 附录B. 命令处理概述（资料性） ......................................................

### B.1 非数据命令 
当BIOS或软件驱动程序写入Command寄存器时，主机适配卡会将Command寄存器设置为
BSY位到影子状态寄存器中的1，并向设备传输一个命令帧。
当命令动作完成后，设备传输一个Register帧来设置影子寄存器的结束内容。
### B.2 主机从设备读取DMA的情况 
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机适配器的DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出命令。
- 作为对命令影子寄存器块寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并将带有影子寄存器块内容的寄存器--主机到设备FIS传送给设备。
- 当设备处理完命令并准备就绪时，它以一个或多个数据FIS的形式将读数据传送给主机。这种传输是根据流控制信号/准备状态进行的。
- 主机适配器识别到传入的帧是数据FIS，并且DMA控制器已经编程，并将传入的数据引导到主机适配器的DMA控制器，后者将传入的数据转发到适当的主机存储器位置。
- 传输完成后，设备传送一个Register - Device to Host FIS来指示命令的结束状态，将状态寄存器中的BSY位清零，如果头中设置了中断标志，则向主机发出中断信号。

在某些错误条件下，在传送状态信息的寄存器FIS之前可能没有传送数据FIS。如果是这样，主机软件驱动程序应中止设置的
DMA控制器。
### B.3 主机对设备的DMA写入。
- 在向设备发出命令之前，主机驱动软件会用内存地址指针和传输方向对主机适配器的DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。结果，DMA控制器被武装起来，但在等待来自设备的信号以进行数据传输时仍处于暂停状态。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出命令。
- 为了响应命令影子寄存器块寄存器被写入。
 主机适配器设置Shadow状态寄存器中的BSY位，并向设备发送一个带有Shadow寄存器块内容的寄存器--主机到设备FIS，当设备准备好从主机接收数据时，设备向主机发送一个DMA激活FIS，从而激活武装的DMA控制器。
- 当设备准备好接收来自主机的数据时，设备向主机发送一个DMA激活FIS，从而激活武装的DMA控制器。DMA控制器以一个或多个数据FIS的形式向设备传输写数据。如果需要一个以上的数据FIS来完成整个数据传输请求，则应在随后的每一个数据FIS之前发送一个DMA激活FIS。传输给设备的数据量由主机驱动软件在命令设置阶段编入主机适配器的DMA控制器的传输计数决定。
- 传输完成后，设备传送一个Register - Device to Host FIS来指示命令的结束状态，将状态寄存器中的BSY位清零，如果头中设置了中断标志，则向主机发出中断信号。

在某些错误条件下，设备可能在没有传送DMA激活FIS的情况下，通过向主机传送寄存器帧来发出结束状态信号。在这种情况下，主机驱动软件应该中止并清理DMA控制器。
### B.4 从设备读取PIO数据.....................................................................................。

- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PIO读取命令。
- 作为对命令寄存器被写入的响应，主机适配卡将影子状态寄存器中的BSY位设置为1，并将带有影子寄存器块内容的寄存器--主机到设备FIS传送给设备。
- 当设备处理完该命令并准备开始向主机传输数据时，它首先向主机传输一个PIO设置FIS。接收到PIO设置FIS后，主机适配卡将FIS内容保存在一个临时保持缓冲区中。
- 设备在PIO设置FIS之后，会发送一个数据-设备到主机的FIS。当接收到数据FIS时，同时保持PIO设置FIS，主机适配卡将PIO设置FIS中的寄存器内容转移到影子寄存器中，包括初始状态值，导致状态寄存器中DRQ位被设置为1，BSY位被清零。同时，如果中断位被置1，则会产生一个中断给主机。
- 主机控制器将属于数据FIS的传入数据接收到一个速度匹配的FIFO中，这个FIFO在概念上是连接到影子寄存器数据块寄存器的。
- 由于发出的中断和DRQ在状态寄存器中设为1，主机软件在数据寄存器上做REP INSW，并从速度匹配FIFO的头部拉取数据，同时串行链路正在向FIFO的尾部添加数据。流控方案处理数据节流，避免接收速度匹配FIFO的下溢/溢出，而接收速度匹配FIFO则供给数据影子寄存器块寄存器。
- 当主机软件从数据影子寄存器中读取的字数达到PIO设置FIS中指示的值时，主机将先前PIO设置FIS中的结束状态值转移到影子状态寄存器中，导致DRQ被清零并报告结束状态。
- 如果有更多的数据块需要传输，则结束状态指示BSY位被设置为1，这个过程从设备向主机发送PIO设置FIS开始重复。

### B.5 向设备写入PIO数据 
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PIO写命令。
- 作为对命令寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并向设备传送一个带有影子寄存器块内容的寄存器-主机到设备FIS。
- 当设备准备好接收PIO写数据时，它向主机发送一个PIO设置FIS，以指示目标已准备好接收PIO数据和要传输的数据字数。
- 响应PIO Setup FIS中D位指示设备写入的情况下，主机将PIO Setup FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致DRQ位被置1，BSY位被清零。同时，如果中断位被置1，则会产生一个中断给主机。
 
##### 高速串行化 ATTACHMENT(高速串行化) 
序号 ATA国际组织
- 由于影子状态寄存器中的DRQ位被置1，主机驱动软件开始对数据寄存器进行REP OUTSW。

- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送到设备。REP OUTSW将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时，主机控制器将PIO设置帧中指示的最终状态值传输到影子状态寄存器中，导致DRQ被清零，并以CRC和EOFP关闭该帧。如果要传输更多的数据扇区，则传输到影子状态寄存器中的最终状态值会将BSY位设为1，状态与第一次向设备发出命令后的状态相同。
- 如果有更多的数据块要传输，则结束状态指示BSY位被设为1，这个过程从设备向主机发送PIO设置FIS开始重复。
- 当扇区计数寄存器中指示的扇区数被传输完毕后，设备应发送寄存器-设备到主机FIS，命令完成中断，BSY位清零。
- 在写错误的情况下，设备可以在任何扇区边界上，在PIO设置FIS中包含错误状态和命令完成中断，而不需要发送寄存器-设备到主机FIS。

### B.6 ATA标签命令队列 DMA从设备读出 
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出命令。
- 作为对命令影子寄存器块寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并向设备传送一个带有影子寄存器块内容的寄存器--主机到设备FIS。
- 当设备已经排好队并希望释放总线时，它向主机发送一个寄存器FIS，导致BSY位被清零，状态寄存器中的REL位被置1。
- 当设备准备好完成排队命令的传输时，它向主机发送一个Set Device Bits FIS，导致状态寄存器中的SERV位被设置。如果没有其他命令处于活动状态（即BSY位设为1），那么也会产生一个中断。
- 作为对服务请求的响应，主机软件停用DMA控制器(如果激活)，并通过写入影子寄存器块寄存器向设备发出SERVICE命令，导致BSY位被设置为1，并向设备传送一个寄存器FIS。
- 作为对SERVICE请求的响应，设备向主机传送一个寄存器FIS，将TAG值传达给主机，并将BSY位清零，将DRQ位设置为1。
- 当DRQ位设为1时，主机软件从影子寄存器块中读取TAG值，并恢复适合正在完成的命令的DMA控制器上下文。
- 设备将读取的数据以一个或多个数据FIS的形式传送给主机。这种传输是在响应流控制信号/准备状态下进行的。在DMA控制器有其上下文恢复之前到达的任何DMA数据都会倒退到入站速度匹配FIFO中，直到FIFO被填满，此后进行流控制，以节流传入的数据，直到DMA控制器由主机软件恢复其上下文。
- 主机控制器识别到传入的数据包是数据FIS，DMA控制器被编程，并将传入的数据引导到主机控制器的DMA控制器，该控制器将传入的数据转发到相应的主机存储器位置。
 
- 传输完成后，目标传送一个Register - Device to Host FIS来指示命令的结束状态，将状态寄存器中的BSY位清零，如果头中设置了中断标志，则向主机断言中断。

### B.7 ATA标签命令队列 DMA写入设备 
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出命令。
- 为了响应影子寄存器命令块寄存器被写入。
 主机适配器将影子状态寄存器中的BSY位设置为1，并向设备发送一个带有影子寄存器块内容的寄存器--主机到设备FIS。
- 当设备已经排队并希望释放总线时，它向主机传送一个寄存器FIS，导致BSY位被清零，状态寄存器中的REL位被置1。
- 当设备准备好完成排队命令的传输时，它向主机发送一个Set Device Bits FIS，导致状态寄存器中的SERV位被设置。如果没有其他命令处于活动状态（即BSY位设为1），那么也会产生一个中断。
- 作为对服务请求的响应，主机软件停用DMA控制器(如果激活)，并通过写入影子寄存器块寄存器向设备发出SERVICE命令，导致BSY位被设置为1，并向设备传送一个寄存器FIS。
- 作为对SERVICE请求的响应，设备向主机传送一个寄存器FIS，将TAG值传达给主机，并将BSY位清零，将DRQ位设置为1。
- 当DRQ位设为1时，主机软件从影子寄存器块中读取TAG值，并恢复适合正在完成的命令的DMA控制器上下文。
- 当设备准备好接收来自主机的数据时，设备向主机传送DMA激活FIS，激活武装的DMA控制器。DMA控制器以一个或多个 "数据-主机到设备 "FIS的形式向设备传输写入数据。
    如果需要一个以上的数据FIS来完成整个数据传输请求，则应在随后的每一个数据FIS之前发送一个DMA激活FIS。传输给设备的数据量由主机驱动软件在命令设置阶段编入主机DMA控制器的传输次数决定。如果DMA激活FIS在主机软件恢复DMA上下文之前到达主机，则DMA激活FIS的结果是主机软件完成编程后，DMA控制器立即开始传输（即控制器已经被激活，上下文恢复后立即开始传输）。
- 传输完成后，目标传送一个寄存器--主机到设备的FIS来表示命令的结束状态，将状态寄存器中的BSY位清零，如果中断位设为1，则向主机发出中断信号。

### B.8 带有 PIO 数据的 ATAPI 数据包命令。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PACKET命令。
- 作为对命令寄存器被写入的响应，主机适配卡在影子状态寄存器中设置BSY位为1，并向设备传送带有影子寄存器块内容的寄存器-主机到设备FIS。
 
##### 高速串行化 ATTACHMENT(高速串行化) 
序号 ATA国际组织
- 当设备准备好接收ATAPI命令包时，它向主机传送一个PIO设置--设备到主机FIS，以指示目标已准备好接收PIO数据和要传输的数据字数。
- 主机将PIO设置FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致BSY位被清零，DRQ位被置1。
- 由于影子状态寄存器中BSY位被清零，DRQ位被置1，主机驱动软件将命令包写入影子寄存器块数据寄存器。
- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送给设备。对数据寄存器的写入将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时，主控制器将PIO设置帧中指示的最终状态值传输到影子状态寄存器中，导致DRQ位被清零，BSY位被置1，并以CRC和EOFP关闭该帧。这样就完成了命令包对设备的传输。
- 当设备处理完命令，准备开始向主机传输数据时，首先向主机传输一个PIO设置-设备到主机FIS。收到PIO设置-设备到主机FIS后，主机适配器将FIS内容保存在一个临时的保持缓冲区中。

- 设备在PIO设置-设备到主机FIS之后，会有一个数据-设备到主机FIS。
    当接收到数据FIS，同时保持PIO设置FIS上下文时，主机适配器将PIO设置FIS中的寄存器内容转移到影子寄存器中，包括初始状态值，导致状态寄存器中DRQ位被置1，BSY位被清零。同时，如果中断位被置1，则会产生一个中断给主机。
- 主机控制器将属于数据FIS的传入数据接收到一个速度匹配的FIFO中，这个FIFO在概念上是附加在数据影子寄存器块寄存器上的。
- 由于发出的中断和状态寄存器中的DRQ位被置1，主机软件读取字节数，并在数据寄存器上做REP INSW，从速度匹配FIFO的头部拉出数据，同时串行链路正在向FIFO的尾部添加数据。流控制方案处理数据节流，以避免接收速度匹配FIFO的下溢/溢出，该FIFO供给数据影子寄存器块寄存器。
- 当数据FIS中接收的字数达到PIO设置FIS中指示的值，且主机FIFO为空时，主机将先前PIO设置中的结束状态值传送到影子状态寄存器中，导致DRQ位被清零，BSY位被置1。
- 设备通过发送一个寄存器FIS来传输最终的结束状态，BSY位被清零，命令的结束状态和中断位被设置为1。
- 主机检测到包含BSY位清零、命令结束状态和中断位设为1的传入寄存器帧，并将该帧内容放入影子寄存器中，以完成命令。

### B.9 带有PIO数据输出的ATAPI包命令 
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PACKET命令。
- 作为对命令寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并向设备传送一个带有影子寄存器块内容的寄存器--主机到设备FIS。
- 当设备准备好接收ATAPI命令包时，它向主机传送一个PIO设置--设备到主机FIS，以指示目标已准备好接收PIO数据和要传输的数据字数。
 
- 主机将PIO Setup - Device to Host FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致BSY位被清零，DRQ位被置1。
- 由于影子状态寄存器中BSY位被清零，DRQ位被置1，主机驱动软件将命令包写入影子寄存器块数据寄存器。
- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送给设备。对数据寄存器的写入将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时，主控制器将PIO设置帧中指示的最终状态值传输到影子状态寄存器中，导致DRQ位被清零，BSY位被置1，并以CRC和EOFP关闭该帧。这样就完成了命令包对设备的传输。
- 当设备处理完命令，准备接收PIO写数据时，向主机发送PIO Setup - Device to Host FIS，以表明目标已准备好接收PIO数据，以及要传输的数据字数。
- 响应PIO Setup FIS，D位清零，表示对设备进行写，主机将PIO Setup FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致DRQ位被置1。同时，如果中断位被置1，则会对主机产生一个中断。
- 由于DRQ位在影子状态寄存器中被置1，主机驱动软件读取字节数，并对数据寄存器启动REP OUTSW。
- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送到设备。REP OUTSW将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时。
 主机控制器将PIO设置FIS中指示的最终状态值传输到影子状态寄存器中，导致DRQ位被清零，BSY位被设置为1，并以CRC和EOFP关闭帧。
- 设备通过发送一个Register - Device to Host FIS，BSY位清零，命令的结束状态和中断位设为1，传送最后的结束状态。
- 主机检测到一个包含BSY位清零、命令结束状态和中断位设置为1的Register - Device to Host FIS，并将帧内容放入影子寄存器中，以完成命令。

### B.10 带有DMA数据的ATAPI包命令。
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PACKET命令。
- 作为对命令寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并将带有影子寄存器块内容的寄存器--主机到设备FIS传送给设备。
- 当设备准备好接收ATAPI命令包时，它向主机传送一个PIO设置--设备到主机FIS，以指示目标已准备好接收PIO数据和要传输的数据字数。
- 主机将PIO设置FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致BSY位被清零，DRQ位被置1。
 
##### 高速串行化的ATATACHMENT。
序号 ATA国际组织
- 由于影子状态寄存器中BSY位被清零，DRQ位被置1，主机驱动软件将命令包写入影子寄存器块数据寄存器。
- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送给设备。对数据寄存器的写入将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时，主控制器将PIO设置帧中指示的最终状态值传输到影子状态寄存器中，导致DRQ位被清零，BSY位被置1，并以CRC和EOFP关闭该帧。这样就完成了命令包对设备的传输。
- 当设备处理完命令并准备就绪后，就以单个数据FIS的形式向主机传输读取数据。这种传输是根据流控信号/准备状态进行的。
- 主机控制器识别到传入的数据包是一个Data FIS，DMA控制器已经编程，并将传入的数据引导到主机控制器的DMA控制器，该控制器将传入的数据转发到相应的主机存储器位置。
- 传输完成后，目标传送一个Register - Device to Host FIS来指示命令的结束状态，将状态寄存器中的BSY位清零，如果中断位设为1，则向主机发出中断信号。

### B.11 带有 DMA 数据输出的 ATAPI 数据包命令。
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。结果，DMA控制器被武装起来，但仍然暂停，等待来自设备的信号来进行数据传输。
- 主机驱动软件通过写入影子寄存器块寄存器（命令寄存器最后一个）向设备发出PACKET命令。
- 作为对命令寄存器被写入的响应，主机适配器将影子状态寄存器中的BSY位设置为1，并向设备传送一个带有影子寄存器块内容的寄存器--主机到设备FIS。
- 当设备准备好接收ATAPI命令包时，它向主机传送一个PIO设置--设备到主机FIS，以指示目标已准备好接收PIO数据和要传输的数据字数。
- 主机将PIO设置FIS中的起始状态寄存器内容传送到影子状态寄存器中，导致BSY位被清零，DRQ位被置1。
- 由于影子状态寄存器中BSY位被清零，DRQ位被置1。
 主机驱动软件将命令包写入影子寄存器块数据寄存器。
- 写入数据寄存器的数据被放置在出站速度匹配的FIFO中，并以数据-主机到设备FIS的形式传送到设备。对数据寄存器的写入将数据推到FIFO的尾部，串行链路从头部拉出数据。流控制方案处理数据节流，以避免传输FIFO的下溢。
- 当PIO设置FIS中指示的字数已经写入传输FIFO时，主控制器将PIO设置帧中指示的最终状态值传输到影子状态寄存器中，导致DRQ位被清零，BSY位被置1，并以CRC和EOFP关闭该帧。这样就完成了命令包对设备的传输。
- 当设备准备好接收主机的数据时，设备向主机发送DMA激活FIS，激活武装的DMA控制器。DMA控制器以一个或多个数据FIS的形式将写数据传送给设备。传输是在响应流控制信号/准备状态下进行的。传输到设备的数据量由主机驱动软件在命令设置阶段编程到主机的DMA引擎中的传输计数决定。
- 传输完成后，设备传送一个寄存器--设备到主机FIS来指示命令的结束状态，将状态寄存器中的BSY位清零，如果中断位设置为1，则向主机发出中断信号。

### B.12 奇数字数注意事项 
本节概述了为适应奇数16位字量的数据传输所需的特殊考虑。每种数据交易类型都有单独的考虑因素。串行ATA没有为奇数8位字节量的传输提供便利。
#### B.12.1 从目标读取奇数字数的DMA。
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。DMA传输的计数是一个奇数字（16位）数量。
- 当设备处理完相应的命令，准备向主机传输数据时，就以一个或多个数据FIS的形式进行传输。由于传输次数是奇数，所以传输给主机的最后一个32位Dword的高阶16位用零填充。在FIS结束时传输的CRC值是在整个FIS上计算的，包括最后传输的Dword中的任何垫字节。
- 主机控制器接收接收到的数据，DMA控制器将接收到的数据从接收FIFO引导到适当的主机存储器位置。DMA控制器的传输粒度为16位字（与ATA/ATAPI主机适配器标准一致）。
- 在接收到最后一个32位的接收数据Dword后，DMA控制器将前半部分(低阶16位)传输到相应的最终内存位置，此时DMA引擎的传输次数已经用完。DMA控制器丢弃最后接收Dword的高阶16位，因为它代表着在请求的DMA传输结束后收到的数据。丢弃的16个高阶位与发送方插入的16位传输垫相对应。

#### B.12.2 奇数字数的主机对目标的DMA写法 
- 在向设备发出命令之前，主机驱动软件用内存地址指针和传输方向对主机侧DMA控制器进行编程，并对DMA控制器进行布防（启用 "运行 "标志）。DMA传输的计数是一个奇数字（16位）数量。
- 当设备处理完相应的命令并准备好接收来自主机的数据时，就用DMA激活FIS发出准备就绪的信号。
- 收到DMA Activate信号后，主机将数据以一个或多个数据FIS的形式传送给设备。由于传输次数是奇数，所以DMA控制器只将FIFO中最后一个Dword的低阶16位填满，而将上面16位归零后，就完成了从主机存储器到传输FIFO的数据传输。这个填充后的最后一个Dword作为数据帧中的最后一个Dword进行传输。在FIS结束时传输的CRC值是在整个FIS上计算的，包括最后传输的Dword中的任何垫字节。
- 在意识到命令集并对当前命令进行解码后，接收传输数据的设备对预期的数据传输长度有所了解。
    从主机接收到数据后．
 设备将接收到的数据的最后32位Dword的上16位中的16位pad数据删除。
 
##### 高速 SERIALIZED ATTACHMENT(高速串行化) 
序号 ATA国际组织
### B.13 从设备读取PIO数据.....................................................................................。

- 为了响应解码和处理具有奇数16位字传输次数的PIO读取命令，设备以单个数据FIS的形式向主机传输相应的数据。器件对最后传输的FIS的最后32位D字的上16位进行填充，以便关闭FIS。在FIS结束时传输的CRC值是根据整个FIS计算的，包括最后传输的Dword中的任何垫字节。
- 负责检索PIO数据的主机驱动软件知道它期望从影子命令块寄存器数据寄存器中检索到的数据字数，并对奇数的重复次数执行REP INSW操作。
- 当主机驱动软件用完REP INSW操作后，与数据寄存器接口的接收FIFO中剩余一个16位的接收数据字，该字对应于设备在传输帧结束时包含的焊盘。数据寄存器FIFO中剩余的这个数据字，在下一次写入影子命令块寄存器命令寄存器时，或者在收到设备的下一个数据FIS时，会被刷新。

### B.14 PIO数据写到设备上 
- 响应于解码和处理具有16位奇数字量的传输计数的PIO写命令，设备向主机传送一个PIO设置FIS，表示它已准备好接收PIO数据并指示传输计数。传递的传输计数是针对奇数的16位字量。
- 负责传输PIO数据的主机驱动软件知道需要向影子命令块寄存器数据寄存器写入的数据字数，并执行重复次数为奇数的REP OUTSW操作。
- 在软件驱动程序对影子命令块寄存器数据寄存器进行最后一次写入后，PIO设置包中指示的传输计数用尽，这就给主控制器发出关闭FIS的信号。由于传输计数是奇数，所以要传输的最后一个32位数据Dword的上16位仍然为零（pad），主机控制器在传输完这最后一个有垫的Dword后关闭FIS。FIS结束时传输的CRC值是在整个FIS上计算的，包括最后传输的Dword中的任何垫字节。
- 在意识到命令集并对当前命令进行解码后，接收传输数据的设备对预期的数据传输长度有所了解。
    从主机接收数据后，设备将接收数据的最后32位Dword的上16位中的16位pad数据删除。

### B.15 原生命令队列示例（信息量大 
下面是两个典型的Native的宏操作及其顺序的概述。
命令队列场景。这些说明性序列假定主机控制器DMA实现与当前主流桌面实现相当（因此引用了
PRD 表和其他数据结构通常为此类实现所引用），这些说明性序列并不打算排除其他可能的主机控制器实现。

#### B.15.1 排队命令与非顺序完成.............................................。

主机动作 DEVICE动作
主机通过在SActive寄存器中预置位0，向其写入值000001h(...000001b)，发出Read Command Tag=0，并向设备发送一个寄存器FIS。
设备通过向主机发送一个寄存器FIS将BSY位清零。
主机发出Read Command Tag=5(如果BSY位还未清零，主机需要等待)，将SActive寄存器中的位5写入000020h (...00100000b)，并向设备发送一个寄存器FIS。结果SActive寄存器的值为21h。
器件将BSY位清零。
器件发送DMA设置FIS，DMA
缓冲区ID=5（在本例中，第二个发出的命令先被服务）。
主机将PRD指针加载到对应缓冲区5的DMA引擎中。
设备为对应TAG=5的命令发送数据。
主机DMA引擎将输入的数据引导到缓冲区5中。
设备发送Set Device Bits FIS，中断位设置为1，并且在中断位设置为1的情况下，设备发送Set Device Bits FIS。
SActive值为000020h(...00100000b)，表示TAG=5结束。
主机收到Set Device Bits FIS，SActive字段值为20h，中断位设为1。导致SActive寄存器中的第5位被清空，产生SActive影子寄存器中的01h值，中断被触发。
器件发送DMA设置FIS，DMA
缓冲区ID=0

主机将PRD指针加载到对应于缓冲区0的DMA引擎中。
主机软件处理接收到的中断。读取
SActive影子寄存器，并确定第5位被去掉，并以TAG=5的方式退出命令。
设备为对应TAG=0的命令发送数据。
主机DMA引擎将输入的数据引导到缓冲区0中。
设备发送Set Device Bits FIS，中断位设为1，且有
SActive值为000001h(...000001b)，表示TAG=0已经结束。

##### 高速 SERIALIZED ATTACHMENT(附件) 
序号 ATA国际组织
宿主行为 DEVICE行为
主机收到设置设备位FIS，SActive字段值为01h，中断位设置为1。导致SActive寄存器中的0位被清除，从而在SActive影子寄存器中产生00h值，并触发中断。
设备空闲
主机软件处理收到的中断。读取
SActive影子寄存器，并确定位0去掉assert化，以TAG=0的方式退出命令。 主机空闲。
#### B.15.2 中断聚合。
宿主行为 DEVICE行为
主机通过在SActive寄存器中预置位0，向其写入值000001h(...000001b)，发出Read Command Tag=0，并向设备发送一个寄存器FIS。
设备通过向主机发送一个寄存器FIS将BSY位清零。
主机发出Read Command Tag=5(如果BSY位还没有清零，主机需要等待)，通过在SActive寄存器中预置位5，写入00000020h (...00100000b)，并向设备发送一个寄存器FIS。结果SActive寄存器的值为21h。
器件将BSY位清零。
设备发送DMA设置FIS，DMA设置FIS，DMA设置FIS。
缓冲区ID=5（在本例中，第二个发出的命令先被服务）。
主机将PRD指针加载到对应缓冲区5的DMA引擎中。
设备为对应TAG=5的命令发送数据。
主机DMA引擎将输入的数据引导到缓冲区5中。
设备发送Set Device Bits FIS，中断位设置为1，并且在中断位设置为1的情况下，设备发送Set Device Bits FIS。
SActive值为000020h(...00100000b)，表示TAG=5结束。
主机收到Set Device Bits FIS，SActive字段值为20h，中断位设为1。导致SActive寄存器中的第5位被清空，产生SActive影子寄存器中的01h值，中断被触发。
器件发送DMA设置FIS，DMA
缓冲区ID=0 
宿主行为 DEVICE行为
主机将PRD指针加载到对应于缓冲区0的DMA引擎中。
设备为对应TAG=0的命令发送数据。
主机DMA引擎将输入的数据引导到缓冲区0中。
主机很忙，对接收到的中断响应和清除速度很慢。本例中主机中断响应时间相对于设备完成速度较慢。
设备发送Set Device Bits FIS，中断位设为1，并且在?
SActive值为000001h(...000001b)，表示TAG=0已结束。
主机收到Set Device Bits FIS，SActive字段值为01h，中断位设为1。结果SActive寄存器中的0位被清除，产生SActive影子寄存器中的00h值，中断被触发。如果主机在TAG=5完成后还没有重置待定中断，则不会触发新的中断。如果之前的中断已经被重置，那么新的中断就会被触发，这就是前面的例子。
B.15.1
主机有一个较长的延迟，但现在正在处理该中断，并已重置了中断等待标志。主机现在正在进行命令完成处理。由于第一个中断没有很快被复位，设备发出的第二个中断被聚合了。
主机读取SActive影子寄存器，发现
TAG=0和TAG=1命令均已完成（均未设置其SActive位）。主机处理命令完成后，将这两条命令退场。
设备空闲 
##### 在附件处进行高速小型化。
序号 ATA国际组织
## 附录C. 设备对nIEN的模拟与中断等待(信息) .......................。

本规范将寄存器Device to Host FIS中的中断位定义为设备的中断待定状态，它不被接收到的Host to Host中的nIEN位的状态所修改。
设备FIS。在本规范中，设备忽略接收到的主机到设备FIS中的nIEN位，并始终按nIEN位清零的方式执行。请参阅10.3.4和10.3.5节。
有些设备实现了以前的串行ATA规范修订版，使用了本规范的nIEN位。
寄存器主机到设备的FIS，作为将中断位设置为寄存器之一的前提条件。
设备到主机和设置设备位FISs。使用nIEN位使能中断位的目的是为了模拟ATA并行实现的操作。在并行实现中，当nIEN位清零时，devicer对主机的INTRQ线是启用的。当nIEN位设置为1时，设备器将INTRQ线置于高阻抗状态。
 该功能通常用于支持设备0和设备1操作的设备中（见13.1.3节），重叠操作也需要该功能。
在本规范中，设备0/设备1仿真的实现完全由主机来完成（见13.1.3节）。
nIEN的设备仿真有一个严重的副作用，就是有可能丢失中断。在并行实现中，主机可能会禁用中断，在重新启用中断后（通过将nIEN清零）看到INTRQ线再次被断言。如果串行设备根据nIEN位的状态进行I位掩码，则可以接收到寄存器设备到主机的FIS，并以
中断位清零（因为它被nIEN位掩盖了）。但此时设备可能有一个待处理的中断。当主机在nIEN位清零的情况下写入设备控制寄存器时，不会像并行情况下那样，看到INTRQ的断言反映出待发中断。设备没有办法将中断位设置为1的条件 "重新发送给 "主机。在这种情况下，主机必须采用轮询操作来恢复操作。
系统设计者应注意以下几点。1)中断位是串行ATA设备的中断挂起标志。
2)中断位的行为可能会被实现到以前版本的Serial ATA规范的设备中的nIEN位的状态所修改。这些设备可能会根据nIEN位的当前状态来改变中断位的行为，因为nIEN位的最后一次写入是由一个独立的设备来完成的。
寄存器主机到设备FIS，C位清零或C位设为1。当C位被设置为1时，有些设备不遵守nIEN位。当C位设置为1时，不观察nIEN位的设备与只在SRST位改变状态时传输控制寄存器FIS的主机有兼容性问题。
3）当nIEN位改变时，设备没有定义的行为，nIEN对中断位行为的修改是针对厂商的。
4) 主机应该在所有寄存器Host to Device FIS中把nIEN位清零。这样做的结果是，与那些使用nIEN位作为设置中断挂起标志的前提条件的设备具有最高的兼容性。
5）如果器件支持nIEN仿真，且主机将nIEN位设置为1，则主机驱动应适应nIEN位清零后，器件有待定中断时，无中断产生的情况。

## 附录 D. I/O 控制器模块（资料性） I/O控制器模块（资料性）..................................................................

此可选功能的目的是指定IO连接器（如下图所示，轮廓较重），为I/O控制器和串行ATA磁盘背板之间的电源、数据和外壳服务提供互连。本规范定义了以下设备之间的互操作性
来自一个制造商的I/O模块可以与不同制造商的背板一起工作。
这种互操作性包括电气、机械和外壳管理连接。
符合要求的I/O控制器和串行ATA背板应遵守指定的连接器位置和连接器引脚布局。
I/O模块 I/O模块
IO连接器
存储
附文
处理器
EEPROM
I/O模块到I/O模块通信
I2C环境服务通信
SATA硬盘+活动LED和端口选择器控制信号
磁盘驱动器
模块
SATA硬盘+活动LED+端口选择器
磁盘驱动器
模块
SATA硬盘+活动LED+端口选择器
IO连接器
磁盘驱动器
模块
SATA硬盘+活动LED+端口选择器
磁盘驱动器
模块
SATA硬盘+活动LED+端口选择器
## 图258--概念摘要互连结构。
I/O连接器，如图258中的重号轮廓所示，是被指定的核心项目。虚线格式的I/O模块代表辅助和可选的I/O模块。
阴影区域代表背板。磁盘驱动器模块被设想成一个标准的
串行ATA硬盘在一个载体内，包括。
- 模块与背板之间的电源连接
- 模块和背板之间的数据连接
- 硬盘活动LED（见6.7.1节），可选。
- 端口选择器，带二次连接到背板，可选。 
##### 在附件处进行高速小型化。
序号 ATA国际组织
### D.1 支持的配置 
连接器规范支持两个配置目标。1. 单I/O控制器系统 2. 具有冗余功能的双I/O控制器系统（可选）。
每个实现都有通过使用可用信号支持的强制和可选功能。
#### D.1.1 单一I/O控制器信号 
- 串行ATA接口
- I/O控制器到外壳处理器（SEP）的通信
- 磁盘活动LED信号。
- I/O控制器电源和地线
- I/O控制器识别和控制(RESET) 
##### FRU_ID_SCL 
##### FRU_ID_SDA 
##### ENC_PROC_SCL 
##### ENC_PROC_SDA 
##### ACT_LED_DR(15:0)_L。

IO_SATA_Tx(15:0)+/-。
IO_SATA_Rx(15:0)+/-。
BOX_ID_BIT(2:0)
IO_SLOT_0_L = 低电平 (Gnd)
ACT_LED_HOST_L
单一I/O
控制器
磁盘驱动器(1...16)，带MUX和活动LED。
活动LED（可选
SATA Rx+/-
SATA Tx+/-
ES处理器
EEPROM
##### BOX_ID_BIT(2:0) 
##### FRU_ID_SCL 
##### FRU_ID_SDA 
##### ENC_PROC_SCL 
##### ENC_PROC_SDA 
##### ENC_PROC_SCL 
##### ENC_PROC_SDA 
## 图259 - 一个I/O控制器的信号连接示例.....................................。
 
#### D.1.2 双I/O控制器信号 
至于单I/O控制器和另外。
- 多路复用器控制，为I/O控制器故障切换提供双通道功能
- I/O控制器与I/O控制器之间的通信 
#### D.1.3 其他可选功能......................................................................................

- 支持RAID电池备份
- 额外的低速和高速通信，用于可选的板对板通信。由于本规范并不打算定义不同制造商的板对板，信号和协议的实际实现由I/O控制器制造商决定。
 
##### 高速串行化的接口。
序号 ATA国际组织
BATT_CHARGE
BATT_DISCHARGE
BATT_TEMP
BATT_RETURN
THIS_IO_OK_L
其他_IO_OK_L
此_IO_RESET_L
其他_IO_RESET_L
HS_CHAN_Tx(1:0)+/-。
HS_CHAN_Rx(1:0)+/-。
此_IO_PRESENT_L
其他_IO_PRESENT_L
LOW_FREQ_Tx_(1:0)
LOW_FREQ_Rx_(1:0)
低频_Tx_(1:0)
IMIO_1
IMIO_2
IMIO_3
FRU_ID_SCL
FRU_ID_SDA
ENC_PROC_SCL
ENC_PROC_SDA
ACT_LED_DR(15:0)_L。
MUX_DR(15:0)_L。
IO_SATA_Tx(15:0)+/-。
IO_SATA_Rx(15:0)+/-。
BOX_ID_BIT(2:0)_L。
IO_SLOT_0_L = 低电平 (Gnd)
ACT_LED_HOST_L
0号槽的I/O 1号槽的I/O
磁盘驱动器(1...16)，带MUX和活动LED。
MUX控制
活动LED
SATA Rx+/-
SATA Tx+/-
ES处理器
EEPROM
BOX_ID_BIT(2:0)
FRU_ID_SCL
FRU_ID_SDA
ENC_PROC_SCL
ENC_PROC_SDA
ENC_PROC_SCL
ENC_PROC_SDA
BATT_CHARGE
BATT_DISCHARGE
BATT_TEMP
BATT_RETURN
THIS_IO_OK_L
其他_IO_OK_L
此_IO_RESET_L
其他_IO_RESET_L
HS_CHAN_Tx(1:0)+/-。
HS_CHAN_Rx(1:0)+/-。
此_IO_PRESENT_L
其他_IO_PRESENT_L
LOW_FREQ_Tx_(1:0)
LOW_FREQ_Rx_(1:0)
低频_Tx_(1:0)
IMIO_1
IMIO_2
IMIO_3
FRU_ID_SCL
FRU_ID_SDA
ENC_PROC_SCL
ENC_PROC_SDA
ACT_LED_DR(15:0)_L。
MUX_DR(15:0)_L。
IO_SATA_Tx(15:0)+/-。
IO_SATA_Rx(15:0)+/-。
BOX_ID_BIT(2:0)_L。
IO_SLOT_0_L = HIGH
ACT_LED_HOST_L
## 图260--两个I/O模块的信号连接示例。
### D.2 可选高速通道配置 
可选的高速通信通道可用于两个I/O控制器之间的高速差分通信，或用于I/O控制器与主机之间的通信，如纳入光纤通道回路。建议这些信号应该是100欧姆的差分特性阻抗。
实际使用情况由用户定义，但规范的背板路由应该是其中之一。
配置0：两个通道都连接I/O控制器和I/O控制器。
配置1：一个通道连接两个I/O控制器，另一个是路由器到主机连接器。

HS_CHAN_Tx0+/-。
SLOT 0 背板 SLOT 1
HS_CHAN_Rx0+/-。
HS_CHAN_Tx1+/-。
HS_CHAN_Rx1+/-。
HS_CHAN_Tx0+/-。
HS_CHAN_Rx0+/-。
HS_CHAN_Tx1+/-。
HS_CHAN_Rx1+/-。
## 图261 - 高速通道 - 配置0................................................................

SLOT 0 背板 SLOT 1
主机连接器
Rx Tx
HS_CHAN_Tx0+/-。
HS_CHAN_Rx0+/-。
HS_CHAN_Tx1+/-。
HS_CHAN_Rx1+/-。
HS_CHAN_Tx0+/-。
HS_CHAN_Rx0+/-。
HS_CHAN_Tx1+/-。
HS_CHAN_Rx1+/-。
主机连接器
Rx Tx
## 图262 - 高速通道 - 配置。 
##### 在附件处进行高速小型化。
序号 ATA国际组织
### D.3 可选低速通道配置 
可选的低速通信通道可用于端到端I/O控制器到I/O的通信。
I/O控制器通信。有一对发送和接收信号，用于低频(<500 kHz)I/O控制器到I/O控制器的通信。
LOW_FREQ_Tx_0。
LOW _FREQ_Rx_0.
SLOT 0 背板 SLOT 1
低_FREQ_Tx_1。
低_FREQ_Rx_1
LOW _FREQ_Tx_0.
LOW _FREQ_Rx_0.
低_FREQ_Tx_1。
低_FREQ_Rx_1
## 图263 - 低速通道 
有4个端到端信号可用于模块间I/O通信。
IMIO_0
IMIO_1
IMIO_2
IMIO_3
SLOT 0 背板 SLOT 1
IMIO_0
IMIO_1
IMIO_2
IMIO_3
## 图264 - 互联通道  
### D.4 I/O控制器模块连接器 
在背板上使用的接口连接器是基于Berg-FCI高速接口的。
Metral 5x6 30针公头连接器，零件号59566-1001或同等产品。ITT Cannon公司的等效部件：背板上的5排4000公头CBC20HS4000-030WXP5-5yy-x-VR；I/O控制器上的5排4000标准母头CBC20HS4000-030FDP5-500-x-VR。
#### D.4.1 I/O控制器模块连接器 
I/O控制器上使用的接口连接器是基于Berg-FCI高集成度接口的。
Speed Metal 5x6 30针直角母插座，零件号52057-102。该连接器用于6个高速连接器。

## 图265 - I/O控制器模块连接器渲染..........................................................。
 
##### 在附件处进行高速小型化处理。
序号 ATA国际组织
## 图266 - 连接器引脚布局和引脚长度..................................................................。
 
## 图267 - I/O控制器模块连接器插座工程图......................

## 图268 - 连接器侧视图..........................................................................................
 
##### 高速 SERIALIZED ATTACHMENT (附件) 
序号 ATA国际组织
### D.5 I/O控制器模块连接器位置 
#### D.5.1 目的................................................................................................................

本节定义了来自一个制造商的I/O模块和来自不同制造商的背板之间的匹配连接器位置和连接器排列。这是Serial ATA规范的一个可选功能；但是，支持该行业正常Serial ATA I/O控制器到背板接口定义的I/O控制器和Serial ATA背板应遵守此指定的连接器位置和连接器引脚。
图269和图270中所示的I/O模块的宽度和长度尺寸是作为例子提出的，而不是强制性要求。

## 图269 - 1xWide I/O模块上的I/O控制器模块连接器位置  
##### 在附件处进行高速小型化。
序号 ATA国际组织
## 图270 - 2xWide I/O模块上的I/O控制器模块连接器位置。 
### D.6 引脚清单 
这些表格显示了Metral 4000连接器系统的引脚列表。请注意，每个连接器行和信号之间都有接地屏蔽层，为了便于理解，本矩阵中没有显示。
表 106 - J1、J2、J3 引脚分配表
J1 行 E 行 D 行 C 行 B 行 A 地 1 IO_SATA_RX0+ IO_SATA_RX0- 地 IO_SATA_TX0+ IO_SATA_TX0- 。屏蔽2 ACT_LED_DR0_L MUX_DR0_L 5 V 5 V IO_SLOT_0_L 屏蔽3 IO_SATA_RX1+ IO_SATA_RX1- 地线 IO_SATA_TX1+ IO_SATA_TX1- 。屏蔽 4 ACT_LED_DR1_L MUX_DR1_L 5 V 5 V OTHER_IO_PRESENT_L 屏蔽 5 IO_SATA_RX2+ IO_SATA_RX2-接地 IO_SATA_TX2+ IO_SATA_TX2-屏蔽 6 ACT_LED_DR2_L MUX_DR2_L 5 V PRECHARGE ENC_PROC_SDA ENC_PROC_SCL屏蔽
J2 行 E 行 D 行 C 行 B 行 A 地 1 IO_SATA_RX3+ IO_SATA_RX3- 地 IO_SATA_TX3+ IO_SATA_TX3- 。屏蔽2 ACT_LED_DR3_L MUX_DR3_L 5 V 5 V BOX_ID_BIT_0 屏蔽3 IO_SATA_RX4+ IO_SATA_RX4- 接地 IO_SATA_TX4+ IO_SATA_TX4- 屏蔽 4 ACT_LED_DR4_L MUX_DR4_L 5 V 5 V BOX_ID_BIT_1 屏蔽 5 IO_SATA_RX5+ IO_SATA_RX5- 接地 IO_SATA_TX5+ IO_SATA_TX5- 屏蔽 6 ACT_LED_DR5_L MUX_DR5_L 5 V PRECHARGE FRU_ID_SDA FRU_ID_SCL 屏蔽
J3 行 E 行 D 行 C 行 B 行 A 地 1 IO_SATA_RX6+ IO_SATA_RX6- 地 IO_SATA_TX6+ IO_SATA_TX6- 屏蔽2 ACT_LED_DR6_L MUX_DR6_L 5 V 5 V BATT_CHARGE 屏蔽3 IO_SATA_RX7+ IO_SATA_RX7- 接地 IO_SATA_TX7+ IO_SATA_TX7- 。屏蔽 4 ACT_LED_DR7_L MUX_DR7_L 5 V THIS_IO_PRESENT_L BATT_DISCHARGE 屏蔽 5 IO_SATA_RX8+ IO_SATA_RX8- 接地 IO_SATA_TX8+ IO_SATA_TX8- 屏蔽 6 ACT_LED_DR8_L MUX_DR8_L 12 V PRECHARGE 12 V 12 V 屏蔽 6 ACT_LED_DR8_L MUX_DR8_L 12 V PRECHARGE 12 V 12 V.
表107 - J4、J5、J6引脚分配表
J4 行 E 行 D 行 C 行 B 行 A 行 接地 1 IO_SATA_RX9+ IO_SATA_RX9- 接地 IO_SATA_TX9+ IO_SATA_TX9- 屏蔽 2 ACT_LED_DR9_L MUX_DR9_L 5 V 12 V BATT_RETURN 屏蔽 3 IO_SATA_RX10+ IO_SATA_RX10- 4 ACT_LED_DR10_L MUX_DR10_L 5 V THIS_IO_OK_L BATT_TEMP Shield 5 IO_SATA_RX11+ IO_SATA_RX11- Ground IO_SATA_TX11+ IO_SATA_TX11- Shield 6 ACT_LED_DR11_L MUX_DR11_L Reserved (3_3 V)
(PRECHARGE)
保留 (3_3 V) BOX_ID_BIT_2 屏蔽器
J5 行 E 行 D 行 C 行 B 行 A 行 接地 1 IO_SATA_RX12+ IO_SATA_RX12- 接地 IO_SATA_TX12+ IO_SATA_TX12- 屏蔽 2 ACT_LED_DR12_L MUX_DR12_L 5 V LOW_FREQ_RX_2 LOW_FREQ_TX_2 屏蔽 3 IO_SATA_RX13+ IO_SATA_RX13- 接地 IO_SATA_TX13+ IO_SATA_TX13- 屏蔽 4 ACT_LED_DR13_L MUX_DR13_L 5 V ACT_LED_HOST0 ACT_LED_HOST1 屏蔽。
##### 在附件处进行高速小型化。
串行ATA国际组织 5 IO_SATA_RX14+ IO_SATA_RX14- 地 IO_SATA_TX14+ IO_SATA_TX14- 屏蔽 6 ACT_LED_DR14_L MUX_DR14_L 保留 (3_3 V)
(PRECHARGE)
保留 保留 屏蔽
J6 行 E 行 D 行 C 行 B 行 A 地 1 IO_SATA_RX15+ IO_SATA_RX15- 地 IO_SATA_TX15+ IO_SATA_TX15- 。屏蔽 2 ACT_LED_DR15_L MUX_DR15_L 5 V 5 V OTHER_IO_RESET_L 屏蔽 3 HS_CHAN_TX(0)+ HS_CHAN_TX(0)- 地 HS_CHAN_RX(0)+ HS_CHAN_RX(0)- 。屏蔽 4 LOW_FREQ_RX_1 LOW_FREQ_TX_1 5 V IMIO_0 IMIO_1 屏蔽 5 HS_CHAN_TX(1)+ HS_CHAN_TX(1)- 地 HS_CHAN_RX(1)+ HS_CHAN_RX(1)- 屏蔽 6 OTHER_IO_OK_L THIS_IO_RESET_L5 V PRECHARGE IMIO_2 IMIO_3屏蔽
注意事项 1 从背板的第1面看连接器。(即磁盘侧) 2 黑色的长针 - 长度 7.25 mm 3 灰色的中针 - 长度 6.50 mm 4 所有其他短针 - 长度 5.75 mm。
### D.7 信号描述 
##### ACT_LED_DR(15:0)_L。

信号用于驱动与每个磁盘驱动器相关联的活动LED。这是一个活动的低信号，即当信号为低时，LED灯亮。LED被拉到+5 Vdc。LED控制电路应能在0.4 V稳态下下沉15 mA。
该信号应由开漏输出驱动，以防止两个I/O模块无意中试图同时驱动该信号时造成损坏。在RESET期间，I/O控制器输出应设置为高阻抗状态。
活动LED信号的数量应与控制器支持的SATA端口数量相匹配。不一定要支持16个端口，此配置可支持1至16个SATA端口之间的任何数量。
MUX_DR(15:0)_L
信号用于控制通过前端多路复用器到磁盘驱动器（如果已实现）的串行ATA路径。当该信号为低电平时，多路复用器选择连接到GND的IO_Slot_0标识的选项槽0中的I/O控制器的串行ATA路径。这是一个标准的3.3
VTTL电平信号。该信号应该由一个开漏输出驱动，以防止两个I/O模块无意中同时试图驱动该信号而造成损坏。
串行ATA是一种点对点、控制器到磁盘驱动器的单启动器接口。目前的Serial ATA设备不支持双Serial ATA端口，因此，不存在实现以下功能的本机能力。
I/O控制器故障切换（主动-主动或主动-被动）。另一种方法是提供双
I/O控制器对同一磁盘驱动器的访问是实现前端多路复用器之间的。
I/O控制器和磁盘驱动器。该多路复用器只允许一个I/O控制器拥有对磁盘驱动器的完整访问权，并实现主动-被动故障切换。

该信号不得在单I/O控制器机柜中实现，因为所有的Serial ATA信号应直接连接到单槽。I/O控制器需要确保在没有这些信号存在的情况下，能够在单I/O控制器配置中运行。
I/O控制器上的MUX_DRx_L控制应能使用I/O控制器RESET信号复位到OPEN或高阻抗状态。这是为了在I/O控制器发生故障时，允许故障切换I/O控制器对MUX_DRx_L控件具有直接RESET能力。
活动MUX_DR信号的数量应与控制器支持的SATA端口数量相匹配。并非必须支持16个端口，本规范可支持1至16个SATA端口之间的任何数量。
I/O_SATA_Tx(15:0)±。
差分的SATA信号对，从I/O控制器(Tx)开始，由SATA磁盘驱动器(Rx)接收。并非必须支持16个端口，本规格可支持1至16个SATA端口之间的任何数量。
这些信号应该是100欧姆的差分特性阻抗，符合表29中记载的标称差分阻抗。
IO_SATA_Rx(15:0) ± ±
差分的SATA信号对，从SATA磁盘驱动器(Tx)出发，由I/O控制器(Rx)接收。并非必须支持16个端口，本规格可支持1至16个SATA端口之间的任何数量。
这些信号应是100欧姆的差分特性阻抗。根据表29中记载的标称差分阻抗。
IO_Slot_0_L
识别I/O控制器位置的活动低电平信号，0或1。对于IO插槽0，该信号应在背板上拉低(GND)，对于IO插槽1，该信号应拉高(通过10 kOhms电阻拉高3.3 Vdc)。
在单I/O控制器外壳中，该信号应连接到GND。在双控制器配置中，I/O控制器应检测该线路，以确定其位于哪个插槽。
接地
I/O模块的信号和电源地。
5 V PRECHARGE +5 Vdc 电源，可在扩展引脚上使用。这用于对I/O模块进行预充电。
外壳应规定每个5 V预充电引脚的峰值电流限制为4.5 A (R=1.1欧姆)。
欧姆）。)
5 V +5 Vdc电源，可在标准长度引脚上使用。

##### 高速 SERIALIZED ATTACHMENT (高速 SERIALIZED ATTACHMENT) 
序号 ATA国际组织
外壳应能为每个I/O模块提供10 A的5 V电流。
3V3 PRECHARGE +3.3 Vdc电源，可在扩展引脚上使用。这用于对I/O控制器3.3 V电路进行预充电。外壳应规定每个3.3 V预充电引脚的电流限制为0.75 A (R=4.4 Ohms)。
3V3 +3.3 Vdc电源，可在标准长度引脚上使用。
外壳应能为每个I/O模块提供0.75 A的3.3 V电流。
12 V PRECHARGE +12 Vdc 电源，可在扩展引脚上使用。用于对I/O选件插槽模块中的12 V电路进行预充电。
机箱应能在每个12 V预充电引脚上提供2.4 A的峰值（R=5）。
欧姆）。)
12 V +12 Vdc电源，可在标准长度引脚上使用。

机箱应能为每个I/O模块提供1.0 A的电流。
FRU_ID_SCL
FRU识别二线制、串行总线的时钟信号。背板在此信号上有一个1.1千欧姆的电阻拉到3.3V。该总线上的器件应具有集电极开路输出。这条2线串行总线由机柜处理器用来收集位于机柜内的所有FRU的信息。
FRU_ID_SDA
FRU识别二线制、串行总线的数据信号。背板在此信号上有一个1.1千欧姆的电阻拉到3.3V。该总线上的器件应具有集电极开路输出。这条2线串行总线由机柜处理器用来收集位于机柜内的所有FRU的信息。
ENC_PROC_SCL
SES处理器2线制、串行总线的时钟信号。SES处理器在此信号上有一个1.1 kOhms的电阻拉到3.3 V。该总线上的器件应具有集电极开路输出。这条2线串行总线由I/O控制器用来与外壳处理器对话。
ENC_PROC_SDA
SES处理器2线制、串行总线的数据信号。SES处理器在此信号上有一个1.1 kOhms的电阻拉到3.3 V。该总线上的器件应具有集电极开路输出。这条2线串行总线由I/O控制器用来与外壳处理器对话。
HS_CHAN_Tx(1:0) 
差分传输对，可将I/O控制器连接到其他I/O控制器或一个I/O处理器上。
I/O连接器的接收对。这些信号的详细用途在图261和
图262。建议这些信号的特性阻抗为100欧姆差分。
HS_CHAN_Rx(1:0)
差分接收对，可将I/O控制器连接到另一个I/O控制器或一个I/O控制器。
I/O连接器发送对。这些信号的详细使用情况见图261和。
图262。建议这些信号为100欧姆差分特性阻抗。
ACT_LED_HOST_L
来自I/O控制器的主机链接活动LED控制信号，用于前面板安装的LED。每个端口应具有一个单独的LED，用于指示哪个控制器端口处于活动状态。确切的功能可由供应商定义。
BATT_CHARGE
信号用于为电池后备单元（BBU）充电。背板应支持该线路上的最大电流为2 A。
BATT_DISCHARGE
信号是用来放电的BBU。背板在此线路上最大支持2 A。
BATT_TEMP
信号用于报告模拟电压水平，该电压水平对应于一个温度水平。
BBU。背板在此轨迹上支持最大100 mA的电流。
BATT_RETURN
信号被用作BBU的返回（地）路径。背板在该路径上最大支持2个A。
此信号用于BBU的返回（地）路径。
主动低电平信号用于确定I/O选件槽模块是否在规格内执行。该信号由I/O控制器驱动。当I/O选项槽模块处于非活动状态时，I/O选项槽模块应为该线路提供一个上拉。背板应支持该跟踪的最大电流为100 mA。
其他_IO_OK_L
主动低电平信号用于确定双控制器配置中的另一个 I/O 选项槽模块是否在规格内执行。该信号是对I/O控制器的输入。背板应支持该跟踪的最大电流为100 mA。
其他_IO_RESET_L
主动低电平输出信号，用于复位双控制器系统中位于对面插槽的另一个I/O选件插槽模块。背板应提供该线路的上拉功能。
##### 在附件处进行高速小型化。
串行ATA国际组织不活动时。该信号与双控制器背板上的THIS_IO_RESET_L信号交叉布线。背板应支持该迹线上最大100 mA的电流。
该信号与双控制器背板上的THIS_IO_RESET_L信号交叉布线。
有源低电平输入信号，用于复位位于该槽的I/O选项槽模块。该信号与双控制器背板上的OTHER_IO_RESET_L信号交叉布线。背板应支持该迹线上最大100 mA的电流。
LOW_FREQ_RX_(1:0)
用于模块间2线通信的信号线。该信号与双控制器背板上的信号线交叉连接。
双控制器背板上的LOW_FREQ_TX信号，如图263所示。这是一条低速信号线。最大频率为500 kHz。该信号的实际实现由I/O控制器厂商决定。背板应支持该迹线上最大100 mA的电流。
LOW_FREQ_TX_(1:0)
用于模块间2线通信的信号线。该信号与模块间的信号线交叉连接。
双控制器背板上的LOW_FREQ_RX信号，如图263所示。这是一条低速信号线。最大频率为500 kHz。该信号的实际实现由I/O控制器厂商决定。背板在此跟踪上应支持最大100 mA的电流。
其他_IO_PRESENT_L
主动低电平信号用于表示对面I/O选项槽模块中存在选项槽模块。
 I/O控制器应在该线路不活动时为其提供一个上拉信号。该信号仅在双背板上与THIS_IO_PRESENT_L信号交叉布线。这是一条低速信号线。该信号的实际实现由I/O控制器厂商决定。背板在此跟踪上应支持最大100 mA。
这个信号的实际实现是由I/O控制器厂商决定的。
主动低电平信号用于表示本地I/O选件槽模块中存在一个选件槽模块。I/O控制器应在该线路不活动时为其提供一个上拉信号。该信号仅在双背板上与OTHER_IO_PRESENT_L信号交叉布线。此信号为低速信号线。该信号的实际实现由I/O控制器厂商决定。背板在此跟踪上应支持最大100 mA的电流。
IMIO_(3:0)
这些是用于模块间通信的直接连接信号。背板在这些迹线上应支持最大100mA的电流。详情请参见图264。
BOX_ID_BIT_(2:0)
信号用于确定安装在其中的外壳的ID。
保留(2引脚)
两个未定义的引脚J5行A引脚6，和J5行B引脚6，这两个引脚目前还不能使用。无论是背板还是I/O选件上的这些信号，都不应该连接任何信号。
槽模块。

## 附录E. 不含SSC的抖动公式(信息性)............................................................

### E.1 时钟到数据 
考虑时钟边缘发生的时间。一个完美的时钟的边沿出现在
#### 给定周期T的倍数。给每个时钟边沿关联一个整数索引。理想时钟边沿的时间用以下方法表示
#### ti iTC()= 
数据转换总是发生在时钟边沿上。理想的数据转换与时钟边沿发生的时间相同。在实际系统中，数据转换不是在理想的时间发生的。数据转换与理想的时间误差称为 "时钟到边缘抖动"。用_ti iTDi_()=+'表示，其中'_i_是与理想时间的偏差，即时钟到边沿的抖动。随着时间的推移，这些扰动受到1 0的制约。
#### lim 0 
N i
#### N i N a' ) = = 
参考时钟
数据转换
#### ' 0 ' 1 ' 2 ' 3 ' 4 ' 5 
## 图271 - 抖动偏差......................................................................................................。

### E.2 数据到数据(因历史原因显示) 
数据转换之间的时间差如图272所示，由_tj ti jiTDD_()a()=(a)+''_ji_ a给出  
##### 在附件处进行高速小型化。
序号 ATA国际组织
#### tD() j - tD() i 
参考时钟
数据转换
#### ' 0 ' 1 ' 2 ' 3 ' 4 ' 5 
## 图272 - 边缘对边缘计时..............................................................................................

规格应与测量的时间保持不变，因此引入一个新的量。
#### kji =()a为位间的间隔。数据转换之间的时间差为_tik ti kTDD_ ()()+ a =+'' _ji_ a。
为这个时间差的极限定义一个新的量--这是Gen1i和Gen1i的抖动定义。
#### Gen1m。最大和最小值是在所有的比特位置i上取的，这使得抖动是一个 
#### 函数的只有位间距k。
 _tkJDDiDDi_ () max (=+[ _tik ti_ )a ()],,amin ([ _tik ti_ + )a ()]。 _tkJikiiikii_（）max=+[ _kT_ '+ a ]，amin[ _kT_ +''+ a ]。
#### 请注意，kT是每一个k的常数，并且在最大和最小项中都存在。

由于取了差值，各项抵消，得到_tkJikiiikii_（）max=[''+aa a]，min[''+]。
#### 这种抖动定义的一个明显优点是不依赖于比特时间T .当时钟像扩频时钟(SSC)那样进行频率调制时，这是不正确的。
对于给定的以时钟周期表示的数据转换间隔，数据转换间隔的最大峰峰值偏差就是抖动。它只是过渡间隔的函数，而不是任何特定过渡的位置。这个抖动定义表达了数据过渡时间的极端分离。


